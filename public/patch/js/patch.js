(()=>{var ce={};(()=>{ce.d=(e,t)=>{for(var i in t){if(ce.o(t,i)&&!ce.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{ce.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{ce.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var fe={};(()=>{"use strict";ce.r(fe);ce.d(fe,{Anim:()=>h,AnimKey:()=>l,CONSTANTS:()=>c,EMBED:()=>L,Link:()=>I,LoadingStatus:()=>D,Op:()=>M,Patch:()=>w,PatchVariable:()=>ie,Port:()=>B,Profiler:()=>se,RenderLoop:()=>le,Timer:()=>y,default:()=>he,now:()=>O,utils:()=>e});var e={};ce.r(e);ce.d(e,{ajax:()=>T,basename:()=>x,cacheBust:()=>A,clamp:()=>E,cleanJson:()=>d,copyArray:()=>C,escapeHTML:()=>te,filename:()=>Z,float32Concat:()=>Y,generateUUID:()=>o,getShortOpName:()=>i,isNumeric:()=>f,logErrorConsole:()=>K,logStack:()=>X,map:()=>F,prefixedHash:()=>m,request:()=>q,shortId:()=>b,shuffleArray:()=>n,simpleId:()=>p,smoothStep:()=>_,smootherStep:()=>v,uniqueArray:()=>Q,uuid:()=>s});class R{constructor(e,t,i,n){this.targetObj=e;this.id=t;this.eventName=i;this.cb=n}remove(){this.targetObj.off(this.id)}}class P{constructor(){this._simpleIdCounter=0}uuid(){let i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e==="x"?t:t&3|8).toString(16)})}isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}simpleId(){this._simpleIdCounter++;return this._simpleIdCounter}pathLookup(e,t){const i=t.split(".");if(i.length==1){return e[i[0]]}return this.pathLookup(e[i[0]],i.slice(1).join("."))}}const a=new P;class u{constructor(e,t){this.initiator=e;this._options=t;if(!this.initiator){console.error("no log initator given");CABLES.logStack()}}stack(e){console.info("["+this.initiator+"] ",e);console.log((new Error).stack)}groupCollapsed(e){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments);console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)||!CABLES.UI){console.error("["+this.initiator+"]",...arguments)}if(this._options&&this._options.onError){this._options.onError(this.initiator,...arguments)}}errorGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)}warn(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:1},...arguments))console.warn("["+this.initiator+"]",...arguments)}verbose(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}info(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.info("["+this.initiator+"]",...arguments)}log(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}logGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)}userInteraction(e){}}class t{#eventLog=new u("eventtarget");#listeners={};#logEvents=false;#logName="";#eventCallbacks={};#countErrorUnknowns=0;eventsPaused=false;constructor(){}on(e,t,i=""){const n=(i||"")+a.simpleId();const r=new R(this,n,e,t);if(!this.#eventCallbacks[e])this.#eventCallbacks[e]=[r];else this.#eventCallbacks[e].push(r);this.#listeners[r.id]=r;return r}removeAllEventListeners(){for(const e in this.#listeners){this.off(this.#listeners[e])}}addEventListener(e,t,i=""){return this.on(e,t,i)}hasEventListener(e,t=null){if(e&&!t){if(typeof e=="string")return!!this.#listeners[e];else return!!this.#listeners[e.id]}else{this.#eventLog.warn("old eventtarget function haseventlistener!");if(e&&t){if(this.#eventCallbacks[e]){const i=this.#eventCallbacks[e].indexOf(t);return i!==-1}}}}hasListenerForEventName(e){return this.#eventCallbacks[e]&&this.#eventCallbacks[e].length>0}removeEventListener(e){return this.off(e)}off(e){if(e===null||e===undefined){this.#eventLog.warn("removeEventListener id null",e);return}let i=e;if(e.eventName)i=e.id;if(typeof i!="string"){console.log("old function signature: removeEventListener! use listener id");return}const n=this.#listeners[i];if(!n){if(this.#countErrorUnknowns==20)this.#eventLog.warn("stopped reporting unknown events");if(this.#countErrorUnknowns<20)this.#eventLog.warn("could not find event...",i,n);this.#countErrorUnknowns++;return}let r=0;let a=true;while(a){a=false;let t=-1;for(let e=0;e<this.#eventCallbacks[n.eventName].length;e++){if(this.#eventCallbacks[n.eventName][e].id.indexOf(i)===0){a=true;t=e}}if(t!==-1){this.#eventCallbacks[n.eventName].splice(t,1);delete this.#listeners[i];r++}}if(r==0)console.log("no events removed",n.eventName,i);return}logEvents(e,t){this.#logEvents=e;this.#logName=t}emitEvent(t,i=null,n=null,r=null,a=null,s=null,o=null,l=null,u=null){if(this.eventsPaused)return;if(this.#logEvents)this.#eventLog.log("[event] ",this.#logName,t,this.#eventCallbacks);if(this.#eventCallbacks[t]){for(let e=0;e<this.#eventCallbacks[t].length;e++){if(this.#eventCallbacks[t][e]){this.#eventCallbacks[t][e].cb(i,n,r,a,s,o,l,u)}}}else{if(this.#logEvents)this.#eventLog.log("[event] has no event callback",t,this.#eventCallbacks)}}}class l{anim=null;id=CABLES.simpleId();time=0;value=0;onChange=null;_easing=0;bezCp1=null;bezCp2=null;bezAn=null;cb=null;cbTriggered=false;temp={};uiAttribs={};clip=null;clipId=null;constructor(e,t){this.anim=e.anim||t||null;this.setEasing(h.EASING_LINEAR);this.set(e)}setClip(e,t){this.clipId=e;this.clip=t;if(this.anim)this.anim.emitEvent(h.EVENT_CHANGE)}emitChange(){if(this.anim.batchMode)return;if(!this.anim)return;this.bezAn=null;if(this.onChange!==null)this.onChange();this.anim.forceChangeCallbackSoon();for(let e=0;e<this.anim.keys.length;e++)this.anim.keys[e].bezAn=null}delete(){if(this.anim)this.anim.remove(this);else console.log("animkey without anim...")}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}if(this.anim)this.anim.emitEvent(h.EVENT_CHANGE)}setEasing(e){if(this.anim.uiAttribs.readOnly)return;if(this.anim.uiAttribs.muted)return;let t=false;if(this._easing!=e)t=true;this._easing=e;if(this._easing!=h.EASING_CLIP){this.clipId="";this.clip=null}if(this._easing==h.EASING_LINEAR)this.ease=this.easeLinear;else if(this._easing==h.EASING_ABSOLUTE)this.ease=this.easeAbsolute;else if(this._easing==h.EASING_SMOOTHSTEP)this.ease=l.easeSmoothStep;else if(this._easing==h.EASING_SMOOTHERSTEP)this.ease=l.easeSmootherStep;else if(this._easing==h.EASING_CUBIC_IN)this.ease=l.easeCubicIn;else if(this._easing==h.EASING_CUBIC_OUT)this.ease=l.easeCubicOut;else if(this._easing==h.EASING_CUBIC_INOUT)this.ease=l.easeCubicInOut;else if(this._easing==h.EASING_EXPO_IN)this.ease=l.easeExpoIn;else if(this._easing==h.EASING_EXPO_OUT)this.ease=l.easeExpoOut;else if(this._easing==h.EASING_EXPO_INOUT)this.ease=l.easeExpoInOut;else if(this._easing==h.EASING_SIN_IN)this.ease=l.easeSinIn;else if(this._easing==h.EASING_SIN_OUT)this.ease=l.easeSinOut;else if(this._easing==h.EASING_SIN_INOUT)this.ease=l.easeSinInOut;else if(this._easing==h.EASING_BACK_OUT)this.ease=l.easeOutBack;else if(this._easing==h.EASING_BACK_IN)this.ease=l.easeInBack;else if(this._easing==h.EASING_BACK_INOUT)this.ease=l.easeInOutBack;else if(this._easing==h.EASING_ELASTIC_IN)this.ease=l.easeInElastic;else if(this._easing==h.EASING_ELASTIC_OUT)this.ease=l.easeOutElastic;else if(this._easing==h.EASING_BOUNCE_IN)this.ease=l.easeInBounce;else if(this._easing==h.EASING_BOUNCE_OUT)this.ease=l.easeOutBounce;else if(this._easing==h.EASING_QUART_OUT)this.ease=l.easeOutQuart;else if(this._easing==h.EASING_QUART_IN)this.ease=l.easeInQuart;else if(this._easing==h.EASING_QUART_INOUT)this.ease=l.easeInOutQuart;else if(this._easing==h.EASING_QUINT_OUT)this.ease=l.easeOutQuint;else if(this._easing==h.EASING_QUINT_IN)this.ease=l.easeInQuint;else if(this._easing==h.EASING_QUINT_INOUT)this.ease=l.easeInOutQuint;else if(this._easing==h.EASING_CLIP)this.ease=this.easeAbsolute;else if(this._easing==h.EASING_CUBICSPLINE){if(this.ease!=this.easeCubicSpline){this.ease=this.easeCubicSpline;this.bezReset()}this.bezAn=null}else{this._easing=h.EASING_LINEAR;this.ease=this.easeLinear}if(t)this.emitChange()}bezReset(){let e=.5;const t=this.anim.getPrevKey(this.time);if(t)e=(this.time-t.time)/2;let i=.5;const n=this.anim.getNextKey(this.time);if(n)i=(n.time-this.time)/2;this.bezCp1=[-Math.min(e,i),0];this.bezCp2=[Math.min(e,i),0];this.emitChange()}trigger(){this.cb();this.cbTriggered=true}setValue(e){this.value=e;this.emitChange()}setBezCp1(e,t){this.bezCp1=[e,t];this.emitChange()}setBezCp2(e,t){this.bezCp2=[e,t];this.emitChange()}set(e){if(e){if(e.hasOwnProperty("e"))this.setEasing(e.e);if(e.cb){this.cb=e.cb;this.cbTriggered=false}if(e.hasOwnProperty("cp1")){this.bezCp1=e.cp1;this.bezCp2=e.cp2}if(e.hasOwnProperty("t"))this.time=e.t;if(e.hasOwnProperty("time"))this.time=e.time;if(e.hasOwnProperty("v"))this.value=e.v;else if(e.hasOwnProperty("value"))this.value=e.value;if(e.hasOwnProperty("uiAttribs"))this.setUiAttribs(e.uiAttribs);if(e.clipId)this.clipId=e.clipId}this.emitChange()}getSerialized(){const e={};e.t=this.time;e.v=this.value;e.e=this._easing;e.uiAttribs=this.uiAttribs;if(this.clipId)e.clipId=this.clipId;if(this._easing===h.EASING_CUBICSPLINE){e.cp1=this.bezCp1;e.cp2=this.bezCp2}return e}getEasing(){return this._easing}easeCubicSpline(e,t){if(!this.bezAn){const i=30;this.bezAn=new h;for(let e=0;e<=i+1;e++){const n=l.cubicSpline(e/i,this,t);this.bezAn.setValue(n[0],n[1])}}return this.bezAn.getValue(this.time+e*(t.time-this.time))}easeLinear(e,t){return l.linear(e,this,t)}easeAbsolute(){return this.value}}l.cubicSpline=function(e,t,i){const n=1-e;const r=n*n;const a=e*e;const s=r*n;const o=3*r*e;const l=3*n*a;const u=a*e;t.bezCp1=t.bezCp1||[-.5,0];t.bezCp2=t.bezCp2||[.5,0];i.bezCp1=i.bezCp1||[-.5,0];i.bezCp2=i.bezCp2||[.5,0];const h=Math.min(i.time,t.bezCp2[0]+t.time);const c=Math.max(t.time,i.bezCp1[0]+i.time);const f=s*t.time+o*h+l*c+u*i.time;const d=s*t.value+o*(t.bezCp2[1]+t.value)+l*(i.bezCp1[1]+i.value)+u*i.value;return[f,d]};l.linear=function(e,t,i){return t.value+(i.value-t.value)*e};const k=function(e){return e=2**(10*(e-1))};l.easeExpoIn=function(e,t){e=k(e);return l.linear(e,this,t)};const U=function(e){e=-(2**(-10*e))+1;return e};l.easeExpoOut=function(e,t){e=U(e);return l.linear(e,this,t)};const V=function(e){e*=2;if(e<1){e=.5*2**(10*(e-1))}else{e--;e=.5*(-(2**(-10*e))+2)}return e};l.easeExpoInOut=function(e,t){e=V(e);return l.linear(e,this,t)};l.easeSinIn=function(e,t){e=-1*Math.cos(e*Math.PI/2)+1;return l.linear(e,this,t)};l.easeSinOut=function(e,t){e=Math.sin(e*Math.PI/2);return l.linear(e,this,t)};l.easeSinInOut=function(e,t){e=-.5*(Math.cos(Math.PI*e)-1);return l.linear(e,this,t)};const G=function(e){e=e*e*e;return e};l.easeCubicIn=function(e,t){e=G(e);return l.linear(e,this,t)};l.easeInQuint=function(e,t){e=e*e*e*e*e;return l.linear(e,this,t)};l.easeOutQuint=function(e,t){e=(e-=1)*e*e*e*e+1;return l.linear(e,this,t)};l.easeInOutQuint=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e*e;else e=.5*((e-=2)*e*e*e*e+2);return l.linear(e,this,t)};l.easeInQuart=function(e,t){e=e*e*e*e;return l.linear(e,this,t)};l.easeOutQuart=function(e,t){e=-1*((e-=1)*e*e*e-1);return l.linear(e,this,t)};l.easeInOutQuart=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e;else e=-.5*((e-=2)*e*e*e-2);return l.linear(e,this,t)};l.bounce=function(e){if((e/=1)<1/2.75)e=7.5625*e*e;else if(e<2/2.75)e=7.5625*(e-=1.5/2.75)*e+.75;else if(e<2.5/2.75)e=7.5625*(e-=2.25/2.75)*e+.9375;else e=7.5625*(e-=2.625/2.75)*e+.984375;return e};l.easeInBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeOutBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeInElastic=function(e,t){let i=1.70158;let n=0;let r=1;const a=0;const s=1;const o=1;if(e===0)e=a;else if((e/=s)==1)e=a+o;else{if(!n)n=s*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=-(r*2**(10*(e-=1))*Math.sin((e*s-i)*(2*Math.PI)/n))+a}return l.linear(e,this,t)};l.easeOutElastic=function(e,t){let i=1.70158;let n=0;let r=1;const a=0;const s=1;const o=1;if(e===0)e=a;else if((e/=s)==1)e=a+o;else{if(!n)n=s*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=r*2**(-10*e)*Math.sin((e*s-i)*(2*Math.PI)/n)+o+a}return l.linear(e,this,t)};l.easeInBack=function(e,t){const i=1.70158;e=e*e*((i+1)*e-i);return l.linear(e,this,t)};l.easeOutBack=function(e,t){const i=1.70158;e=(e=e/1-1)*e*((i+1)*e+i)+1;return l.linear(e,this,t)};l.easeInOutBack=function(e,t){let i=1.70158;const n=1/2;if((e/=1/2)<1)e=n*(e*e*(((i*=1.525)+1)*e-i));else e=n*((e-=2)*e*(((i*=1.525)+1)*e+i)+2);return l.linear(e,this,t)};const j=function(e){e--;e=e*e*e+1;return e};l.easeCubicOut=function(e,t){e=j(e);return l.linear(e,this,t)};const z=function(e){e*=2;if(e<1)e=.5*e*e*e;else{e-=2;e=.5*(e*e*e+2)}return e};l.easeCubicInOut=function(e,t){e=z(e);return l.linear(e,this,t)};l.easeSmoothStep=function(e,t){const i=Math.max(0,Math.min(1,e));e=i*i*(3-2*i);return l.linear(e,this,t)};l.easeSmootherStep=function(e,t){const i=Math.max(0,Math.min(1,(e-0)/(1-0)));e=i*i*i*(i*(i*6-15)+10);return l.linear(e,this,t)};let H={};class h extends t{static EVENT_KEY_DELETE="keyDelete";static EVENT_CHANGE="onChange";static EVENT_UIATTRIB_CHANGE="uiattrchange";static LOOP_OFF=0;static LOOP_REPEAT=1;static LOOP_MIRROR=2;static LOOP_OFFSET=3;static EASING_LINEAR=0;static EASING_ABSOLUTE=1;static EASING_SMOOTHSTEP=2;static EASING_SMOOTHERSTEP=3;static EASING_CUBICSPLINE=4;static EASING_CUBIC_IN=5;static EASING_CUBIC_OUT=6;static EASING_CUBIC_INOUT=7;static EASING_EXPO_IN=8;static EASING_EXPO_OUT=9;static EASING_EXPO_INOUT=10;static EASING_SIN_IN=11;static EASING_SIN_OUT=12;static EASING_SIN_INOUT=13;static EASING_BACK_IN=14;static EASING_BACK_OUT=15;static EASING_BACK_INOUT=16;static EASING_ELASTIC_IN=17;static EASING_ELASTIC_OUT=18;static EASING_BOUNCE_IN=19;static EASING_BOUNCE_OUT=21;static EASING_QUART_IN=22;static EASING_QUART_OUT=23;static EASING_QUART_INOUT=24;static EASING_QUINT_IN=25;static EASING_QUINT_OUT=26;static EASING_QUINT_INOUT=27;static EASING_CLIP=28;static EASINGNAMES=["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out","Clip"];#tlActive=true;uiAttribs={};loop=0;onLooped=null;_timesLooped=0;#needsSort=false;_cachedIndex=0;port=null;keys=[];onChange=null;stayInTimeline=false;batchMode=false;#log=new u("Anim");constructor(e={}){super();e=e||{};this.id=s();this.name=e.name||null;this.defaultEasing=e.defaultEasing||h.EASING_LINEAR}forceChangeCallback(){if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}forceChangeCallbackSoon(){if(this.batchMode)return;if(!this.forcecbto)this.forcecbto=setTimeout(()=>{this.forceChangeCallback();this.forcecbto=null},50)}getLoop(){return this.loop}setLoop(e){if(e===false)e=0;if(e===true)e=1;this.loop=e;this.emitEvent(h.EVENT_CHANGE,this)}hasEnded(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return true;if(this.keys[this.keys.length-1].time<=e)return true;return false}hasStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return false;if(e>=this.keys[0].time)return true;return false}isRising(e){if(this.#needsSort)this.sortKeys();if(this.hasEnded(e))return false;const t=this.getKeyIndex(e);if(this.keys[t].value<this.keys[t+1].value)return true;return false}clearBefore(e){if(this.#needsSort)this.sortKeys();const t=this.getValue(e);const i=this.getKeyIndex(e);this.setValue(e,t);if(i>1){this.keys.splice(0,i);this.#needsSort=true}}clear(e){if(this.#needsSort)this.sortKeys();let t=0;if(e)t=this.getValue(e);for(let e=0;e<this.keys.length;e++)this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.length=0;if(e)this.setValue(e,t);this.#needsSort=true;if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}checkIsSorted(){let t=true;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e].time>this.keys[e+1].time){t=false;break}return t}sortKeys(){if(this.batchMode)return;if(!this.checkIsSorted()){this.keys.sort((e,t)=>{return e.time-t.time});this.#needsSort=false;this.emitEvent(h.EVENT_CHANGE)}}hasDuplicates(){const t={};let i=0;for(let e=0;e<this.keys.length;e++){t[this.keys[e].time]=1;i++}const e=Object.keys(t);if(e.length!=i){return true}return false}removeDuplicates(){if(this.hasDuplicates()){if(this.#needsSort)this.sortKeys();let t=0;while(this.hasDuplicates()){for(let e=0;e<this.keys.length-1;e++){if(this.keys[e].time==this.keys[e+1].time){const i=this.keys[e];this.keys.splice(e,1);this.emitEvent(h.EVENT_KEY_DELETE,i)}t++}}this.#needsSort=true}}getLengthLoop(){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return this.lastKey.time-this.firstKey.time}getLength(){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return 0;return this.lastKey.time}getKeyIndex(t){if(this.#needsSort)this.sortKeys();let i=0;let n=0;if(this._cachedIndex&&this.keys.length>this._cachedIndex&&t>=this.keys[this._cachedIndex].time)n=this._cachedIndex;for(let e=n;e<this.keys.length;e++){if(t>=this.keys[e].time)i=e;if(this.keys[e].time>t){if(t!=0)this._cachedIndex=i;return i}}return i}setValue(t,i,n=null){if(CABLES.UI&&CABLES.UI.showDevInfos)if(isNaN(i))CABLES.logStack();if(this.#needsSort)this.sortKeys();let r=null;if(!this.batchMode)if(this.keys.length==0||t<=this.lastKey.time)for(let e=0;e<this.keys.length;e++)if(this.keys[e].time==t){r=this.keys[e];this.keys[e].setValue(i);this.keys[e].cb=n;break}if(!r){r=new l({time:t,value:i,e:this.defaultEasing,cb:n,anim:this});this.keys.push(r)}if(!this.batchMode){if(this.onChange)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}return r}setKeyEasing(e,t){if(this.keys[e]){this.keys[e].setEasing(t);this.emitEvent(h.EVENT_CHANGE,this)}}deserialize(t,e,i){if(t.loop)this.loop=t.loop;if(t.tlActive)this.#tlActive=t.tlActive;if(t.height)this.uiAttribs.height=t.height;if(e){while(this.keys.length)this.keys[0].delete();this.keys.length=0}for(const n in t.keys){let e=new l(t.keys[n],this);this.keys.push(e);if(i)if(t.keys[n].clipId){i[t.keys[n].clipId]=i[t.keys[n].clipId]||[];if(i)i[t.keys[n].clipId].push(e)}}this.sortKeys()}getSerialized(){const t={};t.keys=[];t.loop=this.loop;if(this.#tlActive)t.tlActive=this.tlActive;if(this.uiAttribs.height)t.height=this.uiAttribs.height;for(let e=0;e<this.keys.length;e++)t.keys.push(this.keys[e].getSerialized());return t}getKey(e){if(this.#needsSort)this.sortKeys();const t=this.getKeyIndex(e);return this.keys[t]}getNextKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)+1;if(t>=this.keys.length)return null;return this.keys[t]}getPrevKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)-1;if(t<0)return null;return this.keys[t]}isFinished(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return true;return e>this.lastKey.time}isStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return false;return e>=this.firstKey.time}remove(t,i){for(let e=0;e<this.keys.length;e++){if(this.keys[e]==t){this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.splice(e,1);this.#needsSort=true;if(i===undefined){this.emitEvent(h.EVENT_CHANGE,this)}return}}}get lastKey(){if(this.#needsSort)this.sortKeys();return this.keys[this.keys.length-1]}get firstKey(){if(this.#needsSort)this.sortKeys();return this.keys[0]}getLoopIndex(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return(e-this.firstKey.time)/this.getLengthLoop()}getValue(e=0){let t=0;if(this.keys.length===0)return 0;if(this.#needsSort)this.sortKeys();if(!this.loop&&e>this.lastKey.time){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}if(e<this.firstKey.time)return this.keys[0].value;if(this.loop&&this.keys.length>1&&e>this.lastKey.time){const o=this.getLoopIndex(e);if(o>this._timesLooped){this._timesLooped++;if(this.onLooped)this.onLooped()}e=(e-this.firstKey.time)%this.getLengthLoop();if(this.loop==h.LOOP_REPEAT){}else if(this.loop==h.LOOP_MIRROR){if(Math.floor(o)%2==1)e=this.getLengthLoop()-e}else if(this.loop==h.LOOP_OFFSET){t=(this.lastKey.value-this.keys[0].value)*Math.floor(o)}e+=this.firstKey.time}const i=this.getKeyIndex(e);if(i>=this.keys.length-1){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}const n=i+1;const r=this.keys[i];const a=this.keys[n];if(r.cb&&!r.cbTriggered)r.trigger();if(!a)return-1;const s=(e-r.time)/(a.time-r.time);if(r.getEasing()==h.EASING_CLIP){if(!r.clip&&this.port){const l=this.port.op.patch;const u=l.getVar(r.clipId)?.getValue();if(u)r.clip=u}if(r.clip&&r.clip.getValue){return r.clip.getValue(s*r.clip.getLength())}else{this.#log.warn("no clip found")}}return r.ease(s,a)+t}addKey(e){if(e.time===undefined){this.#log.warn("key time undefined, ignoring!")}else{this.keys.push(e);if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}}sortSoon(){this.#needsSort=true}easingFromString(e){if(e=="linear")return h.EASING_LINEAR;if(e=="absolute")return h.EASING_ABSOLUTE;if(e=="smoothstep")return h.EASING_SMOOTHSTEP;if(e=="smootherstep")return h.EASING_SMOOTHERSTEP;if(e=="Cubic In")return h.EASING_CUBIC_IN;if(e=="Cubic Out")return h.EASING_CUBIC_OUT;if(e=="Cubic In Out")return h.EASING_CUBIC_INOUT;if(e=="Expo In")return h.EASING_EXPO_IN;if(e=="Expo Out")return h.EASING_EXPO_OUT;if(e=="Expo In Out")return h.EASING_EXPO_INOUT;if(e=="Sin In")return h.EASING_SIN_IN;if(e=="Sin Out")return h.EASING_SIN_OUT;if(e=="Sin In Out")return h.EASING_SIN_INOUT;if(e=="Back In")return h.EASING_BACK_IN;if(e=="Back Out")return h.EASING_BACK_OUT;if(e=="Back In Out")return h.EASING_BACK_INOUT;if(e=="Elastic In")return h.EASING_ELASTIC_IN;if(e=="Elastic Out")return h.EASING_ELASTIC_OUT;if(e=="Bounce In")return h.EASING_BOUNCE_IN;if(e=="Bounce Out")return h.EASING_BOUNCE_OUT;if(e=="Quart Out")return h.EASING_QUART_OUT;if(e=="Quart In")return h.EASING_QUART_IN;if(e=="Quart In Out")return h.EASING_QUART_INOUT;if(e=="Quint Out")return h.EASING_QUINT_OUT;if(e=="Quint In")return h.EASING_QUINT_IN;if(e=="Quint In Out")return h.EASING_QUINT_INOUT;this.#log.warn("unknown anim easing?",e)}createPort(e,t,i){const n=e.inDropDown(t,h.EASINGNAMES,"linear");n.set("linear");n.defaultValue=0;n.onChange=()=>{this.defaultEasing=this.easingFromString(n.get());this.emitEvent("onChangeDefaultEasing",this);if(i)i()};return n}get tlActive(){return this.#tlActive}set tlActive(e){if(CABLES.UI){this.#tlActive=e;window.gui.emitEvent("tlActiveChanged",this);this.forceChangeCallbackSoon()}}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}this.emitEvent(h.EVENT_UIATTRIB_CHANGE)}hasKeyframesBetween(t,i){for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>=t&&this.keys[e].time<=i)return true;return false}static initClipsFromVars(i){for(const t in i.missingClipAnims){const n=i.getVar(t);for(let e=0;e<i.missingClipAnims[t].length;e++){i.missingClipAnims[t].clip=n.getValue();delete i.missingClipAnims[t]}}}}const c={ANIM:{EASINGS:h.EASINGNAMES,EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27,EASING_CLIP:28},OP:{OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_NUMBER:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_TRIGGER:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},PORT:{PORT_DIR_IN:0,PORT_DIR_OUT:1},PACO:{PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15,PACO_OP_RELOAD:16}};Math.randomSeed=1;Math.setRandomSeed=function(e){Math.randomSeed=e*50728129;if(e!=0){Math.randomSeed=Math.seededRandom()*17624813;Math.randomSeed=Math.seededRandom()*9737333}};Math.seededRandom=function(e,t){if(Math.randomSeed===0)Math.randomSeed=Math.random()*999;e=e||1;t=t||0;Math.randomSeed=(Math.randomSeed*9301+49297)%233280;const i=Math.randomSeed/233280;return t+i*(e-t)};String.prototype.endl=function(){return this+"\n"};String.prototype.contains=function(e){console.warn("string.contains deprecated, use string.includes");console.log((new Error).stack);return this.includes(e)};function W(){}W();function Y(e,t){if(!(e instanceof Float32Array))e=new Float32Array(e);if(!(t instanceof Float32Array))t=new Float32Array(t);const i=new Float32Array(e.length+t.length);i.set(e);i.set(t,e.length);return i}const i=function(e){let t=e.split(".")[e.split(".").length-1];if(t.includes(c.OP.OP_VERSION_PREFIX)){const i=t.split(c.OP.OP_VERSION_PREFIX)[1];t=t.substring(0,t.length-(c.OP.OP_VERSION_PREFIX+i).length)}return t};const n=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1));const n=t[e];t[e]=t[i];t[i]=n}return t};const r={};const b=function(){let e=Math.random().toString(36).substr(2,9);if(r.hasOwnProperty(e))e=b();r[e]=true;return e};const s=a.uuid;const o=s;const f=a.isNumeric;function d(t){for(const e in t){if(t[e]&&typeof objValue==="object"&&t[e].constructor===Object)t[e]=d(t[e]);if(t[e]===null||t[e]===undefined)delete t[e];else if(Array.isArray(t[e])&&t[e].length==0)delete t[e]}return t}const m=function(i,e="id"){let n=0;if(i.length>0){for(let t=0;t<i.length;t++){let e=i.charCodeAt(t);n=(n<<5)-n+e;n&=n}}return e+""+n};let g=0;const p=function(){g++;return g};const _=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*(3-2*t);return e};const v=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*t*(t*(t*6-15)+10);return e};const E=function(e,t,i){return Math.min(Math.max(e,t),i)};const F=function(e,t,i,n,r,a=0,s=true){if(s){if(e>=i)return r;if(e<=t)return n}let o=false;const l=Math.min(t,i);const u=Math.max(t,i);if(l!=t)o=true;let h=false;const c=Math.min(n,r);const f=Math.max(n,r);if(c!=n)h=true;let d=0;let g=0;if(o)d=(u-e)*(f-c)/(u-l);else d=(e-l)*(f-c)/(u-l);if(h)g=f-d;else g=d+c;if(!a)return g;if(a==1){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*(3-2*e)*(r-n)}if(a==2){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*e*(e*(e*6-15)+10)*(r-n)}return g};const A=function(e=""){if(!e)return"";if(e.startsWith("data:"))return;if(e.includes("?"))e+="&";else e+="?";return e+"cache="+CABLES.uuid()};const C=function(t,i){if(!t)return null;i=i||[];i.length=t.length;for(let e=0;e<t.length;e++)i[e]=t[e];return i};const x=function(e){let t=CABLES.filename(e);const i=t.split(".");t=i[0];return t};const X=function(){console.log("logstack",(new Error).stack)};const Z=function(e){let t="";if(!e)return"";if(e.startsWith("data:")&&e.includes(":")){const i=e.split(",");return i[0]}let i=(e+"").split("/");if(i.length>0){const n=i[i.length-1];let e=n.split("?");t=e[0]}return t||""};function T(e,t,i,n,r,a,s={},o={}){const l={url:e,cb:t,method:i,data:n,contenttype:r,sync:false,jsonP:a,headers:s};if(o&&o.credentials)l.credentials=o.credentials;q(l)}function q(t){if(!t.hasOwnProperty("asynch"))t.asynch=true;let i;try{i=new XMLHttpRequest}catch(e){}i.onreadystatechange=function(){if(i.readyState!=4)return;if(t.cb){if(i.status==200||i.status==0)t.cb(false,i.responseText,i);else t.cb(true,i.responseText,i)}};try{i.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync)}catch(e){if(t.cb&&e)t.cb(true,e.msg,i)}if(typeof t.headers==="object"){if(t.headers){const n=Object.keys(t.headers);for(let e=0;e<n.length;e++){const r=n[e];const a=t.headers[r];i.setRequestHeader(r,a)}}}if(t.credentials&&t.credentials!=="omit"){i.withCredentials=true}try{if(!t.post&&!t.data){i.send()}else{i.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded");i.send(t.data||t.post)}}catch(e){if(t.cb)t.cb(true,e.msg,i)}}const K=function(e){CABLES.errorConsole=CABLES.errorConsole||{log:[]};CABLES.errorConsole.log.push({initiator:e,arguments:arguments});if(!CABLES.errorConsole.ele){const t=document.createElement("div");t.id="cablesErrorConsole";t.style.width="90%";t.style.height="300px";t.style.zIndex="9999999";t.style.display="inline-block";t.style.position="absolute";t.style.padding="10px";t.style.fontFamily="monospace";t.style.color="red";t.style.backgroundColor="#200";CABLES.errorConsole.ele=t;document.body.appendChild(t)}let n="ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";for(let i=0;i<CABLES.errorConsole.log.length;i++){n+=CABLES.errorConsole.log[i].initiator+" ";for(let e=1;e<CABLES.errorConsole.log[i].arguments.length;e++){if(e>2)n+=", ";let t=CABLES.errorConsole.log[i].arguments[e];if(t.constructor.name.indexOf("Error")>-1||t.constructor.name.indexOf("error")>-1){let e="Uncaught ErrorEvent ";if(t.message)e+=" message: "+t.message;n+=e}else if(typeof t=="string")n+=t;else if(typeof t=="number")n+=String(t)+" "}n+="<br/>"}CABLES.errorConsole.ele.innerHTML=n};function Q(i){const n={},r=[];for(let e=0,t=i.length;e<t;++e){if(!n.hasOwnProperty(i[e])){r.push(i[e]);n[i[e]]=1}}return r}const J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};const $=/[&<>"']/g;const ee=RegExp($.source);const te=function(e){return e&&ee.test(e)?e.replace($,function(e){return J[e]}):e||""};class B extends t{static DIR_IN=0;static DIR_OUT=1;static TYPE_VALUE=0;static TYPE_NUMBER=0;static TYPE_FUNCTION=1;static TYPE_TRIGGER=1;static TYPE_OBJECT=2;static TYPE_TEXTURE=2;static TYPE_ARRAY=3;static TYPE_DYNAMIC=4;static TYPE_STRING=5;static EVENT_UIATTRCHANGE="onUiAttrChange";static EVENT_VALUE_CHANGE="change";static EVENT_LINK_CHANGED="onLinkChanged";static EVENT_LINK_REMOVED="onLinkRemoved";#log=new u("core_port");#oldAnimVal=-5711;animMuted=false;lastAnimTime=0;#uiActiveState=true;#valueBeforeLink=null;#animated=false;#useVariableName=null;#op=null;constructor(e,t,i,n={}){super();this.data={};this.direction=B.DIR_IN;this.id=String(CABLES.simpleId());this.#op=e;this.links=[];this.value=0;this.name=t;this.type=i||B.TYPE_VALUE;this.uiAttribs=n||{};this.anim=null;this.defaultValue=null;this.ignoreValueSerialize=false;this.onLinkChanged=null;this.crashed=false;this.onValueChanged=null;this.onTriggered=null;this.changeAlways=false;this.forceRefChange=false;this.activityCounter=0;this.apf=0;this.activityCounterStartFrame=0;this.canLink=null;this.preserveLinks=null;this.indexPort=null}get parent(){this.#log.stack("use port.op, not .parent");return this.op}get title(){return this.uiAttribs.title||this.name}get op(){return this.#op}get val(){return this.get()}set val(e){this.setValue(e)}copyLinkedUiAttrib(e,t){if(!CABLES.UI)return;if(!this.isLinked())return;const i={};i[e]=this.links[0].getOtherPort(this).getUiAttrib(e);t.setUiAttribs(i)}getValueForDisplay(){let e=this.value;if(typeof this.value==="string"||this.value instanceof String){if(e.length>1e3){e=e.substring(0,999);e+="..."}if(this.uiAttribs&&this.uiAttribs.display=="boolnum"){e+=" - ";if(!this.value)e+="false";else e+="true"}e=e.replace(/[\u00A0-\u9999<>&]/g,function(e){return"&#"+e.charCodeAt(0)+";"});if(e.length>100)e=e.substring(0,100)}else{e=String(this.value)}return e}onAnimToggle(){}_onAnimToggle(){this.onAnimToggle()}remove(){this.removeLinks();this.#op.removePort(this)}setUiAttribs(e){let t=false;if(!this.uiAttribs)this.uiAttribs={};for(const i in e){if(e[i]===undefined){delete this.uiAttribs[i];continue}if(this.uiAttribs[i]!=e[i])t=true;this.uiAttribs[i]=e[i];if(i=="group"&&this.indexPort)this.indexPort.setUiAttribs({group:e[i]})}if(e.hasOwnProperty("expose"))this.#op.patch.emitEvent("subpatchExpose",this.#op.uiAttribs.subPatch);if(t)this.emitEvent(B.EVENT_UIATTRCHANGE,e,this)}getUiAttribs(){return this.uiAttribs}getUiAttrib(e){if(!this.uiAttribs||!this.uiAttribs.hasOwnProperty(e))return null;return this.uiAttribs[e]}get(){if(CABLES.UI&&this.#animated&&this.lastAnimTime==this.#op.patch.timer.getTime()&&!CABLES.UI.keyframeAutoCreate){return this.value}if(!this.animMuted&&this.#animated&&this.lastAnimFrame!=this.#op.patch.getFrameNum()){this.lastAnimTime=this.#op.patch.timer.getTime();this.lastAnimFrame=this.#op.patch.getFrameNum();let e=this.anim.getValue(this.#op.patch.timer.getTime());if(this.value!=e){this.value=e;this.#oldAnimVal=this.value;this.forceChange()}}return this.value}set(e){this.setValue(e)}setRef(e){this.forceRefChange=true;this.setValue(e)}setValue(t){if(t===undefined)t=null;if(CABLES.UI&&CABLES.UI.showDevInfos){CABLES.UI.countSetWarns=CABLES.UI.countSetWarns||0;if(CABLES.UI.countSetWarns<20&&this.direction==c.PORT.PORT_DIR_OUT&&this.type==B.TYPE_OBJECT&&t&&!this.forceRefChange){this.#log.warn("object port ["+this.name+"] uses .set ["+this.op.objName+"]");CABLES.UI.countSetWarns++}}if(this.#op.enabled&&!this.crashed){if(t!==this.value||this.changeAlways||this.type==B.TYPE_TEXTURE||this.type==B.TYPE_ARRAY){if(CABLES.UI&&this.#animated){CABLES.UI.PREVISKEYVAL=null;if(!CABLES.UI.keyframeAutoCreate)CABLES.UI.PREVISKEYVAL=t}if(CABLES.UI&&this.#animated&&CABLES.UI.keyframeAutoCreate){let e=this.#op.patch.timer.getTime();if(CABLES.UI&&CABLES.Patch.getGui().glTimeline)CABLES.Patch.getGui().glTimeline.createKey(this.anim,e,t);else this.anim.setValue(e,t)}else{try{this.value=t;this.forceChange()}catch(e){this.crashed=true;this.setValue=function(e){};this.onTriggered=function(){};this.#log.error("exception in ",this.#op);this.#log.error(e);this.#op.patch.emitEvent("exception",e,this.#op)}if(this.#op&&this.#op.patch&&this.#op.patch.isEditorMode()&&this.type==B.TYPE_TEXTURE)CABLES.Patch.getGui().texturePreview().updateTexturePort(this)}if(this.direction==c.PORT.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}}}updateAnim(){if(!this.#animated||this.animMuted)return;this.value=this.get();if(this.#oldAnimVal!=this.value||this.changeAlways){this.#oldAnimVal=this.value;this.forceChange()}this.#oldAnimVal=this.value}forceChange(){if(this.onValueChanged||this.onChange){}this._activity();this.emitEvent(B.EVENT_VALUE_CHANGE,this.value,this);if(this.onChange)this.onChange(this,this.value);else if(this.onValueChanged)this.onValueChanged(this,this.value)}getTypeString(){return B.getTypeString(this.type)}deSerializeSettings(e){if(!e)return;if(e.animated)this.setAnimated(e.animated);if(e.useVariable)this.setVariableName(e.useVariable);if(e.title)this.setUiAttribs({title:e.title});if(e.expose)this.setUiAttribs({expose:true});if(e.order)this.setUiAttribs({order:e.order});if(e.multiPortManual)this.setUiAttribs({multiPortManual:e.multiPortManual});if(e.multiPortNum)this.setUiAttribs({multiPortNum:e.multiPortNum});if(e.anim){if(!this.anim)this.anim=new h({name:"port "+this.name});this.#op.hasAnimPort=true;this.anim.port=this;this.anim.deserialize(e.anim,true,this.op.patch.clipAnims);this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.bindAnimListeners();this.anim.sortKeys()}}setInitialValue(e){if(this.op.preservedPortLinks[this.name]){for(let e=0;e<this.op.preservedPortLinks[this.name].length;e++){const t=this.op.preservedPortLinks[this.name][e];this.op.patch._addLink(t.objIn,t.objOut,t.portIn,t.portOut)}}if(this.op.preservedPortValues&&this.op.preservedPortValues.hasOwnProperty(this.name)&&this.op.preservedPortValues[this.name]!==undefined){this.set(this.op.preservedPortValues[this.name])}else if(e!==undefined)this.set(e);if(e!==undefined)this.defaultValue=e}getSerialized(){let t={name:this.getName()};if(!this.ignoreValueSerialize&&this.links.length===0){if(this.type==B.TYPE_OBJECT&&this.value&&this.value.tex){}else t.value=this.value}if(this.#useVariableName)t.useVariable=this.#useVariableName;if(this.#animated)t.animated=true;if(this.anim)t.anim=this.anim.getSerialized();if(this.uiAttribs.multiPortNum)t.multiPortNum=this.uiAttribs.multiPortNum;if(this.uiAttribs.multiPortManual)t.multiPortManual=this.uiAttribs.multiPortManual;if(this.uiAttribs.display=="file")t.display=this.uiAttribs.display;if(this.uiAttribs.expose){t.expose=true;if(this.uiAttribs.hasOwnProperty("order"))t.order=this.uiAttribs.order}if(this.uiAttribs.title)t.title=this.uiAttribs.title;if((this.preserveLinks||this.direction==c.PORT.PORT_DIR_OUT)&&this.links.length>0){t.links=[];for(const e in this.links){if(!this.links[e].ignoreInSerialize&&(this.links[e].portIn&&this.links[e].portOut))t.links.push(this.links[e].getSerialized())}}if(this.direction==B.DIR_IN&&this.links.length>0){for(const e in this.links){if(!this.links[e].portIn||!this.links[e].portOut)continue;const i=this.links[e].getOtherPort(this);if(i.op.isInBlueprint2&&this.op.isInBlueprint2){if(i.op.isInBlueprint2()&&!this.op.isInBlueprint2()){t.links=t.links||[];t.links.push(this.links[e].getSerialized())}}}}if(t.links&&t.links.length==0)delete t.links;if(this.type===B.TYPE_FUNCTION)delete t.value;if(this.type===B.TYPE_FUNCTION&&this.links.length==0)t=null;if(t&&Object.keys(t).length==1&&t.name)t=null;d(t);return t}shouldLink(e,t){return!!(e&&t)}removeLinks(){let e=0;while(this.links.length>0){e++;if(e>5e3){this.#log.warn("could not delete links... / infinite loop");this.links.length=0;break}this.links[0].remove()}}removeLink(t){for(let e=0;e<this.links.length;e++)if(this.links[e]==t)this.links.splice(e,1);if(this.direction==B.DIR_IN){if(this.type==B.TYPE_VALUE)this.setValue(this.#valueBeforeLink||0);else this.setValue(this.#valueBeforeLink||null)}if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(B.EVENT_LINK_CHANGED);this.emitEvent(B.EVENT_LINK_REMOVED);this.#op.emitEvent(B.EVENT_LINK_CHANGED)}catch(e){this.#log.error(e)}}getName(){return this.name}getTitle(){if(this.uiAttribs.title)return this.uiAttribs.title;return this.name}addLink(e){this.#valueBeforeLink=this.value;this.links.push(e);if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(B.EVENT_LINK_CHANGED);this.#op.emitEvent(B.EVENT_LINK_CHANGED)}catch(e){this.#log.error(e)}}getLinkTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]}removeLinkTo(t){for(const e in this.links){if(this.links[e].portIn==t||this.links[e].portOut==t){this.links[e].remove();if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(B.EVENT_LINK_CHANGED);this.emitEvent(B.EVENT_LINK_REMOVED);return}}}isLinkedTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return true;return false}_activity(){this.activityCounter++}trigger(){const t=this.links.length;this._activity();if(t===0)return;if(!this.#op.enabled)return;let i=null;try{for(let e=0;e<t;++e){if(this.links[e].portIn){i=this.links[e].portIn;i.op.patch.pushTriggerStack(i);if(!i._onTriggered){this.#log.log("no porttriggered?!",i,i._onTriggered)}else i._onTriggered();i.op.patch.popTriggerStack()}if(this.links[e])this.links[e].activity()}}catch(e){if(!i)return this.#log.error("unknown port error");i.op.enabled=false;i.op.setUiError("crash","op crashed, port exception "+i.name,3);if(this.#op.patch.isEditorMode()){if(i.op.onError)i.op.onError(e)}this.#log.error("exception in port: ",i.name,i.op.name,i.op.id);this.#log.error(e)}}call(){this.#log.warn("call deprecated - use trigger() ");this.trigger()}execute(){}setVariableName(e){this.#useVariableName=e;this.#op.patch.on("variableRename",(e,t)=>{if(e!=this.#useVariableName)return;this.#useVariableName=t})}getVariableName(){return this.#useVariableName}setVariable(e){this.setAnimated(false);const t={useVariable:false};if(this._variableIn&&this._varChangeListenerId){this._variableIn.off(this._varChangeListenerId);this._variableIn=null}if(e){this._variableIn=this.#op.patch.getVar(e);if(!this._variableIn){}else{if(this.type==B.TYPE_OBJECT){this._varChangeListenerId=this._variableIn.on("change",()=>{this.set(null);this.set(this._variableIn.getValue())})}else{this._varChangeListenerId=this._variableIn.on("change",this.set.bind(this))}this.set(this._variableIn.getValue())}this.#useVariableName=e;t.useVariable=true;t.variableName=this.#useVariableName}else{t.variableName=this.#useVariableName=null;t.useVariable=false}this.setUiAttribs(t);this.#op.patch.emitEvent("portSetVariable",this.#op,this,e)}_handleNoTriggerOpAnimUpdates(e){let t=false;if(!t){if(e)this._notriggerAnimUpdate=this.#op.patch.on("onRenderFrame",()=>{this.updateAnim()});else if(this._notriggerAnimUpdate)this._notriggerAnimUpdate=this.#op.patch.off(this._notriggerAnimUpdate)}}bindAnimListeners(){this.anim.on(h.EVENT_CHANGE,()=>{this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.updateAnimMaxTimeSoon()});this.anim.on(h.EVENT_KEY_DELETE,()=>{this.#op.patch.updateAnimMaxTimeSoon()})}setAnimated(e){let t=false;if(this.#animated!=e){this.#animated=e;this.#op.hasAnimPort=true;t=true}if(this.#animated&&!this.anim){this.anim=new h({name:"port "+this.name});this.bindAnimListeners()}if(this.#animated){let e=0;if(this.#op.patch.gui&&this.#op.patch.gui.glTimeline)e=this.#op.patch.timer.getTime();if(this.anim.keys.length==0)this.anim.setValue(e,this.value)}else{this.anim=null}this._handleNoTriggerOpAnimUpdates(e);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim);this.setUiAttribs({isAnimated:this.#animated});if(t)this._onAnimToggle()}toggleAnim(){this.setAnimated(!this.#animated);this.setUiAttribs({isAnimated:this.#animated});this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim)}getType(){return this.type}isLinked(){return this.links.length>0||this.#animated||this.#useVariableName!=null}isBoundToVar(){const e=this.#useVariableName!=null;this.uiAttribs.boundToVar=e;return e}isAnimated(){return this.#animated}isHidden(){return this.uiAttribs.hidePort}_onTriggered(e){this._activity();this.#op.updateAnims();if(this.#op.enabled&&this.onTriggered)this.onTriggered();if(this.#op.enabled)this.emitEvent("trigger",e)}onValueChange(e){this.onChange=e}hidePort(){}static portTypeNumberToString(e){if(e==B.TYPE_VALUE)return"value";if(e==B.TYPE_FUNCTION)return"function";if(e==B.TYPE_OBJECT)return"object";if(e==B.TYPE_ARRAY)return"array";if(e==B.TYPE_STRING)return"string";if(e==B.TYPE_DYNAMIC)return"dynamic";return"unknown"}static getTypeString(e){if(e==B.TYPE_VALUE)return"Number";if(e==B.TYPE_FUNCTION)return"Trigger";if(e==B.TYPE_OBJECT)return"Object";if(e==B.TYPE_DYNAMIC)return"Dynamic";if(e==B.TYPE_ARRAY)return"Array";if(e==B.TYPE_STRING)return"String";return"Unknown"}}class I extends t{#log=new u("link");constructor(e){super();this.id=CABLES.simpleId();this.portIn=null;this.portOut=null;this._patch=e;this.activityCounter=0;this.ignoreInSerialize=false}setValue(e){if(e===undefined)this._setValue();else this.portIn.set(e)}activity(){this.activityCounter++}_setValue(){if(!this.portOut){this.remove();return}const e=this.portOut.get();if(e==e){if(this.portIn.type!=B.TYPE_FUNCTION)this.activity();if(this.portIn.get()!==e){this.portIn.set(e)}else{if(this.portIn.changeAlways)this.portIn.set(e);if(this.portOut.forceRefChange)this.portIn.forceChange()}}}getOtherPort(e){if(e==this.portIn)return this.portOut;return this.portIn}remove(){if(this.portIn)this.portIn.removeLink(this);if(this.portOut)this.portOut.removeLink(this);if(this._patch){this._patch.emitEvent("onUnLink",this.portIn,this.portOut,this)}if(this.portIn&&(this.portIn.type==B.TYPE_OBJECT||this.portIn.type==B.TYPE_ARRAY)){this.portIn.set(null);if(this.portIn.links.length>0)this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())}if(this.portIn)this.portIn.op._checkLinksNeededToWork();if(this.portOut)this.portOut.op._checkLinksNeededToWork();this.portIn=null;this.portOut=null;this._patch=null}link(e,t){if(!I.canLink(e,t)){this.#log.warn("[core_link] cannot link ports!",e,t);return false}if(e.direction==B.DIR_IN){this.portIn=e;this.portOut=t}else{this.portIn=t;this.portOut=e}e.addLink(this);t.addLink(this);this.setValue();e.op._checkLinksNeededToWork();t.op._checkLinksNeededToWork()}getSerialized(){const e={};e.portIn=this.portIn.getName();e.portOut=this.portOut.getName();e.objIn=this.portIn.op.id;e.objOut=this.portOut.op.id;return e}static canLinkText(e,t){if(e.direction==t.direction){let e="(out)";if(t.direction==B.DIR_IN)e="(in)";return"can not link: same direction "+e}if(e.op==t.op)return"can not link: same op";if(e.type!=B.TYPE_DYNAMIC&&t.type!=B.TYPE_DYNAMIC){if(e.type!=t.type)return"can not link: different type"}if(CABLES.UI&&e.type==B.TYPE_OBJECT&&t.type==B.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType)if(e.uiAttribs.objType!=t.uiAttribs.objType)return"incompatible objects"}if(!e)return"can not link: port 1 invalid";if(!t)return"can not link: port 2 invalid";if(e.direction==B.DIR_IN&&e.isAnimated())return"can not link: is animated";if(t.direction==B.DIR_IN&&t.isAnimated())return"can not link: is animated";if(e.isLinkedTo(t))return"ports already linked";if(e.canLink&&!e.canLink(t)||t.canLink&&!t.canLink(e))return"Incompatible";return"can link"}static canLink(e,t){if(!e)return false;if(!t)return false;if(e.direction==B.DIR_IN&&e.isAnimated())return false;if(t.direction==B.DIR_IN&&t.isAnimated())return false;if(e.isHidden()||t.isHidden())return false;if(e.isLinkedTo(t))return false;if(e.direction==t.direction)return false;if(CABLES.UI&&e.type==B.TYPE_OBJECT&&t.type==B.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType){if(e.uiAttribs.objType.indexOf("sg_")==0&&t.uiAttribs.objType.indexOf("sg_")==0)return true;if(e.uiAttribs.objType!=t.uiAttribs.objType)return false}}if(e.type!=t.type&&(e.type!=B.TYPE_DYNAMIC&&t.type!=B.TYPE_DYNAMIC))return false;if(e.type==B.TYPE_DYNAMIC||t.type==B.TYPE_DYNAMIC)return true;if(e.op==t.op)return false;if(e.canLink&&!e.canLink(t))return false;if(t.canLink&&!t.canLink(e))return false;return true}}class D extends t{constructor(e){super();this._log=new u("LoadingStatus");this._loadingAssets={};this._cbFinished=[];this._assetTasks=[];this._percent=0;this._count=0;this._countFinished=0;this._order=0;this._startTime=0;this._patch=e;this._wasFinishedPrinted=false;this._loadingAssetTaskCb=false}setOnFinishedLoading(e){this._cbFinished.push(e)}getNumAssets(){return this._countFinished}getProgress(){return this._percent}checkStatus(){this._countFinished=0;this._count=0;for(const e in this._loadingAssets){this._count++;if(!this._loadingAssets[e].finished){this._countFinished++}}this._percent=(this._count-this._countFinished)/this._count;if(this._countFinished===0){for(let e=0;e<this._cbFinished.length;e++){if(this._cbFinished[e]){const t=this._cbFinished[e];setTimeout(()=>{t(this._patch);this.emitEvent("finishedAll")},100)}}if(!this._wasFinishedPrinted){this._wasFinishedPrinted=true;this.print()}this.emitEvent("finishedAll")}}getList(){let t=[];for(const e in this._loadingAssets){t.push(this._loadingAssets[e])}return t}getListJobs(){let t=[];for(const e in this._loadingAssets){if(!this._loadingAssets[e].finished)t.push(this._loadingAssets[e].name)}return t}print(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets){t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"])}this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s");this._log.table(t);this._log.groupEnd()}finished(e){const t=this._loadingAssets[e];if(t){if(t.finished)this._log.warn("loading job was already finished",t);if(t.op)t.op.setUiAttribs({loading:false});t.finished=true;t.timeEnd=Date.now()}this.checkStatus();this.emitEvent("finishedTask");return null}_startAssetTasks(){for(let e=0;e<this._assetTasks.length;e++)this._assetTasks[e]();this._assetTasks.length=0}addAssetLoadingTask(e){if(this._patch.isEditorMode()&&!CABLES.UI.loaded){this._assetTasks.push(e);if(!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this));this._loadingAssetTaskCb=true}else{e()}this.emitEvent("addAssetTask")}existByName(t){for(let e in this._loadingAssets){if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return true}}start(e,t,i){if(this._startTime==0)this._startTime=Date.now();const n=o();t=t||"unknown";if(t.length>100)t=t.substring(0,100);if(i)i.setUiAttrib({loading:true});this._loadingAssets[n]={id:n,op:i,type:e,name:t,finished:false,timeStart:Date.now(),order:this._order};this._order++;this.emitEvent("startTask");return n}}class ie extends t{#name;constructor(e,t,i){super();this.#name=e;this.type=i;this.setValue(t)}addListener(e){this.on("change",e,"var")}getValue(){return this._v}get name(){return this.#name}getName(){return this.#name}setValue(e){this._v=e;this.emitEvent("change",e,this)}}const S=function(){return window.performance.now()};const O=function(){return S()};class y extends t{static EVENT_PLAY_PAUSE="playPause";static EVENT_TIME_CHANGED="timeChange";#lastTime=0;#timeOffset=0;#currentTime=0;#paused=true;#delay=0;#timeStart=0;#ts;constructor(){super();this.#timeStart=0;this.overwriteTime=-1}#internalNow(){if(this.#ts)return this.#ts;return S()}#getTime(){this.#lastTime=(this.#internalNow()-this.#timeStart)/1e3;return this.#lastTime+this.#timeOffset}setDelay(e){this.#delay=e;this.emitEvent(y.EVENT_TIME_CHANGED)}isPlaying(){return!this.#paused}update(e){if(e)this.#ts=e;if(this.#paused)return;this.#currentTime=this.#getTime();return this.#currentTime}getMillis(){return this.get()*1e3}get(){return this.getTime()}getTime(){if(this.overwriteTime>=0)return this.overwriteTime-this.#delay;return this.#currentTime-this.#delay}togglePlay(){if(this.#paused)this.play();else this.pause()}setTime(e){if(isNaN(e)||e<0)e=0;this.#timeStart=this.#internalNow();this.#timeOffset=e;this.#currentTime=e;this.emitEvent(y.EVENT_TIME_CHANGED)}setOffset(e){if(this.#currentTime+e<0){this.#timeStart=this.#internalNow();this.#timeOffset=0;this.#currentTime=0}else{this.#timeOffset+=e;this.#currentTime=this.#lastTime+this.#timeOffset}this.emitEvent(y.EVENT_TIME_CHANGED)}play(){this.#timeStart=this.#internalNow();this.#paused=false;this.emitEvent(y.EVENT_PLAY_PAUSE)}pause(){this.#timeOffset=this.#currentTime;this.#paused=true;this.emitEvent(y.EVENT_PLAY_PAUSE)}static now(){return window.performance.now()}}class w extends t{static EVENT_OP_DELETED="onOpDelete";static EVENT_OP_ADDED="onOpAdd";static EVENT_PAUSE="pause";static EVENT_RESUME="resume";static EVENT_PATCHLOADEND="patchLoadEnd";static EVENT_VARIABLES_CHANGED="variablesChanged";static EVENT_RENDER_FRAME="onRenderFrame";static EVENT_RENDERED_ONE_FRAME="renderedOneFrame";static EVENT_LINK="onLink";static EVENT_VALUESSET="loadedValueSet";static EVENT_DISPOSE="dispose";static EVENT_ANIM_MAXTIME_CHANGE="animmaxtimechange";static EVENT_INIT_CGL="INIT_CGL";#log;#renderOneFrame=false;#initialDeserialize=true;ops=[];settings={};animMaxTime=0;missingClipAnims={};profiler=null;aborted=false;_crashedOps=[];animFrameOps=[];_animReq=null;_opIdCache={};_triggerStack=[];storeObjNames=false;_volumeListeners=[];namedTriggers={};_origData=null;tempData={};frameStore={};constructor(e){super();this.renderloop=null;this.config=e||{glCanvasResizeToWindow:false,prefixAssetPath:"",prefixJsPath:"",silent:true,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0};this.#log=new u("core_patch",{onError:e.onError});this.timer=new y;this.freeTimer=new y;this.gui=null;CABLES.logSilent=this.silent=true;this.loading=new D(this);if(!function(){return!this}())this.#log.warn("not in strict mode: core patch");if(this.config.hasOwnProperty("silent"))this.silent=CABLES.logSilent=this.config.silent;if(!this.config.hasOwnProperty("doRequestAnimation"))this.config.doRequestAnimation=true;if(!this.config.prefixAssetPath)this.config.prefixAssetPath="";if(!this.config.prefixJsPath)this.config.prefixJsPath="";if(!this.config.masterVolume)this.config.masterVolume=1;this._variables={};this.vars={};if(e&&e.vars)this.vars=e.vars;this.cgl=null;this.cgp=null;this._subpatchOpCache={};window.dispatchEvent(new CustomEvent(w.EVENT_INIT_CGL,{detail:this}));this.loading.setOnFinishedLoading(this.config.onFinishedLoading);if(!CABLES.OPS){this.aborted=true;throw new Error("no CABLES.OPS found")}this.freeTimer.play();if(this.config.patch){this.deSerialize(this.config.patch)}else if(this.config.patchFile){T(this.config.patchFile,(e,t)=>{try{const i=JSON.parse(t);if(e){const n="";this.#log.error("err",e);this.#log.error("data",i);this.#log.error("data",i.msg);return}this.deSerialize(i)}catch(e){this.#log.error("could not load/parse patch ",e)}})}this.timer.play();console.log("made with https://cables.gl");this.cg=undefined}static getGui(){return window.gui}isPlaying(){if(this.renderloop)return!this.renderloop.paused;return false}renderOneFrame(){}isEditorMode(){return this.config.editorMode===true}pause(){this.emitEvent(w.EVENT_PAUSE);if(this.renderloop)this.renderloop.pause();this.freeTimer.pause()}resume(){this.freeTimer.play();this.emitEvent(w.EVENT_RESUME);if(this.renderloop)this.renderloop.resume()}setVolume(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)}getAssetPath(t=null){if(this.config.hasOwnProperty("assetPath")){return this.config.assetPath}else if(this.isEditorMode()){let e=t||w.getGui().project()._id;return"/assets/"+e+"/"}else if(document.location.href.indexOf("cables.gl")>0||document.location.href.indexOf("cables.local")>0){const i=document.location.pathname.split("/");let e=t||i[i.length-1];return"/assets/"+e+"/"}else{return"assets/"}}getJsPath(){if(this.config.hasOwnProperty("jsPath")){return this.config.jsPath}else{return"js/"}}getFilePath(e){if(!e)return e;e=String(e);if(e.indexOf("https:")===0||e.indexOf("http:")===0)return e;if(e.indexOf("data:")===0)return e;if(e.indexOf("file:")===0)return e;e=e.replace("//","/");if(e.startsWith(this.config.prefixAssetPath))e=e.replace(this.config.prefixAssetPath,"");return this.config.prefixAssetPath+e+(this.config.suffixAssetPath||"")}clear(){this.emitEvent("patchClearStart");this.animFrameOps.length=0;this.timer=new y;while(this.ops.length>0)this.deleteOp(this.ops[0].id);this._opIdCache={};this.emitEvent("patchClearEnd")}createOp(e,t,i=null){let n=null;let r="";try{if(!e){console.error("createop identifier false",e);console.log((new Error).stack);return}if(e.indexOf("Ops.")===-1){const a=e;if(CABLES.OPS[a]){r=CABLES.OPS[a].objName;try{n=new CABLES.OPS[a].f(this,r,t,a)}catch(e){this._crashedOps.push(r);this.#log.error("[instancing error] constructor: "+r,e);if(!this.isEditorMode()){this.#log.error("INSTANCE_ERR","Instancing Error: "+r,e)}else{n=new CABLES.Op(this,r,t);n.setUiError("instancingError","Failed to instanciate op",3);n.setEnabled(false);if(this.#initialDeserialize)w.getGui().patchView.store.opCrashed=true}}n.opId=a}else{if(i){e=i;this.#log.warn("could not find op by id: "+a)}else{throw new Error("could not find op by id: "+a,{cause:"opId:"+a})}}}if(!n){r=e;const s=e.split(".");const o=w.getOpClass(r);if(!o){this.emitEvent("criticalError",{title:"Unknown op: "+r,text:"Unknown op: "+r});this.#log.error("unknown op: "+r);throw new Error("unknown op: "+r)}else{n=new o(this,r,t)}if(n){n.opId=null;for(const e in CABLES.OPS){if(CABLES.OPS[e].objName==r)n.opId=e}}}}catch(e){this._crashedOps.push(r);this.#log.error("[instancing error] "+r,e);if(!this.isEditorMode()){this.#log.error("INSTANCE_ERR","Instancing Error: "+r,e)}else{if(this.#initialDeserialize)w.getGui().patchView.store.opCrashed=true}}if(n){n._objName=r;n.patch=this}else{this.#log.log("no op was created!?",e,t)}return n}addOp(e,t,i,n=false,r=null){const a=this.createOp(e,i,r);if(a){t=t||{};if(t.hasOwnProperty("errors"))delete t.errors;if(t.hasOwnProperty("error"))delete t.error;t.subPatch=t.subPatch||0;a.setUiAttribs(t);if(a.onCreate)a.onCreate();if(a.hasOwnProperty("onAnimFrame")&&a.onAnimFrame)this.addOnAnimFrame(a);if(a.hasOwnProperty("onMasterVolumeChanged"))this._volumeListeners.push(a);if(this._opIdCache[a.id]){this.#log.warn("opid with id "+a.id+" already exists in patch!");this.deleteOp(a.id)}this.ops.push(a);this._opIdCache[a.id]=a;if(this._subPatchCacheAdd)this._subPatchCacheAdd(t.subPatch,a);this.emitEvent(w.EVENT_OP_ADDED,a,n);if(a.init)a.init();a.emitEvent(M.EVENT_INIT,n)}else{this.#log.error("addop: op could not be created: ",e)}return a}addOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t){return}this.animFrameOps.push(t)}removeOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++){if(this.animFrameOps[e]==t){this.animFrameOps.splice(e,1);return}}}addOnAnimFrameCallback(e){this.animFrameCallbacks.push(e)}removeOnAnimCallback(t){for(let e=0;e<this.animFrameCallbacks.length;e++){if(this.animFrameCallbacks[e]==t){this.animFrameCallbacks.splice(e,1);return}}}updateAnimMaxTimeSoon(){if(this.toAnimMaxTime)clearTimeout(this.toAnimMaxTime);this.toAnimMaxTime=setTimeout(()=>{this.updateAnimMaxTime()},50)}updateAnimMaxTime(){let i=0;for(let t=0;t<this.ops.length;t++){if(this.ops[t].hasAnimPort){for(let e=0;e<this.ops[t].portsIn.length;e++){if(this.ops[t].portsIn[e].anim){if(this.ops[t].portsIn[e].anim.lastKey&&this.ops[t].portsIn[e].anim.lastKey.time>i){i=this.ops[t].portsIn[e].anim.lastKey.time}}}}}if(i!=this.animMaxTime){this.animMaxTime=i;this.emitEvent(w.EVENT_ANIM_MAXTIME_CHANGE)}}deleteOp(n,r,a){let s=false;for(let i=0;i<this.ops.length;i++){if(this.ops[i].id==n){const o=this.ops[i];let e=null;let t=null;if(o){s=true;if(r){if(o.portsIn.length>0&&o.getFirstPortIn()&&o.getFirstPortIn().isLinked()&&(o.portsOut.length>0&&o.getFirstPortOut()&&o.getFirstPortOut().isLinked())){if(o.getFirstPortIn().getType()==o.getFirstPortOut().getType()&&o.getFirstPortIn().isLinked()){e=o.getFirstPortIn()?.links[0]?.getOtherPort(o.getFirstPortIn());t=o.getFirstPortOut()?.links[0]?.getOtherPort(o.getFirstPortOut())}}}const l=this.ops[i];l.removeLinks();this.ops.splice(i,1);l.emitEvent("delete",l);this.emitEvent(w.EVENT_OP_DELETED,l,a);if(this.clearSubPatchCache)this.clearSubPatchCache(l.uiAttribs.subPatch);if(l.onDelete)l.onDelete(a);l.cleanUp();if(e&&t&&e.op&&t.op){this.link(e.op,e.getName(),t.op,t.getName())}delete this._opIdCache[n];break}}}if(!s)this.#log.warn("core patch deleteop: not found...",n)}getFrameNum(){if(this.renderloop)return this.renderloop.frameNum}updateAnims(t,i,e){if(!this.renderloop)return;this.timer.update(e);this.freeTimer.update(e);t=t||this.timer.getTime();for(let e=0;e<this.animFrameOps.length;++e)if(this.animFrameOps[e].onAnimFrame)this.animFrameOps[e].onAnimFrame(t,this.renderloop.frameNum,i)}link(e,t,i,n,r=false,a=false){if(!e)return this.#log.warn("link: op1 is null ");if(!i)return this.#log.warn("link: op2 is null");const s=e.getPort(t,r);const o=i.getPort(n,r);if(!s)return this.#log.warn("port1 not found! "+t+" ("+e.objName+")");if(!o)return this.#log.warn("port2 not found! "+n+" of "+i.name+"("+i.objName+")",i);if(!s.shouldLink(s,o)||!o.shouldLink(s,o))return false;if(I.canLink(s,o)){const l=new I(this);if(s&&o)l.link(s,o);this.emitEvent(w.EVENT_LINK,s,o,l,a);return l}}serialize(e){const t={};e=e||{};t.ops=[];t.settings=this.settings;for(let e=0;e<this.ops.length;e++){const i=this.ops[e];if(i&&i.getSerialized)t.ops.push(i.getSerialized())}d(t);if(e.asObject)return t;return JSON.stringify(t)}getOpsByRefId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].storage&&this.ops[e].storage.ref==t)i.push(this.ops[e]);return i}getOpById(e){return this._opIdCache[e]}getOpsByObjName(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].objName==t)i.push(this.ops[e]);return i}getOpsByOpId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].opId==t)i.push(this.ops[e]);return i}getSubPatchOpsByName(t,i){const n=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)n.push(this.ops[e]);return n}getSubPatchOp(e,t){return this.getFirstSubPatchOpByName(e,t)}getFirstSubPatchOpByName(t,i){for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)return this.ops[e];return null}_addLink(e,t,i,n){return this.link(this.getOpById(e),i,this.getOpById(t),n,false,true)}logStartup(e){if(window.logStartup)window.logStartup(e)}deSerialize(s,e={genIds:false,createRef:false}){if(this.aborted)return;const n=[];const t=this.loading.start("core","deserialize");if(typeof s==="string")s=JSON.parse(s);if(this.#initialDeserialize){this.namespace=s.namespace||"";this.name=s.name||"";this.settings=s.settings}this.emitEvent("patchLoadStart");s.ops=s.ops||[];this.logStartup("add "+s.ops.length+" ops... ");const r=[];for(let i=0;i<s.ops.length;i++){const a=CABLES.now();const o=s.ops[i];let t=null;try{if(o.opId)t=this.addOp(o.opId,o.uiAttribs,o.id,true,o.objName);else t=this.addOp(o.objName,o.uiAttribs,o.id,true)}catch(e){this.#log.error("[instancing error] op data:",o,e)}if(t){r.push(t);if(e.genIds)t.id=b();t.portsInData=o.portsIn;t._origData=structuredClone(o);t.storage=o.storage;if(o.portsIn)for(let e=0;e<o.portsIn.length;e++){const u=o.portsIn[e];if(u&&u.hasOwnProperty("name")){const h=t.getPort(u.name);if(h&&(h.uiAttribs.display=="bool"||h.uiAttribs.type=="bool")&&!isNaN(u.value))u.value=u.value==true?1:0;if(h&&u.value!==undefined&&h.type!=B.TYPE_TEXTURE)h.set(u.value);if(h){h.deSerializeSettings(u)}else{t.preservedPortValues=t.preservedPortValues||{};t.preservedPortValues[u.name]=u.value}}}if(o.portsOut)for(let e=0;e<o.portsOut.length;e++){const u=o.portsOut[e];if(u&&u.hasOwnProperty("name")){const c=t.getPort(u.name);if(c){c.deSerializeSettings(u);if(c.uiAttribs.hasOwnProperty("title")){t.preservedPortTitles=t.preservedPortTitles||{};t.preservedPortTitles[c.name]=c.uiAttribs.title}if(c.type!=B.TYPE_TEXTURE&&u.hasOwnProperty("value"))c.set(s.ops[i].portsOut[e].value);if(u.expose)c.setUiAttribs({expose:true})}}}n.push(t)}const l=Math.round(100*(CABLES.now()-a))/100;if(!this.silent&&l>5)console.log("long op init ",s.ops[i].objName,l)}this.logStartup("add ops done");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoadedValueSet){this.ops[e].onLoadedValueSet(this.ops[e]._origData);this.ops[e].onLoadedValueSet=null;this.ops[e]._origData=null}this.ops[e].emitEvent(w.EVENT_VALUESSET)}this.logStartup("creating links");if(e.opsCreated)e.opsCreated(r);if(s.ops){for(let a=0;a<s.ops.length;a++){if(s.ops[a].portsIn){for(let t=0;t<s.ops[a].portsIn.length;t++){if(s.ops[a].portsIn[t]&&s.ops[a].portsIn[t].links){for(let e=0;e<s.ops[a].portsIn[t].links.length;e++){this._addLink(s.ops[a].portsIn[t].links[e].objIn,s.ops[a].portsIn[t].links[e].objOut,s.ops[a].portsIn[t].links[e].portIn,s.ops[a].portsIn[t].links[e].portOut)}}}}if(s.ops[a].portsOut)for(let r=0;r<s.ops[a].portsOut.length;r++)if(s.ops[a].portsOut[r]&&s.ops[a].portsOut[r].links){for(let n=0;n<s.ops[a].portsOut[r].links.length;n++){if(s.ops[a].portsOut[r].links[n]){if(s.ops[a].portsOut[r].links[n].subOpRef){const f=this.getOpById(s.ops[a].portsOut[r].links[n].objOut);let t=null;let i=0;for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==s.ops[a].portsOut[r].links[n].subOpRef&&f.uiAttribs.subPatch==this.ops[e].uiAttribs.subPatch){i=this.ops[e].patchId.get();break}}for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==s.ops[a].portsOut[r].links[n].refOp&&this.ops[e].uiAttribs.subPatch==i){t=this.ops[e];break}}if(!t)this.#log.warn("could not find op for lost link");else{this._addLink(t.id,s.ops[a].portsOut[r].links[n].objOut,s.ops[a].portsOut[r].links[n].portIn,s.ops[a].portsOut[r].links[n].portOut)}}else{const i=this._addLink(s.ops[a].portsOut[r].links[n].objIn,s.ops[a].portsOut[r].links[n].objOut,s.ops[a].portsOut[r].links[n].portIn,s.ops[a].portsOut[r].links[n].portOut);if(!i){const d=this.getOpById(s.ops[a].portsOut[r].links[n].objIn);const g=this.getOpById(s.ops[a].portsOut[r].links[n].objOut);if(!d)console.log("could not find link op1");if(!g)console.log("could not find link op2");const p=s.ops[a].portsOut[r].links[n].portIn;if(d&&!d.getPort(p)){d.preservedPortLinks[p]=d.preservedPortLinks[p]||[];d.preservedPortLinks[p].push(s.ops[a].portsOut[r].links[n])}const m=s.ops[a].portsOut[r].links[n].portOut;if(g&&!g.getPort(m)){g.preservedPortLinks[p]=g.preservedPortLinks[p]||[];g.preservedPortLinks[p].push(s.ops[a].portsOut[r].links[n])}}}}}}}}this.logStartup("calling ops onloaded");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoaded){this.ops[e].onLoaded();this.ops[e].onLoaded=null}}this.logStartup("initializing ops...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].init){try{this.ops[e].init();this.ops[e].init=null}catch(e){console.error("op.init crash",e)}}}this.logStartup("initializing vars...");if(this.config.variables)for(const _ in this.config.variables)this.setVarValue(_,this.config.variables[_]);this.logStartup("initializing var ports");for(let e=0;e<this.ops.length;e++){this.ops[e].initVarPorts();delete this.ops[e].uiAttribs.pasted}setTimeout(()=>{this.loading.finished(t)},100);this.updateAnimMaxTime();if(this.config.onPatchLoaded)this.config.onPatchLoaded(this);this.emitEvent(w.EVENT_PATCHLOADEND,n,s,e.genIds);this.#initialDeserialize=false}setVariable(e,t){if(this._variables[e]!==undefined){this._variables[e].setValue(t)}else{this.#log.warn("variable "+e+" not found!")}}_sortVars(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((e,t)=>{return e.localeCompare(t,"en",{sensitivity:"base"})}).forEach(e=>{t[e]=this._variables[e]});this._variables=t}hasVar(e){return this._variables[e]!==undefined}setVarValue(e,t,i){if(this.hasVar(e)){this._variables[e].setValue(t)}else{this._variables[e]=new ie(e,t,i);this._sortVars();this.emitEvent(w.EVENT_VARIABLES_CHANGED)}return this._variables[e]}getVarValue(e,t){if(this._variables.hasOwnProperty(e))return this._variables[e].getValue()}getVar(e){if(this._variables.hasOwnProperty(e))return this._variables[e]}deleteVar(i){for(let t=0;t<this.ops.length;t++)for(let e=0;e<this.ops[t].portsIn.length;e++)if(this.ops[t].portsIn[e].getVariableName()==i)this.ops[t].portsIn[e].setVariable(null);delete this._variables[i];this.emitEvent("variableDeleted",i);this.emitEvent("variablesChanged")}getVars(t){if(t===undefined)return this._variables;if(t===1)return{};const i=[];let n="";if(t==B.TYPE_STRING)n="string";else if(t==B.TYPE_VALUE)n="number";else if(t==B.TYPE_ARRAY)n="array";else if(t==B.TYPE_OBJECT)n="object";else if(t==B.TYPE_DYNAMIC)n="dynamic";else{console.log("unknown port type",t);console.log((new Error).stack)}for(const e in this._variables){if(!this._variables[e].type||this._variables[e].type==n||this._variables[e].type==t)i.push(this._variables[e])}return i}preRenderOps(){this.#log.log("prerendering...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].preRender){this.ops[e].preRender();this.#log.log("prerender "+this.ops[e].objName)}}}dispose(){this.pause();this.clear();this.emitEvent(w.EVENT_DISPOSE)}pushTriggerStack(e){this._triggerStack.push(e)}popTriggerStack(){this._triggerStack.pop()}printTriggerStack(){if(this._triggerStack.length==0){return}console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].op.objName+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++){t.push(e+". "+this._triggerStack[e].op.objName+" "+this._triggerStack[e].name)}console.table(t);console.groupEnd()}get containerElement(){if(this.config.containerElement)return this.config.containerElement;if(this.cg&&this.cg.canvas.parentElement)return this.cg.canvas.parentElement;if(this.cgl&&this.cgl.canvas.parentElement)return this.cgl.canvas.parentElement;return document.body}getDocument(){return this.containerElement.ownerDocument}static getOpClass(e){const t=e.split(".");let i=null;try{if(t.length==2)i=window[t[0]][t[1]];else if(t.length==3)i=window[t[0]][t[1]][t[2]];else if(t.length==4)i=window[t[0]][t[1]][t[2]][t[3]];else if(t.length==5)i=window[t[0]][t[1]][t[2]][t[3]][t[4]];else if(t.length==6)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]];else if(t.length==7)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]];else if(t.length==8)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]];else if(t.length==9)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]];else if(t.length==10)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]][t[9]];return i}catch(e){return null}}static replaceOpIds(n,r){const t={};for(const e in n.ops){t[n.ops[e].id]=n.ops[e]}for(const i in n.ops){for(const o in n.ops[i].portsOut){const l=n.ops[i].portsOut[o].links;if(l){let e=l.length;while(e--){if(l[e]&&(!t[l[e].objIn]||!t[l[e].objOut])){if(!r.doNotUnlinkLostLinks){l.splice(e,1)}else{if(r.fixLostLinks){const u=w.getGui().corePatch().getOpById(l[e].objIn);if(!u)console.log("op not found!");else{const h=w.getGui().patchView.getSubPatchOuterOp(u.uiAttribs.subPatch);if(h){u.storage=u.storage||{};u.storage.ref=u.storage.ref||b();l[e].refOp=u.storage.ref;l[e].subOpRef=h.storage.ref}}}}}}}}}for(const t in n.ops){const u=n.ops[t];const c=u.id;let e=b();if(r.prefixHash)e=m(r.prefixHash+c);else if(r.prefixId)e=r.prefixId+c;else if(r.refAsId){if(u.storage&&u.storage.ref){e=u.storage.ref;delete u.storage.ref}else{u.storage=u.storage||{};u.storage.ref=e=b()}}const f=u.id=e;if(r.oldIdAsRef){u.storage=u.storage||{};u.storage.ref=c}for(const i in n.ops){if(n.ops[i].portsIn)for(const o in n.ops[i].portsIn){if(n.ops[i].portsIn[o].links){let e=n.ops[i].portsIn[o].links.length;while(e--)if(n.ops[i].portsIn[o].links[e]===null)n.ops[i].portsIn[o].links.splice(e,1);for(e in n.ops[i].portsIn[o].links){if(n.ops[i].portsIn[o].links[e].objIn===c)n.ops[i].portsIn[o].links[e].objIn=f;if(n.ops[i].portsIn[o].links[e].objOut===c)n.ops[i].portsIn[o].links[e].objOut=f}}}if(n.ops[i].portsOut)for(const o in n.ops[i].portsOut){if(n.ops[i].portsOut[o].links){let e=n.ops[i].portsOut[o].links.length;while(e--)if(n.ops[i].portsOut[o].links[e]===null)n.ops[i].portsOut[o].links.splice(e,1);for(e in n.ops[i].portsOut[o].links){if(n.ops[i].portsOut[o].links[e].objIn===c)n.ops[i].portsOut[o].links[e].objIn=f;if(n.ops[i].portsOut[o].links[e].objOut===c)n.ops[i].portsOut[o].links[e].objOut=f}}}}}const a=[];const s=[];for(let i=0;i<n.ops.length;i++){if(n.ops[i].storage&&n.ops[i].storage.subPatchVer){for(let t=0;t<n.ops[i].portsIn.length;t++){if(n.ops[i].portsIn[t].name==="patchId"){let e=b();if(r.prefixHash)e=m(r.prefixHash+n.ops[i].portsIn[t].value);const d=n.ops[i].portsIn[t].value;const g=n.ops[i].portsIn[t].value=e;a.push(g);for(let e=0;e<n.ops.length;e++){if(n.ops[e].uiAttribs){if(n.ops[e].uiAttribs.subPatch===d){n.ops[e].uiAttribs.subPatch=g;s.push(n.ops[e].id)}}}}}}}for(const p in n.ops){let t=false;for(let e=0;e<s.length;e++){if(n.ops[p].id===s[e]){t=true;break}}if(!t&&n.ops[p].uiAttribs&&r.parentSubPatchId!=null)n.ops[p].uiAttribs.subPatch=r.parentSubPatchId}return n}}class ne extends B{constructor(e,t,i,n,r){super(e,t,i,n);this.get=()=>{let e=super.get();if(CABLES.UI){if(e===""||e===null||e===undefined||n.values&&n.values.indexOf(String(e))===-1){this.op.setUiError("invalidswitch","Invalid Value ["+this.name+']: "'+e+'"',1)}else this.op.setUiError("invalidswitch",null)}if(e===null||e===undefined)e="";return e};this.indexPort=r;this.indexPort.set=e=>{const t=n.values;if(!t){return}let i=Math.floor(e);i=Math.min(i,t.length-1);i=Math.max(i,0);this.indexPort.setValue(i);this.set(t[i]);if(this.op.patch.isEditorMode()&&performance.now()-(this.lastTime||0)>100&&w.getGui()&&w.getGui().patchView.isCurrentOp(this.op)){w.getGui().opParams.show(this.op);this.lastTime=performance.now()}}}setUiAttribs(e){const t=e.hidePort;e.hidePort=true;super.setUiAttribs(e);if(typeof t!=="undefined")this.indexPort.setUiAttribs({hidePort:t})}}const N=2;class re extends B{constructor(e,i,n,r,t,a){super(e,i,B.TYPE_ARRAY,t);this._log=new u("multiport old");this.setUiAttribs({multiPort:true,group:this.name,order:-1});this.ports=[];this.direction=r;this._uiAttribsPorts=a;const s=()=>{const t=[];let i=1;if(this.uiAttribs.multiPortManual)i=0;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let a=!this.uiAttribs.multiPortManual||false;if(this.direction==c.PORT.PORT_DIR_OUT)a=false;for(let r=0;r<this.ports.length;r++){let e;let t=false;let i;let n={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[r].name])i=this.op.preservedPortTitles[this.ports[r].name];if(r==0)e=this.ports.length;if(!this.uiAttribs.multiPortManual)if(r==this.ports.length-1){i="add port";t=true;a=true}for(const s in this._uiAttribsPorts){n[s]=this._uiAttribsPorts[s]}n.addPort=t;n.longPort=e;n.title=i;n.greyout=a;n.group=this.name;this.ports[r].setUiAttribs(n)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++){if(!this.ports[e])this.ports.splice(e,1)}if(!this.uiAttribs.multiPortManual){if(this.ports.length>N)for(let e=this.ports.length-1;e>1;e--){if(!this.ports[e].isLinked())this.uiAttribs.multiPortNum=e;else break}}s()};this.countPorts=()=>{const e=w.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let i=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const n=this.ports[e+1];const r=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!n||!r){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,n.name,r.op,r.name);i=true}break}}if(!this.uiAttribs.multiPortManual){let t=true;while(t){t=false;for(let e=this.ports.length-1;e>1;e--){if(this.ports[e]&&this.ports[e].links.length>0&&this.ports[e-1].links.length==0){const r=this.ports[e].links[0].getOtherPort(this.ports[e]);this.ports[e].links[0].remove();const n=this.ports[e-1];if(n&&this.ports[e]){this.op.patch.link(this.op,n.name,r.op,r.name);t=true;i=true;break}}}}}if(!this.uiAttribs.multiPortManual){while(this.ports.length>N&&!this.ports[this.ports.length-1].isLinked()&&!this.ports[this.ports.length-2].isLinked()){let e=this.ports.length-1;if(!this.ports[e].isLinked()&&this.ports[e-1]&&!this.ports[e-1].isLinked()){this.ports[e].setUiAttribs({removed:true});this.ports[e].remove();this.ports.splice(e,1)}}}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();s();o();if(i)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",s.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered()});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=n;const t=this.op.newPort(this.op,i+"_"+this.ports.length,n,e);t.direction=r;if(this.direction==c.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(n==B.TYPE_NUMBER)t.setInitialValue(0);else if(n==B.TYPE_STRING)t.setInitialValue("");this.addListeners();o();s();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<N;e++)this.newPort();s();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(N,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts()};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||N;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.toggleManual=()=>{this.setUiAttribs({multiPortManual:!this.uiAttribs.multiPortManual});this.op.refreshParams()};this.on("onUiAttrChange",e=>{if(e.hasOwnProperty("multiPortManual")){o();this.removeInvalidPorts();this.checkNum();this.countPorts();o()}});this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}class ae extends B{constructor(e,n,r,a,t,i,s=1){super(e,n,B.TYPE_ARRAY,t);this._log=new u("multiport2");this.setUiAttribs({multiPort2:true,multiPort:true,group:this.name,order:-1,multiPortManual:true});this.minNumPorts=s;this.ports=[];this.direction=a;this._uiAttribsPorts=i;const o=()=>{const t=[];let i=1;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const l=()=>{for(let a=0;a<this.ports.length;a++){let e;let t=false;let i;let n=false;let r={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[a].name])i=this.op.preservedPortTitles[this.ports[a].name];if(a==0)e=this.ports.length;if(a==this.ports.length-1){i="add port";t=true;n=true}for(const s in this._uiAttribsPorts)r[s]=this._uiAttribsPorts[s];r.addPort=t;r.longPort=e;r.title=i;r.greyout=n;r.group=this.name;this.ports[a].setUiAttribs(r)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++)if(!this.ports[e])this.ports.splice(e,1);o()};this.countPorts=()=>{const e=w.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let t=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const n=this.ports[e+1];const r=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!n||!r){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,n.name,r.op,r.name);t=true}break}}const i=this.ports.length-1;if(this.ports.length>=1&&this.ports[i].uiAttribs.addPort&&this.ports[i].isLinked()){this.newPort();this.setUiAttribs({multiPortNum:this.ports.length})}this.removeInvalidPorts();o();l();if(t)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",o.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered(i)});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{l();this.countPorts();this.emitEvent("onLinkChanged")})}};this.newPort=e=>{const t={};t.type=r;const i=this.op.newPort(this.op,n+"_"+this.ports.length,r,t);i.direction=a;if(this.direction==c.PORT.PORT_DIR_OUT)this.op.addOutPort(i);else this.op.addInPort(i,this.ports[this.ports.length-1]);this.ports.push(i);if(r==B.TYPE_NUMBER)i.setInitialValue(0);else if(r==B.TYPE_STRING)i.setInitialValue("");this.addListeners();l();o();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[i.name])i.setUiAttribs({title:this.op.preservedPortTitles[i.name]});return i};this.initPorts=()=>{while(this.ports.length<this.minNumPorts)this.newPort("init"+this.minNumPorts);o();l()};this.checkNum=()=>{this.uiAttribs.multiPortNum||=this.minNumPorts;this.uiAttribs.multiPortNum=Math.max(this.minNumPorts,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort("checknum");while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts();if(this.ports.length>1&&this.ports[this.ports.length-1].uiAttribs.addPort&&this.ports[this.ports.length-1].isLinked()){this.ports[this.ports.length-1].removeLinks()}};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||this.minNumPorts;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();l()};this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();l()}}class M extends t{static OP_VERSION_PREFIX="_v";static EVENT_INIT="init";static EVENT_UIATTR_CHANGE="onUiAttribsChange";static UI_ERRORLEVEL_HINT=0;static UI_ERRORLEVEL_WARNING=1;static UI_ERRORLEVEL_ERROR=2;static UI_ERRORLEVEL_NOTWORKING=3;#objName="";#log=new u("core_op");#shortOpName="";opId="";portsOut=[];patch=null;data={};storage={};portsIn=[];portsInData=[];uiAttribs={};enabled=true;onAnimFrame=null;preservedPortTitles={};preservedPortValues={};preservedPortLinks={};linkTimeRules={needsLinkedToWork:[],needsStringToWork:[],needsParentOp:null};inValueSlider=this.inFloatSlider;shouldWork={};hasUiErrors=0;uiErrors={};hasAnimPort=false;patchId=null;constructor(e,t,i=null){super();this.opId=i;this.#objName=t;this.patch=e;this.#shortOpName=CABLES.getShortOpName(t);this.getTitle();this.id=i||b();this.onAddPort=null;this.onCreate=null;this.onResize=null;this.onLoaded=null;this.onDelete=null;this.onError=null;this._instances=null;this.preRender=null;this.init=null}isInBlueprint2(){return false}getSubPatch(){return 0}get name(){return this.getTitle()}set name(e){this.setTitle(e)}set _objName(e){this.#objName=e;this.#log=new u("op "+e)}get objName(){return this.#objName}get shortName(){return this.#shortOpName}require(e){if(CABLES.platform&&CABLES.StandaloneElectron&&!CABLES.platform.frontendOptions.isElectron)this.setUiError("notstandalone","This op will only work in cables standalone version",3);return null}checkMainloopExists(){if(!CABLES.UI)return;if(!this.patch.tempData.mainloopOp)this.setUiError("nomainloop","patch should have a mainloop to use this op");else this.setUiError("nomainloop",null)}getTitle(){if(!this.uiAttribs)return"nouiattribs"+this.shortName;return this.uiAttribs.title||this.#shortOpName}setTitle(e){if(e!=this.getTitle())this._setUiAttrib({title:e})}setStorage(e){if(!e)return;this.storage=this.storage||{};let t=false;for(const i in e){if(this.storage[i]!=e[i])t=true;this.storage[i]=e[i]}if(t)this.emitEvent("onStorageChange",e)}isSubPatchOp(){if(this.patchId&&this.storage)return this.storage.subPatchVer||this.storage.blueprintVer||0;return false}setUiAttrib(e){this._setUiAttrib(e)}setUiAttribs(e){this._setUiAttrib(e)}uiAttr(e){this._setUiAttrib(e)}inValueSelect(e,t,i,n){return this.inDropDown(e,t,i,n)}inValueInt(e,t){return this.inInt(e,t)}outFunction(e,t){return this.outTrigger(e,t)}outValue(e,t){return this.outNumber(e,t)}outValueBool(e,t){return this.outBool(e,t)}outBool(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_VALUE,{display:"bool"}));if(t!==undefined)i.set(t);else i.set(0);return i}outValueString(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_VALUE,{type:"string"}));if(t!==undefined)i.set(t);return i}inDynamic(e,t,i,n){const r=this.newPort(this,e,B.TYPE_DYNAMIC,i);r.shouldLink=()=>{if(t&&Array.isArray(t))return false;return true};this.addInPort(r);if(n!==undefined){r.set(n);r.defaultValue=n}return r}_setUiAttrib(e){if(!e)return;if(typeof e!="object")this.#log.error("op.uiAttrib attribs are not of type object");if(!this.uiAttribs)this.uiAttribs={};let t=false;let i=false;if(CABLES.UI&&e.hasOwnProperty("translate")&&(!this.uiAttribs.translate||this.uiAttribs.translate.x!=e.translate.x||this.uiAttribs.translate.y!=e.translate.y))i=true;if(e.hasOwnProperty("title")&&e.title!=this.uiAttribs.title){this.uiAttribs.title=e.title;t=true}if(e.hasOwnProperty("disabled")){t=true;this.setEnabled(!e.disabled)}for(const n in e){if(this.uiAttribs[n]!=e[n])t=true;this.uiAttribs[n]=e[n]}if(this.uiAttribs.hasOwnProperty("highlighted")&&this.uiAttribs.highlighted==false)delete this.uiAttribs.highlighted;if(this.uiAttribs.hasOwnProperty("highlightedMore")&&this.uiAttribs.highlightedMore==false)delete this.uiAttribs.highlightedMore;if(this.uiAttribs.hasOwnProperty("selected")&&this.uiAttribs.selected==false)delete this.uiAttribs.selected;if(this.uiAttribs.hasOwnProperty("selected"))t=true;if(t){this.emitEvent(M.EVENT_UIATTR_CHANGE,e);this.patch.emitEvent("onUiAttribsChange",this,e)}if(i)this.emitEvent("move")}getName(){return this.#shortOpName}addOutPort(e){e.direction=c.PORT.PORT_DIR_OUT;if(e.op!=this)this.#log.error("port op is not this...");this.portsOut.push(e);this.emitEvent("onPortAdd",e);return e}hasDynamicPort(){let e=0;for(e=0;e<this.portsIn.length;e++){if(this.portsIn[e].type==B.TYPE_DYNAMIC)return true;if(this.portsIn[e].getName()=="dyn")return true}for(e=0;e<this.portsOut.length;e++){if(this.portsOut[e].type==B.TYPE_DYNAMIC)return true;if(this.portsOut[e].getName()=="dyn")return true}return false}addInPort(e,t){e.direction=B.DIR_IN;e._op=this;if(!t){this.portsIn.push(e)}else{const i=this.portsIn.indexOf(t);this.portsIn.splice(i+1,0,e)}this.emitEvent("onPortAdd",e);return e}inFunction(e,t){return this.inTrigger(e,t)}inTrigger(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}inTriggerButton(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_FUNCTION,{display:"button"}));if(t!==undefined)i.set(t);return i}inUiTriggerButtons(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_FUNCTION,{display:"buttons"}));if(t!==undefined)i.set(t);return i}inValueFloat(e,t){return this.inFloat(e,t)}inValue(e,t){return this.inFloat(e,t)}inValueBool(e,t){return this.inBool(e,t)}inFloat(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_VALUE));i.setInitialValue(t);return i}inBool(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_NUMBER,{display:"bool"}));if(t===true)t=1;if(t===false)t=0;i.setInitialValue(t);return i}inMultiPort(e,t,i){const n={addPort:true,hidePort:true};const r=new re(this,e,t,B.DIR_IN,n,i);r.ignoreValueSerialize=true;this.addInPort(r);r.initPorts();return r}inMultiPort2(e,t,i,n=2){const r={addPort:true,hidePort:true};const a=new ae(this,e,t,B.DIR_IN,r,i,n);a.ignoreValueSerialize=true;this.addInPort(a);a.initPorts();return a}outMultiPort(e,t,i={}){const n=new re(this,e,t,c.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);n.ignoreValueSerialize=true;this.addOutPort(n);n.initPorts();return n}outMultiPort2(e,t,i={}){const n=new ae(this,e,t,c.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);n.ignoreValueSerialize=true;this.addOutPort(n);n.initPorts();return n}inValueString(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_VALUE,{type:"string"}));i.value="";i.setInitialValue(t);return i}inString(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_STRING,{type:"string"}));t=t||"";i.setInitialValue(t);return i}inTextarea(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_STRING,{type:"string",display:"text"}));i.value="";if(t!==undefined){i.set(t);i.defaultValue=t}return i}inStringEditor(e,t,i,n=true){const r=this.addInPort(this.newPort(this,e,B.TYPE_STRING,{type:"string",display:"editor",editShortcut:true,editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inValueEditor(e,t,i,n=true){const r=this.addInPort(this.newPort(this,e,B.TYPE_NUMBER,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inDropDown(e,t,i,n){let r=null;if(!n){const a=this.newPort(this,e+" index",B.TYPE_NUMBER,{increment:"integer",hideParam:true});const s=this.addInPort(a);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new ne(this,e,B.TYPE_NUMBER,{display:"dropdown",hidePort:true,type:"string",values:t},s);o.indexPort=a;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});a.on(B.EVENT_LINK_CHANGED,()=>{o.setUiAttribs({greyout:a.isLinked()});o.forceChange()});r=this.addInPort(o);if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});s.setValue(l);r.defaultValue=i;s.defaultValue=l}}else{const o=this.newPort(this,e,B.TYPE_VALUE,{display:"dropdown",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inSwitch(e,t,i,n){let r=null;if(!n){if(!i)i=t[0];const a=this.newPort(this,e+" index",B.TYPE_VALUE,{increment:"integer",values:t,hideParam:true});const s=this.addInPort(a);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new ne(this,e,B.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t},s);o.indexPort=a;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});r=this.addInPort(o);a.on(B.EVENT_LINK_CHANGED,()=>{o.setUiAttribs({greyout:a.isLinked()});o.forceChange()});if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});s.setValue(l);r.defaultValue=i;s.defaultValue=l}}else{const o=this.newPort(this,e,B.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inInt(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_VALUE,{increment:"integer"}));if(t!==undefined){i.set(t);i.defaultValue=t}return i}inFile(e,t,i){const n=this.addInPort(this.newPort(this,e,B.TYPE_VALUE,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inUrl(e,t,i){const n=this.addInPort(this.newPort(this,e,B.TYPE_STRING,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inTexture(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_OBJECT,{display:"texture",objType:"texture",preview:true}));i.ignoreValueSerialize=true;if(t!==undefined)i.set(t);return i}inObject(e,t,i){const n=this.addInPort(this.newPort(this,e,B.TYPE_OBJECT,{objType:i}));n.ignoreValueSerialize=true;if(t!==undefined)n.set(t);return n}inGradient(e,t){const i=this.addInPort(this.newPort(this,e,B.TYPE_VALUE,{display:"gradient"}));if(t!==undefined)i.set(t);return i}getPortVisibleIndex(t){let i=this.portsIn;if(t.direction==c.PORT_DIR_OUT)i=this.portsOut;let n=0;for(let e=0;e<i.length;e++){if(i[e].uiAttribs.hidePort)continue;n++;if(i[e]==t)return n}}inArray(e,t=undefined,i=undefined){let n=i;if(!i&&CABLES.isNumeric(t))n=t;const r=this.addInPort(this.newPort(this,e,B.TYPE_ARRAY,{stride:n}));if(t!==undefined&&(Array.isArray(t)||t==null))r.set(t);return r}inFloatSlider(e,t,i,n){const r={display:"range"};if(i!=undefined&&n!=undefined){r.min=i;r.max=n}const a=this.addInPort(this.newPort(this,e,B.TYPE_VALUE,r));if(t!==undefined){a.set(t);a.defaultValue=t}return a}outTrigger(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}outNumber(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_VALUE));if(t!==undefined)i.set(t);return i}outBoolNum(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_VALUE,{display:"boolnum"}));i.set=function(e){this.setValue(e?1:0)}.bind(i);if(t!==undefined)i.set(t);else i.set(0);return i}outString(e,t){const i=this.addOutPort(this.newPort(this,e,B.TYPE_STRING,{type:"string"}));if(t!==undefined)i.set(t);else i.set("");return i}outObject(e,t,i){const n=this.addOutPort(this.newPort(this,e,B.TYPE_OBJECT,{objType:i||null}));n.set(t||null);n.ignoreValueSerialize=true;return n}outArray(e,t,i){if(!i&&CABLES.isNumeric(t))i=t;const n=this.addOutPort(this.newPort(this,e,B.TYPE_ARRAY,{stride:i}));if(t!==undefined&&(Array.isArray(t)||t==null))n.set(t);n.ignoreValueSerialize=true;return n}outTexture(e,t){return null}removeLinks(){for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].removeLinks();for(let e=0;e<this.portsOut.length;e++)this.portsOut[e].removeLinks()}getSerialized(){const t={};if(this.opId)t.opId=this.opId;if(this.patch.storeObjNames)t.objName=this.objName;t.id=this.id;t.uiAttribs=structuredClone(this.uiAttribs)||{};if(this.storage&&Object.keys(this.storage).length>0)t.storage=structuredClone(this.storage);if(this.uiAttribs.hasOwnProperty("working")&&this.uiAttribs.working==true)delete this.uiAttribs.working;if(t.uiAttribs.hasOwnProperty("uierrors"))delete t.uiAttribs.uierrors;if(t.uiAttribs.hasOwnProperty("highlighted"))delete t.uiAttribs.highlighted;if(t.uiAttribs.hasOwnProperty("highlightedMore"))delete t.uiAttribs.highlightedMore;if(t.uiAttribs.hasOwnProperty("heatmapIntensity"))delete t.uiAttribs.heatmapIntensity;if(t.uiAttribs.title==="")delete t.uiAttribs.title;if(t.uiAttribs.color===null)delete t.uiAttribs.color;if(t.uiAttribs.comment===null)delete t.uiAttribs.comment;if(t.uiAttribs.title==this.#shortOpName||(this.uiAttribs.title||"").toLowerCase()==this.#shortOpName.toLowerCase())delete t.uiAttribs.title;t.portsIn=[];t.portsOut=[];for(let e=0;e<this.portsIn.length;e++){const i=this.portsIn[e].getSerialized();if(i)t.portsIn.push(i)}for(let e=0;e<this.portsOut.length;e++){const i=this.portsOut[e].getSerialized();if(i)t.portsOut.push(i)}if(t.portsIn.length==0)delete t.portsIn;if(t.portsOut.length==0)delete t.portsOut;d(t);return t}getFirstOutPortByType(t){for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].type==t)return this.portsOut[e]}getFirstInPortByType(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].type==t)return this.portsIn[e]}getPort(e,t=false){return this.getPortByName(e,t)}getPortByName(t,e=false){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t||this.portsIn[e].id.toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t||this.portsOut[e].id.toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t||this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t||this.portsOut[e].id==t)return this.portsOut[e]}}getPortById(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]}updateAnims(){if(this.hasAnimPort)for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].updateAnim()}log(){this.#log.log(...arguments)}logError(){this.#log.error(...arguments)}logWarn(){this.#log.warn(...arguments)}logVerbose(){this.#log.verbose(...arguments)}error(){this.#log.error(...arguments)}warn(){this.#log.warn(...arguments)}verbose(){this.#log.verbose(...arguments)}cleanUp(){if(this._instances){for(let e=0;e<this._instances.length;e++)if(this._instances[e].onDelete)this._instances[e].onDelete();this._instances.length=0}for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].setAnimated(false);if(this.onAnimFrame)this.patch.removeOnAnimFrame(this)}instanced(e){return false}initInstancable(){}hasUiError(e){return this.uiErrors.hasOwnProperty(e)&&this.uiErrors[e]}setUiError(e,t,i=2,n={}){}setEnabled(e){this.enabled=e;this.emitEvent("onEnabledChange",e)}setPortGroup(t,i){for(let e=0;e<i.length;e++){if(i[e])if(i[e].setUiAttribs)i[e].setUiAttribs({group:t});else this.#log.error("setPortGroup: invalid port!")}}setUiAxisPorts(e,t,i){if(e)e.setUiAttribs({axis:"X"});if(t)t.setUiAttribs({axis:"Y"});if(i)i.setUiAttribs({axis:"Z"})}removePort(t){for(let e=0;e<this.portsIn.length;e++){if(this.portsIn[e]==t){this.portsIn.splice(e,1);this.emitEvent(M.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}for(let e=0;e<this.portsOut.length;e++){if(this.portsOut[e]==t){this.portsOut.splice(e,1);this.emitEvent(M.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}}toWorkNeedsParent(e){this.linkTimeRules.needsParentOp=e}toWorkShouldNotBeChild(e,t){if(!this.patch.isEditorMode())return;this.linkTimeRules.forbiddenParent=e;if(t!=undefined)this.linkTimeRules.forbiddenParentType=t}toWorkPortsNeedsString(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsStringToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsStringToWork.push(arguments[e])}toWorkPortsNeedToBeLinked(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsLinkedToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsLinkedToWork.push(arguments[e])}toWorkPortsNeedToBeLinkedReset(){if(!this.patch.isEditorMode())return;this.linkTimeRules.needsLinkedToWork.length=0;if(this.checkLinkTimeWarnings)this.checkLinkTimeWarnings()}initVarPorts(){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getVariableName())this.portsIn[e].setVariable(this.portsIn[e].getVariableName())}checkLinkTimeWarnings(){}_checkLinksNeededToWork(){}refreshParams(){if(this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp())w.getGui().opParams.show(this)}isCurrentUiOp(){if(this.patch.isEditorMode())return w.getGui().patchView.isCurrentOp(this)}checkGraphicsApi(e=1){if(this.patch.isEditorMode())if(this.patch.cg&&this.patch.cg.gApi!=e)this.setUiError("wronggapi","Wrong graphics API",2)}newPort(e,t,i,n){return new CABLES.Port(e,t,i,n)}}const L={};L.addPatch=function(e,t){let i=e;let n=o();if(typeof e=="string"){n=e;i=document.getElementById(n);if(!i){console.error(n+" Container Element not found!");return}}const r=document.createElement("canvas");r.id="glcanvas_"+n;r.width=i.clientWidth;r.height=i.clientHeight;window.addEventListener("resize",function(){this.height=i.clientHeight;this.width=i.clientWidth}.bind(r));i.appendChild(r);t=t||{};t.glCanvasId=r.id;if(!t.onError){t.onError=function(e){console.error(e)}}CABLES.patch=new w(t);return r};class se{constructor(e){this.startFrame=e.getFrameNum();this.items={};this.currentId=null;this.currentStart=0;this._patch=e}getItems(){return this.items}clear(){this.currentStart=performance.now();if(this.paused)return;this.items={}}togglePause(){this.paused=!this.paused;if(!this.paused){this.items={};this.currentStart=performance.now()}}add(e,t){if(this.paused)return;if(this.currentId!==null){if(!t||t.id!=this.currentId){const i=this.items[this.currentId];if(i){i.timeUsed+=performance.now()-this.currentStart;i._timePsCount++;i._timePsMs+=performance.now()-this.currentStart;if(i._timePsStart==0||performance.now()>i._timePsStart+1e3){i.timePsMs=i._timePsMs;i.timePsMsAvg=i._timePsMs/i._timePsCount;i.timePsCount=i._timePsCount;i._timePsCount=0;i._timePsMs=0;i._timePsStart=performance.now()}if(!i.peakTime||O()-i.peakTime>5e3){i.peak=0;i.peakTime=O()}i.peak=Math.max(i.peak,performance.now()-this.currentStart)}}}if(t!==null){if(!this.items[t.id]){this.items[t.id]={numTriggers:0,timeUsed:0,timeUsedFrame:0,timePsMsAvg:0,timePsMs:0,_timePsCount:0,_timePsMs:0,_timePsStart:performance.now()}}if(this.items[t.id].lastFrame!=this._patch.getFrameNum())this.items[t.id].numTriggers=0;this.items[t.id].lastFrame=this._patch.getFrameNum();this.items[t.id].numTriggers++;this.items[t.id].opid=t.op.id;this.items[t.id].title=t.op.name+"."+t.name;this.items[t.id].subPatch=t.op.uiAttribs.subPatch;this.currentId=t.id;this.currentStart=performance.now()}else{this.currentId=null}}print(){for(const e in this.items){console.log(this.items[e].title+": "+this.items[e].numTriggers+" / "+this.items[e].timeUsed)}}}const oe=function(){let t=null;const i=[];this.onChanged=function(e){i.push(e)};this.getValue=function(){return t};this.setValue=function(e){t=e;this.emitChanged()};this.emitChanged=function(){for(let e=0;e<i.length;e++){i[e]()}}};class le extends t{paused=false;frameNum=0;frameStartTime=0;exec(e){}pause(){}resume(){}}class ue{#arr=[];push(e){this.#arr.push(e)}pop(){return this.#arr.pop()}clear(){this.#arr.length=0;return this}current(){return this.#arr[this.#arr.length-1]}array(){return this.#arr}}CABLES=CABLES||{};CABLES={...CABLES,...c.PORT,...c.PACO,...c.ANIM,...c.OP};CABLES.EMBED=L;CABLES.Link=I;CABLES.Port=B;CABLES.Op=M;CABLES.Profiler=se;CABLES.Patch=w;CABLES.Timer=y;CABLES.LoadingStatus=D;CABLES.now=O;CABLES.internalNow=S;CABLES.Anim=h;CABLES.AnimKey=l;CABLES.RenderLoop=le;CABLES.shortId=b;CABLES.uuid=s;CABLES.getShortOpName=i;CABLES.simpleId=p;CABLES.clamp=E;CABLES.map=F;CABLES.generateUUID=o;CABLES.prefixedHash=m;CABLES.smoothStep=_;CABLES.smootherStep=v;CABLES.copyArray=C;CABLES.basename=x;CABLES.logStack=X;CABLES.filename=Z;CABLES.ajax=T;CABLES.cacheBust=A;CABLES.shuffleArray=n;CABLES.Variable=oe;CABLES.logErrorConsole=K;CABLES.isNumeric=f;CABLES.uniqueArray=Q;CABLES.Stack=ue;CABLES.OPS=[];CABLES.utils=e;CABLES.CONSTANTS=c;CABLES.SHARED={};CABLES.SHARED.Events=t;CABLES.SHARED.Logger=u;const he=CABLES;if(!function(){return!this}())console.warn("not in strict mode: index core")})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in fe)e[t]=fe[t];if(fe.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();var CABLES=CABLES||{};CABLES.build={timestamp:1770648367878,created:"2026-02-09T14:46:07.878Z",git:{branch:"master",commit:"fbcb58ca0c090bf250973b002c9c621a721fc620",date:"1770648116",message:"shit's broken yo"}};if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["j656st"]={_id:"672cd01ac9c9465474881283",ops:[{id:"7622a63a-ecd7-4a72-82df-d360307352b4",portsIn:[{name:"FPS Limit",value:0},{name:"Reduce FPS not focussed",value:1},{name:"Reduce FPS loading",value:0},{name:"Clear",value:1},{name:"ClearAlpha",value:1},{name:"Fullscreen Button",value:0},{name:"Hires Displays",value:0},{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"6498eb39-ae25-4fb5-9215-159247350374",objOut:"7622a63a-ecd7-4a72-82df-d360307352b4"}]},{name:"width",value:640},{name:"height",value:320}],objName:"Ops.Gl.MainLoop"},{id:"07fd3576-0ef1-41b8-a206-2539f98c6434",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:.9},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"54b1c3a7-877b-4bdd-80cf-aca6bb1af336",objOut:"07fd3576-0ef1-41b8-a206-2539f98c6434"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"76000d69-b621-4fb3-a4f8-b273ad4f7733",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"07fd3576-0ef1-41b8-a206-2539f98c6434",objOut:"76000d69-b621-4fb3-a4f8-b273ad4f7733"}]},{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"b8238c55-c580-4b42-a9ad-24ee15a94c83",objOut:"76000d69-b621-4fb3-a4f8-b273ad4f7733"},{portIn:"Image",portOut:"texture_out",objIn:"2a5b0069-3bf8-430d-83d3-9e57165d278f",objOut:"76000d69-b621-4fb3-a4f8-b273ad4f7733"},{portIn:"Texture",portOut:"texture_out",objIn:"02bd6327-c6d9-45d1-b7d6-0f89ccec3cd9",objOut:"76000d69-b621-4fb3-a4f8-b273ad4f7733"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"a0da83aa-50ac-4e12-9db4-152b247ff612",portsOut:[{name:"trigger 0",links:[{portIn:"Render",portOut:"trigger 0",objIn:"76000d69-b621-4fb3-a4f8-b273ad4f7733",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 1",links:[{portIn:"render",portOut:"trigger 1",objIn:"02bd6327-c6d9-45d1-b7d6-0f89ccec3cd9",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 2",links:[{portIn:"Render",portOut:"trigger 2",objIn:"a76eb466-b52e-4a30-a23f-2e49026f7f59",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 3",links:[{portIn:"Render",portOut:"trigger 3",objIn:"b74dc535-314f-4f10-bec0-c76a412fd48f",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 4",links:[{portIn:"Render",portOut:"trigger 4",objIn:"0ac22e5d-42b0-48f3-b289-30f4d56ddf42",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 5",links:[{portIn:"Render",portOut:"trigger 5",objIn:"db8e6cd2-fd1e-46ef-b089-081c3d3e5bde",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 6",links:[{portIn:"Render",portOut:"trigger 6",objIn:"a2b0912c-7870-4e92-8649-003e7e6e17f9",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 7",links:[{portIn:"Render",portOut:"trigger 7",objIn:"06a13487-7127-498d-b7c1-53b3d1da21c4",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 14",links:[{portIn:"Render",portOut:"trigger 14",objIn:"025508fe-2b54-4bc9-85f0-c9bff6b29bf6",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]},{name:"trigger 15",links:[{portIn:"Render",portOut:"trigger 15",objIn:"a59bbd30-ce71-4da5-bbc4-b4fcb958086a",objOut:"a0da83aa-50ac-4e12-9db4-152b247ff612"}]}],objName:"Ops.Trigger.Sequence"},{id:"b8238c55-c580-4b42-a9ad-24ee15a94c83",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"71080205-074c-48ad-865e-05f94cb13e31",objOut:"b8238c55-c580-4b42-a9ad-24ee15a94c83"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"a76eb466-b52e-4a30-a23f-2e49026f7f59",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"b8238c55-c580-4b42-a9ad-24ee15a94c83",objOut:"a76eb466-b52e-4a30-a23f-2e49026f7f59"}]},{name:"texture_out",links:[{portIn:"displaceTex",portOut:"texture_out",objIn:"575e6cef-482d-4c09-b505-2fa50834a66d",objOut:"a76eb466-b52e-4a30-a23f-2e49026f7f59"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"2a5b0069-3bf8-430d-83d3-9e57165d278f",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"dfa2e382-e0f3-434e-8b2b-5752cff88ef3",objOut:"2a5b0069-3bf8-430d-83d3-9e57165d278f"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"b74dc535-314f-4f10-bec0-c76a412fd48f",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"2a5b0069-3bf8-430d-83d3-9e57165d278f",objOut:"b74dc535-314f-4f10-bec0-c76a412fd48f"}]},{name:"texture_out",links:[{portIn:"Texture 1",portOut:"texture_out",objIn:"4e388ca7-cab8-4e7b-b58b-b9e7c3feb785",objOut:"b74dc535-314f-4f10-bec0-c76a412fd48f"},{portIn:"Image",portOut:"texture_out",objIn:"892578cb-0130-4fd0-88cb-7ec699a3a450",objOut:"b74dc535-314f-4f10-bec0-c76a412fd48f"},{portIn:"Image",portOut:"texture_out",objIn:"780d3a59-ae9a-4546-b329-550ed0fc6f6a",objOut:"b74dc535-314f-4f10-bec0-c76a412fd48f"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"fdf216a8-1511-4efe-a17a-b0084a356be3",portsIn:[{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"b6de5b31-6d3d-4907-83b8-b88568832e54",objOut:"fdf216a8-1511-4efe-a17a-b0084a356be3"}]}],objName:"Ops.Gl.Meshes.FullscreenRectangle"},{id:"3d945f33-17a0-435a-aa5d-15538ca9d2af",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Color index",value:0},{name:"Color",value:"Mono"},{name:"Aspect",value:1},{name:"Multiply",value:1},{name:"Harmonics",value:"1"},{name:"X",value:0},{name:"Offset Multiply",value:1},{name:"Offset X index",value:0},{name:"Offset X",value:"None"},{name:"Offset Y index",value:0},{name:"Offset Y",value:"None"},{name:"Offset Z index",value:1},{name:"Offset Z",value:"R"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"575e6cef-482d-4c09-b505-2fa50834a66d",objOut:"3d945f33-17a0-435a-aa5d-15538ca9d2af"}]}],objName:"Ops.Gl.ImageCompose.Noise.PerlinNoise"},{id:"02bd6327-c6d9-45d1-b7d6-0f89ccec3cd9",portsIn:[{name:"use original size",value:1},{name:"width",value:640},{name:"height",value:320},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"HDR",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"A"},{name:"Convert Greyscale index",value:0},{name:"Convert Greyscale",value:"Off"},{name:"Invert R",value:0},{name:"Invert G",value:0},{name:"Invert B",value:0},{name:"Invert A",value:0}],portsOut:[{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"07fd3576-0ef1-41b8-a206-2539f98c6434",objOut:"02bd6327-c6d9-45d1-b7d6-0f89ccec3cd9"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.Textures.CopyTexture"},{id:"71080205-074c-48ad-865e-05f94cb13e31",portsIn:[{name:"Strength",value:10},{name:"Red index",value:7},{name:"Red",value:"Horizontal Difference Red"},{name:"Red Flip",value:0},{name:"Green index",value:0},{name:"Green",value:"Vertical Difference Red"},{name:"Green Flip",value:0},{name:"Blue index",value:14},{name:"Blue",value:"Midpoint"},{name:"Blue Flip",value:0}],objName:"Ops.Gl.ImageCompose.PixelDifference"},{id:"575e6cef-482d-4c09-b505-2fa50834a66d",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Wrap index",value:1},{name:"Wrap",value:"Clamp"},{name:"Input index",value:1},{name:"Input",value:"RedGreen"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"}],portsOut:[{name:"trigger",links:[{portIn:"exec",portOut:"trigger",objIn:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe",objOut:"575e6cef-482d-4c09-b505-2fa50834a66d"}]}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v3"},{id:"7d1f344d-f292-4196-8c43-3ee17ff586be",portsIn:[{name:"contrast",value:1},{name:"brightness",value:.5}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"9618161c-453f-4101-8cc1-7d54361c27f8",objOut:"7d1f344d-f292-4196-8c43-3ee17ff586be"}]}],objName:"Ops.Gl.ImageCompose.BrightnessContrast"},{id:"dfa2e382-e0f3-434e-8b2b-5752cff88ef3",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Method index",value:0},{name:"Method",value:"Luminance"},{name:"Min",value:0},{name:"Max",value:1},{name:"Position",value:.5}],objName:"Ops.Gl.ImageCompose.ColorMap"},{id:"e3c29035-7820-433e-9532-4867becf5359",portsIn:[{name:"Smooth",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Image",portOut:"Texture",objIn:"d6b05509-d8cc-40e6-b332-7fb63caf0b0d",objOut:"e3c29035-7820-433e-9532-4867becf5359"},{portIn:"Texture In",portOut:"Texture",objIn:"8fa67302-88f5-460e-9d75-b9a3ac804577",objOut:"e3c29035-7820-433e-9532-4867becf5359"}]}],objName:"Ops.Color.ColorPalettes"},{id:"355cfe5b-8a22-4722-bd28-e509c8250150",portsIn:[{name:"amount",value:1},{name:"Clamp",value:1},{name:"Mask Invert",value:0},{name:"direction index",value:0},{name:"direction",value:"both"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"67aafb84-dada-495f-a135-c15658120c6c",objOut:"355cfe5b-8a22-4722-bd28-e509c8250150"}]}],objName:"Ops.Gl.ImageCompose.FastBlur"},{id:"67aafb84-dada-495f-a135-c15658120c6c",portsIn:[{name:"amount",value:1}],portsOut:[{name:"Trigger",links:[{portIn:"Execute",portOut:"Trigger",objIn:"8eab601b-2407-4df6-8f11-b8e0f2661d96",objOut:"67aafb84-dada-495f-a135-c15658120c6c"}]}],objName:"Ops.Gl.ImageCompose.Sharpen"},{id:"b07e7a26-d1a9-402f-b404-3d1e0e6be3a4",portsIn:[{name:"Blend Mode index",value:11},{name:"Blend Mode",value:"overlay"},{name:"Amount",value:1},{name:"width",value:200},{name:"height",value:200}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"b07e7a26-d1a9-402f-b404-3d1e0e6be3a4"}]}],objName:"Ops.Gl.ImageCompose.Pixelate"},{id:"8154063e-71c1-4fe1-9dee-fcc58c922d86",portsIn:[{name:"Variable",value:"colPal"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"1aea9d5e-5ae2-47fe-9c99-29af1ae94760",portsIn:[{name:"Variable",value:"pNoisePosY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"d9ffddd0-7054-467b-aa0d-7cbd3d90d379",portsIn:[{name:"Variable",value:"colPal"}],portsOut:[{name:"Value",links:[{portIn:"index",portOut:"Value",objIn:"9781e888-abd2-4662-bf84-a0db50595855",objOut:"d9ffddd0-7054-467b-aa0d-7cbd3d90d379"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"c5a8403d-c4b5-4d1e-8e08-e1befb2edeaa",portsIn:[{name:"Variable",value:"pNoisePosY"}],portsOut:[{name:"Value",links:[{portIn:"Y",portOut:"Value",objIn:"3d945f33-17a0-435a-aa5d-15538ca9d2af",objOut:"c5a8403d-c4b5-4d1e-8e08-e1befb2edeaa"},{portIn:"y",portOut:"Value",objIn:"05eaf768-9012-4085-b98c-5fa9417b7c47",objOut:"c5a8403d-c4b5-4d1e-8e08-e1befb2edeaa"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"d6b05509-d8cc-40e6-b332-7fb63caf0b0d",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"18692c8d-d1dc-4e23-924c-bb4c9d3764cc",objOut:"d6b05509-d8cc-40e6-b332-7fb63caf0b0d"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"0ac22e5d-42b0-48f3-b289-30f4d56ddf42",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"d6b05509-d8cc-40e6-b332-7fb63caf0b0d",objOut:"0ac22e5d-42b0-48f3-b289-30f4d56ddf42"}]},{name:"texture_out",links:[{portIn:"Gradient",portOut:"texture_out",objIn:"dfa2e382-e0f3-434e-8b2b-5752cff88ef3",objOut:"0ac22e5d-42b0-48f3-b289-30f4d56ddf42"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"18692c8d-d1dc-4e23-924c-bb4c9d3764cc",portsIn:[{name:"amountY",value:0},{name:"Repeat",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"17e9698b-aa4d-4947-afc3-c7159c27d00e",objOut:"18692c8d-d1dc-4e23-924c-bb4c9d3764cc"}]}],objName:"Ops.Gl.ImageCompose.ScrollTexture"},{id:"50a8782c-8ba0-4f62-b7f6-b12c79df8738",portsIn:[{name:"Speed",value:.1},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"amountX",portOut:"Time",objIn:"18692c8d-d1dc-4e23-924c-bb4c9d3764cc",objOut:"50a8782c-8ba0-4f62-b7f6-b12c79df8738"}]}],objName:"Ops.Anim.Timer_v2"},{id:"17e9698b-aa4d-4947-afc3-c7159c27d00e",portsIn:[{name:"amount",value:5},{name:"Clamp",value:0},{name:"Mask Invert",value:0},{name:"direction index",value:0},{name:"direction",value:"both"}],objName:"Ops.Gl.ImageCompose.FastBlur"},{id:"afce2bd7-878b-4eff-afcd-fbf1f6e92483",portsIn:[{name:"Active",value:1},{name:"relative",value:0},{name:"normalize",value:0},{name:"flip y",value:1},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"smooth",value:0},{name:"smoothSpeed",value:20},{name:"multiply",value:1}],portsOut:[{name:"x",value:346},{name:"y",value:3},{name:"button down",value:0},{name:"click",links:[{portIn:"Generate",portOut:"click",objIn:"2191794d-fef0-473c-ba79-145b8029a036",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"00c1f08f-fcb7-43c9-8550-25c9e9c7a3df",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"a49fc0f5-539f-442b-a68d-71d55cad566c",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"f0e0dd97-a7e2-4b9b-b75a-f8a7909637f3",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"132a0e02-ae28-4c94-b6e5-8b9b34512917",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"6632c186-c239-4efb-9e0f-e3443cf18f3a",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"bafa8ff5-1b70-45ea-a87d-7fcff918779b",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"85978609-e882-482a-9240-7eb542889e6a",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"f4e13ee8-6e9f-4d87-b945-b1e42c3d0b7e",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"34627b0b-bb21-49c7-9bee-2c5cc7cfd216",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"ad82861a-c26d-4eba-871d-609358ba4851",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"5c3acac1-4d87-41d2-8492-71fe3d02df18",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"682aa349-2dac-4a4f-b130-ef41a0cd90d3",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"0a62fba8-e068-40e7-962e-d90194dec3bd",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"5388eb95-4517-4f2d-8393-f441003e0e91",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"b9c85eeb-3d71-4aa1-973f-9bd7b12610aa",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"a9d0b8de-8551-4cfb-8a19-6daed8437ef5",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"},{portIn:"Generate",portOut:"click",objIn:"f92de782-beee-4236-a943-eef306b8c17a",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"}]},{name:"click right",links:[{portIn:"Trigger",portOut:"click right",objIn:"5fc9a638-2491-41d2-9b47-e5521c14151e",objOut:"afce2bd7-878b-4eff-afcd-fbf1f6e92483"}]},{name:"mouseOver",value:0},{name:"button",value:0}],objName:"Ops.Devices.Mouse.Mouse_v2"},{id:"2191794d-fef0-473c-ba79-145b8029a036",portsIn:[{name:"min",value:0},{name:"max",value:14},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"8154063e-71c1-4fe1-9dee-fcc58c922d86",objOut:"2191794d-fef0-473c-ba79-145b8029a036"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"00c1f08f-fcb7-43c9-8550-25c9e9c7a3df",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"next",links:[{portIn:"Generate",portOut:"next",objIn:"cb273409-77a6-4ffd-bfbd-5fb991410578",objOut:"00c1f08f-fcb7-43c9-8550-25c9e9c7a3df"}]},{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"1aea9d5e-5ae2-47fe-9c99-29af1ae94760",objOut:"00c1f08f-fcb7-43c9-8550-25c9e9c7a3df"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"b6de5b31-6d3d-4907-83b8-b88568832e54",portsIn:[{name:"File Type index",value:0},{name:"File Type",value:"PNG"},{name:"ZIP multiple files",value:0},{name:"Download Files",value:1},{name:"Filename",value:"cables"},{name:"Quality",value:.8},{name:"Duration Type index",value:1},{name:"Duration Type",value:"Frames"},{name:"Duration",value:1},{name:"FPS",value:1},{name:"Transparency",value:0},{name:"Use Canvas Size",value:0},{name:"texture width",value:4096},{name:"texture height",value:4096}],portsOut:[{name:"Progress",value:2},{name:"Frame",value:2},{name:"Status",value:"Finished"},{name:"Started",value:false}],objName:"Ops.Gl.RenderAnim_v2"},{id:"a49fc0f5-539f-442b-a68d-71d55cad566c",portsIn:[{name:"min",value:.1},{name:"max",value:1},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"bfb567bf-28d2-4373-850a-c72304eed5d4",objOut:"a49fc0f5-539f-442b-a68d-71d55cad566c"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"bfb567bf-28d2-4373-850a-c72304eed5d4",portsIn:[{name:"Variable",value:"pixelDiffStep"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"0c2182fa-e2da-45a8-b11d-3a803554d733",portsIn:[{name:"Variable",value:"pixelDiffStep"}],portsOut:[{name:"Value",links:[{portIn:"Step",portOut:"Value",objIn:"71080205-074c-48ad-865e-05f94cb13e31",objOut:"0c2182fa-e2da-45a8-b11d-3a803554d733"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"1f2d345b-a130-4f81-a83b-c030eac030ff",portsIn:[{name:"amount",value:.5},{name:"Lumi Scale",value:.9},{name:"Line Size",value:4},{name:"Displacement",value:0},{name:"Add",value:.02},{name:"scroll",value:0}],objName:"Ops.Gl.ImageCompose.Interlace"},{id:"9618161c-453f-4101-8cc1-7d54361c27f8",portsOut:[{name:"Switched Value",value:0},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"1f2d345b-a130-4f81-a83b-c030eac030ff",objOut:"9618161c-453f-4101-8cc1-7d54361c27f8"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"bcba75d9-2ae1-4525-9bf9-9ac4cfb77f46",portsIn:[{name:"Variable",value:"idxFeedbackFx"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"f0e0dd97-a7e2-4b9b-b75a-f8a7909637f3",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"bcba75d9-2ae1-4525-9bf9-9ac4cfb77f46",objOut:"f0e0dd97-a7e2-4b9b-b75a-f8a7909637f3"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"656de317-e544-4ec3-9ca1-47a91ebfb7e0",portsIn:[{name:"Variable",value:"idxFeedbackFx"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"9618161c-453f-4101-8cc1-7d54361c27f8",objOut:"656de317-e544-4ec3-9ca1-47a91ebfb7e0"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"37dc57f2-d60e-4577-92f0-92339f1d1c53",portsIn:[{name:"Variable",value:"dispDir"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"132a0e02-ae28-4c94-b6e5-8b9b34512917",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Random Seed ",portOut:"result",objIn:"7b1892b9-ea47-4291-81ed-695eca920e86",objOut:"132a0e02-ae28-4c94-b6e5-8b9b34512917"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"7b1892b9-ea47-4291-81ed-695eca920e86",portsIn:[{name:"Num Values",value:1},{name:"Mode index",value:1},{name:"Mode",value:"AB"},{name:"Integer",value:0},{name:"Last == First",value:0},{name:"Min A",value:-.1},{name:"Max A",value:.1},{name:"Min B",value:-.1},{name:"Max B",value:.1},{name:"Min C",value:-1},{name:"Max C",value:1},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"Value",portOut:"Array Out",objIn:"37dc57f2-d60e-4577-92f0-92339f1d1c53",objOut:"7b1892b9-ea47-4291-81ed-695eca920e86"}]},{name:"Chunks Amount",value:1},{name:"Array length",value:2}],objName:"Ops.Array.RandomNumbersArray_v4"},{id:"75b31dd8-31aa-4450-a11b-a6ef64a073aa",portsIn:[{name:"Variable",value:"dispDir"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"8d1a24b0-73dc-437f-a215-f302db75f760",objOut:"75b31dd8-31aa-4450-a11b-a6ef64a073aa"},{portIn:"array",portOut:"Value",objIn:"9eb4641e-6cdd-4c38-a152-c8c660d68e24",objOut:"75b31dd8-31aa-4450-a11b-a6ef64a073aa"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"8d1a24b0-73dc-437f-a215-f302db75f760",portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"amount X",portOut:"value",objIn:"575e6cef-482d-4c09-b505-2fa50834a66d",objOut:"8d1a24b0-73dc-437f-a215-f302db75f760"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"9eb4641e-6cdd-4c38-a152-c8c660d68e24",portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"amount Y",portOut:"value",objIn:"575e6cef-482d-4c09-b505-2fa50834a66d",objOut:"9eb4641e-6cdd-4c38-a152-c8c660d68e24"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"61d0768a-d33d-4a31-ab93-cf2e18e30e7c",portsIn:[{name:"Visible",value:0},{name:"Opacity",value:1},{name:"Default Minimized",value:0},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:0},{name:"Show Minimize",value:0},{name:"Title",value:"Color Curator"},{name:"Side",value:0},{name:"Default CSS",value:1}],portsOut:[{name:"childs",title:"Children",links:[{portIn:"link",portOut:"childs",objIn:"5a2f0a5a-2582-424e-918a-a6806874c72b",objOut:"61d0768a-d33d-4a31-ab93-cf2e18e30e7c"}]},{name:"Opfened",value:false,title:"Opened"}],objName:"Ops.Sidebar.Sidebar"},{id:"5fc9a638-2491-41d2-9b47-e5521c14151e",portsIn:[{name:"Named Trigger",value:"rightTrig"}],objName:"Ops.Trigger.TriggerSend"},{id:"12fb940b-dd9c-4651-b3ea-02caff79e098",portsIn:[{name:"Named Trigger",value:"rightTrig"}],objName:"Ops.Trigger.TriggerReceive"},{id:"5b5bb9c2-116a-427f-8cba-00b0dd416bd0",portsIn:[{name:"Variable",value:"colPal"}],portsOut:[{name:"Value",value:6}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ced89cb7-d623-4a7d-b901-1e7a83159265",portsIn:[{name:"Text",value:"Color index"},{name:"Values",value:0},{name:"Default",value:"",title:"Input"},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Lines",value:1}],portsOut:[{name:"Children",links:[{portIn:"link",portOut:"Children",objIn:"3d1f9919-2d88-4331-a9bd-53e317c9406e",objOut:"ced89cb7-d623-4a7d-b901-1e7a83159265"}]},{name:"Result",value:""},{name:"Index",links:[{portIn:"Value",portOut:"Index",objIn:"c8893fb8-efc1-4fa9-a119-a4da3eda2a3a",objOut:"ced89cb7-d623-4a7d-b901-1e7a83159265"}]}],objName:"Ops.Sidebar.DropDown_v2"},{id:"12d62a7d-7481-473e-a729-173f29e3bcab",portsIn:[{name:"Text",value:"Delete Color"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"ced89cb7-d623-4a7d-b901-1e7a83159265",objOut:"12d62a7d-7481-473e-a729-173f29e3bcab"}]},{name:"Pressed Trigger",links:[{portIn:"Execute",portOut:"Pressed Trigger",objIn:"75794a43-b2cd-4950-af5e-c2c0c4356783",objOut:"12d62a7d-7481-473e-a729-173f29e3bcab"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"75794a43-b2cd-4950-af5e-c2c0c4356783",objName:"Ops.Trigger.TriggerExtender"},{id:"99955d79-d91b-4e3c-999c-5459107b9ca1",portsIn:[{name:"Text",value:"Load File:"},{name:"Button Text",value:"Choose File"},{name:"Accept Files",value:""},{name:"Allow Multiple Files",value:0},{name:"Id",value:""},{name:"Visible",value:1},{name:"Grey Out",value:0}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"d40c97a5-6cdc-4725-a85f-a45c70f0ba9d",objOut:"99955d79-d91b-4e3c-999c-5459107b9ca1"}]},{name:"Data URL",links:[{portIn:"file",portOut:"Data URL",objIn:"42f30229-e2fa-471c-bbbc-6f23350381e0",objOut:"99955d79-d91b-4e3c-999c-5459107b9ca1"}]},{name:"Filename",value:""},{name:"Num Files",value:0}],objName:"Ops.Sidebar.LocalFileToDataUrl"},{id:"42f30229-e2fa-471c-bbbc-6f23350381e0",portsIn:[{name:"file",display:"file",title:"URL"},{name:"JsonP",value:0},{name:"body",value:""},{name:"HTTP Method index",value:0},{name:"HTTP Method",value:"GET"},{name:"Content-Type",value:"application/json"},{name:"parse json",value:1},{name:"Auto request",value:1}],portsOut:[{name:"data",links:[{portIn:"Object In",portOut:"data",objIn:"e5981314-b294-401a-b334-b0192f7f34e1",objOut:"42f30229-e2fa-471c-bbbc-6f23350381e0"}]},{name:"Duration MS",value:0},{name:"Status Code",value:0},{name:"Is Loading",value:0},{name:"Loaded",links:[{portIn:"True",portOut:"Loaded",objIn:"20e4bdf5-646c-4cd6-a5cf-2393fa7e98d1",objOut:"42f30229-e2fa-471c-bbbc-6f23350381e0"}]}],objName:"Ops.Json.HttpRequest_v2"},{id:"e5981314-b294-401a-b334-b0192f7f34e1",portsIn:[{name:"When False index",value:0},{name:"When False",value:"keep last object"},{name:"Only Valid Objects",value:0}],objName:"Ops.Json.GateObject"},{id:"20e4bdf5-646c-4cd6-a5cf-2393fa7e98d1",portsOut:[{name:"Result",links:[{portIn:"Pass Through",portOut:"Result",objIn:"e5981314-b294-401a-b334-b0192f7f34e1",objOut:"20e4bdf5-646c-4cd6-a5cf-2393fa7e98d1"}]}],objName:"Ops.Boolean.BoolByTrigger"},{id:"c8893fb8-efc1-4fa9-a119-a4da3eda2a3a",portsIn:[{name:"Variable",value:"selIndex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"daf03f0e-abae-484b-9a18-8c6f895b50ac",portsIn:[{name:"Variable",value:"selIndex"}],portsOut:[{name:"Value",value:0}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"9246c229-b94f-449c-b240-d0206c0b02df",portsIn:[{name:"Value",value:0},{name:"Variable",value:"colIndex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"3ba26b45-ac24-41a4-a827-d1c55e49234a",portsIn:[{name:"Text",value:"Add Color"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"12d62a7d-7481-473e-a729-173f29e3bcab",objOut:"3ba26b45-ac24-41a4-a827-d1c55e49234a"}]},{name:"Pressed Trigger",links:[{portIn:"Execute",portOut:"Pressed Trigger",objIn:"28c614f0-16cb-4344-8a5e-121c6e333164",objOut:"3ba26b45-ac24-41a4-a827-d1c55e49234a"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"28c614f0-16cb-4344-8a5e-121c6e333164",objName:"Ops.Trigger.TriggerExtender"},{id:"5a2f0a5a-2582-424e-918a-a6806874c72b",portsIn:[{name:"Text",value:"Don't forget to save the colors before closing the patch!"},{name:"Id",value:""}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"8d83f2ed-1458-4bd3-bb7f-63e778422f67",objOut:"5a2f0a5a-2582-424e-918a-a6806874c72b"}]}],objName:"Ops.Sidebar.SidebarText_v2"},{id:"8cee95f0-c328-4970-896f-01165a3c9888",portsIn:[{name:"Text",value:"Colors"},{name:"Show Title",value:1},{name:"Default Minimized",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"3ba26b45-ac24-41a4-a827-d1c55e49234a",objOut:"8cee95f0-c328-4970-896f-01165a3c9888"}]}],objName:"Ops.Sidebar.Group"},{id:"8d83f2ed-1458-4bd3-bb7f-63e778422f67",portsIn:[{name:"Text",value:"Files"},{name:"Show Title",value:1},{name:"Default Minimized",value:0},{name:"Visible",value:1}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"8cee95f0-c328-4970-896f-01165a3c9888",objOut:"8d83f2ed-1458-4bd3-bb7f-63e778422f67"}]},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"99955d79-d91b-4e3c-999c-5459107b9ca1",objOut:"8d83f2ed-1458-4bd3-bb7f-63e778422f67"}]}],objName:"Ops.Sidebar.Group"},{id:"e3aaba27-fdb0-4a6f-afce-aea3386df0b5",portsIn:[{name:"Variable",value:"json"}],objName:"Ops.Vars.VarSetObject_v2"},{id:"09ae3dd4-160f-4a52-bd47-878df9d54e6d",portsIn:[{name:"Filename",value:"ColorCurator_"}],objName:"Ops.Json.SaveJsonFile"},{id:"d40c97a5-6cdc-4725-a85f-a45c70f0ba9d",portsIn:[{name:"Text",value:"Download Colors"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Pressed Trigger",links:[{portIn:"download",portOut:"Pressed Trigger",objIn:"09ae3dd4-160f-4a52-bd47-878df9d54e6d",objOut:"d40c97a5-6cdc-4725-a85f-a45c70f0ba9d"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"82e9a0af-c61a-41ed-8068-f793b7930161",portsIn:[{name:"Variable",value:"json"}],portsOut:[{name:"Value",links:[{portIn:"Object",portOut:"Value",objIn:"09ae3dd4-160f-4a52-bd47-878df9d54e6d",objOut:"82e9a0af-c61a-41ed-8068-f793b7930161"}]}],objName:"Ops.Vars.VarGetObject_v2"},{id:"a0ae627a-76d5-4801-b4ba-8a7bf6e6ffbe",portsIn:[{name:"array",value:0}],portsOut:[{name:"length",links:[{portIn:"Number",portOut:"length",objIn:"3ed16ce4-cb11-4005-a307-d512df2c9ef7",objOut:"a0ae627a-76d5-4801-b4ba-8a7bf6e6ffbe"}]}],objName:"Ops.Array.ArrayLength"},{id:"3d1f9919-2d88-4331-a9bd-53e317c9406e",portsIn:[{name:"Text",value:"Colors"}],objName:"Ops.Sidebar.DisplayValue_v2"},{id:"3ed16ce4-cb11-4005-a307-d512df2c9ef7",portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"3d1f9919-2d88-4331-a9bd-53e317c9406e",objOut:"3ed16ce4-cb11-4005-a307-d512df2c9ef7"}]}],objName:"Ops.String.NumberToString_v2"},{id:"ad3bca0d-b0a0-4c0e-80ff-09ac9d9d84b7",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Loop",value:0},{name:"RGB",value:0},{name:"Minimum value",value:0},{name:"Maximum value",value:1},{name:"Num X",value:10},{name:"Num Y",value:10},{name:"X",value:0},{name:"Y",value:0},{name:"Z",value:0},{name:"Centered",value:0}],objName:"Ops.Gl.ImageCompose.Noise.PixelNoise_v2"},{id:"af8f1205-7e36-45b3-ac63-4874b4b27471",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"b53d9b8a-31a1-4b06-991a-3d5f9dfd1099",objOut:"af8f1205-7e36-45b3-ac63-4874b4b27471"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"db8e6cd2-fd1e-46ef-b089-081c3d3e5bde",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"af8f1205-7e36-45b3-ac63-4874b4b27471",objOut:"db8e6cd2-fd1e-46ef-b089-081c3d3e5bde"}]},{name:"texture_out",links:[{portIn:"Multiplier",portOut:"texture_out",objIn:"b07e7a26-d1a9-402f-b404-3d1e0e6be3a4",objOut:"db8e6cd2-fd1e-46ef-b089-081c3d3e5bde"},{portIn:"Mask",portOut:"texture_out",objIn:"8917b9fe-b3a6-40f1-a19e-29e71bf197be",objOut:"db8e6cd2-fd1e-46ef-b089-081c3d3e5bde"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"3fcb33cb-1fc6-4364-ad50-6ea4126e8ba3",portsIn:[{name:"Variable",value:"texIndex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"6632c186-c239-4efb-9e0f-e3443cf18f3a",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"3fcb33cb-1fc6-4364-ad50-6ea4126e8ba3",objOut:"6632c186-c239-4efb-9e0f-e3443cf18f3a"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"cfd0fd3f-12ef-4f1e-8f42-502a14291914",portsIn:[{name:"Variable",value:"noiseSeed"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"bafa8ff5-1b70-45ea-a87d-7fcff918779b",portsIn:[{name:"min",value:0},{name:"max",value:0},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"cfd0fd3f-12ef-4f1e-8f42-502a14291914",objOut:"bafa8ff5-1b70-45ea-a87d-7fcff918779b"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"5cca7484-e2e1-460c-ae4c-bf516d625355",portsIn:[{name:"Variable",value:"noiseSeed"}],portsOut:[{name:"Value",links:[{portIn:"Seed",portOut:"Value",objIn:"ad3bca0d-b0a0-4c0e-80ff-09ac9d9d84b7",objOut:"5cca7484-e2e1-460c-ae4c-bf516d625355"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"b53d9b8a-31a1-4b06-991a-3d5f9dfd1099",portsOut:[{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"25ff2057-8c85-4e08-92e4-309553ee374c",objOut:"b53d9b8a-31a1-4b06-991a-3d5f9dfd1099"}]},{name:"Trigger 1",links:[{portIn:"Render",portOut:"Trigger 1",objIn:"ad3bca0d-b0a0-4c0e-80ff-09ac9d9d84b7",objOut:"b53d9b8a-31a1-4b06-991a-3d5f9dfd1099"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"8ccd1187-f27e-4896-8dd3-6bb72b3edef8",portsIn:[{name:"Variable",value:"interlaceDir"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"85978609-e882-482a-9240-7eb542889e6a",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"8ccd1187-f27e-4896-8dd3-6bb72b3edef8",objOut:"85978609-e882-482a-9240-7eb542889e6a"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"c19fbf57-ea38-4869-889a-11d74dff928a",portsIn:[{name:"Variable",value:"interlaceDir"}],portsOut:[{name:"Value",links:[{portIn:"X or Y",portOut:"Value",objIn:"1f2d345b-a130-4f81-a83b-c030eac030ff",objOut:"c19fbf57-ea38-4869-889a-11d74dff928a"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8eab601b-2407-4df6-8f11-b8e0f2661d96",portsOut:[{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"b07e7a26-d1a9-402f-b404-3d1e0e6be3a4",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"b95ceb07-afcf-48c7-ab28-1bb330143943",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 3",links:[{portIn:"Render",portOut:"Trigger 3",objIn:"8917b9fe-b3a6-40f1-a19e-29e71bf197be",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 4",links:[{portIn:"Render",portOut:"Trigger 4",objIn:"7aeb0acb-3e90-466a-bf40-8088e95f3646",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 5",links:[{portIn:"render",portOut:"Trigger 5",objIn:"b013404b-e1f2-4c1a-8dff-c62b9faa2264",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Trigger 6",links:[{portIn:"Render",portOut:"Trigger 6",objIn:"48e52de8-6a60-4428-94ad-fec5b1287924",objOut:"8eab601b-2407-4df6-8f11-b8e0f2661d96"}]},{name:"Highest Index",value:6}],objName:"Ops.Trigger.RouteTrigger"},{id:"b95ceb07-afcf-48c7-ab28-1bb330143943",portsIn:[{name:"Strength",value:1.7},{name:"Clear",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"42a5c212-f054-4613-a9c7-a60648c3ee61",objOut:"b95ceb07-afcf-48c7-ab28-1bb330143943"}]}],objName:"Ops.Gl.ImageCompose.Emboss"},{id:"8917b9fe-b3a6-40f1-a19e-29e71bf197be",portsIn:[{name:"time",value:0},{name:"SpeedX",value:4},{name:"SpeedY",value:4},{name:"Multiply",value:.01}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"8917b9fe-b3a6-40f1-a19e-29e71bf197be"}]}],objName:"Ops.Gl.ImageCompose.Wobble"},{id:"7aeb0acb-3e90-466a-bf40-8088e95f3646",portsIn:[{name:"amount",value:.25}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"60a017ad-e49f-48b6-aa43-2e510dc2aabc",objOut:"7aeb0acb-3e90-466a-bf40-8088e95f3646"}]}],objName:"Ops.Gl.ImageCompose.Sharpen"},{id:"b013404b-e1f2-4c1a-8dff-c62b9faa2264",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Lens Distort",value:0},{name:"Smooth",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"b013404b-e1f2-4c1a-8dff-c62b9faa2264"}]}],objName:"Ops.Gl.ImageCompose.ChromaticAberration"},{id:"84217149-d257-482a-963f-30a4f383b73b",portsIn:[{name:"Variable",value:"effect"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"f4e13ee8-6e9f-4d87-b945-b1e42c3d0b7e",portsIn:[{name:"min",value:0},{name:"max",value:0},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"84217149-d257-482a-963f-30a4f383b73b",objOut:"f4e13ee8-6e9f-4d87-b945-b1e42c3d0b7e"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"dc65bf42-2f45-4d7b-b3b6-db71a94d201f",portsIn:[{name:"Variable",value:"effect"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"8eab601b-2407-4df6-8f11-b8e0f2661d96",objOut:"dc65bf42-2f45-4d7b-b3b6-db71a94d201f"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"9781e888-abd2-4662-bf84-a0db50595855",portsIn:[{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"Index",portOut:"value",objIn:"e3c29035-7820-433e-9532-4867becf5359",objOut:"9781e888-abd2-4662-bf84-a0db50595855"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"a0699f6e-116b-48b5-873c-561320c6aed1",portsIn:[{name:"Variable",value:"chromAbPxl"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"34627b0b-bb21-49c7-9bee-2c5cc7cfd216",portsIn:[{name:"min",value:-5},{name:"max",value:5},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"a0699f6e-116b-48b5-873c-561320c6aed1",objOut:"34627b0b-bb21-49c7-9bee-2c5cc7cfd216"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"e310ed97-8040-49c0-8aa9-2efe31da739d",portsIn:[{name:"Variable",value:"chromAbPxl"}],portsOut:[{name:"Value",links:[{portIn:"Pixel",portOut:"Value",objIn:"b013404b-e1f2-4c1a-8dff-c62b9faa2264",objOut:"e310ed97-8040-49c0-8aa9-2efe31da739d"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"36ce09b1-5588-4b69-bb63-b55f22e08808",portsIn:[{name:"Variable",value:"wobbleXY"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"ad82861a-c26d-4eba-871d-609358ba4851",portsIn:[{name:"min",value:0},{name:"max",value:0},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Random Seed ",portOut:"result",objIn:"28269797-faac-4f9a-af93-24dfb2a74881",objOut:"ad82861a-c26d-4eba-871d-609358ba4851"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"28269797-faac-4f9a-af93-24dfb2a74881",portsIn:[{name:"Num Values",value:1},{name:"Mode index",value:1},{name:"Mode",value:"AB"},{name:"Integer",value:1},{name:"Last == First",value:0},{name:"Min A",value:0},{name:"Max A",value:100},{name:"Min B",value:0},{name:"Max B",value:100},{name:"Min C",value:-1},{name:"Max C",value:1},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"Value",portOut:"Array Out",objIn:"36ce09b1-5588-4b69-bb63-b55f22e08808",objOut:"28269797-faac-4f9a-af93-24dfb2a74881"}]},{name:"Chunks Amount",value:1},{name:"Array length",value:2}],objName:"Ops.Array.RandomNumbersArray_v4"},{id:"2bd1ab50-2db1-4b21-8c2f-e7104868b2f4",portsIn:[{name:"Variable",value:"wobbleXY"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"18487441-27e8-4adf-af2e-c538676f2acf",objOut:"2bd1ab50-2db1-4b21-8c2f-e7104868b2f4"},{portIn:"array",portOut:"Value",objIn:"8c3d528b-c7c7-479a-b466-b50bf3be6cc7",objOut:"2bd1ab50-2db1-4b21-8c2f-e7104868b2f4"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"18487441-27e8-4adf-af2e-c538676f2acf",portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"RepeatX",portOut:"value",objIn:"8917b9fe-b3a6-40f1-a19e-29e71bf197be",objOut:"18487441-27e8-4adf-af2e-c538676f2acf"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"8c3d528b-c7c7-479a-b466-b50bf3be6cc7",portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"RepeatY",portOut:"value",objIn:"8917b9fe-b3a6-40f1-a19e-29e71bf197be",objOut:"8c3d528b-c7c7-479a-b466-b50bf3be6cc7"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"42a5c212-f054-4613-a9c7-a60648c3ee61",portsIn:[{name:"amount",value:1},{name:"Clamp",value:0},{name:"Mask Invert",value:0},{name:"direction index",value:0},{name:"direction",value:"both"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"42a5c212-f054-4613-a9c7-a60648c3ee61"}]}],objName:"Ops.Gl.ImageCompose.FastBlur"},{id:"60a017ad-e49f-48b6-aa43-2e510dc2aabc",portsIn:[{name:"Exponent",value:.6}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"60a017ad-e49f-48b6-aa43-2e510dc2aabc"}]}],objName:"Ops.Gl.ImageCompose.Denoise"},{id:"4e388ca7-cab8-4e7b-b58b-b9e7c3feb785",portsIn:[{name:"Mask Invert",value:0},{name:"Blendmode 1 index",value:0},{name:"Blendmode 1",value:"normal"},{name:"Mask Source 1 index",value:0},{name:"Mask Source 1",value:"R"},{name:"Opacity 1 index",value:0},{name:"Opacity 1",value:"Normal"},{name:"Amount 1",value:1},{name:"Blendmode 2 index",value:15},{name:"Blendmode 2",value:"softlight"},{name:"Mask Source 2 index",value:0},{name:"Mask Source 2",value:"R"},{name:"Opacity 2 index",value:0},{name:"Opacity 2",value:"Normal"},{name:"Amount 2",value:1},{name:"Blendmode 3 index",value:0},{name:"Blendmode 3",value:"normal"},{name:"Mask Source 3 index",value:0},{name:"Mask Source 3",value:"R"},{name:"Opacity 3 index",value:0},{name:"Opacity 3",value:"Normal"},{name:"Amount 3",value:1},{name:"Blendmode 4 index",value:0},{name:"Blendmode 4",value:"normal"},{name:"Mask Source 4 index",value:0},{name:"Mask Source 4",value:"R"},{name:"Opacity 4 index",value:0},{name:"Opacity 4",value:"Normal"},{name:"Amount 4",value:1},{name:"Blendmode 5 index",value:0},{name:"Blendmode 5",value:"normal"},{name:"Mask Source 5 index",value:0},{name:"Mask Source 5",value:"R"},{name:"Opacity 5 index",value:0},{name:"Opacity 5",value:"Normal"},{name:"Amount 5",value:1},{name:"Blendmode 6 index",value:0},{name:"Blendmode 6",value:"normal"},{name:"Mask Source 6 index",value:0},{name:"Mask Source 6",value:"R"},{name:"Opacity 6 index",value:0},{name:"Opacity 6",value:"Normal"},{name:"Amount 6",value:1},{name:"Blendmode 7 index",value:0},{name:"Blendmode 7",value:"normal"},{name:"Mask Source 7 index",value:0},{name:"Mask Source 7",value:"R"},{name:"Opacity 7 index",value:0},{name:"Opacity 7",value:"Normal"},{name:"Amount 7",value:1},{name:"Blendmode 8 index",value:0},{name:"Blendmode 8",value:"normal"},{name:"Mask Source 8 index",value:0},{name:"Mask Source 8",value:"R"},{name:"Opacity 8 index",value:0},{name:"Opacity 8",value:"Normal"},{name:"Amount 8",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"2482919b-673a-4388-ad26-0b02b697a179",objOut:"4e388ca7-cab8-4e7b-b58b-b9e7c3feb785"}]}],objName:"Ops.Gl.ImageCompose.MultiDrawImage"},{id:"ccb6dd39-ac6a-47c5-b7ff-ebe99583b3d6",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"4e388ca7-cab8-4e7b-b58b-b9e7c3feb785",objOut:"ccb6dd39-ac6a-47c5-b7ff-ebe99583b3d6"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"fdf216a8-1511-4efe-a17a-b0084a356be3",objOut:"ccb6dd39-ac6a-47c5-b7ff-ebe99583b3d6"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"6498eb39-ae25-4fb5-9215-159247350374",portsOut:[{name:"trigger 0",links:[{portIn:"exe",portOut:"trigger 0",objIn:"a0da83aa-50ac-4e12-9db4-152b247ff612",objOut:"6498eb39-ae25-4fb5-9215-159247350374"}]},{name:"trigger 14",links:[{portIn:"Execute",portOut:"trigger 14",objIn:"ff89ece9-0521-4024-b3f0-ad1645c3a3b9",objOut:"6498eb39-ae25-4fb5-9215-159247350374"}]},{name:"trigger 15",links:[{portIn:"Execute",portOut:"trigger 15",objIn:"29fbdb01-588a-4d25-832f-dd012770dd40",objOut:"6498eb39-ae25-4fb5-9215-159247350374"}]}],objName:"Ops.Trigger.Sequence"},{id:"780d3a59-ae9a-4546-b329-550ed0fc6f6a",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:1},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exec",portOut:"trigger",objIn:"dc4f3a48-abe2-4565-966f-46094c4d3354",objOut:"780d3a59-ae9a-4546-b329-550ed0fc6f6a"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"a59bbd30-ce71-4da5-bbc4-b4fcb958086a",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"780d3a59-ae9a-4546-b329-550ed0fc6f6a",objOut:"a59bbd30-ce71-4da5-bbc4-b4fcb958086a"}]},{name:"texture_out",links:[{portIn:"Texture 2",portOut:"texture_out",objIn:"4e388ca7-cab8-4e7b-b58b-b9e7c3feb785",objOut:"a59bbd30-ce71-4da5-bbc4-b4fcb958086a"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"892578cb-0130-4fd0-88cb-7ec699a3a450",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"37c7759c-c226-4152-8e7e-3f30a1b97625",objOut:"892578cb-0130-4fd0-88cb-7ec699a3a450"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"a2b0912c-7870-4e92-8649-003e7e6e17f9",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:8},{name:"Height",value:8},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"892578cb-0130-4fd0-88cb-7ec699a3a450",objOut:"a2b0912c-7870-4e92-8649-003e7e6e17f9"}]},{name:"texture_out",links:[{portIn:"texture1",portOut:"texture_out",objIn:"dc4f3a48-abe2-4565-966f-46094c4d3354",objOut:"a2b0912c-7870-4e92-8649-003e7e6e17f9"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"0e1e2bb1-a963-43cb-8ae0-fc34532cd8db",portsIn:[{name:"Blend Mode index",value:16},{name:"Blend Mode",value:"hardlight"},{name:"Amount",value:1}],objName:"Ops.Gl.ImageCompose.PatternLookup"},{id:"37c7759c-c226-4152-8e7e-3f30a1b97625",portsIn:[{name:"amount",value:1},{name:"Invert Mask",value:0}],objName:"Ops.Gl.ImageCompose.Desaturate"},{id:"283f13a9-a4ad-4253-a518-3e89b013e947",portsIn:[{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Color",value:0},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Integer",value:0},{name:"Seed",value:0},{name:"Channel R",value:1},{name:"Min R",value:0},{name:"Max R",value:1},{name:"Channel G",value:1},{name:"Min G",value:0},{name:"Max G",value:1},{name:"Channel B",value:1},{name:"Min B",value:0},{name:"Max B",value:1},{name:"Channel A",value:1},{name:"Min A",value:1},{name:"Max A",value:1}],portsOut:[{name:"Texture",links:[{portIn:"texture2",portOut:"Texture",objIn:"dc4f3a48-abe2-4565-966f-46094c4d3354",objOut:"283f13a9-a4ad-4253-a518-3e89b013e947"}]},{name:"Total Pixel",value:204800}],objName:"Ops.Gl.Textures.NoiseTexture"},{id:"dc4f3a48-abe2-4565-966f-46094c4d3354",portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"0e1e2bb1-a963-43cb-8ae0-fc34532cd8db",objOut:"dc4f3a48-abe2-4565-966f-46094c4d3354"}]},{name:"texture",links:[{portIn:"Multiplier",portOut:"texture",objIn:"0e1e2bb1-a963-43cb-8ae0-fc34532cd8db",objOut:"dc4f3a48-abe2-4565-966f-46094c4d3354"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"9673fd1d-bc0b-4e5e-bee1-d9056ddffd5e",portsIn:[{name:"Variable",value:"setLookup"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"5c3acac1-4d87-41d2-8492-71fe3d02df18",portsIn:[{name:"min",value:0},{name:"max",value:5},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"9673fd1d-bc0b-4e5e-bee1-d9056ddffd5e",objOut:"5c3acac1-4d87-41d2-8492-71fe3d02df18"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"5a9fa7b3-a1e3-4b52-952c-6eddc4828644",portsIn:[{name:"Variable",value:"setLookup"}],portsOut:[{name:"Value",links:[{portIn:"num",portOut:"Value",objIn:"dc4f3a48-abe2-4565-966f-46094c4d3354",objOut:"5a9fa7b3-a1e3-4b52-952c-6eddc4828644"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"9bdef672-091f-4599-a0dc-5737629f7f6a",portsIn:[{name:"Variable",value:"patternSize"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"682aa349-2dac-4a4f-b130-ef41a0cd90d3",portsIn:[{name:"min",value:.1},{name:"max",value:1},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"9bdef672-091f-4599-a0dc-5737629f7f6a",objOut:"682aa349-2dac-4a4f-b130-ef41a0cd90d3"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"82e4ca93-5af7-4441-bf8f-b97a922d773a",portsIn:[{name:"Variable",value:"patternSize"}],portsOut:[{name:"Value",links:[{portIn:"Width",portOut:"Value",objIn:"0e1e2bb1-a963-43cb-8ae0-fc34532cd8db",objOut:"82e4ca93-5af7-4441-bf8f-b97a922d773a"},{portIn:"Height",portOut:"Value",objIn:"0e1e2bb1-a963-43cb-8ae0-fc34532cd8db",objOut:"82e4ca93-5af7-4441-bf8f-b97a922d773a"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"06c73f1a-64ab-4501-8869-9b8aaaa69ac4",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"066fa9a1-5ecb-4fe0-bf80-704d7cc27194",objOut:"06c73f1a-64ab-4501-8869-9b8aaaa69ac4"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"025508fe-2b54-4bc9-85f0-c9bff6b29bf6",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:8},{name:"Height",value:8},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"06c73f1a-64ab-4501-8869-9b8aaaa69ac4",objOut:"025508fe-2b54-4bc9-85f0-c9bff6b29bf6"}]},{name:"texture_out",links:[{portIn:"texture3",portOut:"texture_out",objIn:"dc4f3a48-abe2-4565-966f-46094c4d3354",objOut:"025508fe-2b54-4bc9-85f0-c9bff6b29bf6"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"066fa9a1-5ecb-4fe0-bf80-704d7cc27194",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Num",value:200},{name:"Width",value:.5},{name:"Rotate",value:.125},{name:"Offset",value:0},{name:"Gradients",value:1},{name:"Circular",value:0},{name:"Invert",value:0},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],objName:"Ops.Gl.ImageCompose.Stripes_v3"},{id:"c3a811fd-a116-4b86-b4f2-0c29bad5c297",portsIn:[{name:"Variable",value:"pNoiseScale"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"cb273409-77a6-4ffd-bfbd-5fb991410578",portsIn:[{name:"min",value:0},{name:"max",value:2},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"next",links:[{portIn:"Generate",portOut:"next",objIn:"ca8218a9-3c6a-474b-9d9e-33fb9a4ab984",objOut:"cb273409-77a6-4ffd-bfbd-5fb991410578"}]},{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"c3a811fd-a116-4b86-b4f2-0c29bad5c297",objOut:"cb273409-77a6-4ffd-bfbd-5fb991410578"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"675dc8b4-2c6d-4add-9bca-8e8e7b368a94",portsIn:[{name:"Variable",value:"pNoiseScale"}],portsOut:[{name:"Value",links:[{portIn:"Scale",portOut:"Value",objIn:"3d945f33-17a0-435a-aa5d-15538ca9d2af",objOut:"675dc8b4-2c6d-4add-9bca-8e8e7b368a94"},{portIn:"scale",portOut:"Value",objIn:"05eaf768-9012-4085-b98c-5fa9417b7c47",objOut:"675dc8b4-2c6d-4add-9bca-8e8e7b368a94"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"48e52de8-6a60-4428-94ad-fec5b1287924",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Strength",value:1},{name:"Radius",value:.626},{name:"Sharp",value:0},{name:"Aspect",value:1},{name:"r",value:0},{name:"g",value:0},{name:"b",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"7d1f344d-f292-4196-8c43-3ee17ff586be",objOut:"48e52de8-6a60-4428-94ad-fec5b1287924"}]}],objName:"Ops.Gl.ImageCompose.Vignette_v2"},{id:"29fbdb01-588a-4d25-832f-dd012770dd40",portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"fdf216a8-1511-4efe-a17a-b0084a356be3",objOut:"29fbdb01-588a-4d25-832f-dd012770dd40"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"ff89ece9-0521-4024-b3f0-ad1645c3a3b9",portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"ccb6dd39-ac6a-47c5-b7ff-ebe99583b3d6",objOut:"ff89ece9-0521-4024-b3f0-ad1645c3a3b9"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"ca8218a9-3c6a-474b-9d9e-33fb9a4ab984",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"cad2827a-7d39-4a54-9598-5513e6175eaa",objOut:"ca8218a9-3c6a-474b-9d9e-33fb9a4ab984"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"cad2827a-7d39-4a54-9598-5513e6175eaa",portsIn:[{name:"Variable",value:"pNoiseHarm"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"7e02b080-5580-419e-9acb-c24c864c984d",portsIn:[{name:"Variable",value:"pNoiseHarm"}],portsOut:[{name:"Value",links:[{portIn:"Number",portOut:"Value",objIn:"f72f6abe-4cbb-4ed8-b3e0-763739d6d5d1",objOut:"7e02b080-5580-419e-9acb-c24c864c984d"},{portIn:"Harmonics index",portOut:"Value",objIn:"05eaf768-9012-4085-b98c-5fa9417b7c47",objOut:"7e02b080-5580-419e-9acb-c24c864c984d"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"f72f6abe-4cbb-4ed8-b3e0-763739d6d5d1",portsOut:[{name:"Result",links:[{portIn:"Harmonics index",portOut:"Result",objIn:"3d945f33-17a0-435a-aa5d-15538ca9d2af",objOut:"f72f6abe-4cbb-4ed8-b3e0-763739d6d5d1"}]}],objName:"Ops.Ui.VizNumber"},{id:"d050e196-03b8-4eed-900e-23c968e79309",portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"e3bc2e90-ca54-4178-a053-09d2334cae0f",portsIn:[{name:"Speed",value:.01},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"Z",portOut:"Time",objIn:"3d945f33-17a0-435a-aa5d-15538ca9d2af",objOut:"e3bc2e90-ca54-4178-a053-09d2334cae0f"},{portIn:"time",portOut:"Time",objIn:"05eaf768-9012-4085-b98c-5fa9417b7c47",objOut:"e3bc2e90-ca54-4178-a053-09d2334cae0f"}]}],objName:"Ops.Anim.Timer_v2"},{id:"54b1c3a7-877b-4bdd-80cf-aca6bb1af336",portsOut:[{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Execute",portOut:"Trigger 0",objIn:"35e8a0da-e794-43c5-abed-199ff132cf4a",objOut:"54b1c3a7-877b-4bdd-80cf-aca6bb1af336"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"05eaf768-9012-4085-b98c-5fa9417b7c47",objOut:"54b1c3a7-877b-4bdd-80cf-aca6bb1af336"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"35e8a0da-e794-43c5-abed-199ff132cf4a",portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"3d945f33-17a0-435a-aa5d-15538ca9d2af",objOut:"35e8a0da-e794-43c5-abed-199ff132cf4a"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"4c62d5c9-96ab-4539-adbf-0b760839d380",portsIn:[{name:"Variable",value:"setNoiseTex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"0a62fba8-e068-40e7-962e-d90194dec3bd",portsIn:[{name:"min",value:0},{name:"max",value:1},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"4c62d5c9-96ab-4539-adbf-0b760839d380",objOut:"0a62fba8-e068-40e7-962e-d90194dec3bd"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"d8330ac9-73a0-4e87-af66-7cfb4006fce5",portsIn:[{name:"Variable",value:"setNoiseTex"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"54b1c3a7-877b-4bdd-80cf-aca6bb1af336",objOut:"d8330ac9-73a0-4e87-af66-7cfb4006fce5"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"05eaf768-9012-4085-b98c-5fa9417b7c47",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"smoothness",value:1},{name:"Harmonics",value:"1"},{name:"Aspect",value:0},{name:"x",value:0},{name:"Offset Multiply",value:1},{name:"Offset X index",value:0},{name:"Offset X",value:"None"},{name:"Offset Y index",value:0},{name:"Offset Y",value:"None"},{name:"Offset Z index",value:1},{name:"Offset Z",value:"R"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"575e6cef-482d-4c09-b505-2fa50834a66d",objOut:"05eaf768-9012-4085-b98c-5fa9417b7c47"}]}],objName:"Ops.Gl.ImageCompose.Noise.SimplexNoise"},{id:"0d2eb042-3aef-4dc6-9925-7f2aa6287f1f",portsIn:[{name:"key code",value:83},{name:"canvas only",value:1},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:1},{name:"Prevent Default",value:1}],portsOut:[{name:"on press",links:[{portIn:"trigger",portOut:"on press",objIn:"654a939c-e7ec-4024-8cc8-a722ef3d1f0f",objOut:"0d2eb042-3aef-4dc6-9925-7f2aa6287f1f"}]},{name:"Pressed",value:1},{name:"Key",value:"S"}],objName:"Ops.Devices.Keyboard.KeyPressLearn"},{id:"654a939c-e7ec-4024-8cc8-a722ef3d1f0f",portsIn:[{name:"Default",value:0}],portsOut:[{name:"result",links:[{portIn:"Boolean",portOut:"result",objIn:"bea187f9-432b-4cb6-a3ee-a715de38bb50",objOut:"654a939c-e7ec-4024-8cc8-a722ef3d1f0f"}]}],objName:"Ops.Boolean.ToggleBool"},{id:"bea187f9-432b-4cb6-a3ee-a715de38bb50",portsOut:[{name:"Result",links:[{portIn:"Active",portOut:"Result",objIn:"7622a63a-ecd7-4a72-82df-d360307352b4",objOut:"bea187f9-432b-4cb6-a3ee-a715de38bb50"}]}],objName:"Ops.Boolean.Not"},{id:"416f140b-58f6-420b-9183-fbdcd1a021d1",portsIn:[{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"width",links:[{portIn:"Width",portOut:"width",objIn:"283f13a9-a4ad-4253-a518-3e89b013e947",objOut:"416f140b-58f6-420b-9183-fbdcd1a021d1"}]},{name:"height",links:[{portIn:"Height",portOut:"height",objIn:"283f13a9-a4ad-4253-a518-3e89b013e947",objOut:"416f140b-58f6-420b-9183-fbdcd1a021d1"}]},{name:"Pixel Ratio",value:1},{name:"Aspect Ratio",value:2},{name:"Landscape",value:1}],objName:"Ops.Gl.CanvasInfo"},{id:"256e243d-c48a-4d8d-a4d0-48961f951832",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Waveform",value:"Sine"},{name:"Line Width",value:0},{name:"invert color",value:0},{name:"Solid fill",value:0},{name:"Offset X",value:0},{name:"Offset Y",value:.5},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"5f8105be-b333-4522-b6b0-d562d89cb48d",objOut:"256e243d-c48a-4d8d-a4d0-48961f951832"}]}],objName:"Ops.Gl.ImageCompose.Waveform_v2"},{id:"4ad5f80d-8cce-4b66-b166-9e62a8465c7d",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"4ad5f80d-8cce-4b66-b166-9e62a8465c7d"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"06a13487-7127-498d-b7c1-53b3d1da21c4",portsIn:[{name:"Use viewport size",value:1},{name:"Width",value:8},{name:"Height",value:8},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"4ad5f80d-8cce-4b66-b166-9e62a8465c7d",objOut:"06a13487-7127-498d-b7c1-53b3d1da21c4"}]},{name:"texture_out",links:[{portIn:"texture1",portOut:"texture_out",objIn:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe",objOut:"06a13487-7127-498d-b7c1-53b3d1da21c4"},{portIn:"Image",portOut:"texture_out",objIn:"25ff2057-8c85-4e08-92e4-309553ee374c",objOut:"06a13487-7127-498d-b7c1-53b3d1da21c4"}]},{name:"Aspect Ratio",value:2}],objName:"Ops.Gl.ImageCompose.ImageCompose_v2"},{id:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe",portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"355cfe5b-8a22-4722-bd28-e509c8250150",objOut:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe"}]},{name:"texture",links:[{portIn:"Mask",portOut:"texture",objIn:"355cfe5b-8a22-4722-bd28-e509c8250150",objOut:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"e55e0009-59b9-4727-a873-f534ac89340a",portsIn:[{name:"Variable",value:"blurMaskIndex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"5388eb95-4517-4f2d-8393-f441003e0e91",portsIn:[{name:"min",value:0},{name:"max",value:4},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"e55e0009-59b9-4727-a873-f534ac89340a",objOut:"5388eb95-4517-4f2d-8393-f441003e0e91"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"b4fe2242-da67-4a8f-b798-a47cffb6c355",portsIn:[{name:"Variable",value:"blurMaskIndex"}],portsOut:[{name:"Value",links:[{portIn:"Number",portOut:"Value",objIn:"5495fc39-950b-4133-a77a-383b25d37956",objOut:"b4fe2242-da67-4a8f-b798-a47cffb6c355"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"5495fc39-950b-4133-a77a-383b25d37956",portsOut:[{name:"Result",links:[{portIn:"num",portOut:"Result",objIn:"c7b729ea-1e46-436e-9fd9-92756a5ab1fe",objOut:"5495fc39-950b-4133-a77a-383b25d37956"}]}],objName:"Ops.Ui.VizNumber"},{id:"b9c85eeb-3d71-4aa1-973f-9bd7b12610aa",portsIn:[{name:"min",value:0},{name:"max",value:4},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Random Seed ",portOut:"result",objIn:"215606e7-2d16-493e-86b9-e46a89d8bb39",objOut:"b9c85eeb-3d71-4aa1-973f-9bd7b12610aa"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"215606e7-2d16-493e-86b9-e46a89d8bb39",portsIn:[{name:"Num Values",value:1},{name:"Mode index",value:3},{name:"Mode",value:"ABCD"},{name:"Integer",value:0},{name:"Last == First",value:0},{name:"Min A",value:.01},{name:"Max A",value:2},{name:"Min B",value:.1},{name:"Max B",value:1},{name:"Min C",value:.1},{name:"Max C",value:.4},{name:"Min D",value:0},{name:"Max D",value:4}],portsOut:[{name:"Array Out",links:[{portIn:"Value",portOut:"Array Out",objIn:"efc1ada2-c046-410d-91ec-6a6d0e0a91a9",objOut:"215606e7-2d16-493e-86b9-e46a89d8bb39"}]},{name:"Chunks Amount",value:1},{name:"Array length",value:4}],objName:"Ops.Array.RandomNumbersArray_v4"},{id:"efc1ada2-c046-410d-91ec-6a6d0e0a91a9",portsIn:[{name:"Variable",value:"waveformPars"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"561caea9-8de0-4dda-ac30-22f7638f49bd",portsIn:[{name:"Variable",value:"waveformPars"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"dd00862b-0473-4327-8eb5-0c306a006555",objOut:"561caea9-8de0-4dda-ac30-22f7638f49bd"},{portIn:"array",portOut:"Value",objIn:"61b1520a-b630-49d4-ac4c-16916bc4e720",objOut:"561caea9-8de0-4dda-ac30-22f7638f49bd"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"dd00862b-0473-4327-8eb5-0c306a006555",portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"Amplitude",portOut:"X",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"dd00862b-0473-4327-8eb5-0c306a006555"}]},{name:"Y",links:[{portIn:"Frequency",portOut:"Y",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"dd00862b-0473-4327-8eb5-0c306a006555"}]},{name:"Z",links:[{portIn:"Line Glow",portOut:"Z",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"dd00862b-0473-4327-8eb5-0c306a006555"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"61b1520a-b630-49d4-ac4c-16916bc4e720",portsIn:[{name:"index",value:3},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"Waveform index",portOut:"value",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"61b1520a-b630-49d4-ac4c-16916bc4e720"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"0f639171-2713-4287-98f1-48a7429a370f",portsIn:[{name:"Speed",value:.1},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"time",portOut:"Time",objIn:"5f8105be-b333-4522-b6b0-d562d89cb48d",objOut:"0f639171-2713-4287-98f1-48a7429a370f"}]}],objName:"Ops.Anim.Timer_v2"},{id:"f6e10755-ba5c-4423-aa90-d7a57a1a7877",portsIn:[{name:"Blend Mode index",value:15},{name:"Blend Mode",value:"softlight"},{name:"Amount",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"scale",value:13.4},{name:"scrollX",value:9},{name:"scrollY",value:0},{name:"repeat",value:1},{name:"aspect",value:1},{name:"Layer 1",value:1},{name:"Layer 2",value:1},{name:"Layer 3",value:1},{name:"Layer 4",value:1},{name:"Tileable",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"5e814346-272e-420b-9f22-9ed6a4759c03",objOut:"f6e10755-ba5c-4423-aa90-d7a57a1a7877"}]}],objName:"Ops.Gl.ImageCompose.Noise.FBMNoise"},{id:"a9d0b8de-8551-4cfb-8a19-6daed8437ef5",portsIn:[{name:"min",value:0},{name:"max",value:.5},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"6a1b9b1a-3fff-4aed-8a0d-1fac5de430cc",objOut:"a9d0b8de-8551-4cfb-8a19-6daed8437ef5"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"6a1b9b1a-3fff-4aed-8a0d-1fac5de430cc",portsIn:[{name:"Variable",value:"waveformRot"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"77c688ae-9f4f-4bd9-a5f7-7e8ac5d97b4e",portsIn:[{name:"Variable",value:"waveformRot"}],portsOut:[{name:"Value",links:[{portIn:"Rotate",portOut:"Value",objIn:"256e243d-c48a-4d8d-a4d0-48961f951832",objOut:"77c688ae-9f4f-4bd9-a5f7-7e8ac5d97b4e"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"5e814346-272e-420b-9f22-9ed6a4759c03",portsIn:[{name:"Blend Mode index",value:15},{name:"Blend Mode",value:"softlight"},{name:"Amount",value:1},{name:"Strength",value:4},{name:"Width",value:.1},{name:"Mul Color",value:0}],objName:"Ops.Gl.ImageCompose.EdgeDetection_v3"},{id:"5f8105be-b333-4522-b6b0-d562d89cb48d",portsIn:[{name:"Blend Mode index",value:15},{name:"Blend Mode",value:"softlight"},{name:"Amount",value:1},{name:"smoothness",value:3.93},{name:"Harmonics",value:"3"},{name:"Aspect",value:0},{name:"x",value:0},{name:"y",value:0},{name:"Offset Multiply",value:1},{name:"Offset X index",value:0},{name:"Offset X",value:"None"},{name:"Offset Y index",value:0},{name:"Offset Y",value:"None"},{name:"Offset Z index",value:1},{name:"Offset Z",value:"R"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"f6e10755-ba5c-4423-aa90-d7a57a1a7877",objOut:"5f8105be-b333-4522-b6b0-d562d89cb48d"}]}],objName:"Ops.Gl.ImageCompose.Noise.SimplexNoise"},{id:"5721a4a7-57ee-4105-819c-6fdd4f4cd496",portsIn:[{name:"Speed",value:1},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"anim",portOut:"Time",objIn:"f6e10755-ba5c-4423-aa90-d7a57a1a7877",objOut:"5721a4a7-57ee-4105-819c-6fdd4f4cd496"}]}],objName:"Ops.Anim.Timer_v2"},{id:"2a494edf-5656-48c0-8fe5-7204fc475ee9",portsIn:[{name:"Variable",value:"sNoiseHarm"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"0bbb154f-4b82-4151-b049-2c7c35213719",portsIn:[{name:"Variable",value:"sNoiseScale"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"f92de782-beee-4236-a943-eef306b8c17a",portsIn:[{name:"min",value:2},{name:"max",value:4},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"next",links:[{portIn:"Generate",portOut:"next",objIn:"3184c05c-9066-4c79-a7e0-af1eb750d5ba",objOut:"f92de782-beee-4236-a943-eef306b8c17a"}]},{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"0bbb154f-4b82-4151-b049-2c7c35213719",objOut:"f92de782-beee-4236-a943-eef306b8c17a"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"3184c05c-9066-4c79-a7e0-af1eb750d5ba",portsIn:[{name:"min",value:0},{name:"max",value:3},{name:"Integer",value:1},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"2a494edf-5656-48c0-8fe5-7204fc475ee9",objOut:"3184c05c-9066-4c79-a7e0-af1eb750d5ba"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"218b1bc7-c1b2-4173-a241-2c9745c6924b",portsIn:[{name:"Variable",value:"sNoiseScale"}],portsOut:[{name:"Value",links:[{portIn:"scale",portOut:"Value",objIn:"5f8105be-b333-4522-b6b0-d562d89cb48d",objOut:"218b1bc7-c1b2-4173-a241-2c9745c6924b"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"30cd9add-ab41-4cd5-a85c-e5a5d90c38b5",portsIn:[{name:"Variable",value:"sNoiseHarm"}],portsOut:[{name:"Value",links:[{portIn:"Harmonics index",portOut:"Value",objIn:"5f8105be-b333-4522-b6b0-d562d89cb48d",objOut:"30cd9add-ab41-4cd5-a85c-e5a5d90c38b5"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"b5c44065-3634-441e-ad8f-2c871103e7ab",portsIn:[{name:"key code",value:72},{name:"canvas only",value:1},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:1},{name:"Prevent Default",value:1}],portsOut:[{name:"on press",links:[{portIn:"trigger",portOut:"on press",objIn:"aa90a158-e101-4ff8-9cfb-17b853251e8e",objOut:"b5c44065-3634-441e-ad8f-2c871103e7ab"}]},{name:"Pressed",value:0},{name:"Key",value:"H"}],objName:"Ops.Devices.Keyboard.KeyPressLearn"},{id:"aa90a158-e101-4ff8-9cfb-17b853251e8e",portsIn:[{name:"Default",value:0}],portsOut:[{name:"result",links:[{portIn:"Switch Value",portOut:"result",objIn:"2482919b-673a-4388-ad26-0b02b697a179",objOut:"aa90a158-e101-4ff8-9cfb-17b853251e8e"}]}],objName:"Ops.Boolean.ToggleBool"},{id:"d5447345-8747-4436-b25d-76c6540ce18a",portsIn:[{name:"amount",value:2}],objName:"Ops.Gl.ImageCompose.Vibrance"},{id:"2482919b-673a-4388-ad26-0b02b697a179",portsOut:[{name:"Switched Value",value:0},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"4af76dbf-0d8a-41d6-94e3-07cd809db924",objOut:"2482919b-673a-4388-ad26-0b02b697a179"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"4af76dbf-0d8a-41d6-94e3-07cd809db924",portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Pixel",value:5},{name:"Lens Distort",value:0},{name:"Smooth",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"d5447345-8747-4436-b25d-76c6540ce18a",objOut:"4af76dbf-0d8a-41d6-94e3-07cd809db924"}]}],objName:"Ops.Gl.ImageCompose.ChromaticAberration"},{id:"25ff2057-8c85-4e08-92e4-309553ee374c",portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"e00680b1-7b89-43a3-9d6c-e430c7d70b47",objOut:"25ff2057-8c85-4e08-92e4-309553ee374c"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"e00680b1-7b89-43a3-9d6c-e430c7d70b47",portsIn:[{name:"Blend Mode index",value:6},{name:"Blend Mode",value:"add"},{name:"Mask Invert",value:0},{name:"Amount",value:.201}],objName:"Ops.Gl.ImageCompose.Invert"},{id:"a2f06c9a-3a07-47aa-9903-5615d7286615",portsIn:[{name:"Variable",value:"setNoiseTex"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"b53d9b8a-31a1-4b06-991a-3d5f9dfd1099",objOut:"a2f06c9a-3a07-47aa-9903-5615d7286615"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"9d6caa9f-52b0-4c3e-8528-5a1d0281ad77",portsIn:[{name:"Smooth",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"d050e196-03b8-4eed-900e-23c968e79309",objOut:"9d6caa9f-52b0-4c3e-8528-5a1d0281ad77"}]}],objName:"Ops.Color.ColorPalettes"},{id:"17846cc8-9a85-44fb-b46b-771e03ce75f4",portsIn:[{name:"index",value:12},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"Index",portOut:"value",objIn:"9d6caa9f-52b0-4c3e-8528-5a1d0281ad77",objOut:"17846cc8-9a85-44fb-b46b-771e03ce75f4"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"8fa67302-88f5-460e-9d75-b9a3ac804577",portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"14970043-7d0d-4a59-8494-375eb3f7235e",portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"c085d62c-8367-4bba-8aad-3d78afb5e563",portsIn:[{name:"Index",value:62},{name:"Smooth",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"14970043-7d0d-4a59-8494-375eb3f7235e",objOut:"c085d62c-8367-4bba-8aad-3d78afb5e563"}]}],objName:"Ops.Color.ColorPalettes"},{id:"80767b8f-3437-4b27-892f-1a4ef387a463",portsIn:[{name:"Limit",value:15},{name:"Slider",value:0},{name:"Index 0",value:637},{name:"Index 1",value:127},{name:"Index 2",value:624},{name:"Index 3",value:763},{name:"Index 4",value:76},{name:"Index 5",value:62},{name:"Index 6",value:202},{name:"Index 7",value:132},{name:"Index 8",value:333},{name:"Index 9",value:66},{name:"Index 10",value:313},{name:"Index 11",value:208},{name:"Index 12",value:271},{name:"Index 13",value:89},{name:"Index 14",value:263},{name:"Index 15",value:0},{name:"Index 16",value:0},{name:"Index 17",value:0},{name:"Index 18",value:0},{name:"Index 19",value:0},{name:"Index 20",value:0},{name:"Index 21",value:0},{name:"Index 22",value:0},{name:"Index 23",value:0},{name:"Index 24",value:0},{name:"Index 25",value:0},{name:"Index 26",value:0},{name:"Index 27",value:0},{name:"Index 28",value:0},{name:"Index 29",value:0}],objName:"Ops.Array.ArrayFromNumbers"},{id:"dab4c8fa-b172-4eaa-b46c-c2cd23afe627",portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"80767b8f-3437-4b27-892f-1a4ef387a463",objOut:"dab4c8fa-b172-4eaa-b46c-c2cd23afe627"}]}],objName:"Ops.Trigger.TriggerButton"},{id:"060c9142-992c-490f-bfed-8613cf6b17a4",portsIn:[{name:"Number",value:0},{name:"storedJson",value:"[637,127,624,763,76,62,202,132,333,66,313,208,271,89,263]"}],portsOut:[{name:"Frozen Array",links:[{portIn:"array",portOut:"Frozen Array",objIn:"9781e888-abd2-4662-bf84-a0db50595855",objOut:"060c9142-992c-490f-bfed-8613cf6b17a4"}]}],objName:"Ops.Array.FreezeArray"},{id:"58f9a74f-3036-4500-acf3-44375ad323d2",portsIn:[{name:"Number",value:0},{name:"storedJson",value:"[637,127,624,763,76,62,202,132,333,66,313,208,271,89,263]"}],portsOut:[{name:"Frozen Array",links:[{portIn:"array",portOut:"Frozen Array",objIn:"17846cc8-9a85-44fb-b46b-771e03ce75f4",objOut:"58f9a74f-3036-4500-acf3-44375ad323d2"}]}],objName:"Ops.Array.FreezeArray"},{id:"426e6c3e-2b3c-4dee-af9d-ab08c6f71c7c",portsIn:[{name:"title",value:"Unrelated feature"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"}],export:{time:"2026-02-10 05:20",service:"html",exportNumber:1}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["j656st"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Json=Ops.Json||{};Ops.Math=Ops.Math||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Color=Ops.Color||{};Ops.String=Ops.String||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Devices.Mouse=Ops.Devices.Mouse||{};Ops.Gl.ImageCompose=Ops.Gl.ImageCompose||{};Ops.Devices.Keyboard=Ops.Devices.Keyboard||{};Ops.Gl.ImageCompose.Noise=Ops.Gl.ImageCompose.Noise||{};Ops.Gl.MainLoop=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inValue("FPS Limit",0),i=n.outTrigger("trigger"),r=n.outNumber("width"),a=n.outNumber("height"),s=n.inValueBool("Reduce FPS not focussed",false),o=n.inValueBool("Reduce FPS loading"),l=n.inValueBool("Clear",true),u=n.inValueBool("ClearAlpha",true),h=n.inValueBool("Fullscreen Button",false),c=n.inValueBool("Active",true),f=n.inValueBool("Hires Displays",false),d=n.inSwitch("Pixel Unit",["Display","CSS"],"Display");n.onAnimFrame=B;f.onChange=function(){if(f.get())n.patch.cgl.pixelDensity=window.devicePixelRatio;else n.patch.cgl.pixelDensity=1;n.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()};c.onChange=function(){n.patch.removeOnAnimFrame(n);if(c.get()){n.setUiAttrib({extendTitle:""});n.onAnimFrame=B;n.patch.addOnAnimFrame(n);n.log("adding again!")}else{n.setUiAttrib({extendTitle:"Inactive"})}};const g=n.patch.cgl;if(CABLES.UI)gui.canvasManager.addCgContext(n.patch.cgl);if(CABLES.UI)gui.setLayout();let p=0;let m=0;let _=null;let b=false;if(!n.patch.cgl)n.uiAttr({error:"No webgl cgl context"});const v=vec3.create();vec3.set(v,0,0,0);const E=vec3.create();vec3.set(E,0,0,-2);h.onChange=T;setTimeout(T,100);let F=null;let A=true;let C=true;window.addEventListener("blur",()=>{A=false});window.addEventListener("focus",()=>{A=true});document.addEventListener("visibilitychange",()=>{C=!document.hidden});I();n.patch.tempData.mainloopOp=this;d.onChange=()=>{r.set(0);a.set(0)};function x(){if(o.get()&&n.patch.loading.getProgress()<1)return 5;if(s.get()){if(!C)return 10;if(!A)return 30}return t.get()}function T(){function e(){if(F)F.style.display="block"}function t(){if(F)F.style.display="none"}n.patch.cgl.canvas.addEventListener("mouseleave",t);n.patch.cgl.canvas.addEventListener("mouseenter",e);if(h.get()){if(!F){F=document.createElement("div");const i=n.patch.cgl.canvas.parentElement;if(i)i.appendChild(F);F.addEventListener("mouseenter",e);F.addEventListener("click",function(e){if(CABLES.UI&&!e.shiftKey)gui.toggleMaximizeCanvas();else g.fullScreen()})}F.style.padding="10px";F.style.position="absolute";F.style.right="5px";F.style.top="5px";F.style.width="20px";F.style.height="20px";F.style.cursor="pointer";F.style["border-radius"]="40px";F.style.background="#444";F.style["z-index"]="9999";F.style.display="none";F.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 490 490" style="width:20px;height:20px;" xml:space="preserve" width="512px" height="512px"><g><path d="M173.792,301.792L21.333,454.251v-80.917c0-5.891-4.776-10.667-10.667-10.667C4.776,362.667,0,367.442,0,373.333V480     c0,5.891,4.776,10.667,10.667,10.667h106.667c5.891,0,10.667-4.776,10.667-10.667s-4.776-10.667-10.667-10.667H36.416     l152.459-152.459c4.093-4.237,3.975-10.99-0.262-15.083C184.479,297.799,177.926,297.799,173.792,301.792z" fill="#FFFFFF"/><path d="M480,0H373.333c-5.891,0-10.667,4.776-10.667,10.667c0,5.891,4.776,10.667,10.667,10.667h80.917L301.792,173.792     c-4.237,4.093-4.354,10.845-0.262,15.083c4.093,4.237,10.845,4.354,15.083,0.262c0.089-0.086,0.176-0.173,0.262-0.262     L469.333,36.416v80.917c0,5.891,4.776,10.667,10.667,10.667s10.667-4.776,10.667-10.667V10.667C490.667,4.776,485.891,0,480,0z" fill="#FFFFFF"/><path d="M36.416,21.333h80.917c5.891,0,10.667-4.776,10.667-10.667C128,4.776,123.224,0,117.333,0H10.667     C4.776,0,0,4.776,0,10.667v106.667C0,123.224,4.776,128,10.667,128c5.891,0,10.667-4.776,10.667-10.667V36.416l152.459,152.459     c4.237,4.093,10.99,3.975,15.083-0.262c3.992-4.134,3.992-10.687,0-14.82L36.416,21.333z" fill="#FFFFFF"/><path d="M480,362.667c-5.891,0-10.667,4.776-10.667,10.667v80.917L316.875,301.792c-4.237-4.093-10.99-3.976-15.083,0.261     c-3.993,4.134-3.993,10.688,0,14.821l152.459,152.459h-80.917c-5.891,0-10.667,4.776-10.667,10.667s4.776,10.667,10.667,10.667     H480c5.891,0,10.667-4.776,10.667-10.667V373.333C490.667,367.442,485.891,362.667,480,362.667z" fill="#FFFFFF"/></g></svg>'}else{if(F){F.style.display="none";F.remove();F=null}}}n.onDelete=function(){g.gl.clearColor(0,0,0,0);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)};function B(e){if(!c.get())return;if(g.aborted||g.canvas.clientWidth===0||g.canvas.clientHeight===0)return;n.patch.cg=g;if(f.get())n.patch.cgl.pixelDensity=window.devicePixelRatio;const t=performance.now();n.patch.config.fpsLimit=x();if(g.canvasWidth==-1){g.setCanvas(n.patch.config.glCanvasId);return}if(g.canvasWidth!=r.get()||g.canvasHeight!=a.get()){let e=1;if(d.get()=="CSS")e=n.patch.cgl.pixelDensity;r.set(g.canvasWidth/e);a.set(g.canvasHeight/e)}if(CABLES.now()-m>1e3){CGL.fpsReport=CGL.fpsReport||[];if(n.patch.loading.getProgress()>=1&&m!==0)CGL.fpsReport.push(p);p=0;m=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;g.renderStart(g,v,E);if(l.get()){g.gl.clearColor(0,0,0,1);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)}i.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(g);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}g.renderEnd(g);n.patch.cg=null;if(u.get()){g.gl.clearColor(1,1,1,1);g.gl.colorMask(false,false,false,true);g.gl.clear(g.gl.COLOR_BUFFER_BIT);g.gl.colorMask(true,true,true,true)}if(!g.tempData.phong)g.tempData.phong={};p++;n.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function I(){clearTimeout(_);_=setTimeout(()=>{if(n.patch.getOpsByObjName(n.name).length>1){n.setUiError("multimainloop","there should only be one mainloop op!");if(!b)b=n.patch.addEventListener("onOpDelete",I)}else n.setUiError("multimainloop",null,1)},500)}}};Ops.Gl.ImageCompose.DrawImage_v3=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={drawimage_frag:"#ifdef HAS_TEXTURES\n    IN vec2 texCoord;\n    UNI sampler2D tex;\n    UNI sampler2D image;\n#endif\n\n#ifdef TEX_TRANSFORM\n    IN mat3 transform;\n#endif\n// UNI float rotate;\n\n{{CGL.BLENDMODES}}\n\n#ifdef HAS_TEXTUREALPHA\n   UNI sampler2D imageAlpha;\n#endif\n\nUNI float amount;\n\n#ifdef ASPECT_RATIO\n    UNI float aspectTex;\n    UNI float aspectPos;\n#endif\n\nvoid main()\n{\n    vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);\n\n    #ifdef HAS_TEXTURES\n        vec2 tc=texCoord;\n\n        #ifdef TEX_FLIP_X\n            tc.x=1.0-tc.x;\n        #endif\n        #ifdef TEX_FLIP_Y\n            tc.y=1.0-tc.y;\n        #endif\n\n        #ifdef ASPECT_RATIO\n            #ifdef ASPECT_AXIS_X\n                tc.y=(1.0-aspectPos)-(((1.0-aspectPos)-tc.y)*aspectTex);\n            #endif\n            #ifdef ASPECT_AXIS_Y\n                tc.x=(1.0-aspectPos)-(((1.0-aspectPos)-tc.x)/aspectTex);\n            #endif\n        #endif\n\n        #ifdef TEX_TRANSFORM\n            vec3 coordinates=vec3(tc.x, tc.y,1.0);\n            tc=(transform * coordinates ).xy;\n        #endif\n\n        blendRGBA=texture(image,tc);\n\n        vec3 blend=blendRGBA.rgb;\n        vec4 baseRGBA=texture(tex,texCoord);\n        vec3 base=baseRGBA.rgb;\n\n\n        #ifdef PREMUL\n            blend.rgb = (blend.rgb) + (base.rgb * (1.0 - blendRGBA.a));\n        #endif\n\n        vec3 colNew=_blend(base,blend);\n\n\n\n\n        #ifdef REMOVE_ALPHA_SRC\n            blendRGBA.a=1.0;\n        #endif\n\n        #ifdef HAS_TEXTUREALPHA\n            vec4 colImgAlpha=texture(imageAlpha,tc);\n            float colImgAlphaAlpha=colImgAlpha.a;\n\n            #ifdef ALPHA_FROM_LUMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef ALPHA_FROM_INV_UMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=1.0-(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef INVERT_ALPHA\n                colImgAlphaAlpha=clamp(colImgAlphaAlpha,0.0,1.0);\n                colImgAlphaAlpha=1.0-colImgAlphaAlpha;\n            #endif\n\n            blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n        #endif\n    #endif\n\n    float am=amount;\n\n    #ifdef CLIP_REPEAT\n        if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n        {\n            // colNew.rgb=vec3(0.0);\n            am=0.0;\n        }\n    #endif\n\n    #ifdef ASPECT_RATIO\n        #ifdef ASPECT_CROP\n            if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n            {\n                colNew.rgb=base.rgb;\n                am=0.0;\n            }\n\n        #endif\n    #endif\n\n\n\n    #ifndef PREMUL\n        blendRGBA.rgb=mix(colNew,base,1.0-(am*blendRGBA.a));\n        blendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n    #endif\n\n    #ifdef PREMUL\n        // premultiply\n        // blendRGBA.rgb = (blendRGBA.rgb) + (baseRGBA.rgb * (1.0 - blendRGBA.a));\n        blendRGBA=vec4(\n            mix(colNew.rgb,base,1.0-(am*blendRGBA.a)),\n            blendRGBA.a*am+baseRGBA.a\n            );\n    #endif\n\n    #ifdef ALPHA_MASK\n    blendRGBA.a=baseRGBA.a;\n    #endif\n\n    outColor=blendRGBA;\n}\n\n\n\n\n\n\n\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=n.inTrigger("render"),i=CGL.TextureEffect.AddBlendSelect(n,"blendMode"),r=n.inValueSlider("amount",1),a=n.inTexture("Image"),s=n.inValueBool("Premultiplied",false),o=n.inValueBool("Alpha Mask",false),l=n.inValueBool("removeAlphaSrc",false),u=n.inTexture("Mask"),h=n.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance"),c=n.inBool("Invert alpha channel"),f=n.inValueBool("Aspect Ratio",false),d=n.inValueSelect("Stretch Axis",["X","Y"],"X"),g=n.inValueSlider("Position",0),p=n.inValueBool("Crop",false),m=n.outTrigger("trigger");i.set("normal");const _=n.patch.cgl;const b=new CGL.Shader(_,"drawimage");u.onLinkChanged=v;n.setPortGroup("Aspect Ratio",[f,g,p,d]);n.setPortGroup("Mask",[u,h,c]);function v(){if(u.isLinked()){l.setUiAttribs({greyout:true});h.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false})}else{l.setUiAttribs({greyout:false});h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true})}}n.toWorkPortsNeedToBeLinked(a);b.setSource(e.drawimage_vert,e.drawimage_frag);const E=new CGL.Uniform(b,"t","tex",0),L=new CGL.Uniform(b,"t","image",1),R=new CGL.Uniform(b,"t","imageAlpha",2),F=new CGL.Uniform(b,"f","aspectTex",1),P=new CGL.Uniform(b,"f","aspectPos",g);f.onChange=p.onChange=d.onChange=A;function A(){b.removeDefine("ASPECT_AXIS_X");b.removeDefine("ASPECT_AXIS_Y");b.removeDefine("ASPECT_CROP");g.setUiAttribs({greyout:!f.get()});p.setUiAttribs({greyout:!f.get()});d.setUiAttribs({greyout:!f.get()});if(f.get()){b.define("ASPECT_RATIO");if(p.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}else{b.removeDefine("ASPECT_RATIO");if(p.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}}const C=n.inValueBool("flip x");const x=n.inValueBool("flip y");let T=n.inValueBool("Transform");let B=n.inValueSlider("Scale X",1);let I=n.inValueSlider("Scale Y",1);let D=n.inValue("Position X",0);let S=n.inValue("Position Y",0);let O=n.inValue("Rotation",0);const y=n.inValueBool("Clip Repeat",false);const k=new CGL.Uniform(b,"f","scaleX",B);const U=new CGL.Uniform(b,"f","scaleY",I);const V=new CGL.Uniform(b,"f","posX",D);const G=new CGL.Uniform(b,"f","posY",S);const j=new CGL.Uniform(b,"f","rotate",O);T.onChange=w;function w(){b.toggleDefine("TEX_TRANSFORM",T.get());B.setUiAttribs({greyout:!T.get()});I.setUiAttribs({greyout:!T.get()});D.setUiAttribs({greyout:!T.get()});S.setUiAttribs({greyout:!T.get()});O.setUiAttribs({greyout:!T.get()})}CGL.TextureEffect.setupBlending(n,b,i,r);const z=new CGL.Uniform(b,"f","amount",r);t.onTriggered=M;y.onChange=u.onChange=s.onChange=o.onChange=c.onChange=x.onChange=C.onChange=l.onChange=h.onChange=N;w();v();A();N();function N(){b.toggleDefine("REMOVE_ALPHA_SRC",l.get());b.toggleDefine("ALPHA_MASK",o.get());b.toggleDefine("CLIP_REPEAT",y.get());b.toggleDefine("HAS_TEXTUREALPHA",u.get()&&u.get().tex);b.toggleDefine("TEX_FLIP_X",C.get());b.toggleDefine("TEX_FLIP_Y",x.get());b.toggleDefine("INVERT_ALPHA",c.get());b.toggleDefine("ALPHA_FROM_LUMINANCE",h.get()=="luminance");b.toggleDefine("ALPHA_FROM_INV_UMINANCE",h.get()=="luminance_inv");b.toggleDefine("PREMUL",s.get())}function M(){if(!CGL.TextureEffect.checkOpInEffect(n))return;const e=a.get();if(e&&e.tex&&r.get()>0){_.pushShader(b);_.currentTextureEffect.bind();const t=_.currentTextureEffect.getCurrentSourceTexture();_.setTexture(0,t.tex);const i=1/(_.currentTextureEffect.getWidth()/_.currentTextureEffect.getHeight())*(e.width/e.height);F.setValue(i);_.setTexture(1,e.tex);if(u.get()&&u.get().tex){_.setTexture(2,u.get().tex)}_.pushBlendMode(CGL.BLEND_NONE,true);_.currentTextureEffect.finish();_.popBlendMode();_.popShader()}m.trigger()}}};Ops.Gl.ImageCompose.ImageCompose_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={imgcomp_frag:"UNI float a;\nvoid main()\n{\n   outColor= vec4(0.0,0.0,0.0,a);\n}\n"};const i=e.inTrigger("Render"),n=e.inBool("Use viewport size",true),r=e.inValueInt("Width",640),a=e.inValueInt("Height",480),s=e.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),o=e.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),l=e.inValueBool("HDR"),u=e.inValueBool("Transparent",false),h=e.outTrigger("Next"),c=e.outTexture("texture_out"),f=e.outValue("Aspect Ratio");const d=e.patch.cgl;e.setPortGroup("Texture Size",[n,r,a]);e.setPortGroup("Texture Settings",[o,s,l,u]);c.set(CGL.Texture.getEmptyTexture(d,l.get()));let g=null;let p=null;let m=8,_=8;const b=[0,0,0,0];let v=true;let E=CGL.Texture.FILTER_LINEAR;let F=CGL.Texture.WRAP_CLAMP_TO_EDGE;const A=0;const C=0;o.onChange=D;s.onChange=S;i.onTriggered=e.preRender=I;S();D();B();function x(){if(g)g.delete();if(p)p.delete();if(l.get()&&s.get()=="mipmap")e.setUiError("fpmipmap","Don't use mipmap and HDR at the same time, many systems do not support this.");else e.setUiError("fpmipmap",null);g=new CGL.TextureEffect(d,{isFloatingPointTexture:l.get()});p=new CGL.Texture(d,{name:"image_compose_v2_"+e.id,isFloatingPointTexture:l.get(),filter:E,wrap:F,width:Math.ceil(r.get()),height:Math.ceil(a.get())});g.setSourceTexture(p);c.set(CGL.Texture.getEmptyTexture(d,l.get()));v=false}l.onChange=function(){v=true};function T(){if(!g)x();if(n.get()){m=d.getViewPort()[2];_=d.getViewPort()[3]}else{m=Math.ceil(r.get());_=Math.ceil(a.get())}f.set(m/_);if((m!=p.width||_!=p.height)&&(m!==0&&_!==0)){p.setSize(m,_);g.setSourceTexture(p);c.set(CGL.Texture.getEmptyTexture(d,l.get()));c.set(p)}}function B(){r.setUiAttribs({greyout:n.get()});a.setUiAttribs({greyout:n.get()})}n.onChange=function(){B()};e.preRender=function(){I()};function I(){if(!g||v)x();const e=d.getViewPort();b[0]=e[0];b[1]=e[1];b[2]=e[2];b[3]=e[3];d.pushBlend(false);T();const t=d.currentTextureEffect;d.currentTextureEffect=g;d.currentTextureEffect.width=r.get();d.currentTextureEffect.height=a.get();g.setSourceTexture(p);let i=CGL.Texture.getBlackTexture(d);if(u.get())i=CGL.Texture.getEmptyTexture(d,l.get());g.startEffect(i);h.trigger();c.set(g.getCurrentSourceTexture());g.endEffect();d.setViewPort(b[0],b[1],b[2],b[3]);d.popBlend(false);d.currentTextureEffect=t}function D(){if(o.get()=="repeat")F=CGL.Texture.WRAP_REPEAT;if(o.get()=="mirrored repeat")F=CGL.Texture.WRAP_MIRRORED_REPEAT;if(o.get()=="clamp to edge")F=CGL.Texture.WRAP_CLAMP_TO_EDGE;v=true}function S(){if(s.get()=="nearest")E=CGL.Texture.FILTER_NEAREST;if(s.get()=="linear")E=CGL.Texture.FILTER_LINEAR;if(s.get()=="mipmap")E=CGL.Texture.FILTER_MIPMAP;v=true}}};Ops.Trigger.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const e=a.attachments={};const t=a.inTrigger("exe"),i=a.inTriggerButton("Clean up connections");a.setUiAttrib({resizable:true,resizableY:false,stretchPorts:true});const n=[],s=[],r=16;let o=null,l=[];t.onTriggered=c;i.onTriggered=f;i.setUiAttribs({hideParam:true,hidePort:true});for(let t=0;t<r;t++){const d=a.outTrigger("trigger "+t);s.push(d);d.onLinkChanged=h;if(t<r-1){let e=a.inTrigger("exe "+t);e.onTriggered=c;n.push(e)}}u();function u(){l.length=0;for(let e=0;e<s.length;e++)if(s[e].links.length>0)l.push(s[e])}function h(){u();clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<s.length;e++)if(s[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(a.isCurrentUiOp())a.refreshParams()},60)}function c(){for(let e=0;e<l.length;e++)l[e].trigger()}function f(){let n=0;for(let i=0;i<s.length;i++){let t=[];if(s[i].links.length>1)for(let e=1;e<s[i].links.length;e++){while(s[n].links.length>0)n++;t.push(s[i].links[e]);const r=s[i].links[e].getOtherPort(s[i]);a.patch.link(a,"trigger "+n,r.op,r.name);n++}for(let e=0;e<t.length;e++)t[e].remove()}h();u()}}};Ops.Gl.Meshes.FullscreenRectangle=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n    outColor= texture(tex,texCoord);\n}\n\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),n=e.inSwitch("Scale",["Stretch","Fit"],"Fit"),r=e.inValueBool("Flip Y"),a=e.inValueBool("Flip X"),s=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let u=null;let h=new CGL.Geometry("fullscreen rectangle");let c=0,f=0,d=0,g=0,p=0;e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);e.toWorkPortsNeedToBeLinked(i);a.onChange=T;r.onChange=T;i.onTriggered=x;s.onLinkChanged=F;n.onChange=C;const m=new CGL.Shader(l,"fullscreenrectangle",this);m.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setSource(t.shader_vert,t.shader_frag);m.fullscreenRectUniform=new CGL.Uniform(m,"t","tex",0);m.aspectUni=new CGL.Uniform(m,"f","aspectTex",0);let _=false;let b=true;let v=false;let E=[];F();C();e.onDelete=function(){if(u)u.dispose()};s.onChange=function(){b=true};function F(){if(!CABLES.UI)return;r.setUiAttribs({greyout:!s.isLinked()});a.setUiAttribs({greyout:!s.isLinked()});n.setUiAttribs({greyout:!s.isLinked()})}function A(){let e=s.get();if(e)_=true;else _=false}e.preRender=function(){A();m.bind();if(u)u.render(m);x()};function C(){v=n.get()=="Fit"}function x(){if(l.getViewPort()[2]!=g||l.getViewPort()[3]!=p||!u)B();if(b)A();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,g,p,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(v&&s.get()){const i=s.get().width/s.get().height;let e=p;let t=p*i;if(t>g){e=g*1/i;t=g}E[0]=l.getViewPort()[0];E[1]=l.getViewPort()[1];E[2]=l.getViewPort()[2];E[3]=l.getViewPort()[3];l.setViewPort((g-t)/2,(p-e)/2,t,e)}if(_){if(s.get())l.setTexture(0,s.get().tex);u.render(m)}else{u.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(v&&s.get())l.setViewPort(E[0],E[1],E[2],E[3]);o.trigger()}function T(){u=null}function B(){const e=l.getViewPort();if(e[2]==g&&e[3]==p&&u)return;let t=0,i=0;g=e[2];p=e[3];h.vertices=new Float32Array([t+g,i+p,0,t,i+p,0,t+g,i,0,t,i,0]);let n=null;if(r.get())n=new Float32Array([1,0,0,0,1,1,0,1]);else n=new Float32Array([1,1,0,1,1,0,0,0]);if(a.get()){n[0]=0;n[2]=1;n[4]=0;n[6]=1}h.setTexCoords(n);h.verticesIndices=new Uint16Array([2,1,0,3,1,2]);h.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);h.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);h.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!u)u=new CGL.Mesh(l,h);else u.setGeom(h)}}};Ops.Gl.ImageCompose.Noise.PerlinNoise=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={perlinnoise3d_frag:'UNI float z;\nUNI float x;\nUNI float y;\nUNI float scale;\nUNI float rangeMul;\nUNI float harmonics;\nUNI float aspect;\n\nIN vec2 texCoord;\nUNI sampler2D tex;\n\n#ifdef HAS_TEX_OFFSETMAP\n    UNI sampler2D texOffsetZ;\n    UNI float offMul;\n#endif\n\n#ifdef HAS_TEX_MASK\n    UNI sampler2D texMask;\n#endif\n\nUNI float amount;\n\n{{CGL.BLENDMODES}}\n\n\nfloat Interpolation_C2( float x ) { return x * x * x * (x * (x * 6.0 - 15.0) + 10.0); }   //  6x^5-15x^4+10x^3\t( Quintic Curve.  As used by Perlin in Improved Noise.  http://mrl.nyu.edu/~perlin/paper445.pdf )\nvec2 Interpolation_C2( vec2 x ) { return x * x * x * (x * (x * 6.0 - 15.0) + 10.0); }\nvec3 Interpolation_C2( vec3 x ) { return x * x * x * (x * (x * 6.0 - 15.0) + 10.0); }\nvec4 Interpolation_C2( vec4 x ) { return x * x * x * (x * (x * 6.0 - 15.0) + 10.0); }\nvec4 Interpolation_C2_InterpAndDeriv( vec2 x ) { return x.xyxy * x.xyxy * ( x.xyxy * ( x.xyxy * ( x.xyxy * vec2( 6.0, 0.0 ).xxyy + vec2( -15.0, 30.0 ).xxyy ) + vec2( 10.0, -60.0 ).xxyy ) + vec2( 0.0, 30.0 ).xxyy ); }\nvec3 Interpolation_C2_Deriv( vec3 x ) { return x * x * (x * (x * 30.0 - 60.0) + 30.0); }\n\n\nvoid FAST32_hash_3D( vec3 gridcell, out vec4 lowz_hash, out vec4 highz_hash )\t//\tgenerates a random number for each of the 8 cell corners\n{\n    //    gridcell is assumed to be an integer coordinate\n\n    //\tTODO: \tthese constants need tweaked to find the best possible noise.\n    //\t\t\tprobably requires some kind of brute force computational searching or something....\n    const vec2 OFFSET = vec2( 50.0, 161.0 );\n    const float DOMAIN = 69.0;\n    const float SOMELARGEFLOAT = 635.298681;\n    const float ZINC = 48.500388;\n\n    //\ttruncate the domain\n    gridcell.xyz = gridcell.xyz - floor(gridcell.xyz * ( 1.0 / DOMAIN )) * DOMAIN;\n    vec3 gridcell_inc1 = step( gridcell, vec3( DOMAIN - 1.5 ) ) * ( gridcell + 1.0 );\n\n    //\tcalculate the noise\n    vec4 P = vec4( gridcell.xy, gridcell_inc1.xy ) + OFFSET.xyxy;\n    P *= P;\n    P = P.xzxz * P.yyww;\n    highz_hash.xy = vec2( 1.0 / ( SOMELARGEFLOAT + vec2( gridcell.z, gridcell_inc1.z ) * ZINC ) );\n    lowz_hash = fract( P * highz_hash.xxxx );\n    highz_hash = fract( P * highz_hash.yyyy );\n}\n\n\n\n\nvoid FAST32_hash_3D( \tvec3 gridcell,\n                        out vec4 lowz_hash_0,\n                        out vec4 lowz_hash_1,\n                        out vec4 lowz_hash_2,\n                        out vec4 highz_hash_0,\n                        out vec4 highz_hash_1,\n                        out vec4 highz_hash_2\t)\t\t//\tgenerates 3 random numbers for each of the 8 cell corners\n{\n    //    gridcell is assumed to be an integer coordinate\n\n    //\tTODO: \tthese constants need tweaked to find the best possible noise.\n    //\t\t\tprobably requires some kind of brute force computational searching or something....\n    const vec2 OFFSET = vec2( 50.0, 161.0 );\n    const float DOMAIN = 69.0;\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\n\n    //\ttruncate the domain\n    gridcell.xyz = gridcell.xyz - floor(gridcell.xyz * ( 1.0 / DOMAIN )) * DOMAIN;\n    vec3 gridcell_inc1 = step( gridcell, vec3( DOMAIN - 1.5 ) ) * ( gridcell + 1.0 );\n\n    //\tcalculate the noise\n    vec4 P = vec4( gridcell.xy, gridcell_inc1.xy ) + OFFSET.xyxy;\n    P *= P;\n    P = P.xzxz * P.yyww;\n    vec3 lowz_mod = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell.zzz * ZINC.xyz ) );\n    vec3 highz_mod = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell_inc1.zzz * ZINC.xyz ) );\n    lowz_hash_0 = fract( P * lowz_mod.xxxx );\n    highz_hash_0 = fract( P * highz_mod.xxxx );\n    lowz_hash_1 = fract( P * lowz_mod.yyyy );\n    highz_hash_1 = fract( P * highz_mod.yyyy );\n    lowz_hash_2 = fract( P * lowz_mod.zzzz );\n    highz_hash_2 = fract( P * highz_mod.zzzz );\n}\nfloat Falloff_Xsq_C1( float xsq ) { xsq = 1.0 - xsq; return xsq*xsq; }\t// ( 1.0 - x*x )^2   ( Used by Humus for lighting falloff in Just Cause 2.  GPUPro 1 )\nfloat Falloff_Xsq_C2( float xsq ) { xsq = 1.0 - xsq; return xsq*xsq*xsq; }\t// ( 1.0 - x*x )^3.   NOTE: 2nd derivative is 0.0 at x=1.0, but non-zero at x=0.0\nvec4 Falloff_Xsq_C2( vec4 xsq ) { xsq = 1.0 - xsq; return xsq*xsq*xsq; }\n\n\n//\n//\tPerlin Noise 3D  ( gradient noise )\n//\tReturn value range of -1.0->1.0\n//\thttp://briansharpe.files.wordpress.com/2011/11/perlinsample.jpg\n//\nfloat Perlin3D( vec3 P )\n{\n    //\testablish our grid cell and unit position\n    vec3 Pi = floor(P);\n    vec3 Pf = P - Pi;\n    vec3 Pf_min1 = Pf - 1.0;\n\n#if 1\n    //\n    //\tclassic noise.\n    //\trequires 3 random values per point.  with an efficent hash function will run faster than improved noise\n    //\n\n    //\tcalculate the hash.\n    //\t( various hashing methods listed in order of speed )\n    vec4 hashx0, hashy0, hashz0, hashx1, hashy1, hashz1;\n    FAST32_hash_3D( Pi, hashx0, hashy0, hashz0, hashx1, hashy1, hashz1 );\n    //SGPP_hash_3D( Pi, hashx0, hashy0, hashz0, hashx1, hashy1, hashz1 );\n\n    //\tcalculate the gradients\n    vec4 grad_x0 = hashx0 - 0.49999;\n    vec4 grad_y0 = hashy0 - 0.49999;\n    vec4 grad_z0 = hashz0 - 0.49999;\n    vec4 grad_x1 = hashx1 - 0.49999;\n    vec4 grad_y1 = hashy1 - 0.49999;\n    vec4 grad_z1 = hashz1 - 0.49999;\n    vec4 grad_results_0 = inversesqrt( grad_x0 * grad_x0 + grad_y0 * grad_y0 + grad_z0 * grad_z0 ) * ( vec2( Pf.x, Pf_min1.x ).xyxy * grad_x0 + vec2( Pf.y, Pf_min1.y ).xxyy * grad_y0 + Pf.zzzz * grad_z0 );\n    vec4 grad_results_1 = inversesqrt( grad_x1 * grad_x1 + grad_y1 * grad_y1 + grad_z1 * grad_z1 ) * ( vec2( Pf.x, Pf_min1.x ).xyxy * grad_x1 + vec2( Pf.y, Pf_min1.y ).xxyy * grad_y1 + Pf_min1.zzzz * grad_z1 );\n\n#if 1\n    //\tClassic Perlin Interpolation\n    vec3 blend = Interpolation_C2( Pf );\n    vec4 res0 = mix( grad_results_0, grad_results_1, blend.z );\n    vec4 blend2 = vec4( blend.xy, vec2( 1.0 - blend.xy ) );\n    float final = dot( res0, blend2.zxzx * blend2.wwyy );\n    final *= 1.1547005383792515290182975610039;\t\t//\t(optionally) scale things to a strict -1.0->1.0 range    *= 1.0/sqrt(0.75)\n    return final;\n#else\n    //\tClassic Perlin Surflet\n    //\thttp://briansharpe.wordpress.com/2012/03/09/modifications-to-classic-perlin-noise/\n    Pf *= Pf;\n    Pf_min1 *= Pf_min1;\n    vec4 vecs_len_sq = vec4( Pf.x, Pf_min1.x, Pf.x, Pf_min1.x ) + vec4( Pf.yy, Pf_min1.yy );\n    float final = dot( Falloff_Xsq_C2( min( vec4( 1.0 ), vecs_len_sq + Pf.zzzz ) ), grad_results_0 ) + dot( Falloff_Xsq_C2( min( vec4( 1.0 ), vecs_len_sq + Pf_min1.zzzz ) ), grad_results_1 );\n    final *= 2.3703703703703703703703703703704;\t\t//\t(optionally) scale things to a strict -1.0->1.0 range    *= 1.0/cube(0.75)\n    return final;\n#endif\n\n#else\n    //\n    //\timproved noise.\n    //\trequires 1 random value per point.  Will run faster than classic noise if a slow hashing function is used\n    //\n\n    //\tcalculate the hash.\n    //\t( various hashing methods listed in order of speed )\n    vec4 hash_lowz, hash_highz;\n    FAST32_hash_3D( Pi, hash_lowz, hash_highz );\n    //BBS_hash_3D( Pi, hash_lowz, hash_highz );\n    //SGPP_hash_3D( Pi, hash_lowz, hash_highz );\n\n    //\n    //\t"improved" noise using 8 corner gradients.  Faster than the 12 mid-edge point method.\n    //\tKen mentions using diagonals like this can cause "clumping", but we\'ll live with that.\n    //\t[1,1,1]  [-1,1,1]  [1,-1,1]  [-1,-1,1]\n    //\t[1,1,-1] [-1,1,-1] [1,-1,-1] [-1,-1,-1]\n    //\n    hash_lowz -= 0.5;\n    vec4 grad_results_0_0 = vec2( Pf.x, Pf_min1.x ).xyxy * sign( hash_lowz );\n    hash_lowz = abs( hash_lowz ) - 0.25;\n    vec4 grad_results_0_1 = vec2( Pf.y, Pf_min1.y ).xxyy * sign( hash_lowz );\n    vec4 grad_results_0_2 = Pf.zzzz * sign( abs( hash_lowz ) - 0.125 );\n    vec4 grad_results_0 = grad_results_0_0 + grad_results_0_1 + grad_results_0_2;\n\n    hash_highz -= 0.5;\n    vec4 grad_results_1_0 = vec2( Pf.x, Pf_min1.x ).xyxy * sign( hash_highz );\n    hash_highz = abs( hash_highz ) - 0.25;\n    vec4 grad_results_1_1 = vec2( Pf.y, Pf_min1.y ).xxyy * sign( hash_highz );\n    vec4 grad_results_1_2 = Pf_min1.zzzz * sign( abs( hash_highz ) - 0.125 );\n    vec4 grad_results_1 = grad_results_1_0 + grad_results_1_1 + grad_results_1_2;\n\n    //\tblend the gradients and return\n    vec3 blend = Interpolation_C2( Pf );\n    vec4 res0 = mix( grad_results_0, grad_results_1, blend.z );\n    vec4 blend2 = vec4( blend.xy, vec2( 1.0 - blend.xy ) );\n    return dot( res0, blend2.zxzx * blend2.wwyy ) * (2.0 / 3.0);\t//\t(optionally) mult by (2.0/3.0) to scale to a strict -1.0->1.0 range\n#endif\n}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n    vec2 p=vec2(texCoord.x-0.5,texCoord.y-0.5);\n\n    p=p*scale;\n    p=vec2(p.x+0.5-x,p.y+0.5-y);\n\n\n\n    vec3 offset;\n    #ifdef HAS_TEX_OFFSETMAP\n        vec4 offMap=texture(texOffsetZ,texCoord);\n\n        #ifdef OFFSET_X_R\n            offset.x=offMap.r;\n        #endif\n        #ifdef OFFSET_X_G\n            offset.x=offMap.g;\n        #endif\n        #ifdef OFFSET_X_B\n            offset.x=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Y_R\n            offset.y=offMap.r;\n        #endif\n        #ifdef OFFSET_Y_G\n            offset.y=offMap.g;\n        #endif\n        #ifdef OFFSET_Y_B\n            offset.y=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Z_R\n            offset.z=offMap.r;\n        #endif\n        #ifdef OFFSET_Z_G\n            offset.z=offMap.g;\n        #endif\n        #ifdef OFFSET_Z_B\n            offset.z=offMap.b;\n        #endif\n        offset*=offMul;\n    #endif\n\n\n\n    float aa=texture(tex,texCoord).r;\n    // float v=(Perlin3D(vec3(p.x,p.y,z)+offset));\n\n\n    float v = 0.0;\n    p.x*=aspect;\n\n    v+=Perlin3D(vec3(p.x,p.y,z)+offset);\n\n    if (harmonics >= 2.0) v += Perlin3D(vec3(p.x,p.y,z)*2.2+offset) * 0.5;\n    if (harmonics >= 3.0) v += Perlin3D(vec3(p.x,p.y,z)*4.3+offset) * 0.25;\n    if (harmonics >= 4.0) v += Perlin3D(vec3(p.x,p.y,z)*8.4+offset) * 0.125;\n    if (harmonics >= 5.0) v += Perlin3D(vec3(p.x,p.y,z)*16.5+offset) * 0.0625;\n\n\n    v*=rangeMul;\n    v=v*0.5+0.5;\n    float v2=v;\n    float v3=v;\n\n    #ifdef RGB\n        v2=Perlin3D(vec3(p.x*2.0,p.y*2.0,z))*0.5+0.5;\n        v3=Perlin3D(vec3(p.x*3.0,p.y*3.0,z))*0.5+0.5;\n    #endif\n\n    vec4 col=vec4(v,v2,v3,1.0);\n\n    float str=1.0;\n    #ifdef HAS_TEX_MASK\n        str=texture(texMask,texCoord).r;\n    #endif\n\n    col=cgl_blend(base,col,amount*str);\n\n\n    #ifdef NO_CHANNEL_R\n        col.r=base.r;\n    #endif\n    #ifdef NO_CHANNEL_G\n        col.g=base.g;\n    #endif\n    #ifdef NO_CHANNEL_B\n        col.b=base.b;\n    #endif\n\n\n\n    outColor=col;\n}\n'};const i=e.inTrigger("render"),n=e.inTexture("Mask"),r=CGL.TextureEffect.AddBlendSelect(e),a=CGL.TextureEffect.AddBlendAlphaMask(e),s=e.inValueSlider("Amount",1),o=e.inSwitch("Color",["Mono","RGB","R","G","B"],"Mono"),l=e.inValue("Scale",22),u=e.inBool("Aspect",false),h=e.inValue("Multiply",1),c=e.inSwitch("Harmonics",["1","2","3","4","5"],"1"),f=e.inValue("X",0),d=e.inValue("Y",0),g=e.inValue("Z",0),p=e.outTrigger("trigger");const m=e.patch.cgl;const _=new CGL.Shader(m,"perlinnoise");e.setPortGroup("Position",[f,d,g]);_.setSource(_.getDefaultVertexShader(),t.perlinnoise3d_frag);const b=new CGL.Uniform(_,"t","tex",0),v=new CGL.Uniform(_,"t","texOffsetZ",1),E=new CGL.Uniform(_,"t","texMask",2),F=new CGL.Uniform(_,"f","z",g),A=new CGL.Uniform(_,"f","x",f),C=new CGL.Uniform(_,"f","y",d),x=new CGL.Uniform(_,"f","scale",l),T=new CGL.Uniform(_,"f","amount",s),B=new CGL.Uniform(_,"f","rangeMul",h);CGL.TextureEffect.setupBlending(e,_,r,s,a);const I=e.inTexture("Offset"),D=e.inFloat("Offset Multiply",1),S=e.inSwitch("Offset X",["None","R","G","B"],"None"),O=e.inSwitch("Offset Y",["None","R","G","B"],"None"),y=e.inSwitch("Offset Z",["None","R","G","B"],"R");e.setPortGroup("Offset Map",[I,y,O,S,D]);const L=new CGL.Uniform(_,"f","offMul",D);const w=new CGL.Uniform(_,"f","aspect",1);const N=new CGL.Uniform(_,"f","harmonics",0);c.onChange=()=>{N.setValue(parseFloat(c.get()))};S.onChange=O.onChange=y.onChange=n.onChange=o.onChange=I.onChange=M;M();function M(){_.toggleDefine("NO_CHANNEL_R",o.get()=="G"||o.get()=="B");_.toggleDefine("NO_CHANNEL_G",o.get()=="R"||o.get()=="B");_.toggleDefine("NO_CHANNEL_B",o.get()=="R"||o.get()=="G");_.toggleDefine("HAS_TEX_OFFSETMAP",I.get());_.toggleDefine("HAS_TEX_MASK",n.get());_.toggleDefine("OFFSET_X_R",S.get()=="R");_.toggleDefine("OFFSET_X_G",S.get()=="G");_.toggleDefine("OFFSET_X_B",S.get()=="B");_.toggleDefine("OFFSET_Y_R",O.get()=="R");_.toggleDefine("OFFSET_Y_G",O.get()=="G");_.toggleDefine("OFFSET_Y_B",O.get()=="B");_.toggleDefine("OFFSET_Z_R",y.get()=="R");_.toggleDefine("OFFSET_Z_G",y.get()=="G");_.toggleDefine("OFFSET_Z_B",y.get()=="B");S.setUiAttribs({greyout:!I.isLinked()});O.setUiAttribs({greyout:!I.isLinked()});y.setUiAttribs({greyout:!I.isLinked()});D.setUiAttribs({greyout:!I.isLinked()});_.toggleDefine("RGB",o.get()=="RGB")}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;m.pushShader(_);m.currentTextureEffect.bind();if(u.get())w.setValue(m.currentTextureEffect.getWidth()/m.currentTextureEffect.getHeight());else w.setValue(1);m.setTexture(0,m.currentTextureEffect.getCurrentSourceTexture().tex);if(I.get())m.setTexture(1,I.get().tex);if(n.get())m.setTexture(2,n.get().tex);m.currentTextureEffect.finish();m.popShader();p.trigger()}}};Ops.Gl.Textures.CopyTexture=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const R=e.attachments={copytexture_frag:"UNI float a;\nUNI sampler2D tex;\n\n#ifdef TEX_MASK\nUNI sampler2D texMask;\n#endif\n\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    #ifdef TEX_MASK\n        col.a=texture(texMask,texCoord).r;\n    #endif\n\n\n    #ifdef GREY_R\n        col.rgb=vec3(col.r);\n    #endif\n\n    #ifdef GREY_G\n        col.rgb=vec3(col.g);\n    #endif\n\n    #ifdef GREY_B\n        col.rgb=vec3(col.b);\n    #endif\n\n    #ifdef GREY_A\n        col.rgb=vec3(col.a);\n    #endif\n\n    #ifdef GREY_LUMI\n        col.rgb=vec3( dot(vec3(0.2126,0.7152,0.0722), col.rgb) );\n    #endif\n\n\n    #ifdef INVERT_A\n        col.a=1.0-col.a;\n    #endif\n\n    #ifdef INVERT_R\n        col.r=1.0-col.r;\n    #endif\n\n    #ifdef INVERT_G\n        col.g=1.0-col.g;\n    #endif\n\n    #ifdef INVERT_B\n        col.b=1.0-col.b;\n    #endif\n\n    #ifdef ALPHA_1\n        col.a=1.0;\n    #endif\n\n\n\n\n    outColor= col;\n}"};const t=e.inTriggerButton("render"),i=e.inTexture("Texture"),n=e.inTexture("Alpha Mask"),r=e.inValueBool("use original size",true),a=e.inValueInt("width",640),s=e.inValueInt("height",360),o=e.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),u=e.inValueBool("HDR"),h=e.inSwitch("Alpha Mask Source",["A","1"],"A"),c=e.inSwitch("Convert Greyscale",["Off","R","G","B","A","Luminance"],"Off"),f=e.inBool("Invert R",false),d=e.inBool("Invert G",false),g=e.inBool("Invert B",false),P=e.inBool("Invert A",false),p=e.outTrigger("trigger"),m=e.outTexture("texture_out",null),k=e.outNumber("Aspect Ratio");h.setUiAttribs({hidePort:true});c.setUiAttribs({hidePort:true});f.setUiAttribs({hidePort:true});d.setUiAttribs({hidePort:true});g.setUiAttribs({hidePort:true});let _=null;const b=e.patch.cgl;let v=null;let E=null;let F=null;let A=true;let C=2,x=2;const T=[0,0,0,0];let B=true;e.setPortGroup("Size",[r,a,s]);const I=new CGL.Shader(b,"copytexture",this);I.setSource(I.getDefaultVertexShader(),R.copytexture_frag);const U=new CGL.Uniform(I,"t","tex",0);let V=new CGL.Uniform(I,"t","texMask",1);let D=CGL.Texture.FILTER_LINEAR;let S=CGL.Texture.WRAP_CLAMP_TO_EDGE;h.onChange=c.onChange=f.onChange=d.onChange=g.onChange=l.onChange=o.onChange=u.onChange=n.onChange=y;t.onLinkChanged=i.onLinkChanged=i.onChange=()=>{y()};t.onTriggered=L;N();function O(){if(E)E.delete();if(F){F.delete();F=null}E=new CGL.TextureEffect(b,{isFloatingPointTexture:u.get(),clear:false});if(!F||F.width!=Math.floor(a.get())||F.height!=Math.floor(s.get())||F.wrap!=S||F.isFloatingPoint()!=u.get()){if(F)F.delete();F=new CGL.Texture(b,{name:"copytexture_"+e.id,isFloatingPointTexture:u.get(),filter:D,wrap:S,width:Math.floor(a.get()),height:Math.floor(s.get())})}E.setSourceTexture(F);m.set(null);B=false}function y(){G();if(t.links.length===0){B=true;e.patch.cgl.off(_);_=e.patch.cgl.on("beginFrame",()=>{e.patch.cgl.off(_);if(A)w();if(!E)e.log("has no effect");if(!i.get())e.log("has no intexture");L()})}}function w(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(b))return;if(!E)O();if(r.get()){C=i.get().width;x=i.get().height}else{C=Math.floor(a.get());x=Math.floor(s.get())}if((C!=F.width||x!=F.height)&&(C!==0&&x!==0)){s.set(x);a.set(C);F.filter=D;F.setSize(C,x);k.set(C/x);E.setSourceTexture(F)}if(m.get()&&D!=CGL.Texture.FILTER_NEAREST){if(!m.get().isPowerOfTwo())e.setUiError("hintnpot","texture dimensions not power of two! - texture filtering when scaling will not work on ios devices.",0);else e.setUiError("hintnpot",null,0)}else e.setUiError("hintnpot",null,0);A=false}function N(){a.setUiAttribs({greyout:r.get()});s.setUiAttribs({greyout:r.get()})}function M(){A=true;y()}r.onChange=function(){N();if(r.get()){a.onChange=null;s.onChange=null}else{a.onChange=M;s.onChange=M}w()};function L(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(b))m.set(CGL.Texture.getEmptyTexture(b));if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(b)){v=null;p.trigger();return}else if(!E||B||v!=i.get()){O()}const e=b.getViewPort();T[0]=e[0];T[1]=e[1];T[2]=e[2];T[3]=e[3];w();v=i.get();const t=b.currentTextureEffect;b.currentTextureEffect=E;E.setSourceTexture(F);E.startEffect();b.pushShader(I);b.currentTextureEffect.bind();b.setTexture(0,i.get().tex);if(n.get())b.setTexture(1,n.get().tex);b.pushBlend(false);b.currentTextureEffect.finish();b.popShader();b.popBlend();m.set(E.getCurrentSourceTexture());E.endEffect();b.setViewPort(T[0],T[1],T[2],T[3]);b.currentTextureEffect=t;b.setTexture(0,CGL.Texture.getEmptyTexture(b).tex);p.trigger()}function G(){I.toggleDefine("TEX_MASK",n.get());I.toggleDefine("GREY_R",c.get()==="R");I.toggleDefine("GREY_G",c.get()==="G");I.toggleDefine("GREY_B",c.get()==="B");I.toggleDefine("GREY_A",c.get()==="A");I.toggleDefine("GREY_LUMI",c.get()==="Luminance");I.toggleDefine("ALPHA_1",h.get()==="1");I.toggleDefine("ALPHA_A",h.get()==="A");I.toggleDefine("INVERT_R",f.get());I.toggleDefine("INVERT_G",d.get());I.toggleDefine("INVERT_B",g.get());I.toggleDefine("INVERT_A",P.get());if(l.get()=="repeat")S=CGL.Texture.WRAP_REPEAT;else if(l.get()=="mirrored repeat")S=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(l.get()=="clamp to edge")S=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(o.get()=="nearest")D=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")D=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")D=CGL.Texture.FILTER_MIPMAP;if(I.needsRecompile()){B=true}if(F&&(F.width!=Math.floor(a.get())||F.height!=Math.floor(s.get())||F.wrap!=S||F.isFloatingPoint()!=u.get())){B=true}}}};Ops.Gl.ImageCompose.PixelDifference=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={slope_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI vec2 pixel;\nUNI float strength;\nUNI float sstep;\n\nfloat lum(vec3 c)\n{\n    return dot(vec3(0.2126,0.7152,0.0722),c);\n}\n\nvoid main()\n{\n    vec4 a,b;\n    // vec4 px=texture(tex, texCoord);\n    vec4 pxl=texture(tex, texCoord + vec2(-sstep*pixel.x, 0.0));\n    vec4 pxr=texture(tex, texCoord + vec2( sstep*pixel.x, 0.0));\n    vec4 pxt=texture(tex, texCoord + vec2(0.0, -sstep*pixel.y));\n    vec4 pxb=texture(tex, texCoord + vec2(0.0,  sstep*pixel.y));\n\n    vec4 col=vec4(0.5);\n\n    #ifdef DIR_R_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_R_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_R\n        vec4 c=a;\n        a=b;\n        b=c;\n    #endif\n    #ifdef METH_R_DIFF\n        #ifdef METH_R_R\n            col.r+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_R_G\n            col.r+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_R_B\n            col.r+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_R_AVG\n        #ifdef METH_R_R\n            col.r+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_R_G\n            col.r+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_R_B\n            col.r+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_R_LUMI\n        col.r+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_R_ONE\n        col.r=1.0;\n    #endif\n    #ifdef METH_R_ZERO\n        col.r=0.0;\n    #endif\n\n\n    ////////////////////////\n\n    #ifdef DIR_G_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_G_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_G\n        vec4 c3=a;\n        a=b;\n        b=c3;\n    #endif\n    #ifdef METH_G_DIFF\n        #ifdef METH_G_R\n            col.g+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_G_G\n            col.g+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_G_B\n            col.g+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_G_AVG\n        #ifdef METH_G_R\n            col.g+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_G_G\n            col.g+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_G_B\n            col.g+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_G_LUMI\n        col.g+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_G_ONE\n        col.g=1.0;\n    #endif\n    #ifdef METH_G_ZERO\n        col.g=0.0;\n    #endif\n\n\n    ////////////////////////\n\n    #ifdef DIR_B_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_B_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_B\n        vec4 c2=a;\n        a=b;\n        b=c2;\n    #endif\n    #ifdef METH_B_DIFF\n        #ifdef METH_B_R\n            col.b+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_B_G\n            col.b+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_B_B\n            col.b+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_B_AVG\n        #ifdef METH_B_R\n            col.b+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_B_G\n            col.b+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_B_B\n            col.b+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_B_LUMI\n        col.b+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_B_ONE\n        col.b=1.0;\n    #endif\n    #ifdef METH_B_ZERO\n        col.b=0.0;\n    #endif\n\n\n\n    col.a=1.0;\n\n    outColor= col;\n\n}\n"};const i=["Vertical Difference Red","Vertical Difference Green","Vertical Difference Blue","Vertical Average Red","Vertical Average Green","Vertical Average Blue","Vertical Luminance","Horizontal Difference Red","Horizontal Difference Green","Horizontal Difference Blue","Horizontal Average Red","Horizontal Average Green","Horizontal Average Blue","Horizontal Luminance","Midpoint","Zero","One"];const n=t.inTrigger("render"),r=t.inValue("Strength",4),a=t.inValue("Step",1),s=t.inDropDown("Red",i,"Horizontal Difference Red"),o=t.inBool("Red Flip",false),l=t.inDropDown("Green",i,"Vertical Difference Green"),u=t.inBool("Green Flip",false),h=t.inDropDown("Blue",i,"Midpoint"),c=t.inBool("Blue Flip",false),f=t.outTrigger("trigger");t.setPortGroup("Method",[o,u,c,s,l,h]);o.onChange=u.onChange=c.onChange=s.onChange=l.onChange=h.onChange=v;const d=t.patch.cgl;const g=new CGL.Shader(d,t.name,t);g.setSource(g.getDefaultVertexShader(),e.slope_frag);const p=new CGL.Uniform(g,"t","tex",0),m=new CGL.Uniform(g,"f","strength",r),_=new CGL.Uniform(g,"f","sstep",a),b=new CGL.Uniform(g,"2f","pixel");v();function v(){g.toggleDefine("DIR_R_HORIZONTAL",(s.get()+"").indexOf("Horizontal")!=-1);g.toggleDefine("DIR_G_HORIZONTAL",(l.get()+"").indexOf("Horizontal")!=-1);g.toggleDefine("DIR_B_HORIZONTAL",(h.get()+"").indexOf("Horizontal")!=-1);g.toggleDefine("METH_R_DIFF",(s.get()+"").indexOf("Difference")!=-1);g.toggleDefine("METH_G_DIFF",(l.get()+"").indexOf("Difference")!=-1);g.toggleDefine("METH_B_DIFF",(h.get()+"").indexOf("Difference")!=-1);g.toggleDefine("METH_R_AVG",(s.get()+"").indexOf("Average")!=-1);g.toggleDefine("METH_G_AVG",(l.get()+"").indexOf("Average")!=-1);g.toggleDefine("METH_B_AVG",(h.get()+"").indexOf("Average")!=-1);g.toggleDefine("METH_R_R",(s.get()+"").indexOf("Red")!=-1);g.toggleDefine("METH_G_R",(l.get()+"").indexOf("Red")!=-1);g.toggleDefine("METH_B_R",(h.get()+"").indexOf("Red")!=-1);g.toggleDefine("METH_R_G",(s.get()+"").indexOf("Green")!=-1);g.toggleDefine("METH_G_G",(l.get()+"").indexOf("Green")!=-1);g.toggleDefine("METH_B_G",(h.get()+"").indexOf("Green")!=-1);g.toggleDefine("METH_R_B",(s.get()+"").indexOf("Blue")!=-1);g.toggleDefine("METH_G_B",(l.get()+"").indexOf("Blue")!=-1);g.toggleDefine("METH_B_B",(h.get()+"").indexOf("Blue")!=-1);g.toggleDefine("METH_R_LUMI",(s.get()+"").indexOf("Luminance")!=-1);g.toggleDefine("METH_G_LUMI",(l.get()+"").indexOf("Luminance")!=-1);g.toggleDefine("METH_B_LUMI",(h.get()+"").indexOf("Luminance")!=-1);g.toggleDefine("METH_R_MID",(s.get()+"").indexOf("Midpoint")!=-1);g.toggleDefine("METH_G_MID",(l.get()+"").indexOf("Midpoint")!=-1);g.toggleDefine("METH_B_MID",(h.get()+"").indexOf("Midpoint")!=-1);g.toggleDefine("METH_R_ZERO",(s.get()+"").indexOf("Zero")!=-1);g.toggleDefine("METH_G_ZERO",(l.get()+"").indexOf("Zero")!=-1);g.toggleDefine("METH_B_ZERO",(h.get()+"").indexOf("Zero")!=-1);g.toggleDefine("METH_R_ONE",(s.get()+"").indexOf("One")!=-1);g.toggleDefine("METH_G_ONE",(l.get()+"").indexOf("One")!=-1);g.toggleDefine("METH_B_ONE",(h.get()+"").indexOf("One")!=-1);g.toggleDefine("FLIP_R",o.get());g.toggleDefine("FLIP_G",u.get());g.toggleDefine("FLIP_B",c.get())}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t))return;d.pushShader(g);d.currentTextureEffect.bind();const e=d.currentTextureEffect.getCurrentSourceTexture();b.set([1/e.width,1/e.height]);d.setTexture(0,e.tex);d.currentTextureEffect.finish();d.popShader();f.trigger()}}};Ops.Gl.ImageCompose.PixelDisplacement_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixeldisplace3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D displaceTex;\nUNI float amountX;\nUNI float amountY;\nUNI float amount;\n\n{{CGL.BLENDMODES}}\n\nvec3 getOffset(vec3 offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nfloat getOffset(float offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nvoid main()\n{\n    vec3 offset=texture(displaceTex,texCoord).rgb;\n    float x,y;\n\n    #ifdef INPUT_REDGREEN\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_RED\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.r*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_GREEN\n        offset=getOffset(offset);\n        x=offset.g*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_BLUE\n        offset=getOffset(offset);\n        x=offset.b*amountX+texCoord.x;\n        y=offset.b*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_LUMINANCE\n        float o=dot(vec3(0.2126,0.7152,0.0722), offset);\n        o=getOffset(o);\n        x=o*amountX+texCoord.x;\n        y=o*amountY+texCoord.y;\n    #endif\n    #ifdef WRAP_CLAMP\n        x=clamp(x,0.0,1.0);\n        y=clamp(y,0.0,1.0);\n    #endif\n    #ifdef WRAP_REPEAT\n        x=mod(x,1.0);\n        y=mod(y,1.0);\n    #endif\n    #ifdef WRAP_MIRROR\n        float mx=mod(x,2.0);\n        float my=mod(y,2.0);\n        x=abs((floor(mx)-fract(mx)));\n        y=abs((floor(my)-fract(my)));\n    #endif\n\n\n\n    vec4 col=texture(tex,vec2(x,y));\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,amount);\n}"};const i=e.inTrigger("render"),n=e.inTexture("displaceTex"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),a=e.inValueSlider("Amount",1),s=e.inValueSlider("amount X",.2),o=e.inValueSlider("amount Y",.2),l=e.inSwitch("Wrap",["Mirror","Clamp","Repeat"],"Mirror"),u=e.inValueSelect("Input",["Luminance","RedGreen","Red","Green","Blue"],"Luminance"),h=e.inSwitch("Zero Displace",["Grey","Black"],"Grey"),c=e.outTrigger("trigger");e.setPortGroup("Axis Displacement Strength",[s,o]);e.setPortGroup("Modes",[l,u]);e.toWorkPortsNeedToBeLinked(n);const f=e.patch.cgl,d=new CGL.Shader(f,e.name,e);d.setSource(d.getDefaultVertexShader(),t.pixeldisplace3_frag);const g=new CGL.Uniform(d,"t","tex",0),p=new CGL.Uniform(d,"t","displaceTex",1),m=new CGL.Uniform(d,"f","amountX",s),_=new CGL.Uniform(d,"f","amountY",o),b=new CGL.Uniform(d,"f","amount",a);h.onChange=v;l.onChange=E;u.onChange=F;E();F();v();CGL.TextureEffect.setupBlending(e,d,r,a);function v(){d.removeDefine("ZERO_BLACK");d.removeDefine("ZERO_GREY");d.define("ZERO_"+(h.get()+"").toUpperCase())}function E(){d.removeDefine("WRAP_CLAMP");d.removeDefine("WRAP_REPEAT");d.removeDefine("WRAP_MIRROR");d.define("WRAP_"+(l.get()+"").toUpperCase())}function F(){d.removeDefine("INPUT_LUMINANCE");d.removeDefine("INPUT_REDGREEN");d.removeDefine("INPUT_RED");d.define("INPUT_"+(u.get()+"").toUpperCase())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;f.pushShader(d);f.currentTextureEffect.bind();f.setTexture(0,f.currentTextureEffect.getCurrentSourceTexture().tex);if(n.get())f.setTexture(1,n.get().tex);f.currentTextureEffect.finish();f.popShader();c.trigger()}}};Ops.Gl.ImageCompose.BrightnessContrast=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={brightness_contrast_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float amountbright;\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    col=texture(tex,texCoord);\n\n    // apply contrast\n    col.rgb = ((col.rgb - 0.5) * max(amount*2.0, 0.0))+0.5;\n\n    // apply brightness\n    col.rgb *= amountbright*2.0;\n\n    outColor = col;\n}"};const i=e.inTrigger("render"),n=e.inValueSlider("contrast",.5),r=e.inValueSlider("brightness",.5),a=e.outTrigger("trigger");const s=e.patch.cgl;const o=new CGL.Shader(s,"brightnesscontrast");o.setSource(o.getDefaultVertexShader(),t.brightness_contrast_frag);const l=new CGL.Uniform(o,"t","tex",0);const u=new CGL.Uniform(o,"f","amount",n);const h=new CGL.Uniform(o,"f","amountbright",r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;if(!s.currentTextureEffect.getCurrentSourceTexture())return;if(!CGL.TextureEffect.checkOpInEffect(e))return;s.pushShader(o);s.currentTextureEffect.bind();s.setTexture(0,s.currentTextureEffect.getCurrentSourceTexture().tex);s.currentTextureEffect.finish();s.popShader();a.trigger()}}};Ops.Gl.ImageCompose.ColorMap=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={colormap_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D gradient;\nUNI float pos;\nUNI float amount;\nUNI float vmin;\nUNI float vmax;\n\n{{CGL.BLENDMODES}}\n\n\nfloat lumi(vec3 color)\n{\n   return vec3(dot(vec3(0.2126,0.7152,0.0722), color)).r;\n}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n\n   base=clamp(base,vmin,vmax);\n\n    #ifdef METH_LUMI\n        vec4 color=texture(gradient,vec2(lumi(base.rgb),pos));\n    #endif\n\n    #ifdef METH_CHANNELS\n        vec4 color=vec4(1.0);\n        color.r=texture(gradient,vec2(base.r,pos)).r;\n        color.g=texture(gradient,vec2(base.g,pos)).g;\n        color.b=texture(gradient,vec2(base.b,pos)).b;\n    #endif\n\n//   outColor= vec4(color);\n   outColor=cgl_blend(base,color,amount);\n\n}\n"};let i=e.inTrigger("render");let n=e.outTrigger("trigger");const r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const a=e.inValueSlider("Amount",1);let s=e.inTexture("Gradient");let o=e.inSwitch("Method",["Luminance","Channels"],"Luminance");let l=e.inFloatSlider("Min",0);let u=e.inFloatSlider("Max",1);let h=e.inValueSlider("Position",.5);e.setPortGroup("Vertical Position",[l,u,h]);let c=e.patch.cgl;let f=new CGL.Shader(c,e.name,e);f.define("METH_LUMI");f.setSource(f.getDefaultVertexShader(),t.colormap_frag);var d=new CGL.Uniform(f,"t","tex",0);var d=new CGL.Uniform(f,"t","gradient",1);let g=new CGL.Uniform(f,"f","pos",h);let p=new CGL.Uniform(f,"f","vmin",l);let m=new CGL.Uniform(f,"f","vmax",u);let _=new CGL.Uniform(f,"f","amount",a);CGL.TextureEffect.setupBlending(e,f,r,a);o.onChange=()=>{f.toggleDefine("METH_LUMI",o.get()=="Luminance");f.toggleDefine("METH_CHANNELS",o.get()=="Channels")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;if(!s.get())return;c.pushShader(f);c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.setTexture(1,s.get().tex);c.currentTextureEffect.finish();c.popShader();n.trigger()}}};Ops.Color.ColorPalettes=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inValueInt("Index",0);const n=t.outTexture("Texture");const a=t.inValueBool("Smooth");const s=t.outArray("Color Array");let o=document.createElement("canvas");o.id="canvas_"+CABLES.generateUUID();o.width=5;o.height=8;o.style.display="none";let r=document.getElementsByTagName("body")[0];r.appendChild(o);let l=o.getContext("2d");i.onChange=a.onChange=p;let u=[];u.length=5*3;let h=null;p();function c(e){return parseInt(g(e).substring(0,2),16)}function f(e){return parseInt(g(e).substring(2,4),16)}function d(e){return parseInt(g(e).substring(4,6),16)}function g(e=""){return e.charAt(0)=="#"?e.substring(1,7):e}function p(){t.patch.cgl.addNextFrameOnceCallback(m)}function m(){let r=Math.round(i.get())*5;if(r>=_.length-5)r=0;if(r<0)r=0;if(r!=r)r=0;for(let n=0;n<5;n++){let e=c(_[r+n]);let t=f(_[r+n]);let i=d(_[r+n]);u[n*3+0]=e/255;u[n*3+1]=t/255;u[n*3+2]=i/255;l.fillStyle="rgb("+e+","+t+","+i+")";l.fillRect(o.width/5*n,0,o.width/5,o.height)}let e=CGL.Texture.FILTER_NEAREST;if(a.get())e=CGL.Texture.FILTER_LINEAR;if(h==e&&n.get())n.get().initTexture(o,e);else n.set(new CGL.Texture.createFromImage(t.patch.cgl,o,{filter:e}));s.set(null);s.set(u);n.get().unpackAlpha=false;h=e}t.onDelete=function(){o.remove()};const _=["#E6E2AF","#A7A37E","#EFECCA","#046380","002F2F","#468966","#FFF0A5","#FFB03B","#B64926","8E2800","#FCFFF5","#D1DBBD","#91AA9D","#3E606F","193441","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#105B63","#FFFAD5","#FFD34E","#DB9E36","BD4932","#225378","#1695A3","#ACF0F2","#F3FFE2","EB7F00","#2C3E50","#E74C3C","#ECF0F1","#3498DB","2980B9","#000000","#263248","#7E8AA2","#FFFFFF","FF9800","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#DC3522","#D9CB9E","#374140","#2A2C2B","1E1E20","#7D8A2E","#C9D787","#FFFFFF","#FFC0A9","FF8598","#B9121B","#4C1B1B","#F6E497","#FCFAE1","BD8D46","#2E0927","#D90000","#FF2D00","#FF8C00","04756F","#595241","#B8AE9C","#FFFFFF","#ACCFCC","8A0917","#10222B","#95AB63","#BDD684","#E2F0D6","F6FFE0","#F6F792","#333745","#77C4D3","#DAEDE2","EA2E49","#703030","#2F343B","#7E827A","#E3CDA4","C77966","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#D8CAA8","#5C832F","#284907","#382513","363942","#FFF8E3","#CCCC9F","#33332D","#9FB4CC","DB4105","#85DB18","#CDE855","#F5F6D4","#A7C520","493F0B","#04BFBF","#CAFCD8","#F7E967","#A9CF54","588F27","#292929","#5B7876","#8F9E8B","#F2E6B6","412A22","#332532","#644D52","#F77A52","#FF974F","A49A87","#405952","#9C9B7A","#FFD393","#FF974F","F54F29","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","FF530D","#962D3E","#343642","#979C9C","#F2EBC7","348899","#96CA2D","#B5E655","#EDF7F2","#4BB5C1","7FC6BC","#1C1D21","#31353D","#445878","#92CDCF","EEEFF7","#3E454C","#2185C5","#7ECEFD","#FFF6E5","FF7F66","#00585F","#009393","#FFFCC4","#F0EDBB","FF3800","#B4AF91","#787746","#40411E","#32331D","C03000","#63A69F","#F2E1AC","#F2836B","#F2594B","CD2C24","#88A825","#35203B","#911146","#CF4A30","ED8C2B","#F2385A","#F5A503","#E9F1DF","#4AD9D9","36B1BF","#CFC291","#FFF6C5","#A1E8D9","#FF712C","695D46","#FF5335","#B39C85","#306E73","#3B424D","1D181F","#000000","#333333","#FF358B","#01B0F0","AEEE00","#E8E595","#D0A825","#40627C","#26393D","FFFAE4","#E7E8D1","#D3CEAA","#FBF7E4","#424242","8E001C","#354242","#ACEBAE","#FFFF9D","#C9DE55","7D9100","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#DDDCC5","#958976","#611427","#1D2326","6A6A61","#6C6E58","#3E423A","#417378","#A4CFBE","F4F7D9","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#6B0C22","#D9042B","#F4CB89","#588C8C","011C26","#304269","#91BED4","#D9E8F5","#FFFFFF","F26101","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#B0CC99","#677E52","#B7CA79","#F6E8B1","89725B","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#16193B","#35478C","#4E7AC7","#7FB2F0","ADD5F7","#00261C","#044D29","#168039","#45BF55","96ED89","#36362C","#5D917D","#A8AD80","#E6D4A7","825534","#F9E4AD","#E6B098","#CC4452","#723147","31152B","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#002635","#013440","#AB1A25","#D97925","EFE7BE","#FF8000","#FFD933","#CCCC52","#8FB359","192B33","#272F32","#9DBDC6","#FFFFFF","#FF3D2E","DAEAEF","#B8ECD7","#083643","#B1E001","#CEF09D","476C5E","#002F32","#42826C","#A5C77F","#FFC861","C84663","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#5A1F00","#D1570D","#FDE792","#477725","A9CC66","#5E0042","#2C2233","#005869","#00856A","8DB500","#52656B","#FF3B77","#CDFF00","#FFFFFF","B8B89F","#801637","#047878","#FFB733","#F57336","C22121","#730046","#BFBB11","#FFC200","#E88801","C93C00","#24221F","#363F45","#4B5F6D","#5E7C88","FEB41C","#E64661","#FFA644","#998A2F","#2C594F","002D40","#C24704","#D9CC3C","#FFEB79","#A0E0A9","00ADA7","#484A47","#C1CE96","#ECEBF0","#687D77","353129","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#BAB293","#A39770","#EFE4BD","#A32500","2B2922","#6A7059","#FDEEA7","#9BCC93","#1A9481","003D5C","#174C4F","#207178","#FF9666","#FFE184","F5E9BE","#D5FBFF","#9FBCBF","#647678","#2F3738","59D8E6","#DB5800","#FF9000","#F0C600","#8EA106","59631E","#450003","#5C0002","#94090D","#D40D12","FF1D23","#211426","#413659","#656F8C","#9BBFAB","F2EFDF","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F2F2F2","#C6E070","#91C46C","#287D7D","1C344D","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#705B35","#C7B07B","#E8D9AC","#FFF6D9","570026","#F7F2B2","#ADCF4F","#84815B","#4A1A2C","8E3557","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#25064D","#36175E","#553285","#7B52AB","9768D1","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#CFCA4C","#FCF5BF","#9FE5C2","#5EB299","745A33","#776045","#A8C545","#DFD3B6","#FFFFFF","0092B2","#CC3910","#F1F2C0","#CCC59E","#8FA68E","332F29","#FF6600","#C13B00","#5E6D70","#424E4F","1B1D1E","#690011","#BF0426","#CC2738","#F2D99C","E5B96F","#1B1D26","#425955","#778C7A","#F1F2D8","BFBD9F","#F6B1C3","#F0788C","#DE264C","#BC0D35","A20D1E","#597533","#332F28","#61B594","#E6DEA5","C44E18","#3FB8AF","#7FC7AF","#DAD8A7","#FF9E9D","FF3D7F","#0F2D40","#194759","#296B73","#3E8C84","D8F2F0","#42282F","#74A588","#D6CCAD","#DC9C76","D6655A","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#003056","#04518C","#00A1D9","#47D9BF","F2D03B","#13140F","#D4FF00","#E4FFE6","#68776C","00D6DD","#FCFAD0","#A1A194","#5B605F","#464646","A90641","#289976","#67CC8E","#B1FF91","#FFE877","FF5600","#302B1D","#3F522B","#737D26","#A99E46","D9CB84","#56626B","#6C9380","#C0CA55","#F07C6C","AD5472","#32450C","#717400","#DC8505","#EC5519","BE2805","#C7B773","#E3DB9A","#F5FCD0","#B1C2B3","778691","#E83A25","#FFE9A3","#98CC96","#004563","191B28","#3399CC","#67B8DE","#91C9E8","#B4DCED","E8F8FF","#1A212C","#1D7872","#71B095","#DEDBA7","D13F32","#7D2A35","#CC9258","#917A56","#B4BA6C","FEFFC2","#E7E9D1","#D3D4AA","#FCFAE6","#444444","901808","#FFFFFF","#AEAEAE","#E64C66","#2D3E50","1BBC9B","#E0FFB3","#61C791","#31797D","#2A2F36","F23C55","#EB5937","#1C1919","#403D3C","#456F74","D3CBBD","#E6DD00","#8CB302","#008C74","#004C66","332B40","#14A697","#F2C12E","#F29D35","#F27649","F25252","#261822","#40152A","#731630","#CC1E2C","FF5434","#261F27","#FEE169","#CDD452","#F9722E","C9313D","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#2F3837","#C5C7B6","#FFF8D3","#4C493E","222028","#E3CBAC","#9C9985","#C46D3B","#788880","324654","#3F0B1B","#7A1631","#CF423C","#FC7D49","FFD462","#14212B","#293845","#4F6373","#8F8164","D9D7AC","#98A89E","#BAC0AC","#FAFAC6","#FF4411","D40015","#FEFFFF","#3C3F36","#9FB03E","#EBE9DC","72918B","#CC6B32","#FFAB48","#FFE7AD","#A7C9AE","888A63","#262526","#404040","#8C8979","#F2F2F2","F60A20","#00305A","#004B8D","#0074D9","#4192D9","7ABAF2","#0C273D","#54D0ED","#FFFEF1","#70B85D","2C5E2E","#4C1B33","#EFE672","#98A942","#2D6960","141D14","#2F3540","#666A73","#F2EDE4","#D9D1C7","8C8681","#0D1F30","#3B6670","#8BADA3","#F0E3C0","DB6C0F","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#092140","#024959","#F2C777","#F24738","BF2A2A","#133463","#365FB7","#799AE0","#F4EFDC","BA9B65","#C4D4CB","#55665E","#30282A","#542733","E84167","#CDDEC6","#4DAAAB","#1E4F6A","#2A423C","93A189","#EF5411","#FA5B0F","#FF6517","#FF6D1F","FF822E","#41434A","#6E9489","#DEDCC3","#F2F1E9","877963","#292929","#2BBFBD","#F2B33D","#F29B30","F22E2E","#F2385A","#F5A503","#E9F1DF","#56D9CD","3AA1BF","#D5F8B4","#A6E3A8","#8A9A85","#7E566B","422335","#3CBAC8","#93EDD4","#F3F5C4","#F9CB8F","F19181","#979926","#38CCB5","#EEFF8E","#FFD767","CC2A09","#404040","#024959","#037E8C","#F2EFDC","F24C27","#94B34D","#D3FF82","#363D52","#121D2B","111B1C","#282E33","#25373A","#164852","#495E67","FF3838","#313732","#8AA8B0","#DEDEDE","#FFFFFF","F26101","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFF6B8","#ABCCA7","#403529","#7A5E2F","A68236","#4F1025","#C5003E","#D9FF5B","#78AA00","15362D","#49404F","#596166","#D1FFCD","#A9BD8B","948A54","#FF2151","#FF7729","#FFAD29","#FFEBCA","1AB58A","#73603D","#BF8A49","#F2CA80","#5E5A59","0D0D0D","#3D4C53","#70B7BA","#F1433F","#E7E1D4","FFFFFF","#006D8D","#008A6E","#549E39","#8AB833","C0CF3A","#BDDFB3","#2BAA9C","#2F2E2E","#0F2625","465F3F","#F2F2F2","#BF0404","#8C0303","#590202","400101","#76A19A","#272123","#A68D60","#B0C5BB","D9593D","#0E3D59","#88A61B","#F29F05","#F25C05","D92525","#C1E1ED","#76C7C6","#273D3B","#131A19","E35C14","#2D112C","#530031","#820233","#CA293E","EF4339","#AF7575","#EFD8A1","#BCD693","#AFD7DB","3D9CA8","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#FFF6C9","#C8E8C7","#A4DEAB","#85CC9F","499E8D","#229396","#8BA88F","#C7C5A7","#F0DFD0","F23C3C","#57385C","#A75265","#EC7263","#FEBE7E","FFEDBC","#96526B","#D17869","#EBAD60","#F5CF66","8BAB8D","#0D1C33","#17373C","#2B6832","#4F9300","A1D700","#1B2B32","#37646F","#A3ABAF","#E1E7E8","B22E2F","#C5D9B2","#53A194","#572C2C","#3D2324","695A3B","#425957","#81AC8B","#F2E5A2","#F89883","D96666","#002E40","#2A5769","#FFFFFF","#FABD4A","FA9600","#FFFEFC","#E2E3DF","#515B5E","#2E3233","CAF200","#FFF0A3","#B8CC6E","#4B6000","#E4F8FF","004460","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#F2E6CE","#8AB39F","#606362","#593325","1D1D1F","#212B40","#C2E078","#FFFFFF","#BADCDD","547B97","#0B3C4D","#0E5066","#136480","#127899","1A8BB3","#222130","#464D57","#D4E8D3","#FFFCFB","ED8917","#B33600","#FF8A00","#FFC887","#CC5400","B31E00","#012530","#28544B","#ACBD86","#FFD6A0","FF302C","#2E95A3","#50B8B4","#C6FFFA","#E2FFA8","D6E055","#112F41","#068587","#4FB99F","#F2B134","ED553B","#202B30","#4E7178","#4FA9B8","#74C0CF","F1F7E2","#302B2F","#696153","#FFA600","#9BB58F","FFD596","#458C6B","#F2D8A7","#D9A86C","#D94436","A62424","#22475E","#75B08A","#F0E797","#FF9D84","FF5460","#FFAA5C","#DA727E","#AC6C82","#685C79","455C7B","#686E75","#9BAAC1","#82787B","#E4F1DB","AAC19B","#F0C755","#E2AD3B","#BF5C00","#901811","5C110F","#FFFBDC","#BFBCA5","#7F7D6E","#3F3E37","E5E2C6","#BEBEBE","#F1E4D8","#594735","#94C7BA","D8F1E4","#1B1E26","#F2EFBD","#B6D051","#70A99A","2F6D7A","#F7E4A2","#A7BD5B","#DC574E","#8DC7B8","ED9355","#70E8CB","#FFE9C7","#FF5B5B","#545454","2D2D2F","#17111A","#321433","#660C47","#B33467","CCBB51","#2B2E2E","#595855","#A2ABA5","#CAE6E8","313F54","#023B47","#295E52","#F2E085","#FCAB55","EE7F38","#302C29","#D1D1BC","#A7C4BB","#6C8C84","466964","#212629","#067778","#49B8A8","#85EDB6","D9E5CD","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#35262D","#FFFBFF","#E8ECED","#A4B7BB","76A0B0","#61E8D2","#FCEEB9","#302F25","#704623","BBE687","#E1E6B9","#C4D7A4","#ABC8A4","#375D3B","183128","#C98B2F","#803C27","#C56520","#E1B41B","807916","#A3D9B0","#93BF9E","#F2F0D5","#8C8474","40362E","#524656","#CF4747","#EA7A58","#E4DCCB","A6C4BC","#5C2849","#A73E5C","#EC4863","#FFDA66","1FCECB","#0EEAFF","#15A9FA","#1B76FF","#1C3FFD","2C1DFF","#010000","#393845","#9B96A3","#5C0009","940315","#468071","#FFE87A","#FFCA53","#FF893B","E62738","#404040","#024959","#037E8C","#F2EFDC","F24C27","#FF765E","#C2AE8B","#FCCF65","#FFE5C6","B7BDC4","#003647","#00717D","#F2D8A7","#A4A66A","515932","#FAFAC0","#C4BE90","#8C644C","#594D37","293033","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","E74C3C","#3B3B3B","#A8877E","#FFA49D","#FF7474","FF476C","#0A3A4A","#196674","#33A6B2","#9AC836","D0E64B","#FFA340","#38001C","#571133","#017A74","00C2BA","#DCEBDD","#A0D5D6","#789AA1","#304345","AD9A27","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#F0E6B1","#B5D6AA","#99A37A","#70584B","3D3536","#2F400D","#8CBF26","#A8CA65","#E8E5B0","419184","#010712","#13171F","#1C1F26","#24262D","961227","#403F33","#6E755F","#AFC2AA","#FFDEA1","E64C10","#C74029","#FAE8CD","#128085","#385052","F0AD44","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#E0401C","#E6B051","#272F30","#F7EDB7","9E2B20","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#FFFFE4","#F2E5BD","#B9BF8E","#A69F7C","8C6865","#5C8A2D","#AFD687","#FFFFFF","#00C3A9","008798","#4F3130","#FF1F3D","#5BE3E3","#FDFFF1","8B9698","#D23600","#D95100","#DE6D00","#EE8900","FCA600","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#2A7A8C","#176273","#063540","#E6D9CF","403D3A","#21455B","#567D8C","#A59E8C","#8C8372","F2F2F2","#012340","#026873","#83A603","#BBBF45","F2F0CE","#FDFF98","#A7DB9E","#211426","#6B073B","DA8C25","#002F36","#142426","#D1B748","#EDDB43","FFFD84","#420000","#600000","#790000","#931111","BF1616","#3C989E","#5DB5A4","#F4CDA5","#F57A82","ED5276","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#F5ECD9","#2BACB5","#B4CCB9","#E84D5B","3B3B3B","#A5EB3C","#60C21E","#159E31","#53DB50","C5FFCB","#263138","#406155","#7C9C71","#DBC297","FF5755","#0A111F","#263248","#7E8AA2","#E3E3E3","C73226","#003B59","#00996D","#A5D900","#F2E926","FF930E","#00A19A","#04BF9D","#F2E85C","#F53D54","404040","#324152","#47535E","#796466","#C1836A","DEA677","#036F73","#84CDC2","#FEF2D8","#F18C79","EF504F","#174040","#888C65","#D9CA9C","#D98162","A65858","#56797F","#87A0A4","#FCFBDC","#F2DDB6","A6937C","#A8BAA9","#FFF5CF","#DBCDAD","#B39C7D","806854","#60655F","#AB9675","#FFE0C9","#D4CCBA","CF8442","#BDDFB3","#009D57","#2C372E","#0F2925","465F3F","#3E3947","#735360","#D68684","#F1B0B0","EBD0C4","#0A7B83","#2AA876","#FFD265","#F19C65","CE4D45","#FFFFFF","#F4921E","#858585","#C5D2DB","3E6B85","#11151E","#212426","#727564","#B9AA81","690C07","#000000","#910000","#CBB370","#FFFBF1","21786C","#F78F00","#C43911","#75003C","#37154A","0F2459","#003354","#91BED4","#D9E8F5","#FFFFFF","F26101","#3DA8A4","#7ACCBE","#FFFFF7","#FF99A1","FF5879","#64C733","#F0F0F0","#3E879E","#57524D","36302B","#343844","#2AB69D","#E65848","#FDC536","FCF2D7","#E34517","#F5FF53","#B4E85E","#00BD72","0B4239","#A84B3A","#FF9F67","#233138","#FFF7F5","4C646B","#59535E","#FAEEFF","#F1BAF3","#5D4970","372049","#FF6F22","#D9984F","#FFE8A9","#3E4237","32948A","#5D7370","#7FA6A1","#B8D9B8","#D6EDBD","FFF5BC","#FFBE00","#FFDC00","#FFD10F","#FFDE20","E8CA00","#003840","#005A5B","#007369","#008C72","02A676","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#BA2F1D","#FFF8A4","#F5E67F","#264A59","1E2C30","#222526","#FFBB6E","#F28D00","#D94F00","80203B","#EBD096","#D1B882","#5D8A66","#1A6566","21445B","#F00807","#5F6273","#A4ABBF","#CCC9D1","E2E1E9","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#152737","#2B4E69","#799AA5","#FFFFF0","682321","#C44C51","#FFB6B8","#FFEFB6","#A2B5BF","5F8CA3","#5ADED4","#4DAAAB","#26596A","#163342","6C98A1","#FF5B2B","#B1221C","#34393E","#8CC6D7","FFDA8C","#3D4D4D","#99992E","#E6E666","#F2FFBF","800033","#242424","#437346","#97D95C","#D9FF77","E9EB9B","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#4D2B2F","#E57152","#E8DE67","#FFEFC3","C0CCAB","#A82221","#DB5E31","#EDA23E","#F2CB67","BFB840","#3B3140","#BFB8A3","#F2E0C9","#F2B9AC","D97E7E","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#EFDFBB","#9EBEA6","#335D6A","#D64F2A","7A8A7F","#000001","#313634","#C7CECF","#5C0402","941515","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F5F4E1","#D6C9B5","#B4AA97","#D44917","82877A","#19162B","#1C425C","#6ABDC4","#F0E4C5","D6C28F","#00132B","#7F9DB0","#C5E2ED","#FFFFFF","F95900","#1F3642","#6D968D","#B6CCB8","#FFE2B3","56493F","#08A689","#82BF56","#C7D93D","#E9F2A0","F2F2F2","#DE3961","#A4E670","#FFFFDC","#B3EECC","00ADA7","#849972","#D9D094","#A6A23E","#4F2F1D","8F5145","#F41C54","#FF9F00","#FBD506","#A8BF12","00AAB5","#00585F","#009393","#F5F3DC","#454445","FF5828","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#140B04","#332312","#B59D75","#E3D2B4","FFF7EA","#ED3B3B","#171F26","#77B59C","#F2E7B1","635656","#46594B","#A6977C","#D9B384","#734F30","260B01","#CCB8A3","#FF8FB1","#FFF5EA","#4E382F","B29882","#B70000","#FFFFFF","#FFCA3D","#94C4F4","0092B3","#053B44","#06736C","#A53539","#B9543C","EAD075","#E8C1B9","#FFB3AB","#FFCAB8","#E8B69C","FFCEAB","#E7F2DF","#69043B","#59023B","#231E2D","161726","#E82B1E","#E5DEAF","#A0B688","#557A66","453625","#F1E6D4","#BA3D49","#791F33","#9F9694","E3E1DC","#CED59F","#F1EDC0","#B1BEA4","#647168","282828","#2C3E50","#E74C3C","#ECF0F1","#3498DB","646464","#DE7047","#FFDE8D","#FFFFFF","#CDDE47","528540","#8EAB99","#40232B","#D95829","#D97338","DEC085","#E9662C","#EBAF3C","#00AC65","#068894","2B2B2B","#46483C","#A0AA8F","#EBE3CB","#FFFFFF","F26101","#170F0E","#290418","#505217","#FFD372","FFF1AF","#263545","#C4273C","#D7DADB","#6DBCDB","FFFFFF","#DCFAC0","#B1E1AE","#85C79C","#56AE8B","00968B","#075807","#097609","#70AF1A","#B9D40B","E5EB0B","#521000","#712800","#744E1D","#879666","F1D98C","#261F26","#3F3B40","#6C7367","#BFBF8A","F2E086","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#506D7D","#94CCB9","#FFECA7","#FFB170","F07D65","#3F4036","#8DA681","#F2E1C2","#BF2806","8C1D04","#990700","#CC542E","#FF964F","#FFCB7C","787730","#195073","#7F8C1F","#EE913F","#F2E5BD","9FD7C7","#1B3E59","#F2F0F0","#FFAC00","#BF0404","730202","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F95759","#FDA099","#FFFFFF","#D9F3CB","8AC2B0","#265573","#386D73","#81A68A","#9FBF8F","D4D9B0","#E1DA36","#FFEA1B","#6FE4DA","#1DB0BC","007BBC","#013859","#185E65","#F9CC7F","#F15C25","9E1617","#36CC7C","#D6FFBE","#94D794","#228765","77A668","#94201F","#D4421F","#478A80","#D9E061","F08835","#F16233","#00B5B5","#F0F0F0","#3E4651","5C6D7E","#2E806C","#76CC99","#E0FFED","#FF5F3A","D2413C","#00393B","#00766C","#44A18E","#E5EDB6","F6695B","#734854","#F2F2E9","#D9D7C5","#A69580","736766","#03497E","#0596D5","#9DEBFC","#8D7754","FEB228","#F0E14C","#FFBB20","#FA7B12","#E85305","59CC0D","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#00557C","#186D94","#3488AD","#81C1DC","BBE5F3","#DEE8D7","#918773","#420A1A","#240001","4D493A","#FFFFFF","#CAC535","#97AF25","#158471","41342C","#041F3D","#0B2E41","#165751","#448C61","9AC16D","#FA8C01","#FF6405","#577700","#082400","A0A600","#78C0F9","#FFDDCE","#FFFFFF","#FFDBE6","FE86A4","#351330","#CC2A41","#E7CAA4","#759A8A","524549","#02151A","#043A47","#087891","#C8C8C8","B31D14","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#58838C","#DAD7C7","#BF996B","#BF5841","A61C1C","#556354","#E68F0D","#8C948A","#495450","42423F","#323640","#5B6470","#8C94A1","#BDC7D6","DFE2FF","#FF0000","#FF950B","#2FA88C","#DEEB00","4B2C04","#0F3D48","#174C5B","#366774","#ECECE7","E96151","#3DBB7E","#A3CD39","#FBAC1D","#F96C1E","EE4036","#23363B","#A44F3F","#F8983D","#8D9151","BBC946","#4B5657","#969481","#D2C9B0","#F4E3C1","B6B835","#E8980C","#B1F543","#F2FF00","#FF5E00","59BBAB","#849696","#FEFFFB","#232D33","#17384D","FF972C","#555555","#7BB38E","#F4F1D7","#F8AB65","F15C4C","#1D3C42","#67BFAD","#F2EC99","#F2C48D","F25050","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#B8E1F2","#249AA7","#ABD25E","#F8C830","F1594A","#FDEDD0","#BCF1ED","#FF634D","#FD795B","FFF0AA","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFFFF1","#D5FF9B","#8FB87F","#5A7B6C","374E5A","#010340","#0E1E8C","#0003C7","#1510F0","1441F7","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#871E31","#CCC097","#9E9D7B","#687061","262626","#F16663","#F48D6C","#F2E07B","#8ABE9B","4A6D8B","#001F11","#204709","#0C8558","#FFD96A","FF4533","#1D1626","#F2E0BD","#BFAA8F","#8C786C","594C4C","#685D47","#913420","#1E2729","#C1D9C5","FEEFB1","#1D7561","#FC8448","#FF4138","#A8282B","38141B","#BF0633","#FF484E","#FF9273","#D1D0B4","E5ECED","#8E9E63","#E6DBB0","#F5EED7","#C4BCA0","176573","#665446","#809994","#AECCB6","#DEF2C4","E6683F","#3D0D26","#660A3E","#891C56","#B0276F","C93482","#082136","#00294D","#004B8D","#0068C4","2998FF","#3C4631","#9A746F","#F8A2AB","#F1C6B3","EAE9C0","#FF534E","#FFD7AC","#BED194","#499989","176785","#006D80","#BDA44D","#3C2000","#84CECC","78A419","#352C2B","#3C555C","#9E9657","#FFEBCD","CD5510","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#523631","#D1BE91","#605E3A","#4D462F","592F39","#18293B","#5B5A56","#F2DEA0","#D0B580","FFFBFF","#C8DBB6","#ECEBB7","#CCC68A","#B8B165","827A5D ","#7DA88C","#EBE9A0","#BED24B","#859132","35323C","#E8574C","#F27B29","#E6A51B","#D9CC3C","399977","#324032","#B7C22C","#FFFFE1","#22A8B5","2A3F42","#B3A589","#FFB896","#FFF9B1","#9AB385","11929E","#272433","#343F4F","#3D6066","#77994D","B2D249","#250701","#6D4320","#B0925F","#E7DEC0","82ABB8","#023550","#028A9E","#04BFBF","#EFEFEF","FF530D","#594732","#40342A","#7A422E","#D4CA9A","EDE5AE","#013C4D","#BA5B22","#DB913C","#F0B650","FAD46B","#143840","#5C6B63","#A69E89","#E0C297","D96523","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#CA3995","#F58220","#FFDF05","#BED73D","61BC46","#FFE1D0","#FFBFB4","#FF837E","#FF4242","BF1616","#C4EEFF","#7BA32D","#094201","#A41717","C48726","#001325","#187072","#90BD90","#D7D8A2","F2E4C2","#1A4F63","#068587","#6FB07F","#FCB03C","FC5B3F","#97B350","#333230","#736D61","#BAAB90","FFE5BA","#403D33","#807966","#CCC2A3","#8C0000","590000","#5F8A42","#86AD59","#F6FAA1","#F28410","D66011","#BF355D","#ED8168","#FAB66A","#F2DC86","83BFA1","#E1F03E","#FFBA14","#DB3A0F","#A1003D","630024","#212226","#45433F","#687067","#BDBB99","F0EAC3","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#293B47","#5F7A87","#FFFFFF","#CBFF48","00ADA9","#282A33","#697371","#FFE7A6","#F5BA52","FA8000","#0C304A","#2B79A1","#F3F4F1","#85A71E","BFD841","#008B83","#4DAE83","#A0AE79","#FFE499","FF665E","#5D7359","#E0D697","#D6AA5C","#8C5430","661C0E","#324452","#97BDBF","#F2DFBB","#F28705","BF3604","#EEEFB9","#6ACFAE","#369C93","#232928","B03831","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#2B2830","#5C504F","#ABAB8E","#D9D7A3","C7BE88","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#00305A","#00448D","#0074D9","#4192D9","7ABAF2","#344459","#485F73","#5DA6A6","#A9D9CB","F2EAD0","#060719","#4D1B2F","#9E332E","#EB6528","FC9D1C","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#05F2F2","#04BFBF","#EEF1D9","#A60201","7E100E","#E6F1F5","#636769","#AAB3B6","#6E7476","4B4E50","#DA0734","#F1A20D","#4AABB1","#FCF3E7","3F1833","#202D44","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#CC3B37","#398899","#FFFCE8","#FF857F","CCC1A3","#5DBEA9","#EFEDDF","#EF7247","#4E3F35","D1CBBA","#FFC62D","#E49400","#DD5200","#EFE38A","91B166","#B67D14","#F2921F","#F0B23E","#A62409","441208","#C71B1B","#D6BA8A","#017467","#E08F23","0B0D0C","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#435772","#2DA4A8","#FEAA3A","#FD6041","CF2257","#6DD19D","#99E89D","#D0E8A1","#FFF9C0","D40049","#FAF1D5","#DEC9AC","#CCA18B","#11282D","A5C4BB","#000000","#141414","#1C1919","#1A1716","24201F","#D5D8DD","#5CA2BE","#135487","#2A4353","989DA4","#73161E","#BF0F30","#BFB093","#037F8C","0A2140","#195962","#F56F6C","#FFFFFF","#252932","191C21","#F8EFB6","#FEBAC5","#6CD1EA","#FACFD7","C2EAE9","#91D6BC","#768C6A","#755F31","#B37215","FFBA4B","#F2E6BB","#DD4225","#202724","#63BD99","F8FDD8","#762B1B","#807227","#CCBF7A","#FFEF98","60B0A1","#707864","#C1D74E","#F5FF7C","#DFE6B4","A6B89C","#FFF3D2","#97B48F","#E87657","#FF9B6F","E8D495","#33262E","#733230","#CC5539","#E6D27F","86A677","#122430","#273E45","#FFFCE2","#EBD2B5","E63531","#30394F","#FF434C","#6ACEEB","#EDE8DF","FFFBED","#0A3A4A","#196A73","#32A6A6","#A1BF36","C8D94A","#FFF7CC","#CCC28F","#70995C","#33664D","142933","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#B52841","#FFC051","#FF8939","#E85F4D","590051","#473C35","#A36D5C","#9C968B","#D9CEAD","8A866A","#DB4C39","#2D3638","#109489","#44D487","D0DB86","#6F8787","#AEC2AE","#E6DFAE","#B0B57B","888F51","#C8385A","#FFCF48","#ECEABE","#1FCECB","1CA9C9","#42282E","#75A48B","#D9CFB0","#DC9B74","D6665A","#362F2D","#4C4C4C","#94B73E","#B5C0AF","FAFDF2","#98293A","#B14A58","#C86C6B","#DE9D76","EFC77F","#C1D301","#76AB01","#0E6A00","#083500","042200","#453F22","#7A6B26","#CCAD5C","#A1191F","4E1716","#541E32","#8E3557","#88A33E","#C2BD86","F7F2B2","#2B1B2E","#54344D","#FFFFD6","#B89E95","6E444F","#6EC1A5","#9FBEA6","#F5D3A3","#FF9F88","FB7878","#2F252C","#D3CCB2","#99AD93","#6E6751","5C3122","#BE333F","#F2E9CE","#C8C5B1","#939F88","307360","#F0F1F2","#232625","#647362","#B3D929","D2D9B8","#FA2B31","#FFBF1F","#FFF146","#ABE319","00C481","#09455C","#527E7C","#F5FFCC","#E0EB6E","C4D224","#F2DA91","#F2B950","#F29D35","#D96704","BF4904","#A2CFA5","#E0E7AB","#F5974E","#E96B56","D24344","#150033","#310D42","#5C2445","#AB6946","FFCE4C","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#65A683","#218777","#3F585F","#47384D","F53357","#000623","#28475C","#4A6C74","#8BA693","F0E3C0","#E65322","#D19552","#B8BF73","#B6DB83","FFF991","#112F41","#068587","#6FB07F","#FCB03C","FC5B3F","#C89B41","#A16B2B","#77312B","#1C2331","152C52","#C24366","#D9C099","#FFF8D8","#A8E0BA","00ADA7","#CC0000","#006600","#FFFFEC","#9C9178","6C644F","#3D0319","#720435","#C1140E","#FC5008","32241B","#CFC7A4","#5A9E94","#005275","#002344","A38650","#FFEBC3","#CC3A00","#FF3600","#FF851B","800C00","#EFC164","#F3835D","#F35955","#286275","00434C","#E9F29D","#B7C29D","#878E8F","#67617A","51456B","#445859","#03A696","#49C4BE","#F1F2E4","FF7746","#FA726C","#FFD794","#BAD174","#3BA686","5F6F8C","#4D2B1F","#635D61","#7992A2","#97BFD5","BFDCF5","#CC4D00","#E6CF73","#668059","#264D4D","00CCB3","#4385F5","#DC4437","#FCBE1F","#109D59","FFFFFF","#271F2E","#A4A680","#F2EBC9","#D9B166","A66B38","#0B2C3C","#FF6666","#DADFE1","#FFFFFF","444444","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#302B26","#A6B827","#EDE9DD","#98D3D4","594E7A","#4B0505","#720707","#BFB694","#004659","00292B","#B52C38","#EBD1B0","#536682","#D9964B","DE6846","#F2F1DF","#F2B705","#F2C84B","#BF820F","734002","#26140C","#3D2216","#784E3D","#AB8574","D6BCB1","#26221D","#8C2C0F","#E6E5B8","#BFB38D","402D1F","#1F8181","#F2BC79","#F28972","#BF1B39","730240","#002635","#013440","#AB1A25","#D97925","EFE7BE","#8EC447","#FFFFFF","#96D3D4","#636466","2D2D2E","#2D1E1E","#4B3C37","#96A576","#CDE196","FFFFBE","#F06060","#FA987D","#F7F2CB","#72CCA7","10A296","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#DEDE91","#EF9950","#F34E52","#C91452","492449","#6D8EAD","#1F3447","#1A0B07","#362416","CFCDB4","#00CD73","#008148","#2D9668","#3ECD8E","004E2C","#3D8080","#628282","#858383","#A38282","C28080","#475159","#839795","#B2BDB7","#CCC9C0","F2F2F2","#0E6870","#C6B599","#C65453","#FFDDB4","EDAA7D","#CEF0B7","#A8DBA8","#79BD9A","#3B8686","0B486B","#292C44","#FF5349","#F0F0F1","#18CDCA","4F80E1","#272A2B","#383737","#473B39","#692B28","940500","#D6C274","#DB9E46","#25706B","#3D2423","AB362E","#FFA68F","#FF4867","#FFF9C8","#B5EBB9","18B29D","#A1A16A","#727D59","#366353","#133C40","03212E","#D45354","#A9DC3A","#2FCAD8","#818B85","CDCDC1","#F14B6A","#3D3C3E","#22BDAF","#BAD7D4","F4F4F4","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#9FFF4A","#1ABF93","#087363","#004040","2F1933","#FFDB97","#B28F4E","#FFFDFB","#466CB2","97BBFF","#991C00","#E09A25","#FFFCDB","#008B83","262B30","#44281A","#00ACAE","#F5EFD5","#F37606","EE4717","#FF5952","#FCEEC9","#96D6D9","#4FAAC9","176075","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#105F73","#F7F3B2","#C6CC33","#F28322","CC5404","#137072","#56B292","#B7F5AB","#FBFFC0","BF223D","#E3F23E","#6C821C","#A6A53F","#E0E0AC","33302E","#00215E","#003CAA","#1967F7","#5E4000","AA7400","#273A3D","#54695C","#AD9970","#FFBF87","FF8F60","#FFAA00","#C2B93E","#808F5D","#576157","302F30","#BE1405","#F2DCAC","#AABEAA","#736E41","413C2D","#6B1229","#C76A61","#FAB99A","#F7D9B5","CCB1A7","#2D9993","#58B3A3","#83BFA3","#B0D9A8","FFFCB6","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F30B55","#010326","#012840","#54717F","F2E6CE","#2A3411","#73662C","#BC9847","#FFDFB2","6B0031","#637D74","#403D3A","#8C3B3B","#AB6937","D4A960","#010A26","#011640","#B6D6F2","#FFFFFF","E83338","#924847","#EB986C","#E4C678","#9C7885","372C2C","#022440","#3F95AA","#4EC6DE","#EAE2DF","F7572F","#2B1D2E","#323657","#076473","#54B087","D6F567","#052229","#004043","#BCC373","#E3FF55","D0D90C","#4C514A","#907A62","#879796","#755854","B09880","#1D2939","#1CAF9A","#FFFFFF","#EE4F4B","D1DC48","#004B67","#41CCB4","#FFEA95","#FF7C5D","C70151","#C0272D","#FCFBE7","#9FD3DA","#008C9A","05484F","#213130","#FF5E3D","#C9C83E","#FDFFF1","559398","#B1E4FC","#366D78","#39D5F1","#FFFFFF","D9FF03","#DECE6C","#FCF9B6","#BFE3B5","#5D826E","262E2B","#520A17","#668F91","#F5E6AC","#AB8E5B","52301C","#2D3032","#DD5F18","#FBA922","#F7F7F7","404333","#0C2538","#2B434F","#638270","#BCC98E","EDE059","#E85066","#F28E76","#E6CEB0","#5A8C81","382837","#BF2633","#A6242F","#D9CEAD","#C0B18F","011C26","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#0A8B91","#485956","#C4B98F","#FFF9BC","EEDF2E","#B89A7B","#9BBAAC","#F2D649","#D95D50","DBDBDB","#BD7938","#8D4421","#643001","#532700","3A1C00","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#2E4259","#F7483B","#ECF0F1","#03C8FA","737373","#364656","#5D6B74","#94A4A5","#F2F5E9","FF8C31","#3E5916","#93A605","#F28705","#F25C05","E5EFFA","#248077","#74AD8D","#C82754","#F7BB21","F9E2B7","#20736A","#8BD9CA","#B1D95B","#93A651","403E34","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#252F33","#415C4F","#869C80","#93C2CC","CEEAEE","#012840","#79C7D9","#9BF2EA","#497358","9DBF8E","#EE7E94","#F8B4C4","#C7CAC9","#D8505C","41424","#282828","#505050","#FFFFFF","#2DCEDB","F20000","#004358","#1F8A70","#BEDB39","#FF5347","FD7400","#470C3B","#802F56","#C0576F","#E38679","FFBD83","#573328","#B05A3A","#FF8548","#29332E","0F1B1C","#461F2D","#E1FFBB","#BAD47F","#849C23","52533F","#333A40","#4C5E5E","#ADD0E5","#CDE4FF","729EBF","#DE5605","#F7A035","#B1DEB5","#EFECCA","65ABA6","#76D6D2","#F9E270","#EF6F56","#F4EED8","596B56","#403E3F","#F2F2F2","#D9D9D9","#9DAABB","8C8C8C","#059E9A","#F4F2ED","#F5A243","#DB3E3B","585857","#FFBF41","#EE8943","#C02221","#FFF4D3","249CA9","#024E76","#39A6B2","#FCE138","#F5B824","F08106","#FF0067","#FF3D6A","#E7FF04","#9CFF00","56FF00","#003540","#0D3F40","#487360","#8FA671","F2D795","#FF493C","#FFFFFF","#B3ECEF","#31C4F5","ADEB41","#244358","#4A8B87","#7CBCAE","#F0D4AF","C5252B","#EA5930","#F8AF1E","#F5E5C0","#097380","372560","#A1DBB2","#FEE5AD","#FACA66","#F7A541","F45D4C","#2C4A47","#6C9A7F","#BB523D","#C89D11","81810B","#F0F1F2","#232625","#647362","#FF5629","D2D9B8","#7C9B5F","#B8D197","#E3FFF3","#9BDEC7","568F84","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#77A7FB","#E57368","#FBCB43","#34B67A","FFFFFF","#001A2E","#8F0000","#FFFFFF","#8A874B","41594F","#312F40","#49A69C","#EFEAC5","#E89063","BF5656","#047C8C","#018B8D","#F3BF81","#F49B78","F1706D","#00303E","#7096AD","#C1D1DE","#FFF9EF","EC4911","#2D6891","#70A0BF","#F5EEDC","#DC4C1A","F0986C","#040002","#3D1309","#E8B96A","#BC5D15","5C0F00","#8B929C","#5E6070","#514454","#3B313D","FF2479","#142D58","#447F6E","#E1B65B","#C8782A","9E3E17","#22104D","#2D1E5E","#483A85","#7067AB","A49CFA","#919C86","#9E373E","#2B2E36","#D1B993","C45A3B","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#37C78F","#FEE293","#FF4D38","#CC2249","380C2A","#47282C","#8C8468","#C9B37F","#DBDAB7","C4C49C","#14191A","#2D2B21","#A69055","#CCB287","FFB88C","#F5E3CD","#696158","#B6A898","#877D71","504A43","#005151","#009393","#F56200","#454445","969692","#D95F47","#FFF2C1","#80A894","#106153","072C36","#9E352C","#E6E8A9","#93C28C","#2E5A5C","2B2623","#03013A","#334A94","#6B9EDF","#83C3F2","99E6FF","#372A26","#4D4D4D","#6DA0A7","#9ED5A8","C7F5FF","#03658C","#022E40","#F2B705","#F28705","F25C05","#FF3B16","#E87826","#E8BA4A","#80A272","003045","#00748E","#E3DFBB","#F4BA4D","#E3753C","DA3B3A","#25401E","#56732C","#84A63C","#B8D943","EAF2AC","#449BB5","#043D5D","#EB5055","#68C39F","FFFCF5","#108F97","#FF8B6B","#FFE39F","#16866D","103636","#1A4F63","#068F86","#6FD57F","#FCB03C","FC5B3F","#381C19","#472E29","#948658","#F0E99A","362E29","#D7E8F7","#BBD0E3","#9CB7CF","#6A8BAB","375D81","#0F1C28","#136972","#67BFA7","#F3CF5B","F07444","#FFFFFF","#4EA9A0","#969514","#FE9C03","FCDE8E","#2F2D30","#656566","#65537A","#51386E","2A2333","#4C2916","#F05A28","#FBAF3F","#38B449","FFFFFF","#132537","#006C80","#EBCAB8","#FE8315","FA3113","#ECEEE1","#A8DACF","#F05B4F","#D8403A","221E1F","#00305A","#004B8C","#0074D9","#4192D9","7ABAF2","#72CF3F","#85FF00","#23E000","#2FB81B","00FF1C","#45CEEF","#FFF5A5","#FFD4DA","#99D2E4","D8CAB4","#FF5B00","#A1716C","#728296","#439AAB","00CABD","#EB6C2D","#D9C8A2","#939C80","#496158","232F38","#D94214","#FFF2C1","#80A894","#52736B","093844","#4D1B2F","#9E332E","#EB6528","#FC9D1C","FFCA50","#FFEEB0","#9AE8A4","#C7C12D","#F76245","ED1C43","#FFFAED","#D4DBFF","#879AC9","#242942","FF8800","#022840","#013440","#517360","#9DA67C","F2DC99","#331A0F","#519994","#BA4B3C","#EEDDAA","789F63","#577867","#EDCE82","#D68644","#AB3229","662845","#435A66","#88A6AF","#F5F2EB","#D9CDB8","424342","#FF8840","#958D4F","#737B55","#595540","513E38","#9D805A","#EBC99D","#FFE6C5","#9DCEEA","4B809E","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#98C000","#3D4C53","#EA2E49","#FFE11A","0CDBE8","#A20E30","#E93C4F","#DCDCD4","#ADBCC3","2D4255","#1C2640","#263357","#384C80","#4E6AB3","5979CD","#D94214","#FFF2C1","#80A894","#52736B","093844","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#E04946","#3BA686","#B6D15D","#FFD495","FA847E","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#FFA136","#FF814A","#E6635A","#785D6B","534557","#CDCF91","#EBEACC","#D6D5B8","#6D7D80","41545E","#011526","#011C40","#4E8DA6","#F2EA79","F2B33D","#353230","#3F4E51","#7B8F70","#99B2BE","F6F4EA","#063559","#0D8C7F","#8FBF4D","#F2D13E","D95929","#158000","#199900","#20BF00","#24D900","29FF00","#0B0D0E","#137074","#7EB7A3","#F1DDBB","EC6766","#02151A","#043A47","#087891","#C8C8C8","B31D14","#59361F","#5C992E","#A3CC52","#E6E673","FF5933","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#4B1E18","#F9E5C2","#BBB082","#829993","4F5D4E","#032843","#1F595B","#508C6D","#71A670","A6DB89","#191724","#4C4547","#8C594E","#D18952","FDB157","#191919","#182828","#60702D","#AAB232","E6FA87","#212A3F","#434F5B","#F2F2F2","#8AB839","2E2E2E","#004158","#026675","#038B8B","#F1EEC9","F09979","#023059","#3F7EA6","#F2F2F2","#D99E32","BF5E0A","#F21E52","#FFFFFF","#3D3B42","#0C6F73","63CFD4","#452743","#E7635E","#F8E9A8","#89E0AD","00928C","#FAAD63","#D1714D","#785E48","#39403B","3D1C24","#4C0016","#FFF7EB","#DCCEA7","#A17345","104F53","#BF2431","#F24150","#2A4557","#3B848C","EFF2E4","#3B3013","#8F6031","#E88833","#9C0C0A","FDF3C1","#1E2422","#88BEB1","#FF006D","#DAFFFF","718A94","#F1F4F7","#AF9F7B","#775E43","#40413C","251C17","#00182E","#0C6BA1","#D4D6D4","#FFFDEB","FF7500","#FFAB4A","#CCBAAB","#1E2129","#3D5E6E","47A3A3","#66B3A7","#C0D4B6","#EEF0BD","#F0563D","2C2F3B","#332525","#907465","#EDC5B5","#878C6D","63674A","#F04C16","#DBDBD0","#EDBD1F","#4CB09C","313B4A","#2B211D","#611C26","#C5003E","#8EB7A8","F1E4B7","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#03497E","#0596D5","#9DEBFC","#999999","FE4B28","#2F4159","#465E73","#88A649","#F2ECE4","D98841","#323A46","#22282F","#EB4A33","#FFFFFF","E9F0F5","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#F29727","#E05723","#B0382F","#982E4B","713045","#4D584A","#465943","#428552","#3E754E","4C694B","#47191C","#59574B","#829690","#B5B09A","E1E3CB","#1D5123","#B1C661","#FFDA68","#FE9257","F64448","#59323C","#260126","#F2EEB3","#BFAF80","8C6954","#4E0805","#9E0522","#FFF4D4","#B8C591","447622","#424862","#FB9A63","#BFC4D5","#F6FBF4","FEBC98","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#1C2F40","#4C6173","#8094A6","#D9D1BA","F2E9D8","#DFD7B7","#EB7707","#5C5445","#3B2323","9CBFC7","#262E3B","#9C8878","#CFCAAA","#FBF8FF","992435","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#404A69","#516C8A","#8AC0DE","#FFFFFF","FFAC00","#485B61","#4B8C74","#74C476","#A4E66D","CFFC83","#A31180","#C42795","#DE52B4","#EA88CE","FFBFE5","#E64D2E","#FFF5F1","#7893AD","#576B9C","2D2A52","#BF0436","#8C0327","#590219","#F2CBA1","8C674C","#CF5B6F","#FFF8C8","#CAD9B1","#8FB3A0","648991","#341D44","#744D90","#BB8CDD","#3E4417","88904D","#00293E","#003D4E","#006269","#00918F","00BAB5","#43212E","#D9666F","#F2D57E","#A9A688","516057","#2A3B30","#ABFFD1","#EBFFF5","#9DFEFF","273B40","#A63343","#E65159","#F5E9DB","#F4F7CF","BAD984","#1BA68C","#54BFAC","#F2EDA7","#F2E530","D94625","#1A2A40","#3F7369","#F2DEA0","#CE5251","EA895E","#1E9382","#70A758","#EFF1C2","#F0563D","2E313D","#A991E8","#FFB4BB","#ACF7FF","#A2E891","FFEDAE","#225B66","#17A3A5","#8DBF67","#FCCB5F","FC6E59","#282624","#BFB7AA","#403D39","#807A71","ABA398","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#440008","#605521","#988432","#D9A54E","9E3711","#649670","#36291E","#69AD6C","#92E67C","C5FF84","#42342C","#738076","#B2B39B","#DFE5E1","294359","#1A3838","#3F7A51","#82A352","#D1C062","FFBE59","#7D8C22","#B3BF67","#F2E49B","#D9DFF4","6791BF","#8A7D6D","#2D2D38","#E86E48","#FFFFE8","9CC9C9","#CFC949","#FFF5BF","#A9E6C4","#6AB39F","665841","#A1172D","#FDFFBA","#A7DB9E","#275C57","1F1B19","#FF6C0D","#F29E00","#E6C10F","#44996F","216273","#2C3E50","#FA4248","#D7DADB","#6DBCDB","FFFFFF","#627369","#99B397","#E2F2C6","#91CCAD","376266","#04496E","#66CAFF","#A3FC7E","#70D44A","2C6B0F","#1BA68C","#97BF3F","#F2ECD8","#F2B035","F2522E","#A2D9B1","#7CBF9E","#F2F1B9","#8C8575","193741","#024959","#037E8C","#F2EFDC","#E74C30","363636","#212625","#9CA6A2","#D0D9D6","#BF0404","C2C6AF","#00FFFF","#00FF00","#FFFF00","#FF5100","FF007C","#212629","#CDCF19","#FFF77D","#96C4AB","CF2A56","#CFF9FF","#BFC7BB","#787051","#332730","57324F","#98CACB","#FDEFBE","#F0542B","#736E5B","ABA68E","#F2F1EB","#BFB9A4","#262222","#802A30","8C0303","#65356B","#AB434F","#C76347","#FFA24C","519183","#78BF82","#A4D17C","#CFD96C","#EBD464","FFD970","#806265","#FFA256","#F7DD77","#E0D054","ABA73C","#8F323C","#123943","#80BDDB","#4189AB","C98127","#683820","#8C9A89","#E7D6A2","#BEAA65","9A8234","#021B21","#032C36","#065F73","#E8DFD6","FF2A1D","#2D6C73","#3FA693","#B4D9CB","#9ABF49","C6D93B","#141F26","#2B4040","#405950","#A69E86","F2D9BB","#4A8279","#003330","#610400","#003B06","02730F","#69B5E1","#D4E4F5","#EAF2F8","#BEDBED","000000","#893660","#EF7261","#68D693","#A0D7E2","299CA8","#073A59","#2D9AA6","#F2E2DC","#F23322","A61B1B","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF6900","#F3BD8D","#F1A280","#BE6D6B","#704A5B","3E263C","#1C2742","#3C91C7","#5A9ABE","#95C5DE","E0EEFB","#426261","#465A59","#577573","#739A97","9AC1C0","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#589373","#BFBD99","#F2D6B3","#C2512F","241E1E","#1F518B","#1488C8","#F7E041","#E2413E","B5292A","#549494","#E85649","#232C2E","#E6E8D2","706558","#392133","#FFECBE","#D9D098","#C4AB6D","AB7D3A","#F0F0F0","#1C1C1C","#A2FDF5","#1CCDC7","27EDDF","#011526","#025959","#027353","#03A678","03A696","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#37465D","#F2F2F2","#9DC02E","#779324","051A37","#580022","#AA2C30","#FFBE8D","#487B80","011D24","#F9F9F9","#03A678","#E9EDEB","#F44647","00707F","#800000","#BF0000","#E2D6C2","#F6EDD8","FFFFFF","#F7F6AF","#1B2124","#D62822","#97D6A6","468263","#432852","#992255","#FF3D4C","#28656E","00968F","#444344","#52BBB2","#2B344D","#EE5555","F8F7EE","#45334A","#796B7D","#CCC4B0","#FFF1B5","FFA3A3","#5A4B53","#9C3C58","#DE2B5B","#D86A41","D2A825","#14151C","#0C242B","#297059","#84D66E","D1FB7A","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#2E064D","#80176B","#B356A1","#59580B","FFFF00","#CC3333","#FF9D33","#F7F7F0","#3EBBA7","00747A","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","BD6060","#0D3E58","#1C848C","#19C0C2","#F3EDD6","DA6260","#022629","#2A5945","#FAFFED","#E6DCC0","B3371C","#F4FAC7","#7BAD8D","#FFB159","#F77F45","C2454E","#A2C1C6","#86B1B7","#AECBAD","#CFDCB0","D6E1D1","#B0DAFF","#325B80","#64B7FF","#586D80","5092CC","#0F808C","#6C8C26","#F2A71B","#F26A1B","D91818","#FFBC6C","#FE9F6C","#BD716E","#74495F","3B2C4D","#FF4D41","#F2931F","#E6CA21","#91B321","1E8C65","#302821","#453629","#5C4837","#8A735F","BDA895","#415457","#5F7B7F","#9ACCAF","#E6EBC4","F9F7C8","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#805939","#BD9962","#E6CD7D","#578072","2D4B4D","#03588C","#1763A6","#419CA6","#54BF83","8DBF41","#00CCFF","#A1FCFF","#040438","#004878","C9FAFF","#534C64","#B7DECF","#F0F3D7","#7E858C","D96557","#7F7364","#CBB08E","#CBC1B7","#789DCB","646F7F","#5C2849","#A73E5C","#EC7263","#FE9551","FFD285","#FF0012","#FF7D00","#FFD900","#5BE300","0084B0","#F24C32","#F29471","#FCDFA6","#36B898","3D7585","#083157","#0A6C87","#459C97","#92CCA5","C9F0B1","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#323836","#BAD1B5","#DBE8CF","#F0F7E8","FFFEF5","#081724","#589494","#8EBBB4","#D0DCD0","F5EED2","#50781C","#9CAD1C","#EAF7E6","#40A5DE","0B5191","#537F79","#78A68F","#CBD49C","#FED457","CB252A","#F23C13","#CBAB78","#FFFFFF","#898373","1F1C17","#450003","#5C0002","#94090D","#D40D12","FFED75","#0770A2","#82D9F7","#FEFEFE","#AEC844","F36622","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#FF6B6B","#556270","#C7F464","#4ECDC4","EDC8BB","#D9B500","#FFED9C","#BFCC85","#748F74","454545","#452E32","#A34B1B","#B5A187","#EDDF9A","A7CC31","#2C2B33","#596664","#909980","#CCC08D","FF8A00","#C21F1F","#FFFFFC","#E34446","#FFFFDB","E36D6F","#282828","#00AAB5","#C1C923","#F41C54","F5F0F0","#3A3F40","#202627","#151B1E","#EFF4FF","41444D","#DEBB73","#4D0017","#010000","#4D0F30","9A002F","#EB9328","#FFA754","#FFD699","#FFF5DC","4FA6B3","#025E73","#037F8C","#D9D59A","#D9BD6A","590202","#636266","#E0CEA4","#E8A579","#7D6855","42403E","#FF0000","#FF4000","#FF7F00","#FFBF00","FFFF00","#FFFFFF","#74ADA6","#1E5E6F","#241B1F","68A81E","#5A0532","#FF6745","#FFC861","#9DAE64","27404A","#ACCBBC","#467847","#E8E4C1","#A60303","730202","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#0D2557","#93A8C9","#FFFFFF","#F5DED5","558D96","#F53C4A","#565157","#10CFC8","#F2EEE7","F5D662","#FFD97B","#E65029","#A60027","#660033","191C26","#595408","#A6800D","#A66D03","#A63F03","730C02","#2E031F","#590424","#8C072B","#BF0A2B","DEEFC5","#E0C882","#A6874E","#BFA169","#D9B779","F2D399","#D88681","#A67673","#746566","#535A5D","324F54","#FC297D","#FB607A","#FDA286","#FDC188","FEE78A","#FFECA1","#B3B27F","#4C5E52","#2F3436","FFBE2C","#D93312","#B3AB82","#45735F","#394D47","2C3233","#324143","#6595A3","#C8E3E8","#FCFFED","B6C28B","#477984","#FEF5EB","#C03C44","#EEAA4D","313E4A","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#630B11","#33322F","#2A2927","#1E1D1C","000000","#D94214","#FFF2C1","#80A894","#52736B","093844","#051E21","#00302D","#856434","#F28C28","FFAD4E","#D7DADD","#DDDEE3","#E1E1E9","#EDEFF4","F2F3F8","#BF495E","#41A693","#F2EC9B","#D9CF48","D9583B","#067072","#14A589","#DECFA6","#BAAE8C","F94B06","#423A38","#47B8C8","#E7EEE2","#BDB9B1","D7503E","#730324","#DFE3E6","#B4C4D4","#8BA2BD","456382","#537374","#F9BD7F","#EBD7A5","#ADC9A5","5C9E99","#88B59E","#B6DEC8","#39464D","#C04229","ABD1AB","#11A7FC","#95D127","#F2E415","#FF8638","EE3551","#212640","#5D718C","#4B95A6","#60BFBF","EFF2D8","#D8A64D","#9B5422","#351411","#5B0D0D","991C11","#53324F","#668D6E","#F2E0A0","#F19B7A","F0756E","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#7BBADE","#93DE7F","#FFED5D","#F29E4A","FF7050","#133800","#1B4F1B","#398133","#5C9548","93E036","#D9D7AD","#91A685","#FF6A00","#37485C","1C232E","#008767","#FFB27A","#FF6145","#AB2141","5E1638","#727B7F","#CCEAEA","#7A7556","#2E2125","44CACC","#FFFFED","#FF2C38","#FF9A3A","#FFF040","67D9FF","#007148","#60A859","#9BDA6A","#C7F774","F9FFEF","#092740","#45698B","#90B0CC","#F1FAFF","8FD36F","#E2FFA0","#7D8076","#FAFFED","#C2CCBE","8F7D70","#00736A","#00BC9F","#F1EEC7","#FEA301","F2561A","#26282E","#AD5138","#F7F7F7","#DDDAE0","8594AE","#1A191F","#35352F","#484042","#4E5252","E64D38","#49454A","#E69B02","#FAF4C6","#B1D631","324052","#5F1A2B","#1D2834","#6F8B78","#E4D49E","C96466","#012D3D","#38AD9E","#FFEB9E","#FF6867","D0DBED","#0D1F36","#104954","#1E9C89","#38CC85","60EB7B","#8C4E03","#9FA66A","#F2EC94","#F23005","8B0F03","#000001","#20201F","#E2E2E4","#590402","B80000","#344059","#465973","#F2D272","#A69460","595139","#33454C","#608F85","#B6E5CB","#8BAF95","54584E","#FBFEF6","#B7BFA4","#687F70","#1A3841","BF3847","#D7E836","#86FFC7","#FFB048","#E8366C","593BFF","#34A9FF","#5982DB","#665EB8","#684682","632E62","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#BFB978","#84945C","#516967","#4D3130","281B24","#103B73","#20638C","#3786A6","#4EABBF","EBEFF2","#9FB1BF","#1D2D63","#1C5357","#1F6E56","196331","#FFEBBA","#C3BD91","#88947B","#4C3F3F","2A2727","#347373","#4EA6A6","#91D9D9","#FFFFFD","F2E205","#828948","#EFDFC2","#006971","#DC533E","840000","#000137","#29003F","#79003D","#D04D14","F89801","#370005","#4B0005","#5F0005","#730005","870005","#C3AE8D","#F25260","#2D5F73","#6BADC9","8FCED6","#9E1B36","#F7EDBA","#E69B3D","#EB3355","3D241D","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#035C75","#1B808C","#31A6A8","#F3F1BC","F3AD14","#FF7500","#665130","#EBB643","#CEDAA8","668E84","#384D3A","#3E6653","#728053","#A68357","D97C71","#012326","#17455C","#E1CAAB","#FE8333","FA4913","#1A2944","#2DA7C7","#56ACBA","#98C4C9","CBD5D2","#BF3542","#CDC5BA","#EBE3D6","#3C3C3C","2E2E2E","#231921","#695F74","#BEB4CB","#EBEBF0","D2DCEB","#34373F","#686C75","#F3E9D0","#BEB7A7","8E867C","#661510","#D9351A","#F2C76F","#BF9727","204D3F","#3CFFEE","#24AABC","#356781","#2C3D51","1C1F24","#DA3537","#FFFCC4","#00585F","#6A6A61","2A2C2B","#AE3135","#D1AF87","#8C826B","#3D3C33","F2F0CE","#FF0894","#FF5E9F","#FF91A7","#FFB5CA","F5F0BA","#99878D","#323232","#646464","#7E4A5C","372129","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#402B3C","#6AA6A6","#D9CCA7","#F2B263","F26835","#6AA690","#F2BC1B","#F2DC99","#F29057","BF1F1F","#F4FAC7","#7BAD8D","#FFB158","#F77F45","C2454E","#E5533C","#F5E346","#93D06D","#50AC6A","227864","#39588A","#A9BDD7","#FFFFFF","#FFEADD","FFD0BB","#B0B595","#615F4F","#828567","#91A380","EAFFCD","#00427F","#0066BD","#66B5CC","#F0E4C5","D6C28F","#FF6313","#F9E4B3","#C29689","#74474B","45232E","#00585F","#009393","#FFFCC4","#C7C49B","EB0A00","#091840","#44A2FF","#F7F7EA","#B3CC63","4C6620","#5CBBE3","#FCF1BC","#5C8182","#383A47","B4F257","#9E9E9E","#E5E1D1","#E0393D","#253746","425563","#4D9453","#FFFFB1","#ADDE4E","#FF9D27","A62A16","#B70046","#FF850B","#FFEBC5","#109679","675A4C","#363636","#0599B0","#A4BD0A","#FFA615","FF2E00","#7D8077","#BBBFB2","#FAFFED","#E82A33","E3DEBC","#FD9F44","#FC5C65","#007269","#03A679","FAF0B9","#134B57","#81A489","#F1D8B5","#F2A054","C04D31","#946E49","#394042","#EDDBAC","#872A0C","BA8E3A","#404040","#024959","#037E8C","#FFFFFF","F24C27","#2A3342","#163C6E","#4E5F61","#E6A015","EDE7BE","#445060","#829AB5","#849E91","#C14543","D6D5D1","#8A9126","#B7BF5E","#FFE9C4","#F5B776","F58E45","#9B2D1E","#3C3A28","#78A080","#9BCD9E","FFFFAE","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#990000","#FF6600","#FF9900","#996633","CC9966","#DCE6DA","#B8CCBB","#98B3A5","#7A9994","62858C","#0B1C29","#3B7C8F","#73A5A3","#98C1B7","F0EBD2","#F6CB51","#E25942","#13A89E","#3F4953","F2E7DA","#282F36","#FFFEFC","#BDA21D","#BFBC5B","D2E098","#8C182D","#DE7140","#FCB95A","#FAE285","6A7349","#6B9100","#FFE433","#FF841F","#E03D19","A6001C","#FFEAA7","#D9D697","#9FC49F","#718C6A","543122","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#0C2233","#065471","#0A91AB","#FFC045","F2F2F2","#BEE8E0","#373C40","#2E2621","#73320B","FF5E00","#1B2C35","#A3BFC6","#FF005D","#222A30","293A42","#FF8400","#3B4044","#494948","#E6E1D8","F7F2E9","#6A482D","#518C86","#F6BF3D","#EF7C27","BF2424","#261C2B","#292B39","#226468","#608D80","829D8F","#B2AD9A","#110E00","#363226","#A9A695","ECE9D8","#1B1B26","#26394D","#286480","#13B3BF","A3FF57","#F2C2A7","#F5E5C5","#593D28","#422C21","93DEDB","#001028","#033140","#1E5A5B","#7BA78C","EBEDC6","#544E6E","#808CB0","#ABD1D9","#D9FFF7","DDF556","#323A45","#596677","#758194","#FFFFFF","E74C3C","#45291A","#AB926D","#DBD1BC","#4999C3","5FCBEC","#6B151D","#2E1615","#A8553A","#DB8F5A","F2C18E","#000623","#28475C","#4A6C74","#8BA693","F0E3B1","#60807B","#81B37A","#BCCC5F","#FFEE65","E64964","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#1E1B17","#577270","#9C9A79","#C7BDA1","580E0C","#452F27","#5E504A","#6B6865","#9BBAB2","B0FFED","#1B5257","#F7F6C3","#F28159","#CC5850","4F1C2E","#FAA51B","#BF511F","#2C445E","#2F6D82","5EE4EB","#BF3952","#59364A","#556D73","#D9D1A9","D95F5F","#024959","#037E8C","#F2EFDC","#E74C30","363636","#221A26","#544759","#A197A6","#F27405","D93D04","#C4A44A","#E6D399","#9AB8A9","#7C8A7F","4E4B44","#FFFEC8","#B1BF99","#5B604D","#39382B","26181E","#4E3C51","#21A68D","#3BBF9A","#F2E8B6","F25749","#102144","#1B325E","#254580","#3C63B0","5D8AEA","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF4B00","#FFF1BF","#F20058","#FFAEAC","#000001","7D7A96","#FDFFC6","#F2F096","#FF0080","#DE0049","521218","#5B0E00","#FBB500","#FBD864","#807D1A","59233C","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#3C3658","#3EC8B7","#7CD0B4","#B9D8B1","F7E0AE","#FFFFFF","#99B75F","#D5DD98","#EBF4DB","D8D8D8","#248A8A","#C9FA58","#F9E555","#FAAC38","F2572A","#086B63","#77A490","#E2D8C1","#BFAE95","7C7159","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#17162F","#89346D","#C76058","#FFB248","E8C475","#6E8F4A","#65D9C5","#F2E7B6","#EDA430","AB3E2C","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#8E1B13","#F9E4B3","#849689","#46464A","29232E","#686B30","#AB9A52","#E8BA67","#D68F4F","BA512E","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#65BA99","#59A386","#F1DDBB","#D6C4A6","E74C3C","#A6FFBC","#4ACFAF","#00A995","#006161","003D4C","#33271E","#8B7653","#C8D9A0","#FDEE9D","233331","#048789","#503D2E","#D44D27","#E2A72E","EFEBC8","#E5FF1E","#A9D943","#75A660","#698070","494D4B","#2DEBA2","#91F57F","#EBAA69","#E70049","2B0027","#990000","#336699","#DDDDDD","#999999","333333","#F13A4B","#3D3C3E","#22BDAF","#F4F4F4","D7D7D7","#F53A59","#001D2D","#15A88C","#B7D9C8","F3F5F4"]}};Ops.Gl.ImageCompose.FastBlur=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={blur_frag:"\nUNI sampler2D tex;\n#ifdef USE_MASK\n    UNI sampler2D texMask;\n#endif\nUNI float amount;\nUNI float pass;\n\nIN vec2 texCoord;\n\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nIN vec2 coord0;\nIN vec2 coord1;\nIN vec2 coord2;\nIN vec2 coord3;\nIN vec2 coord4;\nIN vec2 coord5;\nIN vec2 coord6;\n\n#ifdef HAS_MASK\n    UNI sampler2D imageMask;\n#endif\n\nvoid main()\n{\n    vec4 color = vec4(0.0);\n\n    #ifdef USE_MASK\n        #ifdef MASK_INVERT\n            if(texture(texMask,texCoord).r<0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n\n        #ifndef MASK_INVERT\n            if(texture(texMask,texCoord).r>0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n    #endif\n\n    color += texture(tex, coord0) * 0.06927096443792478;\n    color += texture(tex, coord1) * 0.1383328848652136;\n    color += texture(tex, coord2) * 0.21920904690397863;\n    color += texture(tex, coord3) * 0.14637421;\n    color += texture(tex, coord4) * 0.21920904690397863;\n    color += texture(tex, coord5) * 0.1383328848652136;\n    color += texture(tex, coord6) * 0.06927096443795711;\n\n    color.a=1.0;\n    outColor= color;\n}",blur_vert:"\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\nUNI mat4 modelMatrix;\n\nUNI float pass;\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nOUT vec2 coord0;\nOUT vec2 coord1;\nOUT vec2 coord2;\nOUT vec2 coord3;\nOUT vec2 coord4;\nOUT vec2 coord5;\nOUT vec2 coord6;\n\n// http://dev.theomader.com/gaussian-kernel-calculator/\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    {{MODULE_VERTEX_POSITION}}\n\n    vec2 dir=vec2(dirX,dirY);\n    vec2 res=vec2( (1.) / width , (1.) / height )*dir;\n\n    coord3= attrTexCoord;\n\n    coord0= attrTexCoord + (-3.0368997744118595 * res);\n    coord1= attrTexCoord + (-2.089778445362373 * res);\n    coord2= attrTexCoord + (-1.2004366090034069 * res);\n    coord4= attrTexCoord + (1.2004366090034069 * res);\n    coord5= attrTexCoord + (2.089778445362373* res);\n    coord6= attrTexCoord + (3.0368997744118595 * res);\n\n    #ifdef CLAMP\n        coord0=clamp(coord0,0.0,1.0);\n        coord1=clamp(coord1,0.0,1.0);\n        coord2=clamp(coord2,0.0,1.0);\n        coord3=clamp(coord3,0.0,1.0);\n        coord4=clamp(coord4,0.0,1.0);\n        coord5=clamp(coord5,0.0,1.0);\n        coord6=clamp(coord6,0.0,1.0);\n    #endif\n\n    gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),n=e.outTrigger("trigger"),r=e.inFloat("amount",3),a=e.inBool("Clamp",false),s=e.inBool("Mask Invert",false),o=e.inTexture("Mask");const l=e.patch.cgl;const u=new CGL.Shader(l,"fastblur");u.setSource(t.blur_vert,t.blur_frag);const h=new CGL.Uniform(u,"t","tex",0),c=new CGL.Uniform(u,"f","dirX",0),f=new CGL.Uniform(u,"f","dirY",0),d=new CGL.Uniform(u,"f","width",0),g=new CGL.Uniform(u,"f","height",0),p=new CGL.Uniform(u,"f","pass",0),m=new CGL.Uniform(u,"f","amount",r.get()),_=new CGL.Uniform(u,"t","texMask",1);r.onChange=()=>{m.setValue(r.get())};const b=e.inDropDown("direction",["both","vertical","horizontal"]);let v=0;b.set("both");b.onChange=()=>{if(b.get()=="both")v=0;if(b.get()=="horizontal")v=1;if(b.get()=="vertical")v=2};a.onChange=()=>{u.toggleDefine("CLAMP",a.get())};s.onChange=o.onChange=()=>{u.toggleDefine("USE_MASK",o.isLinked());u.toggleDefine("MASK_INVERT",s.get())};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;d.setValue(l.currentTextureEffect.getCurrentSourceTexture().width);g.setValue(l.currentTextureEffect.getCurrentSourceTexture().height);const t=r.get();if(o.get())l.setTexture(1,o.get().tex);for(let e=0;e<t;e++){l.pushShader(u);p.setValue(e/t);if(v===0||v==2){l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);c.setValue(0);f.setValue(1+e*e);l.currentTextureEffect.finish()}if(v===0||v==1){l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);c.setValue(1+e*e);f.setValue(0);l.currentTextureEffect.finish()}l.popShader()}n.trigger()}}};Ops.Gl.ImageCompose.Sharpen=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={sharpen_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float pX,pY;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nfloat desaturate(vec4 color)\n{\n  vec3 c= vec3(dot(vec3(0.2126,0.7152,0.0722), color.rgb));\n  return (c.r+c.g+c.b)/3.0;\n}\n\nvoid main()\n{\n\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    col=texture(tex,texCoord);\n\n    float colorL = desaturate(texture(tex, texCoord+vec2(-pX,0) ));\n    float colorR = desaturate(texture(tex, texCoord+vec2( pX,0) ));\n    float colorA = desaturate(texture(tex, texCoord+vec2( 0,-pY) ));\n    float colorB = desaturate(texture(tex, texCoord+vec2( 0, pY) ));\n\n    float colorLA = desaturate(texture(tex, texCoord+vec2(-pX,pY)));\n    float colorRA = desaturate(texture(tex, texCoord+vec2( pX,pY)));\n    float colorLB = desaturate(texture(tex, texCoord+vec2(-pX,-pY)));\n    float colorRB = desaturate(texture(tex, texCoord+vec2( pX,-pY)));\n\n    vec4 final = col + col * amount * (8.0*desaturate(col) - colorL - colorR - colorA - colorB - colorLA - colorRA - colorLB - colorRB);\n\n    outColor= final;\n}"};const i=e.inTrigger("Render");const n=e.outTrigger("Trigger");const r=e.inValueSlider("amount",.5);const a=e.patch.cgl;const s=new CGL.Shader(a,e.name,e);s.setSource(s.getDefaultVertexShader(),t.sharpen_frag);const o=new CGL.Uniform(s,"t","tex",0);const l=new CGL.Uniform(s,"f","amount",r);const u=new CGL.Uniform(s,"f","pX",1/1024);const h=new CGL.Uniform(s,"f","pY",1/1024);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;u.setValue(1/a.currentTextureEffect.getCurrentSourceTexture().width);h.setValue(1/a.currentTextureEffect.getCurrentSourceTexture().height);a.pushShader(s);a.currentTextureEffect.bind();a.setTexture(0,a.currentTextureEffect.getCurrentSourceTexture().tex);a.currentTextureEffect.finish();a.popShader();n.trigger()}}};Ops.Gl.ImageCompose.Pixelate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixelate_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D multiplierTex;\nUNI float amount;\nUNI float amountX;\nUNI float amountY;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    float x=1.0/amountX;\n    float y=1.0/amountY;\n\n    #ifdef PIXELATE_TEXTURE\n    x += texture(multiplierTex,texCoord).r*0.1;//*0.1\n    y += texture(multiplierTex,texCoord).r*0.1;//*0.1\n    #endif\n\n    vec2 coord = vec2(x*floor(texCoord.x/x), y*floor(texCoord.y/y));\n\n    col=texture(tex,coord);\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,amount);\n}"};const i=e.inTrigger("render"),n=e.inTexture("Multiplier"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),a=e.inValueSlider("Amount",1),s=e.inValue("width",320),o=e.inValue("height",180),l=e.outTrigger("trigger");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);h.setSource(h.getDefaultVertexShader(),t.pixelate_frag);const c=new CGL.Uniform(h,"t","tex",0);const f=new CGL.Uniform(h,"t","multiplierTex",1);const d=new CGL.Uniform(h,"f","amount",a);const g=new CGL.Uniform(h,"f","amountX",s);const p=new CGL.Uniform(h,"f","amountY",o);n.onChange=function(){h.toggleDefine("PIXELATE_TEXTURE",n.isLinked())};CGL.TextureEffect.setupBlending(e,h,r,a);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);if(n.get())u.setTexture(1,n.get().tex);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};Ops.Vars.VarSetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",i,e.varName)}};Ops.Vars.VarGetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outNumber("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,i)}};Ops.Gl.ImageCompose.ScrollTexture=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={scroll_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amountX;\nUNI float amountY;\n\n#ifdef HAS_MASK\n    UNI sampler2D texMask;\n#endif\n\nvoid main()\n{\n    float amX=amountX;\n    float amY=amountY;\n\n    #ifdef HAS_MASK\n        vec4 m=texture(texMask,texCoord);\n\n\n        amX*=(m.r-0.5)*2.0;\n        amY*=(m.g-0.5)*2.0;\n    #endif\n\n    vec4 col=vec4(0.0,0.0,0.0,1.0);\n    float x=mod(texCoord.x+amX,1.0);\n    float y=mod(texCoord.y+amY,1.0);\n\n\n    #ifdef NO_REPEAT\n        x=texCoord.x+amX*0.1;\n        y=texCoord.y+amY*0.1;\n    #endif\n\n    col=texture(tex,vec2(x,y));\n\n    #ifdef NO_REPEAT\n        if(x>1.0 || x<0.0 || y>1.0 || y<0.0) col=vec4(0.0,0.0,0.0,0.0);\n    #endif\n    outColor= col;\n}"};const i=e.inTrigger("render"),n=e.outTrigger("trigger"),r=e.inValue("amountX"),a=e.inValue("amountY"),s=e.inTexture("Mask"),o=e.inValueBool("Repeat",true);o.onChange=g;const l=e.patch.cgl;const u=new CGL.Shader(l,e.name,e);u.setSource(u.getDefaultVertexShader(),t.scroll_frag);const h=new CGL.Uniform(u,"t","tex",0),c=new CGL.Uniform(u,"f","amountX",r),f=new CGL.Uniform(u,"f","amountY",a),d=new CGL.Uniform(u,"t","texMask",1);g();s.onChange=function(){if(s.get())u.define("MASK");else u.removeDefine("MASK")};function g(){if(!o.get())u.define("NO_REPEAT");else u.removeDefine("NO_REPEAT")}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;l.pushShader(u);l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);if(s.get())l.setTexture(1,s.get().tex);l.currentTextureEffect.finish();l.popShader();n.trigger()}}};Ops.Anim.Timer_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const a=e.inValue("Speed",1),i=e.inValueBool("Play",true),n=e.inTriggerButton("Reset"),r=e.inValueBool("Sync to timeline",false),s=e.outNumber("Time");e.setPortGroup("Controls",[i,n,a]);const o=new CABLES.Timer;let l=null;let u=0;let h=false;i.onChange=c;c();function c(){if(i.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}n.onTriggered=f;function f(){u=0;l=null;o.setTime(0);s.set(0)}r.onChange=function(){h=r.get();i.setUiAttribs({greyout:h});n.setUiAttribs({greyout:h})};e.onAnimFrame=function(e,t,i){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){s.set(CABLES.overwriteTime*a.get())}else if(h){s.set(e*a.get())}else{o.update();const n=o.get();if(l===null){l=n;return}const r=Math.abs(n-l);l=n;u+=r*a.get();if(u!=u)u=0;s.set(u)}}}}};Ops.Devices.Mouse.Mouse_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const R=e.attachments={};const t=e.inValueBool("Active",true),i=e.inValueBool("relative"),r=e.inValueBool("normalize"),n=e.inValueBool("flip y",true),a=e.inValueSelect("Area",["Canvas","Document","Parent Element"],"Canvas"),s=e.inBool("right click prevent default",true),o=e.inValueBool("Touch support",true),l=e.inValueBool("smooth"),u=e.inValueFloat("smoothSpeed",20),h=e.inValueFloat("multiply",1),c=e.outNumber("x",0),f=e.outNumber("y",0),d=e.outBoolNum("button down"),P=e.outTrigger("click"),k=e.outTrigger("Button Up"),U=e.outTrigger("click right"),g=e.outBoolNum("mouseOver"),p=e.outNumber("button");e.setPortGroup("Behavior",[i,r,n,a,s,o]);e.setPortGroup("Smoothing",[l,u,h]);let m=0;const _=e.patch.cgl;let b=null;function v(i,n){if(r.get()){let e=_.canvas.width/_.pixelDensity;let t=_.canvas.height/_.pixelDensity;if(b==document.body){e=b.clientWidth/_.pixelDensity;t=b.clientHeight/_.pixelDensity}c.set(((i||0)/e*2-1)*h.get());f.set(((n||0)/t*2-1)*h.get())}else{c.set((i||0)*h.get());f.set((n||0)*h.get())}}l.onChange=function(){if(l.get())m=setInterval(j,5);else if(m)clearTimeout(m)};let V,G;let E=0,F=0;r.onChange=function(){A=0;C=0;v(A,C)};let A=_.canvas.width/2;let C=_.canvas.height/2;E=A;F=C;c.set(A);f.set(C);let x=0;let T=0;let B=0;let I=0;L();a.onChange=L;let D=0;function j(){D=u.get();if(D<=0)D=.01;const e=Math.abs(A-E);const t=Math.round(e/D,0);E=E<A?E+t:E-t;const i=Math.abs(C-F);const n=Math.round(i/D,0);F=F<C?F+n:F-n;v(E,F)}function S(e){d.set(false);g.set(true);D=u.get()}function O(e){p.set(e.which);d.set(true)}function y(e){p.set(0);d.set(false);k.trigger()}function w(e){U.trigger();if(s.get())e.preventDefault()}function N(e){P.trigger()}function z(e){x=0;T=0;D=100;g.set(false);d.set(false)}i.onChange=function(){B=0;I=0};function H(e){if(!i.get()){if(a.get()!="Document"){B=e.offsetX;I=e.offsetY}else{B=e.clientX;I=e.clientY}if(l.get()){A=B;if(n.get())C=b.clientHeight-I;else C=I}else{if(n.get())v(B,b.clientHeight-I);else v(B,I)}}else{if(x!=0&&T!=0){B=e.offsetX-x;I=e.offsetY-T}else{}x=e.offsetX;T=e.offsetY;A+=B;C+=I;if(C>460)C=460}}function W(e){g.set(true);H(e)}function Y(e){if(event.touches&&event.touches.length>0)H(e.touches[0])}function X(e){d.set(true);if(e.touches&&e.touches.length>0)O(e.touches[0])}function Z(e){d.set(false);y()}o.onChange=function(){M();L()};function M(){if(!b)return;b.removeEventListener("touchend",Z);b.removeEventListener("touchstart",X);b.removeEventListener("touchmove",Y);b.removeEventListener("click",N);b.removeEventListener("mousemove",W);b.removeEventListener("mouseleave",z);b.removeEventListener("mousedown",O);b.removeEventListener("mouseup",y);b.removeEventListener("mouseenter",S);b.removeEventListener("contextmenu",w);b=null}function L(){if(b||!t.get())M();if(!t.get())return;b=_.canvas;if(a.get()=="Document")b=document.body;if(a.get()=="Parent Element")b=_.canvas.parentElement;if(o.get()){b.addEventListener("touchend",Z);b.addEventListener("touchstart",X);b.addEventListener("touchmove",Y)}b.addEventListener("mousemove",W);b.addEventListener("mouseleave",z);b.addEventListener("mousedown",O);b.addEventListener("mouseup",y);b.addEventListener("mouseenter",S);b.addEventListener("contextmenu",w);b.addEventListener("click",N)}t.onChange=function(){if(b)M();if(t.get())L()};e.onDelete=function(){M()};L()}};Ops.Math.TriggerRandomNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Generate"),n=e.inValue("min",0),r=e.inValue("max",1),a=e.outTrigger("next"),s=e.outNumber("result"),o=e.inValueBool("Integer",false),l=e.inValueBool("No consecutive duplicates",false);e.setPortGroup("Value Range",[n,r]);i.onTriggered=r.onChange=n.onChange=o.onChange=u;u();function u(){let e=Math.random()*(r.get()-n.get())+n.get();if(o.get())e=h();if(n.get()!=r.get()&&r.get()>n.get())while(l.get()&&e==s.get())e=h();s.set(e);a.trigger()}function h(){return Math.floor(Math.random()*(r.get()-n.get()+1)+n.get())}}};Ops.Gl.RenderAnim_v2=class extends CABLES.Op{constructor(){super(...arguments);const o=this;const L=o.attachments={};const e=o.inTrigger("Render"),l=o.outTrigger("Next"),u=o.inDropDown("File Type",["PNG","JPG","WebP","WebM"],"PNG"),t=o.inBool("ZIP multiple files",false),h=o.inBool("Download Files",true),i=o.inString("Filename","cables"),c=o.inFloatSlider("Quality",.8),n=o.inSwitch("Duration Type",["Seconds","Frames"],"Seconds"),r=o.inInt("Duration",1),a=o.inInt("FPS",30),f=o.inValueBool("Transparency",false),d=o.inValueBool("Use Canvas Size",true),s=o.inValueInt("texture width",512),g=o.inValueInt("texture height",512),R=o.inTriggerButton("Start"),P=o.outNumber("Progress",0),k=o.outNumber("Frame",0),p=o.outString("Status","Waiting"),U=o.outBool("Started"),m=o.outString("Data URL"),_=o.outTrigger("Finished");o.setPortGroup("File",[u,t,h,i,c]);o.setPortGroup("Size",[d,s,g]);o.setPortGroup("Timing",[a,n,r]);m.ignoreValueSerialize=true;e.onTriggered=z;let b=false;let v=0;const V=true;let E=30;let F=31;const G=false;let A=CABLES.shortId();let j=false;const C=[];let x=-1;let T=0;let B="";let I=null;let D=o.patch.cgl.canvasWidth;let S=o.patch.cgl.canvasHeight;u.onChange=O;d.onChange=y;O();y();t.onChange=()=>{I=null};function O(){c.setUiAttribs({greyout:u.get()=="PNG"})}function y(){s.setUiAttribs({greyout:d.get()});g.setUiAttribs({greyout:d.get()})}R.onTriggered=function(){B=i.get();o.log("pref",B);C.length=0;p.set("Starting");E=a.get();F=r.get()*E;if(n.get()=="Frames")F=r.get();A=CABLES.shortId();w();if(t.get())I=new JSZip;if(!d.get()){D=CABLES.patch.cgl.canvasWidth;S=CABLES.patch.cgl.canvasHeight;o.patch.cgl.setSize(s.get()/CABLES.patch.cgl.pixelDensity,g.get()/CABLES.patch.cgl.pixelDensity);o.patch.cgl.updateSize()}if(F==0){v=0;b=true}else{v=-20;b=true;x=-9999}};function w(){if(F>=0){T=Math.max(0,v*(1/E));o.patch.timer.setTime(T);CABLES.overwriteTime=T;o.patch.freeTimer.setTime(T)}}function N(){b=false;CABLES.overwriteTime=undefined;p.set("Finished")}function z(){U.set(b);if(!b){l.trigger();return}const e=CABLES.internalNow;if(b){CABLES.internalNow=function(){return T*1e3};w()}if(x==v){l.trigger();return}x=v;let t=v/F;if(t<0)t=0;P.set(t);k.set(v);l.trigger();CABLES.internalNow=e;j=false;if(v>F){o.log("FINISHED...");o.log("ffmpeg -y -framerate 30 -f image2 -i "+B+"_%d.png  -b 9999k -vcodec mpeg4 "+A+".mp4");if(!d.get()){o.patch.cgl.setSize(D,S);o.patch.cgl.updateSize()}if(I){I.generateAsync({type:"blob"}).then(function(e){const t=document.createElement("a");t.download=B+".zip";t.href=URL.createObjectURL(e);if(h.get()){t.click()}N();if(m.isLinked()){M(e,e=>{m.set(e);_.trigger()})}else{m.set(null);_.trigger()}})}else if(u.get()=="WebM"){try{p.set("Creating Video File from frames");o.log("webm frames",C.length);const r=Whammy.fromImageArray(C,E);const a=window.URL.createObjectURL(r);const s=document.createElement("a");s.setAttribute("download",B+".webm");s.setAttribute("href",a);document.body.appendChild(s);if(h.get()){s.click()}N();if(m.isLinked()){M(r,e=>{m.set(e);_.trigger()})}else{m.set(null);_.trigger()}}catch(e){o.logError(e)}C.length=0}else N();return}let i="image/png";let n="png";if(u.get()=="JPG"){i="image/jpeg";n="jpg"}else if(u.get()=="WebP"){i="image/webp";n="webp"}if(v>0){p.set("Rendering Frame "+v+" of "+F);o.log("Rendering Frame "+v+" of "+F,T);if(u.get()=="WebM"){C.push(o.patch.cgl.canvas.toDataURL("image/webp",c.get()*.999));v++;w()}else{o.log("screenshotting frame...",v);o.patch.cgl.screenShot(i=>{if(i){if(I){let e=B+"_"+v+"."+n;I.file(e,i,{base64:false});v++;w()}else{let e=B+"_"+A+"_"+v+"."+n;const t=document.createElement("a");t.download=e;t.href=URL.createObjectURL(i);setTimeout(()=>{if(m.isLinked()){M(i,e=>{m.set(e)})}else{m.set(null)}if(h.get()){t.click()}v++;w()},200)}}else{o.log("screenshot: no blob")}},!f.get(),i,c.get())}}else{p.set("Prerendering...");o.log("pre ",v,T);o.patch.cgl.screenShot(e=>{v++;w()})}}function M(e,t){let i=new FileReader;i.onload=function(e){t(e.target.result)};i.readAsDataURL(e)}}};Ops.Gl.ImageCompose.Interlace=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={interlace_frag:"\n#ifdef HAS_TEXTURES\n  IN vec2 texCoord;\n  UNI sampler2D tex;\n#endif\nUNI float amount;\nUNI float lum;\nUNI float add;\nUNI float lineSize;\nUNI float scroll;\nUNI float displace;\n\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n   col=texture(tex,texCoord);\n    // .endl()+'   col=clamp(col,0.0,1.0);'\n\n    float dir;\n    #ifdef DIRECTION\n        dir = gl_FragCoord.x;\n    #endif\n\n    #ifndef DIRECTION\n        dir = gl_FragCoord.y;\n    #endif\n\n   if( mod(dir+scroll,lineSize)>=lineSize*0.5)\n   {\n       col=texture(tex,vec2(texCoord.x+displace*0.05,texCoord.y));\n       float gray = vec3(dot(vec3(0.2126,0.7152,0.0722), col.rgb)).r;\n       col.rgb=col.rgb*(1.0-amount) + (col.rgb*gray*gray*lum)*amount;\n   }\n   else col+=add;\n\n\n   outColor= col;\n}"};let i=e.inTrigger("render");let n=e.inValueSlider("amount",.5);let r=e.inValueSlider("Lumi Scale",.9);let a=e.inBool("X or Y",false);let s=e.inValue("Line Size",4);let o=e.inValueSlider("Displacement",0);let l=e.inValue("Add",.02);let u=e.inValue("scroll",0);let h=e.outTrigger("trigger");let c=e.patch.cgl;let f=new CGL.Shader(c,e.name,e);f.setSource(f.getDefaultVertexShader(),t.interlace_frag);let d=new CGL.Uniform(f,"t","tex",0);let g=new CGL.Uniform(f,"f","amount",n);let p=new CGL.Uniform(f,"f","lum",r);let m=new CGL.Uniform(f,"f","lineSize",s);let _=new CGL.Uniform(f,"f","add",l);let b=new CGL.Uniform(f,"f","displace",o);let v=new CGL.Uniform(f,"f","scroll",u);a.onChange=function(){f.toggleDefine("DIRECTION",a.get())};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;c.pushShader(f);c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.currentTextureEffect.finish();c.popShader();h.trigger()}}};Ops.Trigger.RouteTrigger=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=24;const n=t.inTriggerButton("Execute"),r=t.inValueInt("Switch Value"),a=t.outTrigger("Next Trigger"),s=t.outNumber("Switched Value");const o=[];n.onTriggered=h;r.setUiAttribs({tlEase:1});for(let e=0;e<i;e++){o[e]=t.outTrigger("Trigger "+e);o[e].onLinkChanged=c}const l=t.outTrigger("Default Trigger"),u=t.outNumber("Highest Index");function h(){const e=Math.round(r.get());if(e>=0&&e<i){s.set(e);o[e].trigger()}else{s.set(-1);l.trigger()}a.trigger()}function c(){let t=0;for(let e=0;e<o.length;e++)if(o[e]&&o[e].isLinked())t=e;u.set(t)}}};Ops.Vars.VarSetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",i,e.varName)}};Ops.Array.RandomNumbersArray_v4=class extends CABLES.Op{constructor(){super(...arguments);const h=this;const e=h.attachments={};const c=h.inValueInt("Num Values",100),f=h.inSwitch("Mode",["A","AB","ABC","ABCD"],"A"),d=h.inValueFloat("Random Seed ",0),g=h.inBool("Integer",false),p=h.inValueBool("Last == First"),m=h.outArray("Array Out"),_=h.outNumber("Chunks Amount"),b=h.outNumber("Array length");const t=["A","B","C","D"];const v=[];const E=t.map(function(e){return{min:h.inValueFloat("Min "+e,-1),max:h.inValueFloat("Max "+e,1)}});for(let e=0;e<E.length;e+=1){const i=E[e];const r=Object.keys(i);h.setPortGroup("Value Range "+t[e],r.map(function(e){return i[e]}));if(e>0)r.forEach(function(e){i[e].setUiAttribs({greyout:true})})}f.onChange=function(){const e=f.get();const t=f.uiAttribs.values;m.setUiAttribs({stride:f.get().length});const r=t.indexOf(e);E.forEach(function(i,n){const e=Object.keys(i);e.forEach(function(e,t){if(n<=r)i[e].setUiAttribs({greyout:false});else i[e].setUiAttribs({greyout:true})})});n()};m.ignoreValueSerialize=true;p.onChange=c.onChange=d.onChange=g.onChange=n;const F=[];n();function n(){const e=f.get();const t=f.uiAttribs.values;const i=t.indexOf(e);const n=Math.floor(Math.abs(c.get()));Math.randomSeed=d.get();h.setUiAttrib({extendTitle:n+"*"+e.length});const r=i+1;const a=n*r;v.length=a;const s=a/r;const o=g.get();for(let t=0;t<r;t+=1){const e=E[t];const l=e.max.get();const u=e.min.get();F[t]=[u,l]}for(let t=0;t<s;t+=1){for(let e=0;e<r;e+=1){const u=F[e][0];const l=F[e][1];const i=t*r+e;if(o)v[i]=Math.floor(Math.seededRandom()*(l+1-u)+u);else v[i]=Math.seededRandom()*(l-u)+u}}if(p.get()&&v.length>r){for(let e=0;e<r;e++)v[v.length-3+e]=v[e]}m.setRef(v);_.set(v.length/r);b.set(v.length)}E.forEach(function(i){Object.keys(i).forEach(function(e){const t=i[e];t.onChange=n})})}};Ops.Vars.VarGetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,i)}};Ops.Array.ArrayGetNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("array"),n=e.inValueInt("index"),r=e.inFloat("Value Invalid Index",0),a=e.outNumber("value"),s=e.outBoolNum("Valid Index",true);i.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);n.onChange=i.onChange=o;function o(){if(i.get()){const e=i.get()[n.get()];if(isNaN(e)){a.set(r.get());s.set(false)}else{s.set(true);a.set(parseFloat(e))}}}}};Ops.Sidebar.Sidebar=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const i=s.attachments={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables *\n{\n    color: #BBBBBB !important;\n    font-family: Arial;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    width: var(--sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    /*outline-style: solid;*/\n    /*outline-color:red;*/\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n    background-position: -4px -9px;\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input:active\n{\n    background-color: #555 !important;\n}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n    display:block;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    /*outline: 0;*/\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n.sidebar__slider input[type=text],\n.sidebar__slider input[type=paddword]\n{\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover,\n.sidebar__slider input[type=password]:active,\n.sidebar__slider input[type=password]:focus,\n.sidebar__slider input[type=password]:hover\n{\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=date],\n.sidebar__text-input input[type=datetime-local],\n.sidebar__text-input input[type=text],\n.sidebar__text-input input[type=search],\n.sidebar__text-input input[type=password] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n\n\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    color-scheme: dark;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n\n\n\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover,\n.sidebar__text-input input[type=search]:active,\n.sidebar__text-input input[type=search]:focus,\n.sidebar__text-input input[type=search]:hover,\n.sidebar__text-input input[type=password]:active,\n.sidebar__text-input input[type=password]:focus,\n.sidebar__text-input input[type=password]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    /*outline: none;*/\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:inactive {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*.sidebar__select-select option*/\n/*{*/\n/*    background-color: #444444;*/\n/*    color: #bbb;*/\n/*}*/\n\n.sidebar__select-select option:checked\n{\n    background-color: #000;\n    color: #FFF;\n}\n\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n\n.sidebar__text-input-input::focus-visible,\n/*.sidebar__text-input-input:active,*/\n.sidebar__button-input:focus-visible,\n.sidebar__text-input:focus-visible\n/*.sidebar__text-input:active*/\n{\n    outline-style: solid;\n    outline-color:white;\n    outline-width: 1px;\n\n}\n\n"};const n="cables-sidebar-style";const r="cables-sidebar-dynamic-style";const o="sidebar-cables";const l="sidebar"+CABLES.uuid();const u="sidebar__items";const h="sidebar__close-button";const a="";const c="";let f=null;let L=null;let d=null;const e=s.inValueBool("Visible",true);const t=s.inValueSlider("Opacity",1);const g=s.inValueBool("Default Minimized");const p=s.inValueSlider("Minimized Opacity",.5);const m=s.inValueBool("Show undo button",false);const _=s.inValueBool("Show Minimize",false);const b=s.inString("Title","");const v=s.inValueBool("Side");const E=s.inValueBool("Default CSS",true);let F=s.patch.cgl.canvas.ownerDocument;const A=s.outObject("childs");A.setUiAttribs({title:"Children"});const C=s.outBool("Opfened");C.setUiAttribs({title:"Opened"});let x=F.querySelector("."+l);if(!x)x=P();const T=x.querySelector("."+u);A.set({parentElement:T,parentOp:s});O();M();w();E.onChange=()=>{M();w()};e.onChange=R;t.onChange=y;g.onChange=O;p.onChange=B;m.onChange=D;s.onDelete=U;function B(){w()}_.onChange=I;function I(e){if(!e||e.uiAttribs)e=F.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=F.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(_.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}v.onChange=function(){if(!x)return;if(v.get())x.classList.add("sidebar-cables-right");else x.classList.remove("sidebar-cables-right")};function D(){const e=F.querySelector(".sidebar-cables .sidebar__group-header");if(e){S(e)}}function S(e){if(e){const t=F.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!m.get()){t.remove()}}else{if(m.get()){const i=F.createElement("span");i.classList.add("sidebar__group-header-undo");i.classList.add("sidebar-icon-undo");i.addEventListener("click",function(e){e.stopPropagation();const t=F.querySelectorAll(".sidebar-cables .sidebar__reloadable");const i=F.createEvent("MouseEvents");i.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(i)})});e.appendChild(i)}}}I(e)}function O(){if(!f){return}if(g.get()){x.classList.add("sidebar--closed");if(e.get())C.set(false)}else{x.classList.remove("sidebar--closed");if(e.get())C.set(true)}}function y(){const e=t.get();x.style.opacity=e}function R(){if(!x)return;if(e.get()){x.style.display="block";if(!x.classList.contains("sidebar--closed"))C.set(true)}else{x.style.display="none";C.set(false)}}v.onChanged=function(){};function w(){const e=F.querySelectorAll("."+r);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}if(!E.get())return;const t=F.createElement("style");t.classList.add("cablesEle");t.classList.add(r);let i=".sidebar--closed .sidebar__close-button { ";i+="opacity: "+p.get();i+="}";const n=F.createTextNode(i);t.appendChild(n);F.body.appendChild(t)}function P(){const e=F.createElement("div");e.classList.add(o);e.classList.add(l);const t=s.patch.cgl.canvas.parentElement;const i=F.createElement("div");i.classList.add("sidebar__group");e.appendChild(i);const n=F.createElement("div");n.classList.add("sidebar__group-header");e.appendChild(n);const r=F.createElement("span");r.classList.add("sidebar__group-header-title");d=F.createElement("span");d.classList.add("sidebar__group-header-title-text");d.innerHTML=b.get();r.appendChild(d);n.appendChild(r);S(n);I(n);i.appendChild(n);e.appendChild(i);i.addEventListener("click",N);if(!t){s.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const a=F.createElement("div");a.classList.add(u);e.appendChild(a);f=F.createElement("div");f.classList.add(h);f.addEventListener("click",N);e.appendChild(f);return e}b.onChange=function(){if(d)d.innerHTML=b.get()};function k(e){}function N(e){e.stopPropagation();if(!x){s.logError("Sidebar could not be closed...");return}x.classList.toggle("sidebar--closed");const t=e.target;let i=a;if(x.classList.contains("sidebar--closed")){i=c;C.set(false)}else{C.set(true)}}function M(){const e=F.querySelectorAll("."+n);if(e){e.forEach(e=>{e.parentNode.removeChild(e)})}if(!E.get())return;const t=F.createElement("style");t.innerHTML=i.style_css;t.classList.add(n);t.classList.add("cablesEle");F.body.appendChild(t)}function U(){V(x)}function V(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}}};Ops.Trigger.TriggerSend=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTriggerButton("Trigger"),i=n.outTrigger("Next");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.onChange=a;t.onTriggered=s;n.patch.addEventListener("namedTriggersChanged",r);r();n.varName.setUiAttribs({_triggerSelect:true});function r(){if(CABLES.UI){let e=[];const t=n.patch.namedTriggers;e.push("+ create new one");for(const i in t)e.push(i);e=e.sort();n.varName.uiAttribs.values=e}}function a(){if(CABLES.UI){if(n.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"Enter a name for the new trigger",promptValue:"",promptOk:e=>{n.varName.set(e);n.patch.namedTriggers[e]=n.patch.namedTriggers[e]||[];r()}});return}n.refreshParams()}if(!n.patch.namedTriggers[n.varName.get()]){n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];n.patch.emitEvent("namedTriggersChanged")}n.setTitle(">"+n.varName.get());n.refreshParams();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())}function s(){const t=n.patch.namedTriggers[n.varName.get()];n.patch.emitEvent("namedTriggerSent",n.varName.get());if(!t){n.setUiError("unknowntrigger","unknown trigger");return}else n.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}i.trigger()}}};Ops.Trigger.TriggerReceive=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.outTrigger("Triggered");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.setUiAttribs({_triggerSelect:true});a();n.patch.addEventListener("namedTriggersChanged",a);let i=null;function r(){t.trigger()}function a(){if(CABLES.UI){let t=[];let i=n.patch.namedTriggers;for(let e in i)t.push(e);t=t.sort();n.varName.uiAttribs.values=t}}n.varName.onChange=function(){if(i){let e=n.patch.namedTriggers[i];let t=e.indexOf(r);if(t!=-1)e.splice(t,1)}n.setTitle(">"+n.varName.get());n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];let e=n.patch.namedTriggers[n.varName.get()];e.push(r);i=n.varName.get();s();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())};n.on("uiParamPanel",s);function s(){if(!n.varName.get()){n.setUiError("unknowntrigger","unknown trigger")}else n.setUiError("unknowntrigger",null)}}};Ops.Sidebar.DropDown_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("Link");const n=t.inString("Text","Value");const r=t.inArray("Values");const a=t.inString("Default","");const s=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=t.inBool("Multiple Selection",false);const u=t.inInt("Lines",1);const h=t.inTriggerButton("Set Default");h.onTriggered=w;const c=t.outObject("Children");const f=t.outString("Result",a.get());const d=t.outNumber("Index"),g=t.outArray("Selected Values");a.setUiAttribs({title:"Input"});const p=document.createElement("div");p.addEventListener("dblclick",function(){f.set(a.get());const e=b.querySelectorAll("option");e.forEach(function(e,t){if(e.value.trim()===a.get()){e.selected=true;d.set(t)}else{e.removeAttribute("selected")}})});p.dataset.op=t.id;p.classList.add("cablesEle");p.classList.add("sidebar__item");p.classList.add("sidebar__select");p.classList.add("sidebar__reloadable");const m=document.createElement("div");m.classList.add("sidebar__item-label");const _=document.createTextNode(n.get());m.appendChild(_);p.appendChild(m);const b=document.createElement("select");b.classList.add("sidebar__select-select");p.appendChild(b);b.addEventListener("input",x);const v=document.createElement("div");v.classList.add("sidebar__greyout");p.appendChild(v);v.style.display="none";s.onChange=function(){v.style.display=s.get()?"block":"none"};o.onChange=function(){p.style.display=o.get()?"block":"none"};i.onChange=I;n.onChange=B;a.onChange=T;t.onDelete=O;r.onChange=F;let E=[];u.onChange=()=>{b.setAttribute("size",u.get())};l.onChange=()=>{if(l.get())b.setAttribute("multiple",l.get());else b.removeAttribute("multiple")};t.onLoaded=function(){f.set(a.get())};function F(){while(b.lastChild)b.removeChild(b.lastChild);E=r.get();const n=a.get();if(E){E.forEach(function(e){const t=document.createElement("option");t.setAttribute("value",e);if(e===n||e===f.get()){t.setAttribute("selected","")}const i=document.createTextNode(e);t.appendChild(i);b.appendChild(t)})}else{f.set("")}d.set(0);C();if(!n&&E&&E.length)f.set(E[0])}let A=0;function C(e){const t=b.querySelectorAll("option");let i=null;t.forEach(function(e,t){if(e.value.trim()===f.get()){i=e;A=t}e.removeAttribute("selected")});if(e){const n=a.get()+"".trim();t.forEach(function(e,t){if(e.value.trim()===n){i=e;A=t}e.removeAttribute("selected")})}if(i)i.setAttribute("selected","");d.set(A)}function x(e){const i=[];const t=b.querySelectorAll("option");t.forEach(function(e,t){if(e.selected)i.push(e.value)});g.set(i);f.set(e.target.value);d.set(E.indexOf(e.target.value));C()}function T(){const e=a.get();f.set(e);b.value=e;C()}function B(){const e=n.get();m.textContent=e;if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function I(){c.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(p);c.set(e)}else{if(p.parentElement)p.parentElement.removeChild(p)}}function D(e){if(e)e.style.display="block";C()}function S(e){if(e)e.style.display="none"}function O(){y(p)}function y(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}function w(){a.set(b.value);t.refreshParams()}}};Ops.Sidebar.Button_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link");const n=t.inString("Text","Button");const r=t.outObject("childs");const a=t.outTrigger("Pressed Trigger");const s=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const u=document.createElement("button");u.classList.add("sidebar__button-input");l.appendChild(u);u.addEventListener("click",f);u.style.width="100%";const h=document.createTextNode(n.get());u.appendChild(h);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");i.onChange=g;n.onChange=d;t.onDelete=_;const c=document.createElement("div");c.classList.add("sidebar__greyout");l.appendChild(c);c.style.display="none";s.onChange=function(){c.style.display=s.get()?"block":"none"};o.onChange=function(){l.style.display=o.get()?"block":"none"};function f(){a.trigger()}function d(){const e=n.get();u.textContent=e;u.setAttribute("aria-label","button "+n.get());if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function g(){r.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(l);r.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function p(e){if(e){e.style.display="block"}}function m(e){if(e){e.style.display="none"}}function _(){b(l)}function b(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};Ops.Trigger.TriggerExtender=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Execute"),n=e.outTrigger("Next");i.onTriggered=function(){n.trigger()}}};Ops.Sidebar.LocalFileToDataUrl=class extends CABLES.Op{constructor(){super(...arguments);const u=this;const e=u.attachments={};const t=u.inObject("link","element"),i=u.inString("Text","Select File:"),h=u.inString("Button Text","Choose File"),n=u.inString("Accept Files",""),r=u.inBool("Allow Multiple Files",false),a=u.inValueString("Id",""),s=u.inBool("Visible",true),o=u.inBool("Grey Out",false),l=u.inTriggerButton("Show Dialog"),c=u.inTriggerButton("Reset"),f=u.outObject("childs"),d=u.outString("Data URL"),g=u.outString("Filename"),p=u.outObject("File Object"),m=u.outNumber("Num Files"),_=u.outArray("Data URLs"),b=u.outArray("Filenames"),v=u.outTrigger("File Changed");d.ignoreValueSerialize=true;const E=document.createElement("div");E.dataset.op=u.id;E.classList.add("cablesEle");E.classList.add("sidebar__item");E.classList.add("sidebar__text");const F=document.createElement("div");F.classList.add("sidebar__item-label");const A=document.createTextNode(i.get());F.appendChild(A);E.appendChild(F);const C=document.createElement("input");C.type="file";C.id="file";C.name="file";C.style["background-color"]="transparent";C.style.width="90%";C.style.display="none";const x=document.createElement("div");x.style.cursor="pointer";x.style.position="absolute";x.style.right="10px";x.style["margin-top"]="15px";x.innerHTML="&nbsp;&nbsp;";const T=document.createElement("div");T.classList.add("sidebar__button-input");T.innerHTML=h.get();T.onclick=()=>{C.click()};l.onTriggered=()=>{T.click()};T.style["margin-top"]="10px";T.style["padding-left"]="5px";T.style["padding-right"]="5px";T.style.width="80%";T.style["text-overflow"]="ellipsis";T.style.overflow="hidden";T.style["white-space"]="nowrap";E.appendChild(x);E.appendChild(T);E.appendChild(C);const B=document.createElement("img");C.addEventListener("change",S,false);const I=document.createElement("div");I.classList.add("sidebar__greyout");E.appendChild(I);I.style.display="none";r.onChange=()=>{if(r.get())C.setAttribute("multiple","multiple");else C.removeAttribute("multiple")};n.onChange=()=>{C.accept=n.get()};h.onChange=()=>{T.innerHTML=h.get()};o.onChange=function(){I.style.display=o.get()?"block":"none"};s.onChange=function(){E.style.display=s.get()?"block":"none"};function D(){C.value="";d.set("");T.innerHTML=h.get();v.trigger();m.set(0);_.setRef([]);b.setRef([])}c.onTriggered=D;x.addEventListener("click",D);function S(t){const i=new FileReader;const n=[];const r=[];i.onabort=function(e){u.log("File read cancelled")};i.onload=function(e){n[0]=e.target.result;d.set(e.target.result)};const a=t.target.files.length;m.set(a);let s=null;if(t.target.files[0]){for(let e=0;e<a;e++){if(e===0){i.readAsDataURL(t.target.files[0]);g.set(t.target.files[0].name);if(a==1)T.innerHTML=t.target.files[0].name;p.set(t.target.files[0])}r.push(t.target.files[e].name);const o=new FileReader;const l=e;o.onload=function(e){n[l]=e.target.result;T.innerHTML=a+" files selected";clearTimeout(s);s=setTimeout(()=>{_.setRef(n);v.trigger()},100)};o.readAsDataURL(t.target.files[e])}}else{T.innerHTML=h.get();b.setRef([]);d.set("");g.set("");p.set(null)}b.setRef(r);v.trigger()}t.onChange=w;i.onChange=y;a.onChange=O;u.onDelete=N;u.toWorkNeedsParent("Ops.Sidebar.Sidebar");function O(){E.id=a.get()}function y(){const e=i.get();F.textContent=e}function w(){f.set(null);const e=t.get();if(e&&e.parentElement){e.parentElement.appendChild(E);f.set(e)}else{if(E.parentElement){E.parentElement.removeChild(E)}}}function L(e){if(e){e.style.display="block"}}function R(e){if(e){e.style.display="none"}}function N(){M(E)}function M(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};Ops.Json.HttpRequest_v2=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const n=s.inUrl("file"),o=s.inValueBool("JsonP",false),l=s.inObject("headers",{}),u=s.inStringEditor("body",""),h=s.inDropDown("HTTP Method",["GET","POST","PUT","DELETE","PATCH","HEAD","CONNECT","OPTIONS","TRACE"],"GET"),c=s.inString("Content-Type","application/json"),f=s.inBool("parse json",true),d=s.inBool("Auto request",true),t=s.inTriggerButton("reload"),g=s.outObject("data"),p=s.outString("response"),m=s.outNumber("Duration MS",0),_=s.outNumber("Status Code",0),b=s.outBoolNum("Is Loading",false),v=s.outTrigger("Loaded");n.setUiAttribs({title:"URL"});t.setUiAttribs({buttonTitle:"trigger request"});g.ignoreValueSerialize=true;p.ignoreValueSerialize=true;let a=null;CABLES.jsonp=function(e,t){a=a||0;a++;const i=a;CABLES["jsonpFunc"+i]=function(e){t(false,e)};let n="?";if(e.indexOf(n)>-1)n="&";const r=document.createElement("script");r.setAttribute("src",e+n+"callback=CABLES.jsonpFunc"+i);document.body.appendChild(r)};d.onChange=n.onChange=o.onChange=l.onChange=h.onChange=f.onChange=function(){r(false)};t.onTriggered=function(){r(true)};let i=0;function r(e=false){clearTimeout(i);i=setTimeout(function(){E(null,e)},100)}s.onFileChanged=function(e){if(n.get()&&n.get().indexOf(e)>-1)E(true)};function E(e,t=false){if(!d.get()&&!t)return;if(!n.get())return;const r=s.patch.loading.start("jsonFile",""+n.get(),s);b.set(true);s.setUiAttrib({extendTitle:CABLES.basename(n.get())});s.setUiError("jsonerr",null);let i=CABLES.ajax;if(o.get())i=CABLES.jsonp;let a=s.patch.getFilePath(n.get());if(e)a+="?rnd="+CABLES.generateUUID();s.patch.loading.addAssetLoadingTask(()=>{const e=u.get();const n=performance.now();i(a,(e,t,i)=>{m.set(Math.round(performance.now()-n));g.set(null);p.set(null);_.set(i.status);try{let e=t;if(typeof e==="string"&&f.get()){e=JSON.parse(t);g.set(e)}p.set(t);s.uiAttr({error:null});s.patch.loading.finished(r);v.trigger();b.set(false)}catch(e){s.logError(e);s.setUiError("jsonerr","Problem while loading json:<br/>"+e);s.patch.loading.finished(r);b.set(false)}},h.get(),e&&e.length>0?e:null,c.get(),null,l.get()||{})})}}};Ops.Json.GateObject=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inObject("Object In"),n=e.inValueBool("Pass Through",true),r=e.inSwitch("When False",["keep last object","null"],"keep last object"),a=e.inValueBool("Only Valid Objects",false),s=e.outObject("Object Out");i.onChange=r.onChange=n.onChange=o;i.changeAlways=true;function o(){if(!i.get()&&a.get())return;if(n.get())s.setRef(i.get());else{if(r.get()=="null")s.setRef(null)}}}};Ops.Boolean.BoolByTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("True"),n=e.inTriggerButton("false"),r=e.outBoolNum("Result");i.onTriggered=function(){r.set(true)};n.onTriggered=function(){r.set(false)}}};Ops.Sidebar.SidebarText_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inObject("link");const n=e.inString("Text","Value");const r=e.inValueString("Id","");const a=e.outObject("childs");const s=document.createElement("div");s.dataset.op=e.id;s.classList.add("cablesEle");s.classList.add("sidebar__item");s.classList.add("sidebar__text");const o=document.createElement("div");o.classList.add("sidebar__item-label");const l=document.createElement("div");o.appendChild(l);s.appendChild(o);i.onChange=c;n.onChange=h;r.onChange=u;e.onDelete=g;e.toWorkNeedsParent("Ops.Sidebar.Sidebar");function u(){s.id=r.get()}function h(){const e=n.get();o.innerHTML=e}function c(){a.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(s);a.set(e)}else{if(s.parentElement){s.parentElement.removeChild(s)}}}function f(e){if(e){e.style.display="block"}}function d(e){if(e){e.style.display="none"}}function g(){p(s)}function p(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};Ops.Sidebar.Group=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};let i=t.inObject("link");let n=t.inString("Text","Group");const r=t.inBool("Show Title",true);let a=t.inValueBool("Default Minimized");const s=t.inBool("Visible",true);let o=t.outObject("next");let l=t.outObject("childs");s.onChange=function(){u.style.display=s.get()?"block":"none"};let u=document.createElement("div");u.dataset.op=t.id;u.classList.add("sidebar__group");p();let h=document.createElement("div");h.classList.add("sidebar__group-header");h.classList.add("cablesEle");u.appendChild(h);h.addEventListener("click",m);let c=document.createElement("div");c.classList.add("sidebar__group-header-title");h.appendChild(c);let f=document.createElement("span");f.textContent=n.get();f.classList.add("sidebar__group-header-title-text");c.appendChild(f);let d=document.createElement("span");d.classList.add("sidebar__group-header-icon");d.classList.add("iconsidebar-chevron-up");c.appendChild(d);let g=document.createElement("div");g.classList.add("sidebar__group-items");u.appendChild(g);t.toWorkPortsNeedToBeLinked(i);i.onChange=b;n.onChange=_;a.onChange=p;t.onDelete=F;r.onChange=()=>{if(r.get())h.style.display="block";else h.style.display="none"};function p(){if(a.get()){u.classList.add("sidebar__group--closed")}else{u.classList.remove("sidebar__group--closed")}}function m(e){e.stopPropagation();u.classList.toggle("sidebar__group--closed")}function _(){let e=n.get();f.textContent=e;if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function b(){l.set(null);let e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(u);l.set({parentElement:g,parentOp:t});o.set(e)}else{if(u.parentElement){u.parentElement.removeChild(u)}}}function v(e){if(e){e.style.display="block"}}function E(e){if(e){e.style.display="none"}}function F(){A(u)}function A(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};Ops.Vars.VarSetObject_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inObject("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"object",i,e.varName)}};Ops.Json.SaveJsonFile=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("download"),n=e.inString("Filename","jsonexport"),r=e.inObject("Object");i.onTriggered=function(){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r.get(),null,2));const t=document.createElement("a");t.setAttribute("href",e);t.setAttribute("download",n.get()+".json");t.click();t.remove()}}};Ops.Vars.VarGetObject_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outObject("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"object",e.varName,i)}};Ops.Array.ArrayLength=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("array"),n=e.outNumber("length");n.ignoreValueSerialize=true;function r(){let e=0;if(i.get())e=i.get().length;else e=-1;n.set(e)}i.onChange=r}};Ops.Sidebar.DisplayValue_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link");const n=t.inString("Text","Value");const r=t.inString("Value","");const a=t.outObject("childs");const s=document.createElement("div");s.dataset.op=t.id;s.classList.add("cablesEle");s.classList.add("sidebar__item");s.classList.add("sidebar__value-display");const o=document.createElement("div");o.classList.add("sidebar__item-label");const l=document.createTextNode(n.get());o.appendChild(l);s.appendChild(o);const u=document.createElement("div");u.textContent=r.get();u.classList.add("sidebar__item-value-label");s.appendChild(u);i.onChange=f;n.onChange=c;r.onChange=h;t.onDelete=p;function h(){u.textContent=r.get()}function c(){const e=n.get();o.textContent=e;if(CABLES.UI){t.setUiAttrib({extendTitle:e})}}function f(){a.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(s);a.set(e)}else{if(s.parentElement){s.parentElement.removeChild(s)}}}function d(e){if(e){e.style.display="block"}}function g(e){if(e){e.style.display="none"}}function p(){m(s)}function m(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};Ops.String.NumberToString_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Number"),n=e.inInt("Decimal Places",4),r=e.outString("Result");let a=false;let s=1;n.onChange=o;i.onChange=l;o();l();function o(){a=n.get()<100;s=Math.pow(10,n.get());l()}function l(){if(a)r.set(String(Math.round(i.get()*s)/s));else r.set(String(i.get()||0))}}};Ops.Gl.ImageCompose.Noise.PixelNoise_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixelnoise2_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float numX;\nUNI float numY;\nUNI float addX;\nUNI float addY;\nUNI float addZ;\nUNI float seed2;\nUNI float minIn;\nUNI float maxIn;\n\nfloat random(vec2 co)\n{\n    float r=fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * (5.711+(mod(addZ+5711.210,57111.0))));\n\n    #ifdef LOOP\n        r=abs(r-0.5)*2.0;\n    #endif\n\n    return r;\n}\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    vec2 seed=vec2(0.0);\n\n    #ifndef CENTER\n        seed=vec2(floor( texCoord.x*numX+addX),floor( texCoord.y*numY+addY));\n    #endif\n    #ifdef CENTER\n        seed=vec2(floor( (texCoord.x-0.5)*numX+addX),floor( (texCoord.y-0.5)*numY+addY));\n    #endif\n\n    float r,g,b;\n\n    #ifndef RGB\n        r=g=b=random( seed + 0.5711 + seed2 );\n    #endif\n\n    #ifdef RGB\n        r=random( seed+0.5711 + seed2);\n        g=random( seed+0.5712 + seed2);\n        b=random( seed+0.5713 + seed2);\n    #endif\n\n    vec4 rnd = clamp( vec4( r,g,b,1.0 ),vec4(minIn), vec4(maxIn) );\n\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,rnd,amount);\n\n}"};const i=e.inTrigger("Render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.inValueBool("Loop",false),s=e.inValueBool("RGB",false),o=e.inValue("Minimum value",0),l=e.inValue("Maximum value",1),u=e.inValue("Num X",10),h=e.inValue("Num Y",10),c=e.inValue("X",0),f=e.inValue("Y",0),d=e.inValue("Z",0),g=e.inValue("Seed",0),p=e.inBool("Centered",false),m=e.outTrigger("Next");e.setPortGroup("Look",[s,a,o,l]);e.setPortGroup("Position",[c,f,d]);e.setPortGroup("Scaling",[u,h]);const _=e.patch.cgl;const b=new CGL.Shader(_,e.name,e);b.setSource(b.getDefaultVertexShader(),t.pixelnoise2_frag);const v=new CGL.Uniform(b,"f","amount",r),E=new CGL.Uniform(b,"f","time",1),F=new CGL.Uniform(b,"t","tex",0),A=new CGL.Uniform(b,"f","numX",u),C=new CGL.Uniform(b,"f","numY",h),x=new CGL.Uniform(b,"f","addX",c),T=new CGL.Uniform(b,"f","addY",f),B=new CGL.Uniform(b,"f","addZ",d),I=new CGL.Uniform(b,"f","seed2",g),D=new CGL.Uniform(b,"f","minIn",o),S=new CGL.Uniform(b,"f","maxIn",l);a.onChange=function(){if(a.get())b.define("LOOP");else b.removeDefine("LOOP")};s.onChange=function(){if(s.get())b.define("RGB");else b.removeDefine("RGB")};p.onChange=function(){b.toggleDefine("CENTER",p.get())};CGL.TextureEffect.setupBlending(e,b,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;_.pushShader(b);_.currentTextureEffect.bind();_.setTexture(0,_.currentTextureEffect.getCurrentSourceTexture().tex);_.currentTextureEffect.finish();_.popShader();m.trigger()}}};Ops.Gl.ImageCompose.Emboss=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={emboss_frag:"#ifdef HAS_TEXTURES\n  IN vec2 texCoord;\n  UNI sampler2D tex;\n  UNI float texSizeX;\n  UNI float texSizeY;\n#endif\n\nUNI float strength;\n\nvoid main()\n{\n    vec4 orig=texture(tex, texCoord);\n    vec2 texelSize=vec2(texSizeX,texSizeY);\n\n    float tl = abs(texture(tex, texCoord + texelSize * vec2(-1.0, -1.0)).x); // top left\n    float  l = abs(texture(tex, texCoord + texelSize * vec2(-1.0,  0.0)).x); // left\n    float bl = abs(texture(tex, texCoord + texelSize * vec2(-1.0,  1.0)).x); // bottom left\n    float  t = abs(texture(tex, texCoord + texelSize * vec2( 0.0, -1.0)).x); // top\n    float  b = abs(texture(tex, texCoord + texelSize * vec2( 0.0,  1.0)).x); // bottom\n    float tr = abs(texture(tex, texCoord + texelSize * vec2( 1.0, -1.0)).x); // top right\n    float  r = abs(texture(tex, texCoord + texelSize * vec2( 1.0,  0.0)).x); // right\n    float br = abs(texture(tex, texCoord + texelSize * vec2( 1.0,  1.0)).x); // bottom right\n\n    float dX = tr + 2.0*r + br -tl - 2.0*l - bl;\n    float dY = bl + 2.0*b + br -tl - 2.0*t - tr;\n\n    vec4 N=vec4(1.0);\n\n    N.rgb=orig.rgb;\n\n    #ifdef CLEAR\n        N.rgb=vec3(0.5,0.5,0.5);\n    #endif\n\n    N.rgb-=vec3(dY)*strength;\n    N.rgb+=vec3(dX)*strength;\n\n   outColor= N;\n}"};const i=e.inTrigger("render"),n=e.outTrigger("trigger"),r=e.inValue("Strength",4),a=e.inValueBool("Clear",true),s=e.patch.cgl,o=new CGL.Shader(s,e.name,e);o.setSource(o.getDefaultVertexShader(),t.emboss_frag||"");let l=new CGL.Uniform(o,"t","tex",0);let u=new CGL.Uniform(o,"f","strength",r);let h=new CGL.Uniform(o,"f","texSizeX",1024);let c=new CGL.Uniform(o,"f","texSizeY",1024);a.onChange=f;f();function f(){if(a.get())o.define("CLEAR");else o.removeDefine("CLEAR")}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;s.pushShader(o);s.currentTextureEffect.bind();s.setTexture(0,s.currentTextureEffect.getCurrentSourceTexture().tex);h.set(1/s.currentTextureEffect.getCurrentSourceTexture().width);c.set(1/s.currentTextureEffect.getCurrentSourceTexture().height);s.currentTextureEffect.finish();s.popShader();n.trigger()}}};Ops.Gl.ImageCompose.Wobble=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={wobble_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D texMask;\nUNI float time;\nUNI float speedX;\nUNI float speedY;\nUNI float repeatX;\nUNI float repeatY;\nUNI float mul;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n\nfloat mult=mul;\n#ifdef MASK\n    mult*=texture(texMask,texCoord).r;\n#endif\n\n    vec2 tc = texCoord + cos( (time*vec2(speedX, speedY) + vec2(texCoord.s*repeatX,texCoord.t*repeatY)))*mult;\n\n    col=texture(tex,tc);\n\n    outColor= col;\n}"};const i=e.inTrigger("Render"),n=e.inValue("time",0),r=e.inValue("SpeedX",4),a=e.inValue("SpeedY",8),s=e.inValue("RepeatX",11),o=e.inValue("RepeatY",11),l=e.inValue("Multiply",.01),u=e.inTexture("Mask"),h=e.outTrigger("Trigger");const c=e.patch.cgl;const f=new CGL.Shader(c,e.name,e);f.setSource(f.getDefaultVertexShader(),t.wobble_frag);const d=new CGL.Uniform(f,"t","tex",0);const g=new CGL.Uniform(f,"f","time",n);const p=new CGL.Uniform(f,"f","speedX",r);const m=new CGL.Uniform(f,"f","speedY",a);const _=new CGL.Uniform(f,"f","repeatX",s);const b=new CGL.Uniform(f,"f","repeatY",o);const v=new CGL.Uniform(f,"f","mul",l);const E=new CGL.Uniform(f,"t","texMask",1);u.onChange=function(){f.toggleDefine("MASK",u.isLinked())};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;c.pushShader(f);c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);if(u.get())c.setTexture(1,u.get().tex);c.currentTextureEffect.finish();c.popShader();h.trigger()}}};Ops.Gl.ImageCompose.ChromaticAberration=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={chromatic_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI float pixel;\nUNI float onePixel;\nUNI float amount;\nUNI float lensDistort;\n\n#ifdef MASK\nUNI sampler2D texMask;\n#endif\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n   vec4 base=texture(tex,texCoord);\n   vec4 col=texture(tex,texCoord);\n\n   vec2 tc=texCoord;;\n   float pix = pixel;\n   if(lensDistort>0.0)\n   {\n       float dist = distance(texCoord, vec2(0.5,0.5));\n       tc-=0.5;\n       tc *=smoothstep(-0.9,1.0*lensDistort,1.0-dist);\n       tc+=0.5;\n   }\n\n    #ifdef MASK\n        vec4 m=texture(texMask,texCoord);\n        pix*=m.r*m.a;\n    #endif\n\n    #ifdef SMOOTH\n    #ifdef WEBGL2\n        float numSamples=round(pix/onePixel/4.0+1.0);\n        col.r=0.0;\n        col.b=0.0;\n\n        for(float off=0.0;off<numSamples;off++)\n        {\n            float diff=(pix/numSamples)*off;\n            col.r+=texture(tex,vec2(tc.x+diff,tc.y)).r/numSamples;\n            col.b+=texture(tex,vec2(tc.x-diff,tc.y)).b/numSamples;\n        }\n    #endif\n    #endif\n\n    #ifndef SMOOTH\n        col.r=texture(tex,vec2(tc.x+pix,tc.y)).r;\n        col.b=texture(tex,vec2(tc.x-pix,tc.y)).b;\n    #endif\n\n//   outColor = col;\n   outColor= cgl_blend(base,col,amount);\n\n}\n"};const i=t.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),r=t.inValueSlider("Amount",1),a=t.inValue("Pixel",5),s=t.inValueSlider("Lens Distort",0),o=t.inValueBool("Smooth",false),l=t.inTexture("Mask"),u=t.outTrigger("trigger");const h=t.patch.cgl;const c=new CGL.Shader(h,"chromatic");CGL.TextureEffect.setupBlending(t,c,n,r);c.setSource(c.getDefaultVertexShader(),e.chromatic_frag);const f=new CGL.Uniform(c,"t","tex",0),d=new CGL.Uniform(c,"f","pixel",0),g=new CGL.Uniform(c,"f","onePixel",0),p=new CGL.Uniform(c,"t","texMask",1),m=new CGL.Uniform(c,"f","amount",r),_=new CGL.Uniform(c,"f","lensDistort",s);o.onChange=function(){if(o.get())c.define("SMOOTH");else c.removeDefine("SMOOTH")};l.onChange=function(){if(l.get())c.define("MASK");else c.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t))return;let e=h.currentTextureEffect.getCurrentSourceTexture();d.setValue(a.get()*(1/e.width));g.setValue(1/e.width);h.pushShader(c);h.currentTextureEffect.bind();h.setTexture(0,e.tex);if(l.get())h.setTexture(1,l.get().tex);h.currentTextureEffect.finish();h.popShader();u.trigger()}}};Ops.Gl.ImageCompose.Denoise=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={denoise_frag:"UNI sampler2D tex;\nUNI float exponent;\nUNI float strength;\nUNI vec2 texSize;\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec4 center = texture(tex, texCoord);\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n    const float pixels=4.0;\n    for (float x = -pixels; x <= pixels; x += 1.0) {\n        for (float y = -pixels; y <= pixels; y += 1.0) {\n            vec4 smpl = texture(tex, texCoord + vec2(x, y) / texSize);\n            float weight = 1.0 - abs(dot(smpl.rgb - center.rgb, vec3(0.25)));\n            weight = pow(weight, (1.0-exponent)*50.0);\n            color += smpl * weight;\n            total += weight;\n        }\n    }\n    outColor = color / total;\n}\n"};let i=e.inTrigger("render");let n=e.inValueSlider("Exponent",.6);let r=e.outTrigger("trigger");let a=e.patch.cgl;let s=new CGL.Shader(a,e.name,e);let o=[128,128];let l=t.denoise_frag;s.setSource(s.getDefaultVertexShader(),l);let u=new CGL.Uniform(s,"t","tex",0);let h=new CGL.Uniform(s,"f","exponent",n);let c=new CGL.Uniform(s,"2f","texSize",o);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;o[0]=a.currentTextureEffect.getCurrentSourceTexture().width;o[1]=a.currentTextureEffect.getCurrentSourceTexture().height;c.setValue(o);a.pushShader(s);a.currentTextureEffect.bind();a.setTexture(0,a.currentTextureEffect.getCurrentSourceTexture().tex);a.currentTextureEffect.finish();a.popShader();r.trigger()}}};Ops.Gl.ImageCompose.MultiDrawImage=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const t=i.attachments={invert_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D tex1;\nUNI sampler2D tex2;\nUNI sampler2D tex3;\nUNI sampler2D tex4;\nUNI sampler2D tex5;\nUNI sampler2D tex6;\nUNI sampler2D tex7;\nUNI sampler2D tex8;\n\n\nUNI sampler2D texMask1;\nUNI sampler2D texMask2;\nUNI sampler2D texMask3;\nUNI sampler2D texMask4;\nUNI sampler2D texMask5;\nUNI sampler2D texMask6;\nUNI sampler2D texMask7;\nUNI sampler2D texMask8;\n\nUNI float amount1;\nUNI float amount2;\nUNI float amount3;\nUNI float amount4;\nUNI float amount5;\nUNI float amount6;\nUNI float amount7;\nUNI float amount8;\n\n{{BLENDCODE}}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n\n    #ifdef USE_TEX_1\n        vec4 col1=texture(tex1,texCoord);\n        col=cgl_blend1(col,col1,amount1);\n    #endif\n    #ifdef USE_TEX_2\n        vec4 col2=texture(tex2,texCoord);\n        col=cgl_blend2(col,col2,amount2);\n    #endif\n    #ifdef USE_TEX_3\n        vec4 col3=texture(tex3,texCoord);\n        col=cgl_blend3(col,col3,amount3);\n    #endif\n    #ifdef USE_TEX_4\n        vec4 col4=texture(tex4,texCoord);\n        col=cgl_blend4(col,col4,amount4);\n    #endif\n    #ifdef USE_TEX_5\n        vec4 col5=texture(tex5,texCoord);\n        col=cgl_blend5(col,col5,amount5);\n    #endif\n    #ifdef USE_TEX_6\n        vec4 col6=texture(tex6,texCoord);\n        col=cgl_blend6(col,col6,amount6);\n    #endif\n    #ifdef USE_TEX_7\n        vec4 col7=texture(tex7,texCoord);\n        col=cgl_blend7(col,col7,amount7);\n    #endif\n    #ifdef USE_TEX_8\n        vec4 col8=texture(tex8,texCoord);\n        col=cgl_blend8(col,col8,amount8);\n    #endif\n\n    outColor=col;\n\n}\n"};const n=["normal","lighten","darken","multiply","multiply invert","average","add","substract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight"];const e=i.inTrigger("render"),r=i.inBool("Mask Invert",false),a=i.outTrigger("trigger");const s=8,o=i.patch.cgl,l=new CGL.Shader(o,i.name),u=[],h=[],c=[],f=[],d=[],g=[];let p=true;for(let e=0;e<s;e++){const v=i.inTexture("Texture "+(e+1));const E=i.inDropDown("Blendmode "+(e+1),n,"normal");const F=i.inTexture("Mask "+(e+1));const A=i.inSwitch("Mask Source "+(e+1),["R","R inv","A","A inv"],"R");const C=i.inSwitch("Opacity "+(e+1),["Normal","Prev A","Prev R"],"Normal");const x=i.inValueSlider("Amount "+(e+1),1);E.onChange=C.onChange=A.onChange=F.onLinkChanged=v.onLinkChanged=()=>{p=true};g.push(v);f.push(F);c.push(C);h.push(E);u.push(x);d.push(A);i.setPortGroup("Image "+(e+1),[v,E,x,C,F,A]);new CGL.Uniform(l,"t","tex"+(e+1),e*2+1);new CGL.Uniform(l,"t","texMask"+(e+1),e*2+2);new CGL.Uniform(l,"f","amount"+(e+1),x)}const m=new CGL.Uniform(l,"t","tex",0);function _(){let i="";let n="";for(let t=0;t<s;t++){let e=g[t].isLinked();u[t].setUiAttribs({greyout:!e});h[t].setUiAttribs({greyout:!e});c[t].setUiAttribs({greyout:!e});if(e){i+="#define USE_TEX_"+(t+1)+"".endl();n+=b(t+1,h[t].get(),c[t].get(),f[t].get(),d[t].get())}}let e=i.endl()+t.invert_frag;e=e.replace("{{BLENDCODE}}",n);l.setSource(l.getDefaultVertexShader(),e);p=false}function b(e,t,i,n,r){let a=""+"vec3 _blend"+e+"(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl();if(t=="multiply")a+="       colNew=base*blend;".endl();else if(t=="multiply invert")a+="       colNew=base* vec3(1.0)-blend;".endl();else if(t=="average")a+="       colNew=((base + blend) / 2.0);".endl();else if(t=="add")a+="       colNew=min(base + blend, vec3(1.0));".endl();else if(t=="substract")a+="       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl();else if(t=="difference")a+="       colNew=abs(base - blend);".endl();else if(t=="negation")a+="       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl();else if(t=="exclusion")a+="       colNew=(base + blend - 2.0 * base * blend);".endl();else if(t=="lighten")a+="       colNew=max(blend, base);".endl();else if(t=="darken")a+="       colNew=min(blend, base);".endl();else if(t=="overlay"){a+=""+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()}else if(t=="screen"){a+=""+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()}else if(t=="softlight"){a+=""+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()}else if(t=="hardlight"){a+=""+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()}else if(t=="color dodge"){a+=""+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()}else if(t=="color burn"){a+=""+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()}a+=""+"   return colNew;".endl()+"}".endl()+"vec4 cgl_blend"+e+"(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"float a=(amount*newColor.a);".endl();if(i==="Prev A")a+="a*=oldColor.a;";if(i==="Prev R")a+="a*=oldColor.r;";a=a+"vec4 col = vec4( _blend"+e+"(oldColor.rgb, newColor.rgb), 1.0);".endl()+"col = vec4( mix( col.rgb,oldColor.rgb, col.a * 1.0-amount), 1.0);".endl();if(n)if(r==="R")a=a+"newColor.a *= texture(texMask"+e+",texCoord).r;".endl();else if(r==="R inv")a=a+"newColor.a *= 1.0-texture(texMask"+e+",texCoord).r;".endl();else if(r==="A")a=a+"newColor.a *= texture(texMask"+e+",texCoord).a;".endl();else if(r==="A inv")a=a+"newColor.a *= 1.0-texture(texMask"+e+",texCoord).a;".endl();a=a+"col = vec4( mix( oldColor,col, newColor.a));".endl()+"return col;".endl()+"}".endl().endl();return a}e.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(i))return;if(p)_();o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);let t=1;for(let e=0;e<g.length;e++){if(g[e].get()){o.setTexture(e*2+1,g[e].get().tex);t++}if(f[e].get()){o.setTexture(e*2+2,f[e].get().tex);t++}}if(t>o.maxTextureUnits)i.setUiError("manytex","Too many textures bound");else i.setUiError("manytex",null);o.pushBlendMode(CGL.BLEND_NONE,true);o.currentTextureEffect.finish();o.popBlendMode();o.popShader();a.trigger()}}};Ops.Gl.ImageCompose.PatternLookup=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={patternlookup_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D patternTex;\nUNI float amount;\nUNI float patternWidth;\nUNI float patternHeight;\n\n{{CGL.BLENDMODES}}\n\nfloat desaturate(vec3 color)\n{\n    vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n    return gray.g;\n}\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    vec4 base=texture(tex,texCoord);\n\n    vec2 nc=vec2(0.5,desaturate(base.rgb));\n    nc.x=mod(texCoord.x,patternWidth*0.1);\n    nc.y=nc.y+mod(texCoord.y,patternHeight*0.1);\n\n    // maybe should have a ping pong modulo option...\n\n    nc.x=clamp(nc.x,0.0,1.0);\n    nc.y=clamp(nc.y,0.0,1.0);\n\n    vec4 newCol=texture(patternTex,nc);\n\n    outColor=cgl_blend(base,newCol,amount);\n}"};const i=t.inTrigger("render");const n=t.inTexture("Multiplier");const r=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal");const a=t.inValueSlider("Amount",1);const s=t.outTrigger("trigger");const o=t.inValueSlider("Width",.1);const l=t.inValueSlider("Height",.1);const u=t.patch.cgl;const h=new CGL.Shader(u,t.name,t);t.toWorkPortsNeedToBeLinked(n);h.setSource(h.getDefaultVertexShader(),e.patternlookup_frag);const c=new CGL.Uniform(h,"t","tex",0);const f=new CGL.Uniform(h,"t","patternTex",1);const d=new CGL.Uniform(h,"f","amount",a);const g=new CGL.Uniform(h,"f","patternWidth",o);const p=new CGL.Uniform(h,"f","patternHeight",l);CGL.TextureEffect.setupBlending(t,h,r,a);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t))return;let e=n.get();if(e){u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);if(e)u.setTexture(1,e.tex);u.currentTextureEffect.finish();u.popShader()}s.trigger()}}};Ops.Gl.ImageCompose.Desaturate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={desaturate_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\n\n#ifdef MASK\n    UNI sampler2D mask;\n#endif\n\nvec3 desaturate(vec3 color, float amount)\n{\n   vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n   return vec3(mix(color, gray, amount));\n}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    float am=amount;\n    #ifdef MASK\n        am*=1.0-texture(mask,texCoord).r;\n        #ifdef INVERTMASK\n        am=1.0-am;\n        #endif\n    #endif\n\n    col.rgb=desaturate(col.rgb,am);\n    outColor= col;\n}"};const i=e.inTrigger("render");const n=e.outTrigger("trigger");const r=e.inValueSlider("amount",1);const a=e.inTexture("Mask");const s=e.inValueBool("Invert Mask");const o=e.patch.cgl;const l=new CGL.Shader(o,e.name,e);l.setSource(l.getDefaultVertexShader(),t.desaturate_frag);let u=new CGL.Uniform(l,"t","tex",0);let h=new CGL.Uniform(l,"t","mask",1);let c=new CGL.Uniform(l,"f","amount",r);s.onChange=function(){if(s.get())l.define("INVERTMASK");else l.removeDefine("INVERTMASK")};a.onChange=function(){if(a.get())l.define("MASK");else l.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);if(a.get())o.setTexture(1,a.get().tex);o.currentTextureEffect.finish();o.popShader();n.trigger()}}};Ops.Gl.Textures.NoiseTexture=class extends CABLES.Op{constructor(){super(...arguments);const m=this;const e=m.attachments={};const _=m.inValueInt("Width",256),b=m.inValueInt("Height",256),v=m.inSwitch("Filter",["nearest","linear"],"nearest"),E=m.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"repeat"),F=m.inValueBool("Color",false),A=m.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),C=m.inBool("Integer",false),x=m.inFloat("Seed",1),T=m.inBool("Channel R",true),B=m.inFloat("Min R",0),I=m.inFloat("Max R",1),D=m.inBool("Channel G",true),S=m.inFloat("Min G",0),O=m.inFloat("Max G",1),y=m.inBool("Channel B",true),w=m.inFloat("Min B",0),N=m.inFloat("Max B",1),M=m.inBool("Channel A",true),L=m.inFloat("Min A",1),R=m.inFloat("Max A",1),P=m.outTexture("Texture"),k=m.outNumber("Total Pixel");const U=m.patch.cgl;let t=null;let V=null;x.onChange=_.onChange=b.onChange=A.onChange=B.onChange=I.onChange=S.onChange=L.onChange=O.onChange=R.onChange=w.onChange=N.onChange=T.onChange=y.onChange=D.onChange=M.onChange=v.onChange=E.onChange=C.onChange=F.onChange=i;i();function i(){if(V)U.patch.loading.finished(V);V=U.patch.loading.start("noisetexture","noisetexture");U.addNextFrameOnceCallback(n)}function n(){const e=A.get().indexOf("float")>-1;if(!e){if(B.get()<0||B.get()>1||S.get()<0||S.get()>1||w.get()<0||w.get()>1||I.get()<0||I.get()>1||R.get()<0||R.get()>1||O.get()<0||O.get()>1||N.get()<0||N.get()>1)m.setUiError("nonfprange","Non floating point textures have to be between 0 and 1");else m.setUiError("nonfprange",null)}else m.setUiError("nonfprange",null);S.setUiAttribs({greyout:!F.get()});O.setUiAttribs({greyout:!F.get()});w.setUiAttribs({greyout:!F.get()});N.setUiAttribs({greyout:!F.get()});R.setUiAttribs({greyout:!F.get()});let t=Math.ceil(_.get());let i=Math.ceil(b.get());if(t<1)t=1;if(i<1)i=1;let n;const r=t*4*i;const a=B.get();const s=I.get()-a;const o=S.get();const l=O.get()-o;const u=w.get();const h=N.get()-u;const c=L.get();const f=R.get()-c;Math.randomSeed=x.get();if(e){n=new Float32Array(r);if(F.get()){for(let e=0;e<r;e+=4){n[e+0]=a+Math.seededRandom()*s;n[e+1]=o+Math.seededRandom()*l;n[e+2]=u+Math.seededRandom()*h;n[e+3]=c+Math.seededRandom()*f}}else{for(let t=0;t<r;t+=4){let e=a+Math.seededRandom()*s;n[t+0]=n[t+1]=n[t+2]=e;n[t+3]=1}}}else{n=new Uint8Array(r);if(F.get()){for(let e=0;e<r;e+=4){n[e+0]=(a+Math.seededRandom()*s)*255;n[e+1]=(o+Math.seededRandom()*l)*255;n[e+2]=(u+Math.seededRandom()*h)*255;n[e+3]=(c+Math.seededRandom()*f)*255}}else{for(let e=0;e<r;e+=4){n[e+0]=n[e+1]=n[e+2]=(a+Math.seededRandom()*s)*255;n[e+3]=255}}}if(C.get()){for(let e=0;e<n.length;e++)n[e]=Math.round(n[e]-.5)}if(!T.get())for(let e=0;e<r;e+=4)n[e+0]=0;if(!D.get())for(let e=0;e<r;e+=4)n[e+1]=0;if(!y.get())for(let e=0;e<r;e+=4)n[e+2]=0;if(!M.get())for(let e=0;e<r;e+=4)n[e+3]=0;let d=CGL.Texture.FILTER_NEAREST;if(v.get()=="linear")d=CGL.Texture.FILTER_LINEAR;let g=CGL.Texture.WRAP_REPEAT;if(E.get()=="mirrored repeat")g=CGL.Texture.WRAP_MIRRORED_REPEAT;if(E.get()=="clamp to edge")g=CGL.Texture.WRAP_CLAMP_TO_EDGE;let p=new CGL.Texture(U,{isFloatingPointTexture:e,name:"noisetexture"});p.initFromData(n,t,i,d,g);k.set(t*i);P.setRef(p);V=U.patch.loading.finished(V)}}};Ops.Gl.Textures.SwitchTextures_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("exec"),n=this.inValueInt("num"),r=t.inValueBool("Default Texture Transparent",true),a=t.outTrigger("Next"),s=this.outTexture("texture");const o=t.patch.cgl;const l=[];let u=0;let h=-1;let c=CGL.Texture.getEmptyTexture(o);t.toWorkPortsNeedToBeLinked(i);i.onTriggered=function(){d();a.trigger()};r.onChange=function(){if(r.get())c=CGL.Texture.getEmptyTexture(o);else c=CGL.Texture.getTempTexture(o);d(true)};for(let e=0;e<16;e++){const g=t.inTexture("texture"+e);l.push(g);g.onChange=f}function f(){d(true)}function d(e){u=parseInt(n.get(),10);if(!e){if(u==h)return;if(u!=u)return}if(isNaN(u)||u<0||u>l.length-1)u=0;if(l[u].get())s.setRef(l[u].get());else s.setRef(c);h=u}}};Ops.Gl.ImageCompose.Stripes_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={stripes_v3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float num;\nUNI float width;\nUNI float axis;\nUNI float offset;\nUNI float rotate;\n\nUNI float r;\nUNI float g;\nUNI float b;\n\n\n{{CGL.BLENDMODES}}\n\n#define PI 3.14159265\n#define TAU (2.0*PI)\n\nvoid pR(inout vec2 p, float a)\n{\n\tp = cos(a)*p + sin(a)*vec2(p.y, -p.x);\n}\nvoid main()\n{\n    vec2 uv = texCoord-0.5;\n    pR(uv.xy,rotate*TAU);\n    float stripe=0.0;\n\n    float v=0.0;\n    float c=1.0;\n    v=uv.y;\n    v+=offset;\n\n    float m=mod(v,1.0/num);\n\n    #ifdef CIRCULAR\n        m=mod((length(uv)+offset)*1.5,1.0/num);\n    #endif\n\n    float rm=width*2.0*1.0/num/2.0;\n\n    if(m>rm)\n       stripe=mix(stripe,1.,1.0);\n\n    #ifdef STRIPES_SMOOTHED\n       m*=2.0;\n       stripe= r * smoothstep(0.,1., abs((((m-rm) )/(rm))));\n    #endif\n\n    #ifdef INVERT\n    stripe=1.0-stripe;\n    #endif\n\n    //blend section\n    vec4 col=vec4(vec3(r,g,b),1.0);\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,amount*stripe);\n}\n"};const i=e.inTrigger("Render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.inValue("Num",5),s=e.inValue("Width",.5),o=e.inValueSlider("Rotate",0),l=e.inValue("Offset",0),u=e.inValueBool("Gradients"),h=e.inValueBool("Circular"),c=e.inValueBool("Invert"),f=e.inValueSlider("r",Math.random()),d=e.inValueSlider("g",Math.random()),g=e.inValueSlider("b",Math.random()),p=e.outTrigger("trigger");f.setUiAttribs({colorPick:true});u.onChange=m;h.onChange=m;c.onChange=m;function m(){b.toggleDefine("STRIPES_SMOOTHED",u.get());b.toggleDefine("CIRCULAR",h.get());b.toggleDefine("INVERT",c.get())}const _=e.patch.cgl,b=new CGL.Shader(_,"textureeffect stripes");b.setSource(b.getDefaultVertexShader(),t.stripes_v3_frag);const v=new CGL.Uniform(b,"t","tex",0),E=new CGL.Uniform(b,"f","amount",r),F=new CGL.Uniform(b,"f","rotate",o),A=new CGL.Uniform(b,"f","num",a),C=new CGL.Uniform(b,"f","width",s),x=new CGL.Uniform(b,"f","offset",l),T=new CGL.Uniform(b,"f","r",f),B=new CGL.Uniform(b,"f","g",d),I=new CGL.Uniform(b,"f","b",g);CGL.TextureEffect.setupBlending(e,b,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;_.pushShader(b);_.currentTextureEffect.bind();_.setTexture(0,_.currentTextureEffect.getCurrentSourceTexture().tex);_.currentTextureEffect.finish();_.popShader();p.trigger()}}};Ops.Gl.ImageCompose.Vignette_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={vignette_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float lensRadius1;\nUNI float aspect;\nUNI float amount;\nUNI float strength;\nUNI float sharp;\n\nUNI float r,g,b;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    vec4 vcol=vec4(r,g,b,1.0);\n    vec4 col=texture(tex,texCoord);\n    vec2 tcPos=vec2(texCoord.x,(texCoord.y-0.5)*aspect+0.5);\n    float dist = distance(tcPos, vec2(0.5,0.5));\n    float am = (1.0-smoothstep( (lensRadius1+0.5), (lensRadius1*0.99+0.5)*sharp, dist));\n\n    col=mix(col,vcol,am*strength);\n    vec4 base=texture(tex,texCoord);\n\n\n    outColor=cgl_blend(base,col,amount);\n\n\n\n}\n"};const i=e.inTrigger("Render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.outTrigger("Trigger"),s=e.inValueSlider("Strength",1),o=e.inValueSlider("Radius",.3),l=e.inValueSlider("Sharp",.25),u=e.inValue("Aspect",1),h=e.inValueSlider("r",0),c=e.inValueSlider("g",0),f=e.inValueSlider("b",0);h.setUiAttribs({colorPick:true});const d=e.patch.cgl;const g=new CGL.Shader(d,"vignette");g.setSource(g.getDefaultVertexShader(),t.vignette_frag);const p=new CGL.Uniform(g,"t","tex",0),m=new CGL.Uniform(g,"f","amount",r),_=new CGL.Uniform(g,"f","lensRadius1",o),b=new CGL.Uniform(g,"f","aspect",u),v=new CGL.Uniform(g,"f","strength",s),E=new CGL.Uniform(g,"f","sharp",l),F=new CGL.Uniform(g,"f","r",h),A=new CGL.Uniform(g,"f","g",c),C=new CGL.Uniform(g,"f","b",f);CGL.TextureEffect.setupBlending(e,g,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;d.pushShader(g);d.currentTextureEffect.bind();d.setTexture(0,d.currentTextureEffect.getCurrentSourceTexture().tex);d.currentTextureEffect.finish();d.popShader();a.trigger()}}};Ops.Ui.VizNumber=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inFloat("Number",0);const n=t.outNumber("Result");t.setUiAttrib({widthOnlyGrow:true});i.onChange=r;r();function r(){let e=i.get();t.setUiAttribs({extendTitle:i.getValueForDisplay()});n.set(e)}}};Ops.Ui.VizTexture=class extends CABLES.Op{constructor(){super(...arguments);const P=this;const i=P.attachments={viztex_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI samplerCube cubeMap;\nUNI float width;\nUNI float height;\nUNI float type;\nUNI float time;\n\nfloat LinearizeDepth(float d,float zNear,float zFar)\n{\n    float z_n = 2.0 * d - 1.0;\n    return 2.0 * zNear / (zFar + zNear - z_n * (zFar - zNear));\n}\n\nvoid main()\n{\n    vec4 col=vec4(vec3(0.),0.0);\n\n    vec4 colTex=texture(tex,texCoord);\n\n\n\n    if(type==1.0)\n    {\n        vec4 depth=vec4(0.);\n        vec2 localST=texCoord;\n        localST.y = 1. - localST.y;\n\n        localST.t = mod(localST.t*3.,1.);\n        localST.s = mod(localST.s*4.,1.);\n\n        #ifdef WEBGL2\n            #define texCube texture\n        #endif\n        #ifdef WEBGL1\n            #define texCube textureCube\n        #endif\n\n//         //Due to the way my depth-cubeMap is rendered, objects to the -x,y,z side is projected to the positive x,y,z side\n//         //Inside where top/bottom is to be drawn?\n        if (texCoord.s*4.> 1. && texCoord.s*4.<2.)\n        {\n            //Bottom (-y) quad\n            if (texCoord.t*3. < 1.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-1.,-localST.t*2.+1.);//Due to the (arbitrary) way I choose as up in my depth-viewmatrix, i her emultiply the latter coordinate with -1\n                depth = texCube(cubeMap, dir);\n            }\n            //top (+y) quad\n            else if (texCoord.t*3. > 2.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,1.,localST.t*2.-1.);//Get lower y texture, which is projected to the +y part of my cubeMap\n                depth = texCube(cubeMap, dir);\n            }\n            else//Front (-z) quad\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-localST.t*2.+1.,1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n//         //If not, only these ranges should be drawn\n        else if (texCoord.t*3. > 1. && texCoord.t*3. < 2.)\n        {\n            if (texCoord.x*4. < 1.)//left (-x) quad\n            {\n                vec3 dir=vec3(-1.,-localST.t*2.+1.,localST.s*2.-1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else if (texCoord.x*4. < 3.)//right (+x) quad (front was done above)\n            {\n                vec3 dir=vec3(1,-localST.t*2.+1.,-localST.s*2.+1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else //back (+z) quad\n            {\n                vec3 dir=vec3(-localST.s*2.+1.,-localST.t*2.+1.,-1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n        // colTex = vec4(vec3(depth),1.);\n        colTex = vec4(depth);\n    }\n\n    if(type==2.0)\n    {\n       float near = 0.1;\n       float far = 50.;\n       float depth = LinearizeDepth(colTex.r, near, far);\n       colTex.rgb = vec3(depth);\n    }\n\n\n\n\n    #ifdef ANIM_RANGE\n\n        if(colTex.r>1.0 || colTex.r<0.0)\n            colTex.r=mod(colTex.r,1.0)*0.5+(sin(colTex.r+mod(colTex.r*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.g>1.0 || colTex.g<0.0)\n            colTex.g=mod(colTex.g,1.0)*0.5+(sin(colTex.g+mod(colTex.g*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.b>1.0 || colTex.b<0.0)\n            colTex.b=mod(colTex.b,1.0)*0.5+(sin(colTex.b+mod(colTex.b*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n\n    #endif\n\n\n    // #ifdef ANIM_RANGE\n    //     if(colTex.r>1.0 || colTex.r<0.0)\n    //     {\n    //         float r=mod( time+colTex.r,1.0)*0.5+0.5;\n    //         colTex.r=r;\n    //     }\n    //     if(colTex.g>1.0 || colTex.g<0.0)\n    //     {\n    //         float r=mod( time+colTex.g,1.0)*0.5+0.5;\n    //         colTex.g=r;\n    //     }\n    //     if(colTex.b>1.0 || colTex.b<0.0)\n    //     {\n    //         float r=mod( time+colTex.b,1.0)*0.5+0.5;\n    //         colTex.b=r;\n    //     }\n    // #endif\n\n    #ifdef MOD_RANGE\n        colTex.r=mod(colTex.r,1.0001);\n        colTex.g=mod(colTex.g,1.0001);\n        colTex.b=mod(colTex.b,1.0001);\n\n    #endif\n\n    #ifdef ALPHA_ONE\n        colTex.a=1.0;\n    #endif\n    #ifdef ALPHA_INV\n        colTex.a=1.0-colTex.a;\n    #endif\n\n    outColor = mix(col,colTex,colTex.a);\n}\n\n",viztex_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nOUT vec2 texCoord;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nvoid main()\n{\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);\n    vec4 pos = vec4( vPosition, 1. );\n    mat4 mvMatrix=viewMatrix * modelMatrix;\n    gl_Position = projMatrix * mvMatrix * pos;\n}"};const k=P.inTexture("Texture In"),U=P.inBool("Show Info",false),e=P.inSwitch("Visualize outside 0-1",["Off","Anim","Modulo"],"Anim"),t=P.inSwitch("Alpha",["A","1","1-A"],"A"),V=P.inBool("Show Color",false),G=P.inFloatSlider("X",.5),j=P.inFloatSlider("Y",.5),n=P.outTexture("Texture Out"),z=P.outString("Info");P.setUiAttrib({height:150,resizable:true});const H=new CABLES.Timer;let r=null;let W=null;let Y=null;let X="";let a=true;t.onChange=e.onChange=o;V.onChange=s;s();if(CABLES.UI){H.play()}function s(){G.setUiAttribs({greyout:!V.get()});j.setUiAttribs({greyout:!V.get()})}k.onChange=()=>{const e=k.get();n.setRef(e);let t="";if(k.get()&&k.isLinked())t=k.links[0].getOtherPort(k).name;P.setUiAttrib({extendTitle:t})};function o(){if(!r)return;r.toggleDefine("MOD_RANGE",e.get()=="Modulo");r.toggleDefine("ANIM_RANGE",e.get()=="Anim");r.toggleDefine("ALPHA_INV",t.get()=="1-A");r.toggleDefine("ALPHA_ONE",t.get()=="1")}P.renderVizLayerGl=(c,f)=>{if(!k.isLinked())return;if(!f.useGl)return;const d=k;const g=5;const p=g+1;const e=gui.uiProfiler.start("previewlayer texture");const m=d.op.patch.cgl;if(!this._emptyCubemap)this._emptyCubemap=CGL.Texture.getEmptyCubemapTexture(m);d.op.patch.cgl.profileData.count("vizTexPreviews");const _=d.get()||CGL.Texture.getEmptyTexture(m);if(!this._mesh){const t=new CGL.Geometry("vizTexture rect");t.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];t.texCoords=[1,1,0,1,1,0,0,0];t.verticesIndices=[0,1,2,3,1,2];this._mesh=new CGL.Mesh(m,t)}if(!this._shader){this._shader=new CGL.Shader(m,"glpreviewtex");this._shader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);this._shader.setSource(i.viztex_vert,i.viztex_frag);this._shaderTexUniform=new CGL.Uniform(this._shader,"t","tex",g);this._shaderTexCubemapUniform=new CGL.Uniform(this._shader,"tc","cubeMap",p);r=this._shader;o();this._shaderTexUniformW=new CGL.Uniform(this._shader,"f","width",_.width);this._shaderTexUniformH=new CGL.Uniform(this._shader,"f","height",_.height);this._shaderTypeUniform=new CGL.Uniform(this._shader,"f","type",0);this._shaderTimeUniform=new CGL.Uniform(this._shader,"f","time",0)}m.pushPMatrix();const b=[_.width,_.height];const v=d.op.patch.cgl.canvasWidth>b[0]&&d.op.patch.cgl.canvasHeight>b[1];if(v){mat4.ortho(m.pMatrix,0,d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight,0,.001,11)}else mat4.ortho(m.pMatrix,-1,1,1,-1,.001,11);const E=m.getTexture(g);const F=m.getTexture(p);let A=0;if(_){if(_.cubemap)A=1;if(_.textureType==CGL.Texture.TYPE_DEPTH)A=2;if(A==0||A==2){m.setTexture(g,_.tex);m.setTexture(p,this._emptyCubemap.cubemap,m.gl.TEXTURE_CUBE_MAP)}else if(A==1){m.setTexture(p,_.cubemap,m.gl.TEXTURE_CUBE_MAP)}H.update();this._shaderTimeUniform.setValue(H.get());this._shaderTypeUniform.setValue(A);let t=[d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight];m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);m.pushModelMatrix();if(v){t=b;mat4.translate(m.mMatrix,m.mMatrix,[b[0]/2,b[1]/2,0]);mat4.scale(m.mMatrix,m.mMatrix,[b[0]/2,b[1]/2,0])}this._mesh.render(this._shader);m.popModelMatrix();if(A==0)m.setTexture(g,E);if(A==1)m.setTexture(p,F);m.popPMatrix();m.resetViewPort();const C=[f.width,f.height];const x=false;if(_.width>_.height)C[1]=f.width*b[1]/b[0];else{C[1]=f.width*(b[1]/b[0]);if(C[1]>f.height){const D=f.height/C[1];C[0]*=D;C[1]*=D}}const T=C[0]>b[0]&&C[1]>b[1];c.imageSmoothingEnabled=true;c.fillStyle="#ffffff";c.fillRect(f.x,f.y-10,10,10);c.fillStyle="#000000";c.fillRect(f.x,f.y-10,5,5);c.fillRect(f.x+5,f.y-10+5,5,5);let e=f.height;let i=10*f.width/e*f.scale*2;let n=i*f.height/f.width;let r=e/n;let a=f.width/i;for(let t=0;t<i+1;t++)for(let e=0;e<n+1;e++){if((t+e)%2==0)c.fillStyle="#333333";else c.fillStyle="#393939";c.fillRect(f.x-f.x%a*2+a*t,f.y-f.y%a*2+r*e,a,r)}c.fillStyle="#222";const B=(f.width-C[0])/2;const I=(e-C[1])/2;let s=f.x+(f.width-C[0])/2;let o=f.y+(e-C[1])/2;let l=C[0];let u=C[1];if(e-C[1]<0){s=f.x+(f.width-C[0]*e/C[1])/2;o=f.y;l=C[0]*e/C[1];u=e}c.fillRect(f.x,f.y,s-f.x,e);c.fillRect(f.x+l+s-f.x,f.y,l,e);c.fillRect(f.x,f.y,f.width,I);c.fillRect(f.x,f.y+C[1]+I,f.width,I);if(m.canvas&&m.canvasWidth>0&&m.canvasHeight>0&&m.canvas.width>0&&m.canvas.height>0){try{const S=l/t[0]>3||u/t[1]>3;const O=l/t[0]>10||u/t[1]>10;if(b[1]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(b[0]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(C[0]!=0&&C[1]!=0&&f.width!=0&&e!=0&&l!=0&&u!=0){c.imageSmoothingEnabled=!S;c.drawImage(m.canvas,0,0,t[0],t[1],s,o,l,u)}if(O){const y=l/t[0];const w=u/t[1];c.imageSmoothingEnabled=true;c.lineWidth=1;c.globalAlpha=.5;c.beginPath();for(let e=0;e<=t[0];e++){c.moveTo(s+e*y,o);c.lineTo(s+e*y,o+u)}for(let e=0;e<=t[1];e++){c.moveTo(s,o+e*w);c.lineTo(s+l,o+e*w)}c.strokeStyle="#555";c.stroke();c.globalAlpha=1}}catch(e){console.error("canvas drawimage exception...",e)}}let h="";if(U.get()&&d.get()&&d.get().getInfoOneLine)h+=d.get().getInfoOneLine()+"\n";z.set(h);if(V.get()){h+=X+"\n";const N=s+l*G.get();const M=o+u*j.get();for(let e=0;e<2;e++){if(e==0)c.fillStyle="#000";else c.fillStyle="#fff";c.fillRect(N-1+e,M-10+e,1,20);c.fillRect(N-10+e,M-1+e,20,1)}}if(U.get()||V.get()){P.setUiAttrib({comment:h})}if(V.get()){const L=m.gl;const R=k.get();if(!R){X="";return}if(!W)W=L.createFramebuffer();if(!Y)Y=new CGL.PixelReader;L.bindFramebuffer(L.FRAMEBUFFER,W);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,R.tex,0);L.bindFramebuffer(L.FRAMEBUFFER,null);Y.read(m,W,R.pixelFormat,G.get()*R.width,R.height-j.get()*R.height,1,1,e=>{if(!CGL.Texture.isPixelFormatFloat(R.pixelFormat)){X="Pixel Float: "+Math.floor(e[0]/255*100)/100;if(!isNaN(e[1]))X+=", "+Math.floor(e[1]/255*100)/100;if(!isNaN(e[2]))X+=", "+Math.floor(e[2]/255*100)/100;if(!isNaN(e[3]))X+=", "+Math.floor(e[3]/255*100)/100;X+="\n";if(R.pixelFormat.indexOf("ubyte")>0){X+="Pixel UByte: ";X+=Math.round(e[0]);if(!isNaN(e[1]))X+=", "+Math.round(e[1]);if(!isNaN(e[2]))X+=", "+Math.round(e[2]);if(!isNaN(e[3]))X+=", "+Math.round(e[3]);X+="\n"}}else{X="Pixel Float: "+Math.round(e[0]*100)/100+", "+Math.round(e[1]*100)/100+", "+Math.round(e[2]*100)/100+", "+Math.round(e[3]*100)/100;X+="\n"}})}}m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);e.finish()}}};Ops.Gl.ImageCompose.Noise.SimplexNoise=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={simplexnoise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float smoothness;\nUNI float scale;\nUNI float seed;\nUNI float x;\nUNI float y;\nUNI float time;\nUNI float aspect;\nUNI float harmonics;\n\n#ifdef HAS_TEX_OFFSETMAP\n    UNI sampler2D texOffsetZ;\n    UNI float offMul;\n#endif\n\n\n#ifdef HAS_TEX_MASK\n    UNI sampler2D texMask;\n#endif\n\n\n\n{{CGL.BLENDMODES}}\n\nvoid FAST32_hash_3D(    vec3 gridcell,\n                        vec3 v1_mask,       //  user definable v1 and v2.  ( 0s and 1s )\n                        vec3 v2_mask,\n                        out vec4 hash_0,\n                        out vec4 hash_1,\n                        out vec4 hash_2 )       //  generates 3 random numbers for each of the 4 3D cell corners.  cell  corners:  v0=0,0,0  v3=1,1,1  the other two are user definable\n{\n    //    gridcell is assumed to be an integer coordinate\n\n    //  TODO:   these constants need tweaked to find the best possible noise.\n    //          probably requires some kind of brute force computational searching or something....\n    const vec2 OFFSET = vec2( 50.0, 161.0 );\n    const float DOMAIN = 69.0;\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\n\n    //  truncate the domain\n    gridcell.xyz = gridcell.xyz - floor(gridcell.xyz * ( 1.0 / DOMAIN )) * DOMAIN;\n    vec3 gridcell_inc1 = step( gridcell, vec3( DOMAIN - 1.5 ) ) * ( gridcell + 1.0 );\n\n    //  compute x*x*y*y for the 4 corners\n    vec4 P = vec4( gridcell.xy, gridcell_inc1.xy ) + OFFSET.xyxy;\n    P *= P;\n    vec4 V1xy_V2xy = mix( P.xyxy, P.zwzw, vec4( v1_mask.xy, v2_mask.xy ) );     //  appl y mask for v1 and v2\n    P = vec4( P.x, V1xy_V2xy.xz, P.z ) * vec4( P.y, V1xy_V2xy.yw, P.w );\n\n    //  get the lowz and highz mods\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell.zzz * ZINC.xyz ) );\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell_inc1.zzz * ZINC.xyz ) );\n\n    //  appl mask for v1 and v2 mod values\n    v1_mask = ( v1_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n    v2_mask = ( v2_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n\n    //  compute the final hash\n    hash_0 = fract( P * vec4( lowz_mods.x, v1_mask.x, v2_mask.x, highz_mods.x ) );\n    hash_1 = fract( P * vec4( lowz_mods.y, v1_mask.y, v2_mask.y, highz_mods.y ) );\n    hash_2 = fract( P * vec4( lowz_mods.z, v1_mask.z, v2_mask.z, highz_mods.z ) );\n}\n\n\n//\n//  Given an arbitrary 3D point this calculates the 4 vectors from the corners of the simplex pyramid to the point\n//  It also returns the integer grid index information for the corners\n//\nvoid Simplex3D_GetCornerVectors(    vec3 P,                 //  input point\n                                    out vec3 Pi,            //  integer grid index for the origin\n                                    out vec3 Pi_1,          //  offsets for the 2nd and 3rd corners.  ( the 4th = Pi + 1.0 )\n                                    out vec3 Pi_2,\n                                    out vec4 v1234_x,       //  vectors from the 4 corners to the intput point\n                                    out vec4 v1234_y,\n                                    out vec4 v1234_z )\n{\n    //\n    //  Simplex math from Stefan Gustavsons and Ian McEwans work at...\n    //  http://github.com/ashima/webgl-noise\n    //\n\n    //  simplex math constants\n    const float SKEWFACTOR = 1.0/3.0;\n    const float UNSKEWFACTOR = 1.0/6.0;\n    const float SIMPLEX_CORNER_POS = 0.5;\n    const float SIMPLEX_PYRAMID_HEIGHT = 0.70710678118654752440084436210485;    // sqrt( 0.5 )  height of simplex pyramid.\n\n    P *= SIMPLEX_PYRAMID_HEIGHT;        // scale space so we can have an approx feature size of 1.0  ( optional )\n\n    //  Find the vectors to the corners of our simplex pyramid\n    Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );\n    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    Pi_1 = min( g.xyz, l.zxy );\n    Pi_2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\n\n    //  pack them into a parallel-friendly arrangement\n    v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\n    v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\n    v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\n}\n\n//\n//  Calculate the weights for the 3D simplex surflet\n//\nvec4 Simplex3D_GetSurfletWeights(   vec4 v1234_x,\n                                    vec4 v1234_y,\n                                    vec4 v1234_z )\n{\n    //  perlins original implementation uses the surlet falloff formula of (0.6-x*x)^4.\n    //  This is buggy as it can cause discontinuities along simplex faces.  (0.5-x*x)^3 solves this and gives an almost identical curve\n\n    //  evaluate surflet. f(x)=(0.5-x*x)^3\n    vec4 surflet_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\n    surflet_weights = max(0.5 - surflet_weights, 0.0);      //  0.5 here represents the closest distance (squared) of any simplex pyramid corner to any of its planes.  ie, SIMPLEX_PYRAMID_HEIGHT^2\n    return surflet_weights*surflet_weights*surflet_weights;\n}\n\n\n\n//\n//  SimplexPerlin3D  ( simplex gradient noise )\n//  Perlin noise over a simplex (tetrahedron) grid\n//  Return value range of -1.0->1.0\n//  http://briansharpe.files.wordpress.com/2012/01/simplexperlinsample.jpg\n//\n//  Implementation originally based off Stefan Gustavsons and Ian McEwans work at...\n//  http://github.com/ashima/webgl-noise\n//\nfloat SimplexPerlin3D(vec3 P)\n{\n    //  calculate the simplex vector and index math\n    vec3 Pi;\n    vec3 Pi_1;\n    vec3 Pi_2;\n    vec4 v1234_x;\n    vec4 v1234_y;\n    vec4 v1234_z;\n    Simplex3D_GetCornerVectors( P, Pi, Pi_1, Pi_2, v1234_x, v1234_y, v1234_z );\n\n    //  generate the random vectors\n    //  ( various hashing methods listed in order of speed )\n    vec4 hash_0;\n    vec4 hash_1;\n    vec4 hash_2;\n    FAST32_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    //SGPP_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    hash_0 -= 0.49999;\n    hash_1 -= 0.49999;\n    hash_2 -= 0.49999;\n\n    //  evaluate gradients\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\n\n    //  Normalization factor to scale the final result to a strict 1.0->-1.0 range\n    //  x = sqrt( 0.75 ) * 0.5\n    //  NF = 1.0 / ( x * ( ( 0.5 * x*x ) ^ 3 ) * 2.0 )\n    //  http://briansharpe.wordpress.com/2012/01/13/simplex-noise/#comment-36\n     float FINAL_NORMALIZATION = 37.837227241611314102871574478976*smoothness;\n\n    //  sum with the surflet and return\n    return dot( Simplex3D_GetSurfletWeights( v1234_x, v1234_y, v1234_z ), grad_results ) * FINAL_NORMALIZATION;\n}\n\nvoid main()\n{\n\n    vec2 p=vec2(texCoord.x-0.5,texCoord.y-0.5);\n\n    p.x*=aspect;\n\n\n    p=p*scale;\n\n    p=vec2(p.x+0.5-x,p.y+0.5-y);\n\n    vec3 offset;\n    #ifdef HAS_TEX_OFFSETMAP\n        vec4 offMap=texture(texOffsetZ,texCoord);\n\n        #ifdef OFFSET_X_R\n            offset.x=offMap.r;\n        #endif\n        #ifdef OFFSET_X_G\n            offset.x=offMap.g;\n        #endif\n        #ifdef OFFSET_X_B\n            offset.x=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Y_R\n            offset.y=offMap.r;\n        #endif\n        #ifdef OFFSET_Y_G\n            offset.y=offMap.g;\n        #endif\n        #ifdef OFFSET_Y_B\n            offset.y=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Z_R\n            offset.z=offMap.r;\n        #endif\n        #ifdef OFFSET_Z_G\n            offset.z=offMap.g;\n        #endif\n        #ifdef OFFSET_Z_B\n            offset.z=offMap.b;\n        #endif\n\n        offset*=offMul;\n    #endif\n\n    float v=SimplexPerlin3D(vec3(p.x,p.y,time)+offset)*0.5+0.5;\n\n\n    if (harmonics >= 2.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*2.3+offset) * 0.5;\n    if (harmonics >= 3.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*4.2+offset) * 0.25;\n    if (harmonics >= 4.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*8.1+offset) * 0.125;\n    if (harmonics >= 5.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*16.7+offset) * 0.0625;\n\n\n\n    //blend section\n    vec4 col=vec4(v,v,v,1.0);\n\n    vec4 base=texture(tex,texCoord);\n\n    // outColor=cgl_blend(base,col,amount);\n\n\n    float str=1.0;\n    #ifdef HAS_TEX_MASK\n        str=texture(texMask,texCoord).r;\n    #endif\n\n    outColor=cgl_blend(base,col,amount*str);\n\n}"};const i=e.inTrigger("render"),n=e.inTexture("Mask"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),a=e.inValueSlider("Amount",1),s=e.inValue("smoothness",1),o=e.inSwitch("Harmonics",["1","2","3","4","5"],"1"),l=e.inValue("scale",1),u=e.inBool("Aspect",false),h=e.outTrigger("trigger"),c=e.inValue("x"),f=e.inValue("y"),d=e.inValue("time",.314);const g=e.inTexture("Offset"),p=e.inFloat("Offset Multiply",1),m=e.inSwitch("Offset X",["None","R","G","B"],"None"),_=e.inSwitch("Offset Y",["None","R","G","B"],"None"),b=e.inSwitch("Offset Z",["None","R","G","B"],"R");e.setPortGroup("Offset Map",[g,b,_,m,p]);const v=e.patch.cgl;const E=new CGL.Shader(v,e.name,e);E.setSource(E.getDefaultVertexShader(),t.simplexnoise_frag);const F=new CGL.Uniform(E,"t","tex",0),A=new CGL.Uniform(E,"t","texOffsetZ",1),C=new CGL.Uniform(E,"t","texMask",2),x=new CGL.Uniform(E,"f","amount",a),T=new CGL.Uniform(E,"f","smoothness",s),B=new CGL.Uniform(E,"f","scale",l),I=new CGL.Uniform(E,"f","x",c),D=new CGL.Uniform(E,"f","y",f),S=new CGL.Uniform(E,"f","aspect",1),O=new CGL.Uniform(E,"f","time",d),y=new CGL.Uniform(E,"f","offMul",p),w=new CGL.Uniform(E,"f","harmonics",0);o.onChange=()=>{w.setValue(parseFloat(o.get()))};CGL.TextureEffect.setupBlending(e,E,r,a);m.onChange=_.onChange=b.onChange=n.onChange=g.onChange=N;N();function N(){E.toggleDefine("HAS_TEX_OFFSETMAP",g.get());E.toggleDefine("HAS_TEX_MASK",n.get());E.toggleDefine("OFFSET_X_R",m.get()=="R");E.toggleDefine("OFFSET_X_G",m.get()=="G");E.toggleDefine("OFFSET_X_B",m.get()=="B");E.toggleDefine("OFFSET_Y_R",_.get()=="R");E.toggleDefine("OFFSET_Y_G",_.get()=="G");E.toggleDefine("OFFSET_Y_B",_.get()=="B");E.toggleDefine("OFFSET_Z_R",b.get()=="R");E.toggleDefine("OFFSET_Z_G",b.get()=="G");E.toggleDefine("OFFSET_Z_B",b.get()=="B");m.setUiAttribs({greyout:!g.isLinked()});_.setUiAttribs({greyout:!g.isLinked()});b.setUiAttribs({greyout:!g.isLinked()});p.setUiAttribs({greyout:!g.isLinked()})}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;v.pushShader(E);v.currentTextureEffect.bind();if(u.get())S.setValue(v.currentTextureEffect.getWidth()/v.currentTextureEffect.getHeight());else S.setValue(1);v.setTexture(0,v.currentTextureEffect.getCurrentSourceTexture().tex);if(g.get())v.setTexture(1,g.get().tex);if(n.get())v.setTexture(2,n.get().tex);v.currentTextureEffect.finish();v.popShader();h.trigger()}}};Ops.Devices.Keyboard.KeyPressLearn=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const n=i.inValueInt("key code"),t=i.inValueBool("canvas only",true),r=i.inValueSelect("Mod Key",["none","alt"],"none"),a=i.inValueBool("Enabled",true),s=i.inValueBool("Prevent Default"),o=i.inTriggerButton("learn"),l=i.outTrigger("on press"),u=i.outTrigger("on release"),h=i.outBoolNum("Pressed",false),c=i.outString("Key");const f=i.patch.cgl;let d=false;let g=null;r.onChange=n.onChange=F;v();function p(e){if(d){n.set(e.keyCode);if(CABLES.UI){if(g)g.close();i.refreshParams()}d=false;b();_();if(CABLES.UI)gui.emitEvent("portValueEdited",i,n,n.get())}else{if(e.keyCode==n.get()){if(r.get()=="alt"){if(e.altKey===true){l.trigger();h.set(true);if(s.get())e.preventDefault()}}else{l.trigger();h.set(true);if(s.get())e.preventDefault()}}}}function m(t){if(t.keyCode==n.get()){let e=true;if(r.get()=="alt"&&t.altKey!=true)e=false;if(e){u.trigger();h.set(false)}}}i.onDelete=function(){f.canvas.removeEventListener("keyup",m,false);f.canvas.removeEventListener("keydown",p,false);document.removeEventListener("keyup",m,false);document.removeEventListener("keydown",p,false)};o.onTriggered=function(){if(!CABLES.UI)return;d=true;E();g=new CABLES.UI.ModalDialog({title:"Learn Key...",text:"Just press any key"});g.on("close",()=>{d=false;b();_();g=null})};function _(){if(t.get())v();else E()}function b(){document.removeEventListener("keydown",p,false);document.removeEventListener("keyup",m,false);f.canvas.removeEventListener("keydown",p,false);f.canvas.removeEventListener("keyup",m,false);h.set(false)}function v(){if(!CABLES.isNumeric(f.canvas.getAttribute("tabindex")))f.canvas.setAttribute("tabindex",1);f.canvas.addEventListener("keydown",p,false);f.canvas.addEventListener("keyup",m,false)}function E(){document.addEventListener("keydown",p,false);document.addEventListener("keyup",m,false)}a.onChange=function(){if(!a.get()){b()}else{_()}};t.onChange=function(){b();_()};function F(){let e=A(n.get());const t=r.get();if(t&&t!=="none"){e=t.charAt(0).toUpperCase()+t.slice(1)+"-"+e}i.setUiAttribs({extendTitle:e});c.set(e)}function A(e){if(!e&&e!==0)return"Unidentified";const t={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};if(t[e]){return t[e]}else{return String.fromCharCode(e)}}}};Ops.Boolean.ToggleBool=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("trigger"),n=e.inTriggerButton("reset"),r=e.outBool("result"),a=e.inBool("Default",false);let s=false;r.set(s);r.ignoreValueSerialize=true;i.onTriggered=function(){s=!s;r.set(s)};n.onTriggered=function(){s=a.get();r.set(s)}}};Ops.Boolean.Not=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inBool("Boolean"),n=e.outBoolNum("Result");i.changeAlways=true;i.onChange=function(){n.set(!i.get())}}};Ops.Gl.CanvasInfo=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.outNumber("width"),n=t.outNumber("height"),r=t.inSwitch("Pixel Unit",["Display","CSS"],"Display"),a=t.outNumber("Pixel Ratio"),s=t.outNumber("Aspect Ratio"),o=t.outBool("Landscape"),l=t.outObject("Canvas","element"),u=t.outObject("Canvas Parent","element");let h=t.patch.cgl;l.set(t.patch.cgl.canvas);u.set(t.patch.cgl.canvas.parentElement);h.on("resize",c);r.onChange=c;c();function c(){let e=1;if(r.get()=="CSS")e=t.patch.cgl.pixelDensity;n.set(h.canvasHeight/e);i.set(h.canvasWidth/e);a.set(t.patch.cgl.pixelDensity);s.set(h.canvasWidth/h.canvasHeight);o.set(h.canvasWidth>h.canvasHeight?1:0)}}};Ops.Gl.ImageCompose.Waveform_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={wave_v2_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D tex1;\nUNI float amount;\n\nUNI float r;\nUNI float g;\nUNI float b;\n\nUNI float uAmp;\nUNI float uFreq;\nUNI float uWidth;\nUNI float uGlow;\nUNI float uWaveSelect;\nUNI bool uInvert;\nUNI bool uSolid;\n\nUNI float uOffSetX;\nUNI float uOffSetY;\nUNI float uRotate;\n\n{{CGL.BLENDMODES}}\n\n#define PI 3.14159265359\n#define TAU (2.0*PI)\n\nfloat vmax(vec2 v)\n{\n\treturn max(v.x, v.y);\n}\n\nvoid pR(inout vec2 p, float a)\n{\n    float s = sin(a),c=cos(a); p *= mat2(c,s,-s,c);\n}\n\nfloat pMod1(inout float p, float size)\n{\n\tfloat halfsize = size * 0.5;\n\tfloat c = floor((p + halfsize) / size);\n\tp = mod(p + halfsize, size) - halfsize;\n\treturn c;\n}\n\nfloat pModMirror1(inout float p, float size)\n{\n\tfloat halfsize = size * 0.5;\n\tfloat c = floor((p + halfsize) / size);\n\tp = mod(p + halfsize,size) - halfsize;\n\tp *= mod(c, 2.0) * 2.0 - 1.0;\n\treturn c;\n}\n\nfloat fCapsule2D(vec2 p, float r, float c)\n{\n\treturn mix(abs(p.x) - r, length(vec2(p.x, abs(p.y) - c)) - r, step(c, abs(p.y)));\n}\n\nfloat SineWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float v = sin(p.x * frequency * PI);\n    v *= amplitude;\n\n    float d = 0.0;\n\n    if (solid == false)\n    {\n        d = abs(v * amplitude - p.y * 0.5);\n        d -= line_width;\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n    {\n        d = v * amplitude - p.y * 0.5;\n        d -= -line_width;\n        return smoothstep(0.0, line_glow, -d);\n    }\n}\n\nfloat SawWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 2.0 / frequency;\n    vec2 p1 = p;\n    pMod1(p1.x, inverse_frequency);\n\n    float d1 = fCapsule2D(p1, 0.0, amplitude);\n    p.x += inverse_frequency * 0.5;\n    pMod1(p.x, inverse_frequency);\n    pR(p, atan(inverse_frequency, amplitude * 2.0));\n\n    float d = fCapsule2D(p, 0.0, 0.5 * length(vec2(inverse_frequency, 2.0 * amplitude)));\n\td = min(d, d1);\n    d -= line_width;\n\n    if(solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, min(d,p.x));\n}\n\nfloat TriangleWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 1.0 / frequency;\n    p.x -= inverse_frequency;\n    pModMirror1(p.x, inverse_frequency);\n    pR(p, atan(inverse_frequency, amplitude * 2.0));\n\n    float d = fCapsule2D(p, 0.0, 0.5 * length(vec2(inverse_frequency, 2.0 * amplitude)));\n    d -= line_width;\n\n    if (solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, min(d,p.x));\n}\n\nfloat SquareWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 0.5 / frequency;\n    vec2 p1 = p;\n    pMod1(p1.x, 2.0 * inverse_frequency);\n\n    float d1 = fCapsule2D(p1, 0.0, abs(amplitude));\n    p.x -= inverse_frequency * 0.5;\n    float cell = pMod1(p.x, inverse_frequency);\n\n    if(cell < 0.0) cell = -cell + 1.0;\n    if(int(cell * 0.5) % 2 == 1) p.y -= amplitude;\n        else p.y += amplitude;\n\n    float d = fCapsule2D(p.yx, 0.0, abs(inverse_frequency));\n    d = min(d, d1);\n    d -= line_width;\n\n    if (solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, p.y);\n}\n\nvoid main()\n{\n    vec4 rgb = vec4(r,g,b,1.0);\n\tvec2 uv = texCoord;\n\n    uv -= 0.5;\n    pR(uv.xy,uRotate * TAU);\n    uv += 0.5;\n\n    float wave = 0.0;\n    #ifdef SINE\n        wave = 1.0 - SineWave     (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq , uWidth, uGlow, uSolid);\n    #endif\n    #ifdef SAWTOOTH\n        wave = 1.0 - SawWave      (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n    #ifdef TRIANGLE\n        wave = 1.0 - TriangleWave (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n    #ifdef SQUARE\n        wave = 1.0 - SquareWave   (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n\n    #ifdef INVERT\n        wave = 1.0-wave;\n    #endif\n\n    vec4 col = vec4(r,g,b,1.0);\n\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,wave*amount);\n}\n"};const i=e.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.inValueSelect("Waveform",["Sine","Sawtooth","Triangle","Square"],"Sine"),s=e.inValueSlider("Amplitude",.5),o=e.inFloat("Frequency",2),l=e.inValueSlider("Line Width",.1),u=e.inValueSlider("Line Glow",.1),h=e.inValueBool("invert color",false),c=e.inValueBool("Solid fill",false),f=e.inValueSlider("Offset X",0),d=e.inValueSlider("Offset Y",.5),g=e.inValueSlider("Rotate",0),p=e.inValueSlider("r",1),m=e.inValueSlider("g",1),_=e.inValueSlider("b",1);const b=e.outTrigger("trigger");p.setUiAttribs({colorPick:true});const v=e.patch.cgl;const E=new CGL.Shader(v,e.name,e);E.setSource(E.getDefaultVertexShader(),t.wave_v2_frag);const F=new CGL.Uniform(E,"t","tex",0);const A=new CGL.Uniform(E,"f","amount",r);const C=new CGL.Uniform(E,"f","r",p);const x=new CGL.Uniform(E,"f","g",m);const T=new CGL.Uniform(E,"f","b",_);const B=new CGL.Uniform(E,"f","uAmp",s);const I=new CGL.Uniform(E,"f","uFreq",o);const D=new CGL.Uniform(E,"f","uWidth",l);const S=new CGL.Uniform(E,"f","uGlow",u);const O=new CGL.Uniform(E,"f","uWaveSelect",1);const y=new CGL.Uniform(E,"b","uInvert",h);const w=new CGL.Uniform(E,"b","uSolid",c);const N=new CGL.Uniform(E,"f","uOffSetX",f);const L=new CGL.Uniform(E,"f","uOffSetY",d);const R=new CGL.Uniform(E,"f","uRotate",g);a.onChange=h.onChange=M;M();function M(){E.toggleDefine("SINE",a.get()=="Sine");E.toggleDefine("SAWTOOTH",a.get()=="Sawtooth");E.toggleDefine("TRIANGLE",a.get()=="Triangle");E.toggleDefine("SQUARE",a.get()=="Square");E.toggleDefine("INVERT",h.get()==true)}CGL.TextureEffect.setupBlending(e,E,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;v.pushShader(E);v.currentTextureEffect.bind();v.setTexture(0,v.currentTextureEffect.getCurrentSourceTexture().tex);v.currentTextureEffect.finish();v.popShader();b.trigger()}}};Ops.Array.Array3GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array",3),n=e.inValueInt("Index"),r=e.outNumber("X"),a=e.outNumber("Y"),s=e.outNumber("Z");e.toWorkPortsNeedToBeLinked(i);i.onChange=n.onChange=o;function o(){let e=i.get();if(!e){r.set(0);a.set(0);s.set(0);return}let t=Math.min(e.length-3,n.get()*3);if(e){r.set(e[t+0]);a.set(e[t+1]);s.set(e[t+2])}}}};Ops.Gl.ImageCompose.Noise.FBMNoise=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={fbmnoise_frag:"UNI sampler2D tex;\nUNI float anim;\n\nUNI float scale;\nUNI float repeat;\n\nUNI float scrollX;\nUNI float scrollY;\n\nUNI float amount;\n\nUNI bool layer1;\nUNI bool layer2;\nUNI bool layer3;\nUNI bool layer4;\nUNI vec3 color;\nUNI float aspect;\n\nIN vec2 texCoord;\n\n\n{{CGL.BLENDMODES}}\n\n// adapted from warp shader by inigo quilez/iq\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n// See here for a tutorial on how to make this: http://www.iquilezles.org/www/articles/warp/warp.htm\n\nconst mat2 m = mat2( 0.80,  0.60, -0.60,  0.80 );\n\nfloat noise( in vec2 x )\n{\n\treturn sin(1.5*x.x)*sin(1.5*x.y);\n}\n\nfloat fbm4( vec2 p )\n{\n    float f = 0.0;\n    f += 0.5000*noise( p ); p = m*p*2.02;\n    f += 0.2500*noise( p ); p = m*p*2.03;\n    f += 0.1250*noise( p ); p = m*p*2.01;\n    f += 0.0625*noise( p );\n    return f/0.9375;\n}\n\nfloat fbm6( vec2 p )\n{\n    float f = 0.0;\n    f += 0.500000*(0.5+0.5*noise( p )); p = m*p*2.02;\n    f += 0.250000*(0.5+0.5*noise( p )); p = m*p*2.03;\n    f += 0.125000*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.062500*(0.5+0.5*noise( p )); p = m*p*2.04;\n    f += 0.031250*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.015625*(0.5+0.5*noise( p ));\n    return f/0.96875;\n}\n\nvoid main()\n{\n    // vec4 col=texture(tex,texCoord+2.0*fbm4(texCoord+2.0*fbm6(texCoord+anim)));\n\n    vec2 tc=texCoord;\n\t#ifdef DO_TILEABLE\n\t    tc=abs(texCoord-0.5);\n\t#endif\n\n\n    vec2 p=(tc-0.5)*scale;\n\n\n    p.y/=aspect;\n    vec2 q = vec2( fbm4( p + vec2(0.3+scrollX,0.20+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q2 = vec2( fbm4( p + vec2(2.0+scrollX,1.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q3 = vec2( fbm4( p + vec2(9.0+scrollX,4.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,4.3+scrollY) ) );\n\n\n\n    float v= fbm4( ( p + 4.0*q +anim*0.1)*repeat);\n    float v2= fbm4( (p + 4.0*q2 +anim*0.1)*repeat );\n\n    float v3= fbm6( (p + 4.0*q3 +anim*0.1)*repeat );\n    float v4= fbm6( (p + 4.0*q2 +anim*0.1)*repeat );\n\n\n\n\n    vec4 base=texture(tex,texCoord);\n\n    vec4 finalColor;\n    float colVal=0.0;\n    float numLayers=0.0;\n\n    if(layer1)\n    {\n        colVal+=v;\n        numLayers++;\n    }\n\n    if(layer2)\n    {\n        colVal+=v2;\n        numLayers++;\n    }\n\n    if(layer3)\n    {\n        colVal+=v3;\n        numLayers++;\n    }\n\n    if(layer4)\n    {\n        colVal+=v4;\n        numLayers++;\n    }\n\n    finalColor=vec4( color*vec3(colVal/numLayers),1.0);\n\n    outColor = cgl_blend(base,finalColor,amount);;\n}\n"};const i=e.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.inValueSlider("r",1),s=e.inValueSlider("g",1),o=e.inValueSlider("b",1),l=e.outTrigger("trigger");a.setUiAttribs({colorPick:true});const u=e.patch.cgl;const h=new CGL.Shader(u,"fbmnoise");h.setSource(h.getDefaultVertexShader(),t.fbmnoise_frag);const c=new CGL.Uniform(h,"t","tex",0);const f=new CGL.Uniform(h,"f","scale",e.inValue("scale",2));const d=new CGL.Uniform(h,"f","anim",e.inValue("anim",0));const g=new CGL.Uniform(h,"f","scrollX",e.inValue("scrollX",9));const p=new CGL.Uniform(h,"f","scrollY",e.inValue("scrollY",0));const m=new CGL.Uniform(h,"f","repeat",e.inValue("repeat",1));const _=new CGL.Uniform(h,"f","aspect",e.inValue("aspect",1));const b=new CGL.Uniform(h,"b","layer1",e.inValueBool("Layer 1",true));const v=new CGL.Uniform(h,"b","layer2",e.inValueBool("Layer 2",true));const E=new CGL.Uniform(h,"b","layer3",e.inValueBool("Layer 3",true));const F=new CGL.Uniform(h,"b","layer4",e.inValueBool("Layer 4",true));const A=new CGL.Uniform(h,"3f","color",a,s,o);const C=new CGL.Uniform(h,"f","amount",r);const x=e.inValueBool("Tileable",false);x.onChange=T;function T(){if(x.get())h.define("DO_TILEABLE");else h.removeDefine("DO_TILEABLE")}CGL.TextureEffect.setupBlending(e,h,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;u.pushShader(h);u.currentTextureEffect.bind();_.set(u.currentTextureEffect.getCurrentSourceTexture().width/u.currentTextureEffect.getCurrentSourceTexture().height);u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};Ops.Gl.ImageCompose.EdgeDetection_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={edgedetect_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float width;\nUNI float strength;\nUNI float texWidth;\nUNI float texHeight;\nUNI float mulColor;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvec3 desaturate(vec3 color)\n{\n    return vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n}\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    // vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    // float pixelX=0.27/texWidth;\n    // float pixelY=0.27/texHeight;\n    float pixelX=(width+0.01)*4.0/texWidth;\n    float pixelY=(width+0.01)*4.0/texHeight;\n\nvec2 tc=texCoord;\n// #ifdef OFFSETPIXEL\n    tc.x+=1.0/texWidth*0.5;\n    tc.y+=1.0/texHeight*0.5;\n// #endif\n    // col=texture(tex,texCoord);\n\n    float count=1.0;\n\n\tvec4 horizEdge = vec4( 0.0 );\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y     ) ) * 2.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y     ) ) * 2.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\tvec4 vertEdge = vec4( 0.0 );\n\tvertEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge -= texture( tex, vec2( tc.x    , tc.y - pixelY ) ) * 2.0;\n\tvertEdge -= texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x    , tc.y + pixelY ) ) * 2.0;\n\tvertEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\n\n\tvec3 edge = sqrt((horizEdge.rgb/count * horizEdge.rgb/count) + (vertEdge.rgb/count * vertEdge.rgb/count));\n\n    edge=desaturate(edge);\n    edge*=strength;\n\n    if(mulColor>0.0) edge*=texture( tex, texCoord ).rgb*mulColor*4.0;\n    edge=max(min(edge,1.0),0.0);\n\n    //blend section\n    vec4 col=vec4(edge,1.0);\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,amount);\n}\n\n"};const i=e.inTrigger("Render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),a=e.inFloat("Strength",4),s=e.inValueSlider("Width",.1),o=e.inValueSlider("Mul Color",0),l=e.outTrigger("Trigger");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);h.setSource(h.getDefaultVertexShader(),t.edgedetect_frag);const c=new CGL.Uniform(h,"t","tex",0),f=new CGL.Uniform(h,"f","amount",r),d=new CGL.Uniform(h,"f","strength",a),g=new CGL.Uniform(h,"f","width",s),p=new CGL.Uniform(h,"f","texWidth",128),m=new CGL.Uniform(h,"f","texHeight",128),_=new CGL.Uniform(h,"f","mulColor",o);CGL.TextureEffect.setupBlending(e,h,n,r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);p.setValue(u.currentTextureEffect.getCurrentSourceTexture().width);m.setValue(u.currentTextureEffect.getCurrentSourceTexture().height);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};Ops.Gl.ImageCompose.Vibrance=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={vibrance_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n   col=texture(tex,texCoord);\n\n   float luma = dot(col, lumcoeff);\n   vec4 mask = (col - vec4(luma));\n   mask = clamp(mask, 0.0, 1.0);\n   float lumaMask = dot(lumcoeff, mask);\n   lumaMask = 1.0 - lumaMask;\n   vec4 vibrance = mix(vec4(luma), col, 1.0 + amount * lumaMask);\n   outColor= vibrance;\n}"};const i=e.inTrigger("Render");const n=e.outTrigger("Trigger");const r=e.inValue("amount",2);const a=e.patch.cgl;const s=new CGL.Shader(a,e.name,e);s.setSource(s.getDefaultVertexShader(),t.vibrance_frag);const o=new CGL.Uniform(s,"t","tex",0);const l=new CGL.Uniform(s,"f","amount",r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;a.pushShader(s);a.currentTextureEffect.bind();a.setTexture(0,a.currentTextureEffect.getCurrentSourceTexture().tex);a.currentTextureEffect.finish();a.popShader();n.trigger()}}};Ops.Gl.ImageCompose.Invert=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={invert_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D texMask;\nUNI float amount;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n   col=texture(tex,texCoord);\n\n    #ifdef USE_MASK\n        #ifdef MASK_INVERT\n            if(texture(texMask,texCoord).r>0.5)\n            {\n                outColor= col;\n                return;\n            }\n        #endif\n\n        #ifndef MASK_INVERT\n            if(texture(texMask,texCoord).r<0.5)\n            {\n                outColor= col;\n                return;\n            }\n        #endif\n    #endif\n\n   vec4 invert = vec4(vec3(1.0)-col.rgb,1.0);\n\n   outColor=cgl_blend(col,invert,amount);\n}\n"};const i=e.inTrigger("render");const n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const r=e.inBool("Mask Invert",false);const a=e.inTexture("Mask");const s=e.inValueSlider("Amount",1);const o=e.outTrigger("trigger");const l=e.patch.cgl;const u=new CGL.Shader(l,e.name,e);u.setSource(u.getDefaultVertexShader(),t.invert_frag);const h=new CGL.Uniform(u,"t","tex",0),c=new CGL.Uniform(u,"f","amount",s),f=new CGL.Uniform(u,"t","texMask",1);CGL.TextureEffect.setupBlending(e,u,n,s);r.onChange=a.onChange=()=>{u.toggleDefine("USE_MASK",a.isLinked());u.toggleDefine("MASK_INVERT",r.get())};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;l.pushShader(u);l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);if(a.get())l.setTexture(1,a.get().tex);l.currentTextureEffect.finish();l.popShader();o.trigger()}}};Ops.Array.ArrayFromNumbers=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Update"),n=t.inInt("Limit",30),r=t.inBool("Slider",false),a=t.outTrigger("Next"),s=t.outArray("Array");const o=[];for(let e=0;e<30;e++){const c=t.inFloat("Index "+e,0);o.push(c)}const l=[];let u=null;i.onTriggered=h;r.onChange=()=>{const e=n.get();for(let e=0;e<o.length;e++)if(r.get())o[e].setUiAttribs({display:"range"});else o[e].setUiAttribs({display:null});t.refreshParams()};n.onChange=()=>{clearTimeout(u);u=setTimeout(()=>{const t=n.get();for(let e=0;e<o.length;e++){o[e].setUiAttribs({greyout:e>=t})}},300)};function h(){const t=Math.max(0,Math.ceil(Math.min(n.get(),o.length)));l.length=t;for(let e=0;e<t;e++){l[e]=o[e].get()}s.set(null);s.set(l);a.trigger()}}};Ops.Trigger.TriggerButton=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Trigger"),n=e.outTrigger("Next");i.onTriggered=function(){n.trigger()}}};Ops.Array.FreezeArray=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Number"),n=e.inTriggerButton("Button"),r=e.inString("storedJson"),a=e.outArray("Frozen Array");n.onTriggered=r.onTriggered=o;r.setUiAttribs({hideParam:true,hidePort:true,ignoreBigPort:true});let s=false;i.onChange=()=>{s=true};function o(){if(s){s=false;if(i.get())r.set(JSON.stringify(i.get()));else r.set("")}}a.onLinkChanged=()=>{if(r.get())a.setRef(JSON.parse(r.get()))};r.onChange=()=>{r.get();try{a.setRef(JSON.parse(r.get()))}catch(e){}}}};Ops.Ui.Comment_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("title","New comment"),n=e.inTextarea("text");i.setUiAttribs({hidePort:true});n.setUiAttribs({hidePort:true});e.init=i.onChange=n.onChange=e.onLoaded=r;r();function r(){if(CABLES.UI){e.uiAttr({comment_title:i.get(),comment_text:n.get(),extendTitle:i.get()})}}}};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});window.Whammy=function(){function n(t,i){const e=p(t);const n=3e4;const r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:v(e.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:e.width,id:176},{data:e.height,id:186}]}]}]},{id:475249515,data:[]}]}];const a=r[1];const s=a.data[2];let o=0;let l=0;while(o<t.length){const c={id:187,data:[{data:Math.round(l),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};s.data.push(c);const f=[];let e=0;do{f.push(t[o]);e+=t[o].duration;o++}while(o<t.length&&e<n);var u=0;const d={id:524531317,data:[{data:Math.round(l),id:231}].concat(f.map(function(e){const t=b({discardable:0,frame:e.data.slice(e.data.indexOf("*")-3),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(u)});u+=e.duration;return{data:t,id:163}}))};a.data.push(d);l+=e}let h=0;for(let e=0;e<a.data.length;e++){if(e>=3){s.data[e-3].data[1].data[1].data=h}const g=m([a.data[e]],i);h+=g.size||g.byteLength||g.length;if(e!=2){a.data[e]=g}}return m(r,i)}function p(t){let i=t[0].width,n=t[0].height,r=t[0].duration;for(let e=1;e<t.length;e++){if(t[e].width!=i)throw"Frame "+(e+1)+" has a different width";if(t[e].height!=n)throw"Frame "+(e+1)+" has a different height";if(t[e].duration<0||t[e].duration>32767)throw"Frame "+(e+1)+" has a weird duration (must be between 0 and 32767)";r+=t[e].duration}return{duration:r,width:i,height:n}}function c(e){const t=[];while(e>0){t.push(e&255);e>>=8}return new Uint8Array(t.reverse())}function f(t,i){const n=new Uint8Array(i);for(let e=i-1;e>=0;e--){n[e]=t&255;t>>=8}return n}function d(t){const i=new Uint8Array(t.length);for(let e=0;e<t.length;e++){i[e]=t.charCodeAt(e)}return i}function g(t){const i=[];const e=t.length%8?new Array(1+8-t.length%8).join("0"):"";t=e+t;for(let e=0;e<t.length;e+=8){i.push(parseInt(t.substr(e,8),2))}return new Uint8Array(i)}function m(i,n){const r=[];for(let t=0;t<i.length;t++){if(!("id"in i[t])){r.push(i[t]);continue}let e=i[t].data;if(typeof e=="object")e=m(e,n);if(typeof e=="number")e="size"in i[t]?f(e,i[t].size):g(e.toString(2));if(typeof e=="string")e=d(e);if(e.length){var a=a}const s=e.size||e.byteLength||e.length;const o=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8);const l=s.toString(2);const u=new Array(o*7+7+1-l.length).join("0")+l;const h=new Array(o).join("0")+"1"+u;r.push(c(i[t].id));r.push(g(h));r.push(e)}if(n){const e=_(r);return new Uint8Array(e)}else{return new Blob(r,{type:"video/webm"})}}function _(t,i){if(i==null){i=[]}for(let e=0;e<t.length;e++){if(typeof t[e]=="object"){_(t[e],i)}else{i.push(t[e])}}return i}function u(t){let i="";const e=t.length%8?new Array(1+8-t.length%8).join("0"):"";t=e+t;for(let e=0;e<t.length;e+=8){i+=String.fromCharCode(parseInt(t.substr(e,8),2))}return i}function h(i){let n="";for(let t=0;t<i.length;t++){let e=i[t].data;if(typeof e=="object")e=h(e);if(typeof e=="number")e=u(e.toString(2));const r=e.length;const a=Math.ceil(Math.ceil(Math.log(r)/Math.log(2))/8);const s=r.toString(2);const o=new Array(a*7+7+1-s.length).join("0")+s;const l=new Array(a).join("0")+"1"+o;n+=u(i[t].id.toString(2))+u(l)+e}return n}function b(e){let t=0;if(e.keyframe)t|=128;if(e.invisible)t|=8;if(e.lacing)t|=e.lacing<<1;if(e.discardable)t|=1;if(e.trackNum>127){throw"TrackNumber > 127 not supported"}const i=[e.trackNum|128,e.timecode>>8,e.timecode&255,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame;return i}function r(e){const t=e.RIFF[0].WEBP[0];const i=t.indexOf("*");for(var n=0,r=[];n<4;n++)r[n]=t.charCodeAt(i+3+n);let a,s,o,l,u;u=r[1]<<8|r[0];a=u&16383;s=u>>14;u=r[3]<<8|r[2];o=u&16383;l=u>>14;return{width:a,height:o,data:t,riff:e}}function s(e){let t=0;const i={};while(t<e.length){const n=e.substr(t,4);i[n]=i[n]||[];if(n=="RIFF"||n=="LIST"){const r=parseInt(e.substr(t+4,4).split("").map(function(e){const t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2);const a=e.substr(t+4+4,r);t+=4+4+r;i[n].push(s(a))}else if(n=="WEBP"){i[n].push(e.substr(t+8));t=e.length}else{i[n].push(e.substr(t+4));t=e.length}}return i}function v(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}function e(e,t){this.frames=[];this.duration=1e3/e;this.quality=t||.8}e.prototype.add=function(e,t){if(typeof t!="undefined"&&this.duration)throw"you can't pass a duration if the fps is set";if(typeof t=="undefined"&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(e.canvas){e=e.canvas}if(e.toDataURL){e=e.getContext("2d").getImageData(0,0,e.width,e.height)}else if(typeof e!="string"){throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string"}if(typeof e==="string"&&!/^data:image\/webp;base64,/gi.test(e)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:e,duration:t||this.duration})};e.prototype.encodeFrames=function(i){if(this.frames[0].image instanceof ImageData){const r=this.frames;const a=document.createElement("canvas");const s=a.getContext("2d");a.width=this.frames[0].image.width;a.height=this.frames[0].image.height;var n=function(e){console.log("encodeFrame",e);const t=r[e];s.putImageData(t.image,0,0);t.image=a.toDataURL("image/webp",this.quality);if(e<r.length-1){setTimeout(function(){n(e+1)},1)}else{i()}}.bind(this);n(0)}else{i()}};e.prototype.compile=function(t,i){this.encodeFrames(function(){const e=new n(this.frames.map(function(e){const t=r(s(atob(e.image.slice(23))));t.duration=e.duration;return t}),t);i(e)}.bind(this))};return{Video:e,fromImageArray:function(e,i,t){return n(e.map(function(e){const t=r(s(atob(e.slice(23))));t.duration=1e3/i;return t}),t)},toWebM:n}}();(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.JSZip=e()}})(function(){var e,t,i;return function a(s,o,l){function u(i,e){if(!o[i]){if(!s[i]){var t=typeof require=="function"&&require;if(!e&&t)return t(i,!0);if(h)return h(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=o[i]={exports:{}};s[i][0].call(r.exports,function(e){var t=s[i][1][e];return u(t?t:e)},r,r.exports,a,s,o,l)}return o[i].exports}var h=typeof require=="function"&&require;for(var e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,i){"use strict";var d=e("./utils");var g=e("./support");var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){var t=[];var i,n,r,a,s,o,l;var u=0,h=e.length,c=h;var f=d.getTypeOf(e)!=="string";while(u<e.length){c=h-u;if(!f){i=e.charCodeAt(u++);n=u<h?e.charCodeAt(u++):0;r=u<h?e.charCodeAt(u++):0}else{i=e[u++];n=u<h?e[u++]:0;r=u<h?e[u++]:0}a=i>>2;s=(i&3)<<4|n>>4;o=c>1?(n&15)<<2|r>>6:64;l=c>2?r&63:64;t.push(p.charAt(a)+p.charAt(s)+p.charAt(o)+p.charAt(l))}return t.join("")};i.decode=function(e){var t,i,n;var r,a,s,o;var l=0,u=0;var h="data:";if(e.substr(0,h.length)===h){throw new Error("Invalid base64 input, it looks like a data url.")}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var c=e.length*3/4;if(e.charAt(e.length-1)===p.charAt(64)){c--}if(e.charAt(e.length-2)===p.charAt(64)){c--}if(c%1!==0){throw new Error("Invalid base64 input, bad content length.")}var f;if(g.uint8array){f=new Uint8Array(c|0)}else{f=new Array(c|0)}while(l<e.length){r=p.indexOf(e.charAt(l++));a=p.indexOf(e.charAt(l++));s=p.indexOf(e.charAt(l++));o=p.indexOf(e.charAt(l++));t=r<<2|a>>4;i=(a&15)<<4|s>>2;n=(s&3)<<6|o;f[u++]=t;if(s!==64){f[u++]=i}if(o!==64){f[u++]=n}}return f}},{"./support":30,"./utils":32}],2:[function(e,t,i){"use strict";var n=e("./external");var r=e("./stream/DataWorker");var a=e("./stream/DataLengthProbe");var s=e("./stream/Crc32Probe");var a=e("./stream/DataLengthProbe");function o(e,t,i,n,r){this.compressedSize=e;this.uncompressedSize=t;this.crc32=i;this.compression=n;this.compressedContent=r}o.prototype={getContentWorker:function(){var e=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length"));var t=this;e.on("end",function(){if(this.streamInfo["data_length"]!==t.uncompressedSize){throw new Error("Bug : uncompressed data size mismatch")}});return e},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};o.createWorkerFrom=function(e,t,i){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new a("compressedSize")).withStreamInfo("compression",t)};t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,i){"use strict";var n=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(e){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}};i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,i){"use strict";var r=e("./utils");function n(){var e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++){e=e&1?3988292384^e>>>1:e>>>1}t[i]=e}return t}var o=n();function a(e,t,i,n){var r=o,a=n+i;e=e^-1;for(var s=n;s<a;s++){e=e>>>8^r[(e^t[s])&255]}return e^-1}function s(e,t,i,n){var r=o,a=n+i;e=e^-1;for(var s=n;s<a;s++){e=e>>>8^r[(e^t.charCodeAt(s))&255]}return e^-1}t.exports=function e(t,i){if(typeof t==="undefined"||!t.length){return 0}var n=r.getTypeOf(t)!=="string";if(n){return a(i|0,t,t.length,0)}else{return s(i|0,t,t.length,0)}}},{"./utils":32}],5:[function(e,t,i){"use strict";i.base64=false;i.binary=false;i.dir=false;i.createFolders=true;i.date=null;i.compression=null;i.compressionOptions=null;i.comment=null;i.unixPermissions=null;i.dosPermissions=null},{}],6:[function(e,t,i){"use strict";var n=null;if(typeof Promise!=="undefined"){n=Promise}else{n=e("lie")}t.exports={Promise:n}},{lie:37}],7:[function(e,t,i){"use strict";var n=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var r=e("pako");var a=e("./utils");var s=e("./stream/GenericWorker");var o=n?"uint8array":"array";i.magic="\b\0";function l(e,t){s.call(this,"FlateWorker/"+e);this._pako=null;this._pakoAction=e;this._pakoOptions=t;this.meta={}}a.inherits(l,s);l.prototype.processChunk=function(e){this.meta=e.meta;if(this._pako===null){this._createPako()}this._pako.push(a.transformTo(o,e.data),false)};l.prototype.flush=function(){s.prototype.flush.call(this);if(this._pako===null){this._createPako()}this._pako.push([],true)};l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this);this._pako=null};l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:true,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}};i.compressWorker=function(e){return new l("Deflate",e)};i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,i){"use strict";var O=e("../utils");var r=e("../stream/GenericWorker");var y=e("../utf8");var w=e("../crc32");var N=e("../signature");var M=function(e,t){var i="",n;for(n=0;n<t;n++){i+=String.fromCharCode(e&255);e=e>>>8}return i};var L=function(e,t){var i=e;if(!e){i=t?16893:33204}return(i&65535)<<16};var R=function(e,t){return(e||0)&63};var n=function(e,t,i,n,r,a){var s=e["file"],o=e["compression"],l=a!==y.utf8encode,u=O.transformTo("string",a(s.name)),h=O.transformTo("string",y.utf8encode(s.name)),c=s.comment,f=O.transformTo("string",a(c)),d=O.transformTo("string",y.utf8encode(c)),g=h.length!==s.name.length,p=d.length!==c.length,m,_,b="",v="",E="",F=s.dir,A=s.date;var C={crc32:0,compressedSize:0,uncompressedSize:0};if(!t||i){C.crc32=e["crc32"];C.compressedSize=e["compressedSize"];C.uncompressedSize=e["uncompressedSize"]}var x=0;if(t){x|=8}if(!l&&(g||p)){x|=2048}var T=0;var B=0;if(F){T|=16}if(r==="UNIX"){B=798;T|=L(s.unixPermissions,F)}else{B=20;T|=R(s.dosPermissions,F)}m=A.getUTCHours();m=m<<6;m=m|A.getUTCMinutes();m=m<<5;m=m|A.getUTCSeconds()/2;_=A.getUTCFullYear()-1980;_=_<<4;_=_|A.getUTCMonth()+1;_=_<<5;_=_|A.getUTCDate();if(g){v=M(1,1)+M(w(u),4)+h;b+="up"+M(v.length,2)+v}if(p){E=M(1,1)+M(w(f),4)+d;b+="uc"+M(E.length,2)+E}var I="";I+="\n\0";I+=M(x,2);I+=o.magic;I+=M(m,2);I+=M(_,2);I+=M(C.crc32,4);I+=M(C.compressedSize,4);I+=M(C.uncompressedSize,4);I+=M(u.length,2);I+=M(b.length,2);var D=N.LOCAL_FILE_HEADER+I+u+b;var S=N.CENTRAL_FILE_HEADER+M(B,2)+I+M(f.length,2)+"\0\0"+"\0\0"+M(T,4)+M(n,4)+u+b+f;return{fileRecord:D,dirRecord:S}};var a=function(e,t,i,n,r){var a="";var s=O.transformTo("string",r(n));a=N.CENTRAL_DIRECTORY_END+"\0\0"+"\0\0"+M(e,2)+M(e,2)+M(t,4)+M(i,4)+M(s.length,2)+s;return a};var s=function(e){var t="";t=N.DATA_DESCRIPTOR+M(e["crc32"],4)+M(e["compressedSize"],4)+M(e["uncompressedSize"],4);return t};function o(e,t,i,n){r.call(this,"ZipFileWorker");this.bytesWritten=0;this.zipComment=t;this.zipPlatform=i;this.encodeFileName=n;this.streamFiles=e;this.accumulate=false;this.contentBuffer=[];this.dirRecords=[];this.currentSourceOffset=0;this.entriesCount=0;this.currentFile=null;this._sources=[]}O.inherits(o,r);o.prototype.push=function(e){var t=e.meta.percent||0;var i=this.entriesCount;var n=this._sources.length;if(this.accumulate){this.contentBuffer.push(e)}else{this.bytesWritten+=e.data.length;r.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-n-1))/i:100}})}};o.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten;this.currentFile=e["file"].name;var t=this.streamFiles&&!e["file"].dir;if(t){var i=n(e,t,false,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else{this.accumulate=true}};o.prototype.closedSource=function(e){this.accumulate=false;var t=this.streamFiles&&!e["file"].dir;var i=n(e,t,true,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(i.dirRecord);if(t){this.push({data:s(e),meta:{percent:100}})}else{this.push({data:i.fileRecord,meta:{percent:0}});while(this.contentBuffer.length){this.push(this.contentBuffer.shift())}}this.currentFile=null};o.prototype.flush=function(){var e=this.bytesWritten;for(var t=0;t<this.dirRecords.length;t++){this.push({data:this.dirRecords[t],meta:{percent:100}})}var i=this.bytesWritten-e;var n=a(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})};o.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);if(this.isPaused){this.previous.pause()}else{this.previous.resume()}};o.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;e.on("data",function(e){t.processChunk(e)});e.on("end",function(){t.closedSource(t.previous.streamInfo);if(t._sources.length){t.prepareNextSource()}else{t.end()}});e.on("error",function(e){t.error(e)});return this};o.prototype.resume=function(){if(!r.prototype.resume.call(this)){return false}if(!this.previous&&this._sources.length){this.prepareNextSource();return true}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return true}};o.prototype.error=function(e){var t=this._sources;if(!r.prototype.error.call(this,e)){return false}for(var i=0;i<t.length;i++){try{t[i].error(e)}catch(e){}}return true};o.prototype.lock=function(){r.prototype.lock.call(this);var e=this._sources;for(var t=0;t<e.length;t++){e[t].lock()}};t.exports=o},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,i){"use strict";var r=e("../compressions");var n=e("./ZipFileWorker");var u=function(e,t){var i=e||t;var n=r[i];if(!n){throw new Error(i+" is not a valid compression method !")}return n};i.generateWorker=function(e,s,t){var o=new n(s.streamFiles,t,s.platform,s.encodeFileName);var l=0;try{e.forEach(function(e,t){l++;var i=u(t.options.compression,s.compression);var n=t.options.compressionOptions||s.compressionOptions||{};var r=t.dir,a=t.date;t._compressWorker(i,n).withStreamInfo("file",{name:e,dir:r,date:a,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)});o.entriesCount=l}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){"use strict";function n(){if(!(this instanceof n)){return new n}if(arguments.length){throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.")}this.files={};this.comment=null;this.root="";this.clone=function(){var e=new n;for(var t in this){if(typeof this[t]!=="function"){e[t]=this[t]}}return e}}n.prototype=e("./object");n.prototype.loadAsync=e("./load");n.support=e("./support");n.defaults=e("./defaults");n.version="3.5.0";n.loadAsync=function(e,t){return(new n).loadAsync(e,t)};n.external=e("./external");t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,i){"use strict";var n=e("./utils");var a=e("./external");var r=e("./utf8");var n=e("./utils");var l=e("./zipEntries");var s=e("./stream/Crc32Probe");var u=e("./nodejsUtils");function h(n){return new a.Promise(function(e,t){var i=n.decompressed.getContentWorker().pipe(new s);i.on("error",function(e){t(e)}).on("end",function(){if(i.streamInfo.crc32!==n.decompressed.crc32){t(new Error("Corrupted zip : CRC32 mismatch"))}else{e()}}).resume()})}t.exports=function(e,s){var o=this;s=n.extend(s||{},{base64:false,checkCRC32:false,optimizedBinaryString:false,createFolders:false,decodeFileName:r.utf8decode});if(u.isNode&&u.isStream(e)){return a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file."))}return n.prepareContent("the loaded zip file",e,true,s.optimizedBinaryString,s.base64).then(function(e){var t=new l(s);t.load(e);return t}).then(function e(t){var i=[a.Promise.resolve(t)];var n=t.files;if(s.checkCRC32){for(var r=0;r<n.length;r++){i.push(h(n[r]))}}return a.Promise.all(i)}).then(function e(t){var i=t.shift();var n=i.files;for(var r=0;r<n.length;r++){var a=n[r];o.file(a.fileNameStr,a.decompressed,{binary:true,optimizedBinaryString:true,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:s.createFolders})}if(i.zipComment.length){o.comment=i.zipComment}return o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,i){"use strict";var n=e("../utils");var r=e("../stream/GenericWorker");function a(e,t){r.call(this,"Nodejs stream input adapter for "+e);this._upstreamEnded=false;this._bindStream(t)}n.inherits(a,r);a.prototype._bindStream=function(e){var t=this;this._stream=e;e.pause();e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){if(t.isPaused){this.generatedError=e}else{t.error(e)}}).on("end",function(){if(t.isPaused){t._upstreamEnded=true}else{t.end()}})};a.prototype.pause=function(){if(!r.prototype.pause.call(this)){return false}this._stream.pause();return true};a.prototype.resume=function(){if(!r.prototype.resume.call(this)){return false}if(this._upstreamEnded){this.end()}else{this._stream.resume()}return true};t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,i){"use strict";var r=e("readable-stream").Readable;var n=e("../utils");n.inherits(a,r);function a(e,t,i){r.call(this,t);this._helper=e;var n=this;e.on("data",function(e,t){if(!n.push(e)){n._helper.pause()}if(i){i(t)}}).on("error",function(e){n.emit("error",e)}).on("end",function(){n.push(null)})}a.prototype._read=function(){this._helper.resume()};t.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,t,i){"use strict";t.exports={isNode:typeof Buffer!=="undefined",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from){return Buffer.from(e,t)}else{if(typeof e==="number"){throw new Error('The "data" argument must not be a number')}return new Buffer(e,t)}},allocBuffer:function(e){if(Buffer.alloc){return Buffer.alloc(e)}else{var t=new Buffer(e);t.fill(0);return t}},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on==="function"&&typeof e.pause==="function"&&typeof e.resume==="function"}}},{}],15:[function(e,t,i){"use strict";var r=e("./utf8");var h=e("./utils");var c=e("./stream/GenericWorker");var a=e("./stream/StreamHelper");var f=e("./defaults");var d=e("./compressedObject");var g=e("./zipObject");var s=e("./generate");var p=e("./nodejsUtils");var m=e("./nodejs/NodejsStreamInputAdapter");var o=function(e,t,i){var n=h.getTypeOf(t),r;var a=h.extend(i||{},f);a.date=a.date||new Date;if(a.compression!==null){a.compression=a.compression.toUpperCase()}if(typeof a.unixPermissions==="string"){a.unixPermissions=parseInt(a.unixPermissions,8)}if(a.unixPermissions&&a.unixPermissions&16384){a.dir=true}if(a.dosPermissions&&a.dosPermissions&16){a.dir=true}if(a.dir){e=b(e)}if(a.createFolders&&(r=_(e))){v.call(this,r,true)}var s=n==="string"&&a.binary===false&&a.base64===false;if(!i||typeof i.binary==="undefined"){a.binary=!s}var o=t instanceof d&&t.uncompressedSize===0;if(o||a.dir||!t||t.length===0){a.base64=false;a.binary=true;t="";a.compression="STORE";n="string"}var l=null;if(t instanceof d||t instanceof c){l=t}else if(p.isNode&&p.isStream(t)){l=new m(e,t)}else{l=h.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64)}var u=new g(e,l,a);this.files[e]=u};var _=function(e){if(e.slice(-1)==="/"){e=e.substring(0,e.length-1)}var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""};var b=function(e){if(e.slice(-1)!=="/"){e+="/"}return e};var v=function(e,t){t=typeof t!=="undefined"?t:f.createFolders;e=b(e);if(!this.files[e]){o.call(this,e,null,{dir:true,createFolders:t})}return this.files[e]};function l(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var n={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,n;for(t in this.files){if(!this.files.hasOwnProperty(t)){continue}n=this.files[t];i=t.slice(this.root.length,t.length);if(i&&t.slice(0,this.root.length)===this.root){e(i,n)}}},filter:function(i){var n=[];this.forEach(function(e,t){if(i(e,t)){n.push(t)}});return n},file:function(e,t,i){if(arguments.length===1){if(l(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}else{var r=this.files[this.root+e];if(r&&!r.dir){return r}else{return null}}}else{e=this.root+e;o.call(this,e,t,i)}return this},folder:function(i){if(!i){return this}if(l(i)){return this.filter(function(e,t){return t.dir&&i.test(e)})}var e=this.root+i;var t=v.call(this,e);var n=this.clone();n.root=t.name;return n},remove:function(i){i=this.root+i;var e=this.files[i];if(!e){if(i.slice(-1)!=="/"){i+="/"}e=this.files[i]}if(e&&!e.dir){delete this.files[i]}else{var t=this.filter(function(e,t){return t.name.slice(0,i.length)===i});for(var n=0;n<t.length;n++){delete this.files[t[n].name]}}return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,i={};try{i=h.extend(e||{},{streamFiles:false,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode});i.type=i.type.toLowerCase();i.compression=i.compression.toUpperCase();if(i.type==="binarystring"){i.type="string"}if(!i.type){throw new Error("No output type specified.")}h.checkSupport(i.type);if(i.platform==="darwin"||i.platform==="freebsd"||i.platform==="linux"||i.platform==="sunos"){i.platform="UNIX"}if(i.platform==="win32"){i.platform="DOS"}var n=i.comment||this.comment||"";t=s.generateWorker(this,i,n)}catch(e){t=new c("error");t.error(e)}return new a(t,i.type||"string",i.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){e=e||{};if(!e.type){e.type="nodebuffer"}return this.generateInternalStream(e).toNodejsStream(t)}};t.exports=n},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,i){t.exports=e("stream")},{stream:undefined}],17:[function(e,t,i){"use strict";var n=e("./DataReader");var r=e("../utils");function a(e){n.call(this,e);for(var t=0;t<this.data.length;t++){e[t]=e[t]&255}}r.inherits(a,n);a.prototype.byteAt=function(e){return this.data[this.zero+e]};a.prototype.lastIndexOfSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),r=e.charCodeAt(3);for(var a=this.length-4;a>=0;--a){if(this.data[a]===t&&this.data[a+1]===i&&this.data[a+2]===n&&this.data[a+3]===r){return a-this.zero}}return-1};a.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),r=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&i===a[1]&&n===a[2]&&r===a[3]};a.prototype.readData=function(e){this.checkOffset(e);if(e===0){return[]}var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,t,i){"use strict";var n=e("../utils");function r(e){this.data=e;this.length=e.length;this.index=0;this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")}},setIndex:function(e){this.checkIndex(e);this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,i;this.checkOffset(e);for(i=this.index+e-1;i>=this.index;i--){t=(t<<8)+this.byteAt(i)}this.index+=e;return t},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))}};t.exports=r},{"../utils":32}],19:[function(e,t,i){"use strict";var n=e("./Uint8ArrayReader");var r=e("../utils");function a(e){n.call(this,e)}r.inherits(a,n);a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,i){"use strict";var n=e("./DataReader");var r=e("../utils");function a(e){n.call(this,e)}r.inherits(a,n);a.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)};a.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero};a.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t};a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,t,i){"use strict";var n=e("./ArrayReader");var r=e("../utils");function a(e){n.call(this,e)}r.inherits(a,n);a.prototype.readData=function(e){this.checkOffset(e);if(e===0){return new Uint8Array(0)}var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,i){"use strict";var n=e("../utils");var r=e("../support");var a=e("./ArrayReader");var s=e("./StringReader");var o=e("./NodeBufferReader");var l=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);n.checkSupport(t);if(t==="string"&&!r.uint8array){return new s(e)}if(t==="nodebuffer"){return new o(e)}if(r.uint8array){return new l(n.transformTo("uint8array",e))}return new a(n.transformTo("array",e))}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK";i.CENTRAL_FILE_HEADER="PK";i.CENTRAL_DIRECTORY_END="PK";i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK";i.ZIP64_CENTRAL_DIRECTORY_END="PK";i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,i){"use strict";var n=e("./GenericWorker");var r=e("../utils");function a(e){n.call(this,"ConvertWorker to "+e);this.destType=e}r.inherits(a,n);a.prototype.processChunk=function(e){this.push({data:r.transformTo(this.destType,e.data),meta:e.meta})};t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,i){"use strict";var n=e("./GenericWorker");var r=e("../crc32");var a=e("../utils");function s(){n.call(this,"Crc32Probe");this.withStreamInfo("crc32",0)}a.inherits(s,n);s.prototype.processChunk=function(e){this.streamInfo.crc32=r(e.data,this.streamInfo.crc32||0);this.push(e)};t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,i){"use strict";var n=e("../utils");var r=e("./GenericWorker");function a(e){r.call(this,"DataLengthProbe for "+e);this.propName=e;this.withStreamInfo(e,0)}n.inherits(a,r);a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}r.prototype.processChunk.call(this,e)};t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,i){"use strict";var n=e("../utils");var r=e("./GenericWorker");var a=16*1024;function s(e){r.call(this,"DataWorker");var t=this;this.dataIsReady=false;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=false;e.then(function(e){t.dataIsReady=true;t.data=e;t.max=e&&e.length||0;t.type=n.getTypeOf(e);if(!t.isPaused){t._tickAndRepeat()}},function(e){t.error(e)})}n.inherits(s,r);s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this);this.data=null};s.prototype.resume=function(){if(!r.prototype.resume.call(this)){return false}if(!this._tickScheduled&&this.dataIsReady){this._tickScheduled=true;n.delay(this._tickAndRepeat,[],this)}return true};s.prototype._tickAndRepeat=function(){this._tickScheduled=false;if(this.isPaused||this.isFinished){return}this._tick();if(!this.isFinished){n.delay(this._tickAndRepeat,[],this);this._tickScheduled=true}};s.prototype._tick=function(){if(this.isPaused||this.isFinished){return false}var e=a;var t=null,i=Math.min(this.max,this.index+e);if(this.index>=this.max){return this.end()}else{switch(this.type){case"string":t=this.data.substring(this.index,i);break;case"uint8array":t=this.data.subarray(this.index,i);break;case"array":case"nodebuffer":t=this.data.slice(this.index,i);break}this.index=i;return this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})}};t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,i){"use strict";function n(e){this.name=e||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=true;this.isFinished=false;this.isLocked=false;this._listeners={data:[],end:[],error:[]};this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished){return false}this.flush();try{this.emit("end");this.cleanUp();this.isFinished=true}catch(e){this.emit("error",e)}return true},error:function(e){if(this.isFinished){return false}if(this.isPaused){this.generatedError=e}else{this.isFinished=true;this.emit("error",e);if(this.previous){this.previous.error(e)}this.cleanUp()}return true},on:function(e,t){this._listeners[e].push(t);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(e,t){if(this._listeners[e]){for(var i=0;i<this._listeners[e].length;i++){this._listeners[e][i].call(this,t)}}},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.streamInfo=e.streamInfo;this.mergeStreamInfo();this.previous=e;var t=this;e.on("data",function(e){t.processChunk(e)});e.on("end",function(){t.end()});e.on("error",function(e){t.error(e)});return this},pause:function(){if(this.isPaused||this.isFinished){return false}this.isPaused=true;if(this.previous){this.previous.pause()}return true},resume:function(){if(!this.isPaused||this.isFinished){return false}this.isPaused=false;var e=false;if(this.generatedError){this.error(this.generatedError);e=true}if(this.previous){this.previous.resume()}return!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){this.extraStreamInfo[e]=t;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(e)){continue}this.streamInfo[e]=this.extraStreamInfo[e]}},lock:function(){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.isLocked=true;if(this.previous){this.previous.lock()}},toString:function(){var e="Worker "+this.name;if(this.previous){return this.previous+" -> "+e}else{return e}}};t.exports=n},{}],29:[function(e,t,i){"use strict";var r=e("../utils");var a=e("./ConvertWorker");var s=e("./GenericWorker");var n=e("../base64");var o=e("../support");var l=e("../external");var u=null;if(o.nodestream){try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}}function h(e,t,i){switch(e){case"blob":return r.newBlob(r.transformTo("arraybuffer",t),i);case"base64":return n.encode(t);default:return r.transformTo(e,t)}}function c(e,t){var i,n=0,r=null,a=0;for(i=0;i<t.length;i++){a+=t[i].length}switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":r=new Uint8Array(a);for(i=0;i<t.length;i++){r.set(t[i],n);n+=t[i].length}return r;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function f(e,o){return new l.Promise(function(t,i){var n=[];var r=e._internalType,a=e._outputType,s=e._mimeType;e.on("data",function(e,t){n.push(e);if(o){o(t)}}).on("error",function(e){n=[];i(e)}).on("end",function(){try{var e=h(a,c(r,n),s);t(e)}catch(e){i(e)}n=[]}).resume()})}function d(e,t,i){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string";break}try{this._internalType=n;this._outputType=t;this._mimeType=i;r.checkSupport(n);this._worker=e.pipe(new a(n));e.lock()}catch(e){this._worker=new s("error");this._worker.error(e)}}d.prototype={accumulate:function(e){return f(this,e)},on:function(e,t){var i=this;if(e==="data"){this._worker.on(e,function(e){t.call(i,e.data,e.meta)})}else{this._worker.on(e,function(){r.delay(t,arguments,i)})}return this},resume:function(){r.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(e){r.checkSupport("nodestream");if(this._outputType!=="nodebuffer"){throw new Error(this._outputType+" is not supported by this method")}return new u(this,{objectMode:this._outputType!=="nodebuffer"},e)}};t.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,i){"use strict";i.base64=true;i.array=true;i.string=true;i.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";i.nodebuffer=typeof Buffer!=="undefined";i.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){i.blob=false}else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch(e){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var a=new r;a.append(n);i.blob=a.getBlob("application/zip").size===0}catch(e){i.blob=false}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=false}},{"readable-stream":16}],31:[function(e,t,a){"use strict";var l=e("./utils");var u=e("./support");var i=e("./nodejsUtils");var n=e("./stream/GenericWorker");var h=new Array(256);for(var r=0;r<256;r++){h[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1}h[254]=h[254]=1;var s=function(e){var t,i,n,r,a,s=e.length,o=0;for(r=0;r<s;r++){i=e.charCodeAt(r);if((i&64512)===55296&&r+1<s){n=e.charCodeAt(r+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);r++}}o+=i<128?1:i<2048?2:i<65536?3:4}if(u.uint8array){t=new Uint8Array(o)}else{t=new Array(o)}for(a=0,r=0;a<o;r++){i=e.charCodeAt(r);if((i&64512)===55296&&r+1<s){n=e.charCodeAt(r+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);r++}}if(i<128){t[a++]=i}else if(i<2048){t[a++]=192|i>>>6;t[a++]=128|i&63}else if(i<65536){t[a++]=224|i>>>12;t[a++]=128|i>>>6&63;t[a++]=128|i&63}else{t[a++]=240|i>>>18;t[a++]=128|i>>>12&63;t[a++]=128|i>>>6&63;t[a++]=128|i&63}}return t};var o=function(e,t){var i;t=t||e.length;if(t>e.length){t=e.length}i=t-1;while(i>=0&&(e[i]&192)===128){i--}if(i<0){return t}if(i===0){return t}return i+h[e[i]]>t?i:t};var c=function(e){var t,i,n,r,a;var s=e.length;var o=new Array(s*2);for(n=0,i=0;i<s;){r=e[i++];if(r<128){o[n++]=r;continue}a=h[r];if(a>4){o[n++]=65533;i+=a-1;continue}r&=a===2?31:a===3?15:7;while(a>1&&i<s){r=r<<6|e[i++]&63;a--}if(a>1){o[n++]=65533;continue}if(r<65536){o[n++]=r}else{r-=65536;o[n++]=55296|r>>10&1023;o[n++]=56320|r&1023}}if(o.length!==n){if(o.subarray){o=o.subarray(0,n)}else{o.length=n}}return l.applyFromCharCode(o)};a.utf8encode=function e(t){if(u.nodebuffer){return i.newBufferFrom(t,"utf-8")}return s(t)};a.utf8decode=function e(t){if(u.nodebuffer){return l.transformTo("nodebuffer",t).toString("utf-8")}t=l.transformTo(u.uint8array?"uint8array":"array",t);return c(t)};function f(){n.call(this,"utf-8 decode");this.leftOver=null}l.inherits(f,n);f.prototype.processChunk=function(e){var t=l.transformTo(u.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var i=t;t=new Uint8Array(i.length+this.leftOver.length);t.set(this.leftOver,0);t.set(i,this.leftOver.length)}else{t=this.leftOver.concat(t)}this.leftOver=null}var n=o(t);var r=t;if(n!==t.length){if(u.uint8array){r=t.subarray(0,n);this.leftOver=t.subarray(n,t.length)}else{r=t.slice(0,n);this.leftOver=t.slice(n,t.length)}}this.push({data:a.utf8decode(r),meta:e.meta})};f.prototype.flush=function(){if(this.leftOver&&this.leftOver.length){this.push({data:a.utf8decode(this.leftOver),meta:{}});this.leftOver=null}};a.Utf8DecodeWorker=f;function d(){n.call(this,"utf-8 encode")}l.inherits(d,n);d.prototype.processChunk=function(e){this.push({data:a.utf8encode(e.data),meta:e.meta})};a.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,s){"use strict";var o=e("./support");var l=e("./base64");var i=e("./nodejsUtils");var n=e("set-immediate-shim");var u=e("./external");function h(e){var t=null;if(o.uint8array){t=new Uint8Array(e.length)}else{t=new Array(e.length)}return a(e,t)}s.newBlob=function(t,i){s.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var n=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var r=new n;r.append(t);return r.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};function r(e){return e}function a(e,t){for(var i=0;i<e.length;++i){t[i]=e.charCodeAt(i)&255}return t}var c={stringifyByChunk:function(e,t,i){var n=[],r=0,a=e.length;if(a<=i){return String.fromCharCode.apply(null,e)}while(r<a){if(t==="array"||t==="nodebuffer"){n.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+i,a))))}else{n.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+i,a))))}r+=i}return n.join("")},stringifyByChar:function(e){var t="";for(var i=0;i<e.length;i++){t+=String.fromCharCode(e[i])}return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return false}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch(e){return false}}()}};function f(e){var t=65536,i=s.getTypeOf(e),n=true;if(i==="uint8array"){n=c.applyCanBeUsed.uint8array}else if(i==="nodebuffer"){n=c.applyCanBeUsed.nodebuffer}if(n){while(t>1){try{return c.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}}}return c.stringifyByChar(e)}s.applyFromCharCode=f;function d(e,t){for(var i=0;i<e.length;i++){t[i]=e[i]}return t}var g={};g["string"]={string:r,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return g["string"]["uint8array"](e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,i.allocBuffer(e.length))}};g["array"]={string:f,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(e)}};g["arraybuffer"]={string:function(e){return f(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(new Uint8Array(e))}};g["uint8array"]={string:f,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return i.newBufferFrom(e)}};g["nodebuffer"]={string:f,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return g["nodebuffer"]["uint8array"](e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:r};s.transformTo=function(e,t){if(!t){t=""}if(!e){return t}s.checkSupport(e);var i=s.getTypeOf(t);var n=g[i][e](t);return n};s.getTypeOf=function(e){if(typeof e==="string"){return"string"}if(Object.prototype.toString.call(e)==="[object Array]"){return"array"}if(o.nodebuffer&&i.isBuffer(e)){return"nodebuffer"}if(o.uint8array&&e instanceof Uint8Array){return"uint8array"}if(o.arraybuffer&&e instanceof ArrayBuffer){return"arraybuffer"}};s.checkSupport=function(e){var t=o[e.toLowerCase()];if(!t){throw new Error(e+" is not supported by this platform")}};s.MAX_VALUE_16BITS=65535;s.MAX_VALUE_32BITS=-1;s.pretty=function(e){var t="",i,n;for(n=0;n<(e||"").length;n++){i=e.charCodeAt(n);t+="\\x"+(i<16?"0":"")+i.toString(16).toUpperCase()}return t};s.delay=function(e,t,i){n(function(){e.apply(i||null,t||[])})};s.inherits=function(e,t){var i=function(){};i.prototype=t.prototype;e.prototype=new i};s.extend=function(){var e={},t,i;for(t=0;t<arguments.length;t++){for(i in arguments[t]){if(arguments[t].hasOwnProperty(i)&&typeof e[i]==="undefined"){e[i]=arguments[t][i]}}}return e};s.prepareContent=function(i,e,n,r,a){var t=u.Promise.resolve(e).then(function(n){var e=o.blob&&(n instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n))!==-1);if(e&&typeof FileReader!=="undefined"){return new u.Promise(function(t,i){var e=new FileReader;e.onload=function(e){t(e.target.result)};e.onerror=function(e){i(e.target.error)};e.readAsArrayBuffer(n)})}else{return n}});return t.then(function(e){var t=s.getTypeOf(e);if(!t){return u.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it "+"in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}if(t==="arraybuffer"){e=s.transformTo("uint8array",e)}else if(t==="string"){if(a){e=l.decode(e)}else if(n){if(r!==true){e=h(e)}}}return e})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,i){"use strict";var n=e("./reader/readerFor");var a=e("./utils");var s=e("./signature");var r=e("./zipEntry");var o=e("./utf8");var l=e("./support");function u(e){this.files=[];this.loadOptions=e}u.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature "+"("+a.pretty(t)+", expected "+a.pretty(e)+")")}},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4);var r=n===t;this.reader.setIndex(i);return r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength);var t=l.uint8array?"uint8array":"array";var i=a.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var e=this.zip64EndOfCentralSize-44,t=0,i,n,r;while(t<e){i=this.reader.readInt(2);n=this.reader.readInt(4);r=this.reader.readData(n);this.zip64ExtensibleData[i]={id:i,length:n,value:r}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++){t=this.files[e];this.reader.setIndex(t.localHeaderOffset);this.checkSignature(s.LOCAL_FILE_HEADER);t.readLocalPart(this.reader);t.handleUTF8();t.processAttributes()}},readCentralDir:function(){var e;this.reader.setIndex(this.centralDirOffset);while(this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER)){e=new r({zip64:this.zip64},this.loadOptions);e.readCentralPart(this.reader);this.files.push(e)}if(this.centralDirRecords!==this.files.length){if(this.centralDirRecords!==0&&this.files.length===0){throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)}else{}}},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0){var t=!this.isSignature(0,s.LOCAL_FILE_HEADER);if(t){throw new Error("Can't find end of central directory : is this a zip file ? "+"If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html")}else{throw new Error("Corrupted zip: can't find end of central directory")}}this.reader.setIndex(e);var i=e;this.checkSignature(s.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){this.zip64=true;e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(e<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator")}this.reader.setIndex(e);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)){this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory")}}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;if(this.zip64){n+=20;n+=12+this.zip64EndOfCentralSize}var r=i-n;if(r>0){if(this.isSignature(i,s.CENTRAL_FILE_HEADER)){}else{this.reader.zero=r}}else if(r<0){throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")}},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};t.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,i){"use strict";var n=e("./reader/readerFor");var a=e("./utils");var r=e("./compressedObject");var s=e("./crc32");var o=e("./utf8");var l=e("./compressions");var u=e("./support");var h=0;var c=3;var f=function(e){for(var t in l){if(!l.hasOwnProperty(t)){continue}if(l[t].magic===e){return l[t]}}return null};function d(e,t){this.options=e;this.loadOptions=t}d.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(e){var t,i;e.skip(22);this.fileNameLength=e.readInt(2);i=e.readInt(2);this.fileName=e.readData(this.fileNameLength);e.skip(i);if(this.compressedSize===-1||this.uncompressedSize===-1){throw new Error("Bug or corrupted zip : didn't get enough information from the central directory "+"(compressedSize === -1 || uncompressedSize === -1)")}t=f(this.compressionMethod);if(t===null){throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")")}this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2);e.skip(2);this.bitFlag=e.readInt(2);this.compressionMethod=e.readString(2);this.date=e.readDate();this.crc32=e.readInt(4);this.compressedSize=e.readInt(4);this.uncompressedSize=e.readInt(4);var t=e.readInt(2);this.extraFieldsLength=e.readInt(2);this.fileCommentLength=e.readInt(2);this.diskNumberStart=e.readInt(2);this.internalFileAttributes=e.readInt(2);this.externalFileAttributes=e.readInt(4);this.localHeaderOffset=e.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported")}e.skip(t);this.readExtraFields(e);this.parseZIP64ExtraField(e);this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null;this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?true:false;if(e===h){this.dosPermissions=this.externalFileAttributes&63}if(e===c){this.unixPermissions=this.externalFileAttributes>>16&65535}if(!this.dir&&this.fileNameStr.slice(-1)==="/"){this.dir=true}},parseZIP64ExtraField:function(e){if(!this.extraFields[1]){return}var t=n(this.extraFields[1].value);if(this.uncompressedSize===a.MAX_VALUE_32BITS){this.uncompressedSize=t.readInt(8)}if(this.compressedSize===a.MAX_VALUE_32BITS){this.compressedSize=t.readInt(8)}if(this.localHeaderOffset===a.MAX_VALUE_32BITS){this.localHeaderOffset=t.readInt(8)}if(this.diskNumberStart===a.MAX_VALUE_32BITS){this.diskNumberStart=t.readInt(4)}},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,i,n,r;if(!this.extraFields){this.extraFields={}}while(e.index+4<t){i=e.readInt(2);n=e.readInt(2);r=e.readData(n);this.extraFields[i]={id:i,length:n,value:r}}e.setIndex(t)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8()){this.fileNameStr=o.utf8decode(this.fileName);this.fileCommentStr=o.utf8decode(this.fileComment)}else{var t=this.findExtraFieldUnicodePath();if(t!==null){this.fileNameStr=t}else{var i=a.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(n!==null){this.fileCommentStr=n}else{var r=a.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);if(t.readInt(1)!==1){return null}if(s(this.fileName)!==t.readInt(4)){return null}return o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);if(t.readInt(1)!==1){return null}if(s(this.fileComment)!==t.readInt(4)){return null}return o.utf8decode(t.readData(e.length-5))}return null}};t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,i){"use strict";var a=e("./stream/StreamHelper");var n=e("./stream/DataWorker");var s=e("./utf8");var r=e("./compressedObject");var o=e("./stream/GenericWorker");var l=function(e,t,i){this.name=e;this.dir=i.dir;this.date=i.date;this.comment=i.comment;this.unixPermissions=i.unixPermissions;this.dosPermissions=i.dosPermissions;this._data=t;this._dataBinary=i.binary;this.options={compression:i.compression,compressionOptions:i.compressionOptions}};l.prototype={internalStream:function(e){var t=null,i="string";try{if(!e){throw new Error("No output type specified.")}i=e.toLowerCase();var n=i==="string"||i==="text";if(i==="binarystring"||i==="text"){i="string"}t=this._decompressWorker();var r=!this._dataBinary;if(r&&!n){t=t.pipe(new s.Utf8EncodeWorker)}if(!r&&n){t=t.pipe(new s.Utf8DecodeWorker)}}catch(e){t=new o("error");t.error(e)}return new a(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof r&&this._data.compression.magic===e.magic){return this._data.getCompressedWorker()}else{var i=this._decompressWorker();if(!this._dataBinary){i=i.pipe(new s.Utf8EncodeWorker)}return r.createWorkerFrom(i,e,t)}},_decompressWorker:function(){if(this._data instanceof r){return this._data.getContentWorker()}else if(this._data instanceof o){return this._data}else{return new n(this._data)}}};var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];var h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var c=0;c<u.length;c++){l.prototype[u[c]]=h}t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,c,t){(function(t){"use strict";var e=t.MutationObserver||t.WebKitMutationObserver;var i;{if(e){var n=0;var r=new e(u);var a=t.document.createTextNode("");r.observe(a,{characterData:true});i=function(){a.data=n=++n%2}}else if(!t.setImmediate&&typeof t.MessageChannel!=="undefined"){var s=new t.MessageChannel;s.port1.onmessage=u;i=function(){s.port2.postMessage(0)}}else if("document"in t&&"onreadystatechange"in t.document.createElement("script")){i=function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u();e.onreadystatechange=null;e.parentNode.removeChild(e);e=null};t.document.documentElement.appendChild(e)}}else{i=function(){setTimeout(u,0)}}}var o;var l=[];function u(){o=true;var e,t;var i=l.length;while(i){t=l;l=[];e=-1;while(++e<i){t[e]()}i=l.length}o=false}c.exports=h;function h(e){if(l.push(e)===1&&!o){i()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],37:[function(e,t,i){"use strict";var r=e("immediate");function u(){}var h={};var a=["REJECTED"];var s=["FULFILLED"];var o=["PENDING"];t.exports=n;function n(e){if(typeof e!=="function"){throw new TypeError("resolver must be a function")}this.state=o;this.queue=[];this.outcome=void 0;if(e!==u){d(this,e)}}n.prototype["finally"]=function(i){if(typeof i!=="function"){return this}var n=this.constructor;return this.then(e,t);function e(e){function t(){return e}return n.resolve(i()).then(t)}function t(e){function t(){throw e}return n.resolve(i()).then(t)}};n.prototype["catch"]=function(e){return this.then(null,e)};n.prototype.then=function(e,t){if(typeof e!=="function"&&this.state===s||typeof t!=="function"&&this.state===a){return this}var i=new this.constructor(u);if(this.state!==o){var n=this.state===s?e:t;c(i,n,this.outcome)}else{this.queue.push(new l(i,e,t))}return i};function l(e,t,i){this.promise=e;if(typeof t==="function"){this.onFulfilled=t;this.callFulfilled=this.otherCallFulfilled}if(typeof i==="function"){this.onRejected=i;this.callRejected=this.otherCallRejected}}l.prototype.callFulfilled=function(e){h.resolve(this.promise,e)};l.prototype.otherCallFulfilled=function(e){c(this.promise,this.onFulfilled,e)};l.prototype.callRejected=function(e){h.reject(this.promise,e)};l.prototype.otherCallRejected=function(e){c(this.promise,this.onRejected,e)};function c(t,i,n){r(function(){var e;try{e=i(n)}catch(e){return h.reject(t,e)}if(e===t){h.reject(t,new TypeError("Cannot resolve promise with itself"))}else{h.resolve(t,e)}})}h.resolve=function(e,t){var i=g(f,t);if(i.status==="error"){return h.reject(e,i.value)}var n=i.value;if(n){d(e,n)}else{e.state=s;e.outcome=t;var r=-1;var a=e.queue.length;while(++r<a){e.queue[r].callFulfilled(t)}}return e};h.reject=function(e,t){e.state=a;e.outcome=t;var i=-1;var n=e.queue.length;while(++i<n){e.queue[i].callRejected(t)}return e};function f(t){var i=t&&t.then;if(t&&(typeof t==="object"||typeof t==="function")&&typeof i==="function"){return function e(){i.apply(t,arguments)}}}function d(t,e){var i=false;function n(e){if(i){return}i=true;h.reject(t,e)}function r(e){if(i){return}i=true;h.resolve(t,e)}function a(){e(r,n)}var s=g(a);if(s.status==="error"){n(s.value)}}function g(e,t){var i={};try{i.value=e(t);i.status="success"}catch(e){i.status="error";i.value=e}return i}n.resolve=p;function p(e){if(e instanceof this){return e}return h.resolve(new this(u),e)}n.reject=m;function m(e){var t=new this(u);return h.reject(t,e)}n.all=_;function _(e){var n=this;if(Object.prototype.toString.call(e)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var r=e.length;var a=false;if(!r){return this.resolve([])}var s=new Array(r);var o=0;var t=-1;var l=new this(u);while(++t<r){i(e[t],t)}return l;function i(e,t){n.resolve(e).then(i,function(e){if(!a){a=true;h.reject(l,e)}});function i(e){s[t]=e;if(++o===r&&!a){a=true;h.resolve(l,s)}}}}n.race=b;function b(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var i=e.length;var n=false;if(!i){return this.resolve([])}var r=-1;var a=new this(u);while(++r<i){s(e[r])}return a;function s(e){t.resolve(e).then(function(e){if(!n){n=true;h.resolve(a,e)}},function(e){if(!n){n=true;h.reject(a,e)}})}}},{immediate:36}],38:[function(e,t,i){"use strict";var n=e("./lib/utils/common").assign;var r=e("./lib/deflate");var a=e("./lib/inflate");var s=e("./lib/zlib/constants");var o={};n(o,r,a,s);t.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,i){"use strict";var s=e("./zlib/deflate");var o=e("./utils/common");var l=e("./utils/strings");var r=e("./zlib/messages");var a=e("./zlib/zstream");var u=Object.prototype.toString;var h=0;var c=4;var f=0;var d=1;var g=2;var p=-1;var m=0;var _=8;function b(e){if(!(this instanceof b))return new b(e);this.options=o.assign({level:p,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>0){t.windowBits=-t.windowBits}else if(t.gzip&&t.windowBits>0&&t.windowBits<16){t.windowBits+=16}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new a;this.strm.avail_out=0;var i=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==f){throw new Error(r[i])}if(t.header){s.deflateSetHeader(this.strm,t.header)}if(t.dictionary){var n;if(typeof t.dictionary==="string"){n=l.string2buf(t.dictionary)}else if(u.call(t.dictionary)==="[object ArrayBuffer]"){n=new Uint8Array(t.dictionary)}else{n=t.dictionary}i=s.deflateSetDictionary(this.strm,n);if(i!==f){throw new Error(r[i])}this._dict_set=true}}b.prototype.push=function(e,t){var i=this.strm;var n=this.options.chunkSize;var r,a;if(this.ended){return false}a=t===~~t?t:t===true?c:h;if(typeof e==="string"){i.input=l.string2buf(e)}else if(u.call(e)==="[object ArrayBuffer]"){i.input=new Uint8Array(e)}else{i.input=e}i.next_in=0;i.avail_in=i.input.length;do{if(i.avail_out===0){i.output=new o.Buf8(n);i.next_out=0;i.avail_out=n}r=s.deflate(i,a);if(r!==d&&r!==f){this.onEnd(r);this.ended=true;return false}if(i.avail_out===0||i.avail_in===0&&(a===c||a===g)){if(this.options.to==="string"){this.onData(l.buf2binstring(o.shrinkBuf(i.output,i.next_out)))}else{this.onData(o.shrinkBuf(i.output,i.next_out))}}}while((i.avail_in>0||i.avail_out===0)&&r!==d);if(a===c){r=s.deflateEnd(this.strm);this.onEnd(r);this.ended=true;return r===f}if(a===g){this.onEnd(f);i.avail_out=0;return true}return true};b.prototype.onData=function(e){this.chunks.push(e)};b.prototype.onEnd=function(e){if(e===f){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=o.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function n(e,t){var i=new b(t);i.push(e,true);if(i.err){throw i.msg||r[i.err]}return i.result}function v(e,t){t=t||{};t.raw=true;return n(e,t)}function E(e,t){t=t||{};t.gzip=true;return n(e,t)}i.Deflate=b;i.deflate=n;i.deflateRaw=v;i.gzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,i){"use strict";var f=e("./zlib/inflate");var d=e("./utils/common");var g=e("./utils/strings");var p=e("./zlib/constants");var n=e("./zlib/messages");var r=e("./zlib/zstream");var a=e("./zlib/gzheader");var m=Object.prototype.toString;function s(e){if(!(this instanceof s))return new s(e);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;if(t.windowBits===0){t.windowBits=-15}}if(t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)){t.windowBits+=32}if(t.windowBits>15&&t.windowBits<48){if((t.windowBits&15)===0){t.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new r;this.strm.avail_out=0;var i=f.inflateInit2(this.strm,t.windowBits);if(i!==p.Z_OK){throw new Error(n[i])}this.header=new a;f.inflateGetHeader(this.strm,this.header)}s.prototype.push=function(e,t){var i=this.strm;var n=this.options.chunkSize;var r=this.options.dictionary;var a,s;var o,l,u;var h;var c=false;if(this.ended){return false}s=t===~~t?t:t===true?p.Z_FINISH:p.Z_NO_FLUSH;if(typeof e==="string"){i.input=g.binstring2buf(e)}else if(m.call(e)==="[object ArrayBuffer]"){i.input=new Uint8Array(e)}else{i.input=e}i.next_in=0;i.avail_in=i.input.length;do{if(i.avail_out===0){i.output=new d.Buf8(n);i.next_out=0;i.avail_out=n}a=f.inflate(i,p.Z_NO_FLUSH);if(a===p.Z_NEED_DICT&&r){if(typeof r==="string"){h=g.string2buf(r)}else if(m.call(r)==="[object ArrayBuffer]"){h=new Uint8Array(r)}else{h=r}a=f.inflateSetDictionary(this.strm,h)}if(a===p.Z_BUF_ERROR&&c===true){a=p.Z_OK;c=false}if(a!==p.Z_STREAM_END&&a!==p.Z_OK){this.onEnd(a);this.ended=true;return false}if(i.next_out){if(i.avail_out===0||a===p.Z_STREAM_END||i.avail_in===0&&(s===p.Z_FINISH||s===p.Z_SYNC_FLUSH)){if(this.options.to==="string"){o=g.utf8border(i.output,i.next_out);l=i.next_out-o;u=g.buf2string(i.output,o);i.next_out=l;i.avail_out=n-l;if(l){d.arraySet(i.output,i.output,o,l,0)}this.onData(u)}else{this.onData(d.shrinkBuf(i.output,i.next_out))}}}if(i.avail_in===0&&i.avail_out===0){c=true}}while((i.avail_in>0||i.avail_out===0)&&a!==p.Z_STREAM_END);if(a===p.Z_STREAM_END){s=p.Z_FINISH}if(s===p.Z_FINISH){a=f.inflateEnd(this.strm);this.onEnd(a);this.ended=true;return a===p.Z_OK}if(s===p.Z_SYNC_FLUSH){this.onEnd(p.Z_OK);i.avail_out=0;return true}return true};s.prototype.onData=function(e){this.chunks.push(e)};s.prototype.onEnd=function(e){if(e===p.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=d.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function o(e,t){var i=new s(t);i.push(e,true);if(i.err){throw i.msg||n[i.err]}return i.result}function l(e,t){t=t||{};t.raw=true;return o(e,t)}i.Inflate=s;i.inflate=o;i.inflateRaw=l;i.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,i){"use strict";var n=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";i.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var i=t.shift();if(!i){continue}if(typeof i!=="object"){throw new TypeError(i+"must be non-object")}for(var n in i){if(i.hasOwnProperty(n)){e[n]=i[n]}}}return e};i.shrinkBuf=function(e,t){if(e.length===t){return e}if(e.subarray){return e.subarray(0,t)}e.length=t;return e};var r={arraySet:function(e,t,i,n,r){if(t.subarray&&e.subarray){e.set(t.subarray(i,i+n),r);return}for(var a=0;a<n;a++){e[r+a]=t[i+a]}},flattenChunks:function(e){var t,i,n,r,a,s;n=0;for(t=0,i=e.length;t<i;t++){n+=e[t].length}s=new Uint8Array(n);r=0;for(t=0,i=e.length;t<i;t++){a=e[t];s.set(a,r);r+=a.length}return s}};var a={arraySet:function(e,t,i,n,r){for(var a=0;a<n;a++){e[r+a]=t[i+a]}},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){if(e){i.Buf8=Uint8Array;i.Buf16=Uint16Array;i.Buf32=Int32Array;i.assign(i,r)}else{i.Buf8=Array;i.Buf16=Array;i.Buf32=Array;i.assign(i,a)}};i.setTyped(n)},{}],42:[function(e,t,i){"use strict";var l=e("./common");var r=true;var a=true;try{String.fromCharCode.apply(null,[0])}catch(e){r=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=false}var u=new l.Buf8(256);for(var n=0;n<256;n++){u[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1}u[254]=u[254]=1;i.string2buf=function(e){var t,i,n,r,a,s=e.length,o=0;for(r=0;r<s;r++){i=e.charCodeAt(r);if((i&64512)===55296&&r+1<s){n=e.charCodeAt(r+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);r++}}o+=i<128?1:i<2048?2:i<65536?3:4}t=new l.Buf8(o);for(a=0,r=0;a<o;r++){i=e.charCodeAt(r);if((i&64512)===55296&&r+1<s){n=e.charCodeAt(r+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);r++}}if(i<128){t[a++]=i}else if(i<2048){t[a++]=192|i>>>6;t[a++]=128|i&63}else if(i<65536){t[a++]=224|i>>>12;t[a++]=128|i>>>6&63;t[a++]=128|i&63}else{t[a++]=240|i>>>18;t[a++]=128|i>>>12&63;t[a++]=128|i>>>6&63;t[a++]=128|i&63}}return t};function h(e,t){if(t<65537){if(e.subarray&&a||!e.subarray&&r){return String.fromCharCode.apply(null,l.shrinkBuf(e,t))}}var i="";for(var n=0;n<t;n++){i+=String.fromCharCode(e[n])}return i}i.buf2binstring=function(e){return h(e,e.length)};i.binstring2buf=function(e){var t=new l.Buf8(e.length);for(var i=0,n=t.length;i<n;i++){t[i]=e.charCodeAt(i)}return t};i.buf2string=function(e,t){var i,n,r,a;var s=t||e.length;var o=new Array(s*2);for(n=0,i=0;i<s;){r=e[i++];if(r<128){o[n++]=r;continue}a=u[r];if(a>4){o[n++]=65533;i+=a-1;continue}r&=a===2?31:a===3?15:7;while(a>1&&i<s){r=r<<6|e[i++]&63;a--}if(a>1){o[n++]=65533;continue}if(r<65536){o[n++]=r}else{r-=65536;o[n++]=55296|r>>10&1023;o[n++]=56320|r&1023}}return h(o,n)};i.utf8border=function(e,t){var i;t=t||e.length;if(t>e.length){t=e.length}i=t-1;while(i>=0&&(e[i]&192)===128){i--}if(i<0){return t}if(i===0){return t}return i+u[e[i]]>t?i:t}},{"./common":41}],43:[function(e,t,i){"use strict";function n(e,t,i,n){var r=e&65535|0,a=e>>>16&65535|0,s=0;while(i!==0){s=i>2e3?2e3:i;i-=s;do{r=r+t[n++]|0;a=a+r|0}while(--s);r%=65521;a%=65521}return r|a<<16|0}t.exports=n},{}],44:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,i){"use strict";function n(){var e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++){e=e&1?3988292384^e>>>1:e>>>1}t[i]=e}return t}var o=n();function r(e,t,i,n){var r=o,a=n+i;e^=-1;for(var s=n;s<a;s++){e=e>>>8^r[(e^t[s])&255]}return e^-1}t.exports=r},{}],46:[function(e,a,t){"use strict";var c=e("../utils/common");var u=e("./trees");var U=e("./adler32");var h=e("./crc32");var s=e("./messages");var f=0;var V=1;var G=3;var d=4;var j=5;var g=0;var z=1;var p=-2;var l=-3;var m=-5;var H=-1;var W=1;var _=2;var Y=3;var X=4;var Z=0;var q=2;var b=8;var K=9;var Q=15;var J=8;var $=29;var ee=256;var i=ee+1+$;var te=30;var ie=19;var ne=2*i+1;var re=15;var v=3;var E=258;var F=E+v+1;var ae=32;var A=42;var se=69;var C=73;var x=91;var T=103;var B=113;var I=666;var D=1;var S=2;var O=3;var y=4;var oe=3;function w(e,t){e.msg=s[t];return t}function le(e){return(e<<1)-(e>4?9:0)}function N(e){var t=e.length;while(--t>=0){e[t]=0}}function M(e){var t=e.state;var i=t.pending;if(i>e.avail_out){i=e.avail_out}if(i===0){return}c.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out);e.next_out+=i;t.pending_out+=i;e.total_out+=i;e.avail_out-=i;t.pending-=i;if(t.pending===0){t.pending_out=0}}function o(e,t){u._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t);e.block_start=e.strstart;M(e.strm)}function L(e,t){e.pending_buf[e.pending++]=t}function R(e,t){e.pending_buf[e.pending++]=t>>>8&255;e.pending_buf[e.pending++]=t&255}function ue(e,t,i,n){var r=e.avail_in;if(r>n){r=n}if(r===0){return 0}e.avail_in-=r;c.arraySet(t,e.input,e.next_in,r,i);if(e.state.wrap===1){e.adler=U(e.adler,t,r,i)}else if(e.state.wrap===2){e.adler=h(e.adler,t,r,i)}e.next_in+=r;e.total_in+=r;return r}function he(e,t){var i=e.max_chain_length;var n=e.strstart;var r;var a;var s=e.prev_length;var o=e.nice_match;var l=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0;var u=e.window;var h=e.w_mask;var c=e.prev;var f=e.strstart+E;var d=u[n+s-1];var g=u[n+s];if(e.prev_length>=e.good_match){i>>=2}if(o>e.lookahead){o=e.lookahead}do{r=t;if(u[r+s]!==g||u[r+s-1]!==d||u[r]!==u[n]||u[++r]!==u[n+1]){continue}n+=2;r++;do{}while(u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&n<f);a=E-(f-n);n=f-E;if(a>s){e.match_start=t;s=a;if(a>=o){break}d=u[n+s-1];g=u[n+s]}}while((t=c[t&h])>l&&--i!==0);if(s<=e.lookahead){return s}return e.lookahead}function P(e){var t=e.w_size;var i,n,r,a,s;do{a=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-F)){c.arraySet(e.window,e.window,t,t,0);e.match_start-=t;e.strstart-=t;e.block_start-=t;n=e.hash_size;i=n;do{r=e.head[--i];e.head[i]=r>=t?r-t:0}while(--n);n=t;i=n;do{r=e.prev[--i];e.prev[i]=r>=t?r-t:0}while(--n);a+=t}if(e.strm.avail_in===0){break}n=ue(e.strm,e.window,e.strstart+e.lookahead,a);e.lookahead+=n;if(e.lookahead+e.insert>=v){s=e.strstart-e.insert;e.ins_h=e.window[s];e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+v-1])&e.hash_mask;e.prev[s&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=s;s++;e.insert--;if(e.lookahead+e.insert<v){break}}}}while(e.lookahead<F&&e.strm.avail_in!==0)}function ce(e,t){var i=65535;if(i>e.pending_buf_size-5){i=e.pending_buf_size-5}for(;;){if(e.lookahead<=1){P(e);if(e.lookahead===0&&t===f){return D}if(e.lookahead===0){break}}e.strstart+=e.lookahead;e.lookahead=0;var n=e.block_start+i;if(e.strstart===0||e.strstart>=n){e.lookahead=e.strstart-n;e.strstart=n;o(e,false);if(e.strm.avail_out===0){return D}}if(e.strstart-e.block_start>=e.w_size-F){o(e,false);if(e.strm.avail_out===0){return D}}}e.insert=0;if(t===d){o(e,true);if(e.strm.avail_out===0){return O}return y}if(e.strstart>e.block_start){o(e,false);if(e.strm.avail_out===0){return D}}return D}function fe(e,t){var i;var n;for(;;){if(e.lookahead<F){P(e);if(e.lookahead<F&&t===f){return D}if(e.lookahead===0){break}}i=0;if(e.lookahead>=v){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}if(i!==0&&e.strstart-i<=e.w_size-F){e.match_length=he(e,i)}if(e.match_length>=v){n=u._tr_tally(e,e.strstart-e.match_start,e.match_length-v);e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=v){e.match_length--;do{e.strstart++;e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(--e.match_length!==0);e.strstart++}else{e.strstart+=e.match_length;e.match_length=0;e.ins_h=e.window[e.strstart];e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}}else{n=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(n){o(e,false);if(e.strm.avail_out===0){return D}}}e.insert=e.strstart<v-1?e.strstart:v-1;if(t===d){o(e,true);if(e.strm.avail_out===0){return O}return y}if(e.last_lit){o(e,false);if(e.strm.avail_out===0){return D}}return S}function n(e,t){var i;var n;var r;for(;;){if(e.lookahead<F){P(e);if(e.lookahead<F&&t===f){return D}if(e.lookahead===0){break}}i=0;if(e.lookahead>=v){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}e.prev_length=e.match_length;e.prev_match=e.match_start;e.match_length=v-1;if(i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-F){e.match_length=he(e,i);if(e.match_length<=5&&(e.strategy===W||e.match_length===v&&e.strstart-e.match_start>4096)){e.match_length=v-1}}if(e.prev_length>=v&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-v;n=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-v);e.lookahead-=e.prev_length-1;e.prev_length-=2;do{if(++e.strstart<=r){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}}while(--e.prev_length!==0);e.match_available=0;e.match_length=v-1;e.strstart++;if(n){o(e,false);if(e.strm.avail_out===0){return D}}}else if(e.match_available){n=u._tr_tally(e,0,e.window[e.strstart-1]);if(n){o(e,false)}e.strstart++;e.lookahead--;if(e.strm.avail_out===0){return D}}else{e.match_available=1;e.strstart++;e.lookahead--}}if(e.match_available){n=u._tr_tally(e,0,e.window[e.strstart-1]);e.match_available=0}e.insert=e.strstart<v-1?e.strstart:v-1;if(t===d){o(e,true);if(e.strm.avail_out===0){return O}return y}if(e.last_lit){o(e,false);if(e.strm.avail_out===0){return D}}return S}function de(e,t){var i;var n;var r,a;var s=e.window;for(;;){if(e.lookahead<=E){P(e);if(e.lookahead<=E&&t===f){return D}if(e.lookahead===0){break}}e.match_length=0;if(e.lookahead>=v&&e.strstart>0){r=e.strstart-1;n=s[r];if(n===s[++r]&&n===s[++r]&&n===s[++r]){a=e.strstart+E;do{}while(n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&r<a);e.match_length=E-(a-r);if(e.match_length>e.lookahead){e.match_length=e.lookahead}}}if(e.match_length>=v){i=u._tr_tally(e,1,e.match_length-v);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{i=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(i){o(e,false);if(e.strm.avail_out===0){return D}}}e.insert=0;if(t===d){o(e,true);if(e.strm.avail_out===0){return O}return y}if(e.last_lit){o(e,false);if(e.strm.avail_out===0){return D}}return S}function ge(e,t){var i;for(;;){if(e.lookahead===0){P(e);if(e.lookahead===0){if(t===f){return D}break}}e.match_length=0;i=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++;if(i){o(e,false);if(e.strm.avail_out===0){return D}}}e.insert=0;if(t===d){o(e,true);if(e.strm.avail_out===0){return O}return y}if(e.last_lit){o(e,false);if(e.strm.avail_out===0){return D}}return S}function r(e,t,i,n,r){this.good_length=e;this.max_lazy=t;this.nice_length=i;this.max_chain=n;this.func=r}var k;k=[new r(0,0,0,0,ce),new r(4,4,8,4,fe),new r(4,5,16,8,fe),new r(4,6,32,32,fe),new r(4,4,16,16,n),new r(8,16,32,32,n),new r(8,16,128,128,n),new r(8,32,128,256,n),new r(32,128,258,1024,n),new r(32,258,258,4096,n)];function pe(e){e.window_size=2*e.w_size;N(e.head);e.max_lazy_match=k[e.level].max_lazy;e.good_match=k[e.level].good_length;e.nice_match=k[e.level].nice_length;e.max_chain_length=k[e.level].max_chain;e.strstart=0;e.block_start=0;e.lookahead=0;e.insert=0;e.match_length=e.prev_length=v-1;e.match_available=0;e.ins_h=0}function me(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=b;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new c.Buf16(ne*2);this.dyn_dtree=new c.Buf16((2*te+1)*2);this.bl_tree=new c.Buf16((2*ie+1)*2);N(this.dyn_ltree);N(this.dyn_dtree);N(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new c.Buf16(re+1);this.heap=new c.Buf16(2*i+1);N(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new c.Buf16(2*i+1);N(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function _e(e){var t;if(!e||!e.state){return w(e,p)}e.total_in=e.total_out=0;e.data_type=q;t=e.state;t.pending=0;t.pending_out=0;if(t.wrap<0){t.wrap=-t.wrap}t.status=t.wrap?A:B;e.adler=t.wrap===2?0:1;t.last_flush=f;u._tr_init(t);return g}function be(e){var t=_e(e);if(t===g){pe(e.state)}return t}function ve(e,t){if(!e||!e.state){return p}if(e.state.wrap!==2){return p}e.state.gzhead=t;return g}function Ee(e,t,i,n,r,a){if(!e){return p}var s=1;if(t===H){t=6}if(n<0){s=0;n=-n}else if(n>15){s=2;n-=16}if(r<1||r>K||i!==b||n<8||n>15||t<0||t>9||a<0||a>X){return w(e,p)}if(n===8){n=9}var o=new me;e.state=o;o.strm=e;o.wrap=s;o.gzhead=null;o.w_bits=n;o.w_size=1<<o.w_bits;o.w_mask=o.w_size-1;o.hash_bits=r+7;o.hash_size=1<<o.hash_bits;o.hash_mask=o.hash_size-1;o.hash_shift=~~((o.hash_bits+v-1)/v);o.window=new c.Buf8(o.w_size*2);o.head=new c.Buf16(o.hash_size);o.prev=new c.Buf16(o.w_size);o.lit_bufsize=1<<r+6;o.pending_buf_size=o.lit_bufsize*4;o.pending_buf=new c.Buf8(o.pending_buf_size);o.d_buf=1*o.lit_bufsize;o.l_buf=(1+2)*o.lit_bufsize;o.level=t;o.strategy=a;o.method=i;return be(e)}function Fe(e,t){return Ee(e,t,b,Q,J,Z)}function Ae(e,t){var i,n;var r,a;if(!e||!e.state||t>j||t<0){return e?w(e,p):p}n=e.state;if(!e.output||!e.input&&e.avail_in!==0||n.status===I&&t!==d){return w(e,e.avail_out===0?m:p)}n.strm=e;i=n.last_flush;n.last_flush=t;if(n.status===A){if(n.wrap===2){e.adler=0;L(n,31);L(n,139);L(n,8);if(!n.gzhead){L(n,0);L(n,0);L(n,0);L(n,0);L(n,0);L(n,n.level===9?2:n.strategy>=_||n.level<2?4:0);L(n,oe);n.status=B}else{L(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(!n.gzhead.extra?0:4)+(!n.gzhead.name?0:8)+(!n.gzhead.comment?0:16));L(n,n.gzhead.time&255);L(n,n.gzhead.time>>8&255);L(n,n.gzhead.time>>16&255);L(n,n.gzhead.time>>24&255);L(n,n.level===9?2:n.strategy>=_||n.level<2?4:0);L(n,n.gzhead.os&255);if(n.gzhead.extra&&n.gzhead.extra.length){L(n,n.gzhead.extra.length&255);L(n,n.gzhead.extra.length>>8&255)}if(n.gzhead.hcrc){e.adler=h(e.adler,n.pending_buf,n.pending,0)}n.gzindex=0;n.status=se}}else{var s=b+(n.w_bits-8<<4)<<8;var o=-1;if(n.strategy>=_||n.level<2){o=0}else if(n.level<6){o=1}else if(n.level===6){o=2}else{o=3}s|=o<<6;if(n.strstart!==0){s|=ae}s+=31-s%31;n.status=B;R(n,s);if(n.strstart!==0){R(n,e.adler>>>16);R(n,e.adler&65535)}e.adler=1}}if(n.status===se){if(n.gzhead.extra){r=n.pending;while(n.gzindex<(n.gzhead.extra.length&65535)){if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}M(e);r=n.pending;if(n.pending===n.pending_buf_size){break}}L(n,n.gzhead.extra[n.gzindex]&255);n.gzindex++}if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}if(n.gzindex===n.gzhead.extra.length){n.gzindex=0;n.status=C}}else{n.status=C}}if(n.status===C){if(n.gzhead.name){r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}M(e);r=n.pending;if(n.pending===n.pending_buf_size){a=1;break}}if(n.gzindex<n.gzhead.name.length){a=n.gzhead.name.charCodeAt(n.gzindex++)&255}else{a=0}L(n,a)}while(a!==0);if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}if(a===0){n.gzindex=0;n.status=x}}else{n.status=x}}if(n.status===x){if(n.gzhead.comment){r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}M(e);r=n.pending;if(n.pending===n.pending_buf_size){a=1;break}}if(n.gzindex<n.gzhead.comment.length){a=n.gzhead.comment.charCodeAt(n.gzindex++)&255}else{a=0}L(n,a)}while(a!==0);if(n.gzhead.hcrc&&n.pending>r){e.adler=h(e.adler,n.pending_buf,n.pending-r,r)}if(a===0){n.status=T}}else{n.status=T}}if(n.status===T){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size){M(e)}if(n.pending+2<=n.pending_buf_size){L(n,e.adler&255);L(n,e.adler>>8&255);e.adler=0;n.status=B}}else{n.status=B}}if(n.pending!==0){M(e);if(e.avail_out===0){n.last_flush=-1;return g}}else if(e.avail_in===0&&le(t)<=le(i)&&t!==d){return w(e,m)}if(n.status===I&&e.avail_in!==0){return w(e,m)}if(e.avail_in!==0||n.lookahead!==0||t!==f&&n.status!==I){var l=n.strategy===_?ge(n,t):n.strategy===Y?de(n,t):k[n.level].func(n,t);if(l===O||l===y){n.status=I}if(l===D||l===O){if(e.avail_out===0){n.last_flush=-1}return g}if(l===S){if(t===V){u._tr_align(n)}else if(t!==j){u._tr_stored_block(n,0,0,false);if(t===G){N(n.head);if(n.lookahead===0){n.strstart=0;n.block_start=0;n.insert=0}}}M(e);if(e.avail_out===0){n.last_flush=-1;return g}}}if(t!==d){return g}if(n.wrap<=0){return z}if(n.wrap===2){L(n,e.adler&255);L(n,e.adler>>8&255);L(n,e.adler>>16&255);L(n,e.adler>>24&255);L(n,e.total_in&255);L(n,e.total_in>>8&255);L(n,e.total_in>>16&255);L(n,e.total_in>>24&255)}else{R(n,e.adler>>>16);R(n,e.adler&65535)}M(e);if(n.wrap>0){n.wrap=-n.wrap}return n.pending!==0?g:z}function Ce(e){var t;if(!e||!e.state){return p}t=e.state.status;if(t!==A&&t!==se&&t!==C&&t!==x&&t!==T&&t!==B&&t!==I){return w(e,p)}e.state=null;return t===B?w(e,l):g}function xe(e,t){var i=t.length;var n;var r,a;var s;var o;var l;var u;var h;if(!e||!e.state){return p}n=e.state;s=n.wrap;if(s===2||s===1&&n.status!==A||n.lookahead){return p}if(s===1){e.adler=U(e.adler,t,i,0)}n.wrap=0;if(i>=n.w_size){if(s===0){N(n.head);n.strstart=0;n.block_start=0;n.insert=0}h=new c.Buf8(n.w_size);c.arraySet(h,t,i-n.w_size,n.w_size,0);t=h;i=n.w_size}o=e.avail_in;l=e.next_in;u=e.input;e.avail_in=i;e.next_in=0;e.input=t;P(n);while(n.lookahead>=v){r=n.strstart;a=n.lookahead-(v-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+v-1])&n.hash_mask;n.prev[r&n.w_mask]=n.head[n.ins_h];n.head[n.ins_h]=r;r++}while(--a);n.strstart=r;n.lookahead=v-1;P(n)}n.strstart+=n.lookahead;n.block_start=n.strstart;n.insert=n.lookahead;n.lookahead=0;n.match_length=n.prev_length=v-1;n.match_available=0;e.next_in=l;e.input=u;e.avail_in=o;n.wrap=s;return g}t.deflateInit=Fe;t.deflateInit2=Ee;t.deflateReset=be;t.deflateResetKeep=_e;t.deflateSetHeader=ve;t.deflate=Ae;t.deflateEnd=Ce;t.deflateSetDictionary=xe;t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,i){"use strict";function n(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}t.exports=n},{}],48:[function(e,t,i){"use strict";var D=30;var S=12;t.exports=function e(t,i){var n;var r;var a;var s;var o;var l;var u;var h;var c;var f;var d;var g;var p;var m;var _;var b;var v;var E;var F;var A;var C;var x;var T;var B,I;n=t.state;r=t.next_in;B=t.input;a=r+(t.avail_in-5);s=t.next_out;I=t.output;o=s-(i-t.avail_out);l=s+(t.avail_out-257);u=n.dmax;h=n.wsize;c=n.whave;f=n.wnext;d=n.window;g=n.hold;p=n.bits;m=n.lencode;_=n.distcode;b=(1<<n.lenbits)-1;v=(1<<n.distbits)-1;e:do{if(p<15){g+=B[r++]<<p;p+=8;g+=B[r++]<<p;p+=8}E=m[g&b];t:for(;;){F=E>>>24;g>>>=F;p-=F;F=E>>>16&255;if(F===0){I[s++]=E&65535}else if(F&16){A=E&65535;F&=15;if(F){if(p<F){g+=B[r++]<<p;p+=8}A+=g&(1<<F)-1;g>>>=F;p-=F}if(p<15){g+=B[r++]<<p;p+=8;g+=B[r++]<<p;p+=8}E=_[g&v];i:for(;;){F=E>>>24;g>>>=F;p-=F;F=E>>>16&255;if(F&16){C=E&65535;F&=15;if(p<F){g+=B[r++]<<p;p+=8;if(p<F){g+=B[r++]<<p;p+=8}}C+=g&(1<<F)-1;if(C>u){t.msg="invalid distance too far back";n.mode=D;break e}g>>>=F;p-=F;F=s-o;if(C>F){F=C-F;if(F>c){if(n.sane){t.msg="invalid distance too far back";n.mode=D;break e}}x=0;T=d;if(f===0){x+=h-F;if(F<A){A-=F;do{I[s++]=d[x++]}while(--F);x=s-C;T=I}}else if(f<F){x+=h+f-F;F-=f;if(F<A){A-=F;do{I[s++]=d[x++]}while(--F);x=0;if(f<A){F=f;A-=F;do{I[s++]=d[x++]}while(--F);x=s-C;T=I}}}else{x+=f-F;if(F<A){A-=F;do{I[s++]=d[x++]}while(--F);x=s-C;T=I}}while(A>2){I[s++]=T[x++];I[s++]=T[x++];I[s++]=T[x++];A-=3}if(A){I[s++]=T[x++];if(A>1){I[s++]=T[x++]}}}else{x=s-C;do{I[s++]=I[x++];I[s++]=I[x++];I[s++]=I[x++];A-=3}while(A>2);if(A){I[s++]=I[x++];if(A>1){I[s++]=I[x++]}}}}else if((F&64)===0){E=_[(E&65535)+(g&(1<<F)-1)];continue i}else{t.msg="invalid distance code";n.mode=D;break e}break}}else if((F&64)===0){E=m[(E&65535)+(g&(1<<F)-1)];continue t}else if(F&32){n.mode=S;break e}else{t.msg="invalid literal/length code";n.mode=D;break e}break}}while(r<a&&s<l);A=p>>3;r-=A;p-=A<<3;g&=(1<<p)-1;t.next_in=r;t.next_out=s;t.avail_in=r<a?5+(a-r):5-(r-a);t.avail_out=s<l?257+(l-s):257-(s-l);n.hold=g;n.bits=p;return}},{}],49:[function(e,r,t){"use strict";var S=e("../utils/common");var O=e("./adler32");var y=e("./crc32");var oe=e("./inffast");var w=e("./inftrees");var le=0;var N=1;var M=2;var L=4;var ue=5;var R=6;var P=0;var he=1;var ce=2;var k=-2;var U=-3;var V=-4;var fe=-5;var G=8;var j=1;var z=2;var H=3;var W=4;var Y=5;var X=6;var Z=7;var q=8;var K=9;var Q=10;var J=11;var $=12;var ee=13;var de=14;var te=15;var ge=16;var pe=17;var me=18;var _e=19;var ie=20;var ne=21;var be=22;var ve=23;var Ee=24;var Fe=25;var Ae=26;var re=27;var Ce=28;var xe=29;var ae=30;var se=31;var Te=32;var a=852;var s=592;var o=15;var l=o;function Be(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function u(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new S.Buf16(320);this.work=new S.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function h(e){var t;if(!e||!e.state){return k}t=e.state;e.total_in=e.total_out=t.total=0;e.msg="";if(t.wrap){e.adler=t.wrap&1}t.mode=j;t.last=0;t.havedict=0;t.dmax=32768;t.head=null;t.hold=0;t.bits=0;t.lencode=t.lendyn=new S.Buf32(a);t.distcode=t.distdyn=new S.Buf32(s);t.sane=1;t.back=-1;return P}function c(e){var t;if(!e||!e.state){return k}t=e.state;t.wsize=0;t.whave=0;t.wnext=0;return h(e)}function f(e,t){var i;var n;if(!e||!e.state){return k}n=e.state;if(t<0){i=0;t=-t}else{i=(t>>4)+1;if(t<48){t&=15}}if(t&&(t<8||t>15)){return k}if(n.window!==null&&n.wbits!==t){n.window=null}n.wrap=i;n.wbits=t;return c(e)}function d(e,t){var i;var n;if(!e){return k}n=new u;e.state=n;n.window=null;i=f(e,t);if(i!==P){e.state=null}return i}function g(e){return d(e,l)}var p=true;var i,n;function Ie(e){if(p){var t;i=new S.Buf32(512);n=new S.Buf32(32);t=0;while(t<144){e.lens[t++]=8}while(t<256){e.lens[t++]=9}while(t<280){e.lens[t++]=7}while(t<288){e.lens[t++]=8}w(N,e.lens,0,288,i,0,e.work,{bits:9});t=0;while(t<32){e.lens[t++]=5}w(M,e.lens,0,32,n,0,e.work,{bits:5});p=false}e.lencode=i;e.lenbits=9;e.distcode=n;e.distbits=5}function De(e,t,i,n){var r;var a=e.state;if(a.window===null){a.wsize=1<<a.wbits;a.wnext=0;a.whave=0;a.window=new S.Buf8(a.wsize)}if(n>=a.wsize){S.arraySet(a.window,t,i-a.wsize,a.wsize,0);a.wnext=0;a.whave=a.wsize}else{r=a.wsize-a.wnext;if(r>n){r=n}S.arraySet(a.window,t,i-n,r,a.wnext);n-=r;if(n){S.arraySet(a.window,t,i-n,n,0);a.wnext=n;a.whave=a.wsize}else{a.wnext+=r;if(a.wnext===a.wsize){a.wnext=0}if(a.whave<a.wsize){a.whave+=r}}}return 0}function m(e,t){var i;var n,r;var a;var s;var o,l;var u;var h;var c,f;var d;var g;var p;var m=0;var _,b,v;var E,F,A;var C;var x;var T=new S.Buf8(4);var B;var I;var D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0){return k}i=e.state;if(i.mode===$){i.mode=ee}s=e.next_out;r=e.output;l=e.avail_out;a=e.next_in;n=e.input;o=e.avail_in;u=i.hold;h=i.bits;c=o;f=l;x=P;e:for(;;){switch(i.mode){case j:if(i.wrap===0){i.mode=ee;break}while(h<16){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(i.wrap&2&&u===35615){i.check=0;T[0]=u&255;T[1]=u>>>8&255;i.check=y(i.check,T,2,0);u=0;h=0;i.mode=z;break}i.flags=0;if(i.head){i.head.done=false}if(!(i.wrap&1)||(((u&255)<<8)+(u>>8))%31){e.msg="incorrect header check";i.mode=ae;break}if((u&15)!==G){e.msg="unknown compression method";i.mode=ae;break}u>>>=4;h-=4;C=(u&15)+8;if(i.wbits===0){i.wbits=C}else if(C>i.wbits){e.msg="invalid window size";i.mode=ae;break}i.dmax=1<<C;e.adler=i.check=1;i.mode=u&512?Q:$;u=0;h=0;break;case z:while(h<16){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.flags=u;if((i.flags&255)!==G){e.msg="unknown compression method";i.mode=ae;break}if(i.flags&57344){e.msg="unknown header flags set";i.mode=ae;break}if(i.head){i.head.text=u>>8&1}if(i.flags&512){T[0]=u&255;T[1]=u>>>8&255;i.check=y(i.check,T,2,0)}u=0;h=0;i.mode=H;case H:while(h<32){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(i.head){i.head.time=u}if(i.flags&512){T[0]=u&255;T[1]=u>>>8&255;T[2]=u>>>16&255;T[3]=u>>>24&255;i.check=y(i.check,T,4,0)}u=0;h=0;i.mode=W;case W:while(h<16){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(i.head){i.head.xflags=u&255;i.head.os=u>>8}if(i.flags&512){T[0]=u&255;T[1]=u>>>8&255;i.check=y(i.check,T,2,0)}u=0;h=0;i.mode=Y;case Y:if(i.flags&1024){while(h<16){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.length=u;if(i.head){i.head.extra_len=u}if(i.flags&512){T[0]=u&255;T[1]=u>>>8&255;i.check=y(i.check,T,2,0)}u=0;h=0}else if(i.head){i.head.extra=null}i.mode=X;case X:if(i.flags&1024){d=i.length;if(d>o){d=o}if(d){if(i.head){C=i.head.extra_len-i.length;if(!i.head.extra){i.head.extra=new Array(i.head.extra_len)}S.arraySet(i.head.extra,n,a,d,C)}if(i.flags&512){i.check=y(i.check,n,d,a)}o-=d;a+=d;i.length-=d}if(i.length){break e}}i.length=0;i.mode=Z;case Z:if(i.flags&2048){if(o===0){break e}d=0;do{C=n[a+d++];if(i.head&&C&&i.length<65536){i.head.name+=String.fromCharCode(C)}}while(C&&d<o);if(i.flags&512){i.check=y(i.check,n,d,a)}o-=d;a+=d;if(C){break e}}else if(i.head){i.head.name=null}i.length=0;i.mode=q;case q:if(i.flags&4096){if(o===0){break e}d=0;do{C=n[a+d++];if(i.head&&C&&i.length<65536){i.head.comment+=String.fromCharCode(C)}}while(C&&d<o);if(i.flags&512){i.check=y(i.check,n,d,a)}o-=d;a+=d;if(C){break e}}else if(i.head){i.head.comment=null}i.mode=K;case K:if(i.flags&512){while(h<16){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(u!==(i.check&65535)){e.msg="header crc mismatch";i.mode=ae;break}u=0;h=0}if(i.head){i.head.hcrc=i.flags>>9&1;i.head.done=true}e.adler=i.check=0;i.mode=$;break;case Q:while(h<32){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}e.adler=i.check=Be(u);u=0;h=0;i.mode=J;case J:if(i.havedict===0){e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;i.hold=u;i.bits=h;return ce}e.adler=i.check=1;i.mode=$;case $:if(t===ue||t===R){break e}case ee:if(i.last){u>>>=h&7;h-=h&7;i.mode=re;break}while(h<3){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.last=u&1;u>>>=1;h-=1;switch(u&3){case 0:i.mode=de;break;case 1:Ie(i);i.mode=ie;if(t===R){u>>>=2;h-=2;break e}break;case 2:i.mode=pe;break;case 3:e.msg="invalid block type";i.mode=ae}u>>>=2;h-=2;break;case de:u>>>=h&7;h-=h&7;while(h<32){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if((u&65535)!==(u>>>16^65535)){e.msg="invalid stored block lengths";i.mode=ae;break}i.length=u&65535;u=0;h=0;i.mode=te;if(t===R){break e}case te:i.mode=ge;case ge:d=i.length;if(d){if(d>o){d=o}if(d>l){d=l}if(d===0){break e}S.arraySet(r,n,a,d,s);o-=d;a+=d;l-=d;s+=d;i.length-=d;break}i.mode=$;break;case pe:while(h<14){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.nlen=(u&31)+257;u>>>=5;h-=5;i.ndist=(u&31)+1;u>>>=5;h-=5;i.ncode=(u&15)+4;u>>>=4;h-=4;if(i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols";i.mode=ae;break}i.have=0;i.mode=me;case me:while(i.have<i.ncode){while(h<3){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.lens[D[i.have++]]=u&7;u>>>=3;h-=3}while(i.have<19){i.lens[D[i.have++]]=0}i.lencode=i.lendyn;i.lenbits=7;B={bits:i.lenbits};x=w(le,i.lens,0,19,i.lencode,0,i.work,B);i.lenbits=B.bits;if(x){e.msg="invalid code lengths set";i.mode=ae;break}i.have=0;i.mode=_e;case _e:while(i.have<i.nlen+i.ndist){for(;;){m=i.lencode[u&(1<<i.lenbits)-1];_=m>>>24;b=m>>>16&255;v=m&65535;if(_<=h){break}if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(v<16){u>>>=_;h-=_;i.lens[i.have++]=v}else{if(v===16){I=_+2;while(h<I){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}u>>>=_;h-=_;if(i.have===0){e.msg="invalid bit length repeat";i.mode=ae;break}C=i.lens[i.have-1];d=3+(u&3);u>>>=2;h-=2}else if(v===17){I=_+3;while(h<I){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}u>>>=_;h-=_;C=0;d=3+(u&7);u>>>=3;h-=3}else{I=_+7;while(h<I){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}u>>>=_;h-=_;C=0;d=11+(u&127);u>>>=7;h-=7}if(i.have+d>i.nlen+i.ndist){e.msg="invalid bit length repeat";i.mode=ae;break}while(d--){i.lens[i.have++]=C}}}if(i.mode===ae){break}if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block";i.mode=ae;break}i.lenbits=9;B={bits:i.lenbits};x=w(N,i.lens,0,i.nlen,i.lencode,0,i.work,B);i.lenbits=B.bits;if(x){e.msg="invalid literal/lengths set";i.mode=ae;break}i.distbits=6;i.distcode=i.distdyn;B={bits:i.distbits};x=w(M,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,B);i.distbits=B.bits;if(x){e.msg="invalid distances set";i.mode=ae;break}i.mode=ie;if(t===R){break e}case ie:i.mode=ne;case ne:if(o>=6&&l>=258){e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;i.hold=u;i.bits=h;oe(e,f);s=e.next_out;r=e.output;l=e.avail_out;a=e.next_in;n=e.input;o=e.avail_in;u=i.hold;h=i.bits;if(i.mode===$){i.back=-1}break}i.back=0;for(;;){m=i.lencode[u&(1<<i.lenbits)-1];_=m>>>24;b=m>>>16&255;v=m&65535;if(_<=h){break}if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(b&&(b&240)===0){E=_;F=b;A=v;for(;;){m=i.lencode[A+((u&(1<<E+F)-1)>>E)];_=m>>>24;b=m>>>16&255;v=m&65535;if(E+_<=h){break}if(o===0){break e}o--;u+=n[a++]<<h;h+=8}u>>>=E;h-=E;i.back+=E}u>>>=_;h-=_;i.back+=_;i.length=v;if(b===0){i.mode=Ae;break}if(b&32){i.back=-1;i.mode=$;break}if(b&64){e.msg="invalid literal/length code";i.mode=ae;break}i.extra=b&15;i.mode=be;case be:if(i.extra){I=i.extra;while(h<I){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.length+=u&(1<<i.extra)-1;u>>>=i.extra;h-=i.extra;i.back+=i.extra}i.was=i.length;i.mode=ve;case ve:for(;;){m=i.distcode[u&(1<<i.distbits)-1];_=m>>>24;b=m>>>16&255;v=m&65535;if(_<=h){break}if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if((b&240)===0){E=_;F=b;A=v;for(;;){m=i.distcode[A+((u&(1<<E+F)-1)>>E)];_=m>>>24;b=m>>>16&255;v=m&65535;if(E+_<=h){break}if(o===0){break e}o--;u+=n[a++]<<h;h+=8}u>>>=E;h-=E;i.back+=E}u>>>=_;h-=_;i.back+=_;if(b&64){e.msg="invalid distance code";i.mode=ae;break}i.offset=v;i.extra=b&15;i.mode=Ee;case Ee:if(i.extra){I=i.extra;while(h<I){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}i.offset+=u&(1<<i.extra)-1;u>>>=i.extra;h-=i.extra;i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back";i.mode=ae;break}i.mode=Fe;case Fe:if(l===0){break e}d=f-l;if(i.offset>d){d=i.offset-d;if(d>i.whave){if(i.sane){e.msg="invalid distance too far back";i.mode=ae;break}}if(d>i.wnext){d-=i.wnext;g=i.wsize-d}else{g=i.wnext-d}if(d>i.length){d=i.length}p=i.window}else{p=r;g=s-i.offset;d=i.length}if(d>l){d=l}l-=d;i.length-=d;do{r[s++]=p[g++]}while(--d);if(i.length===0){i.mode=ne}break;case Ae:if(l===0){break e}r[s++]=i.length;l--;i.mode=ne;break;case re:if(i.wrap){while(h<32){if(o===0){break e}o--;u|=n[a++]<<h;h+=8}f-=l;e.total_out+=f;i.total+=f;if(f){e.adler=i.check=i.flags?y(i.check,r,f,s-f):O(i.check,r,f,s-f)}f=l;if((i.flags?u:Be(u))!==i.check){e.msg="incorrect data check";i.mode=ae;break}u=0;h=0}i.mode=Ce;case Ce:if(i.wrap&&i.flags){while(h<32){if(o===0){break e}o--;u+=n[a++]<<h;h+=8}if(u!==(i.total&4294967295)){e.msg="incorrect length check";i.mode=ae;break}u=0;h=0}i.mode=xe;case xe:x=he;break e;case ae:x=U;break e;case se:return V;case Te:default:return k}}e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;i.hold=u;i.bits=h;if(i.wsize||f!==e.avail_out&&i.mode<ae&&(i.mode<re||t!==L)){if(De(e,e.output,e.next_out,f-e.avail_out)){i.mode=se;return V}}c-=e.avail_in;f-=e.avail_out;e.total_in+=c;e.total_out+=f;i.total+=f;if(i.wrap&&f){e.adler=i.check=i.flags?y(i.check,r,f,e.next_out-f):O(i.check,r,f,e.next_out-f)}e.data_type=i.bits+(i.last?64:0)+(i.mode===$?128:0)+(i.mode===ie||i.mode===te?256:0);if((c===0&&f===0||t===L)&&x===P){x=fe}return x}function _(e){if(!e||!e.state){return k}var t=e.state;if(t.window){t.window=null}e.state=null;return P}function b(e,t){var i;if(!e||!e.state){return k}i=e.state;if((i.wrap&2)===0){return k}i.head=t;t.done=false;return P}function v(e,t){var i=t.length;var n;var r;var a;if(!e||!e.state){return k}n=e.state;if(n.wrap!==0&&n.mode!==J){return k}if(n.mode===J){r=1;r=O(r,t,i,0);if(r!==n.check){return U}}a=De(e,t,i,i);if(a){n.mode=se;return V}n.havedict=1;return P}t.inflateReset=c;t.inflateReset2=f;t.inflateResetKeep=h;t.inflateInit=g;t.inflateInit2=d;t.inflate=m;t.inflateEnd=_;t.inflateGetHeader=b;t.inflateSetDictionary=v;t.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,i){"use strict";var L=e("../utils/common");var R=15;var P=852;var k=592;var U=0;var V=1;var G=2;var j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var z=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var H=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var W=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function e(t,i,n,r,a,s,o,l){var u=l.bits;var h=0;var c=0;var f=0,d=0;var g=0;var p=0;var m=0;var _=0;var b=0;var v=0;var E;var F;var A;var C;var x;var T=null;var B=0;var I;var D=new L.Buf16(R+1);var S=new L.Buf16(R+1);var O=null;var y=0;var w,N,M;for(h=0;h<=R;h++){D[h]=0}for(c=0;c<r;c++){D[i[n+c]]++}g=u;for(d=R;d>=1;d--){if(D[d]!==0){break}}if(g>d){g=d}if(d===0){a[s++]=1<<24|64<<16|0;a[s++]=1<<24|64<<16|0;l.bits=1;return 0}for(f=1;f<d;f++){if(D[f]!==0){break}}if(g<f){g=f}_=1;for(h=1;h<=R;h++){_<<=1;_-=D[h];if(_<0){return-1}}if(_>0&&(t===U||d!==1)){return-1}S[1]=0;for(h=1;h<R;h++){S[h+1]=S[h]+D[h]}for(c=0;c<r;c++){if(i[n+c]!==0){o[S[i[n+c]]++]=c}}if(t===U){T=O=o;I=19}else if(t===V){T=j;B-=257;O=z;y-=257;I=256}else{T=H;O=W;I=-1}v=0;c=0;h=f;x=s;p=g;m=0;A=-1;b=1<<g;C=b-1;if(t===V&&b>P||t===G&&b>k){return 1}for(;;){w=h-m;if(o[c]<I){N=0;M=o[c]}else if(o[c]>I){N=O[y+o[c]];M=T[B+o[c]]}else{N=32+64;M=0}E=1<<h-m;F=1<<p;f=F;do{F-=E;a[x+(v>>m)+F]=w<<24|N<<16|M|0}while(F!==0);E=1<<h-1;while(v&E){E>>=1}if(E!==0){v&=E-1;v+=E}else{v=0}c++;if(--D[h]===0){if(h===d){break}h=i[n+o[c]]}if(h>g&&(v&C)!==A){if(m===0){m=g}x+=f;p=h-m;_=1<<p;while(p+m<d){_-=D[p+m];if(_<=0){break}p++;_<<=1}b+=1<<p;if(t===V&&b>P||t===G&&b>k){return 1}A=v&C;a[A]=g<<24|p<<16|x-s|0}}if(v!==0){a[x+v]=h-m<<24|64<<16|0}l.bits=g;return 0}},{"../utils/common":41}],51:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(R,P,e){"use strict";var k=R("../utils/common");var U=4;var n=0;var r=1;var V=2;function t(e){var t=e.length;while(--t>=0){e[t]=0}}var G=0;var o=1;var j=2;var z=3;var H=258;var s=29;var l=256;var u=l+1+s;var h=30;var c=19;var m=2*u+1;var _=15;var a=16;var W=7;var f=256;var d=16;var g=17;var p=18;var b=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var X=512;var F=new Array((u+2)*2);t(F);var A=new Array(h*2);t(A);var C=new Array(X);t(C);var x=new Array(H-z+1);t(x);var T=new Array(s);t(T);var B=new Array(h);t(B);function I(e,t,i,n,r){this.static_tree=e;this.extra_bits=t;this.extra_base=i;this.elems=n;this.max_length=r;this.has_stree=e&&e.length}var D;var S;var O;function i(e,t){this.dyn_tree=e;this.max_code=0;this.stat_desc=t}function Z(e){return e<256?C[e]:C[256+(e>>>7)]}function y(e,t){e.pending_buf[e.pending++]=t&255;e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,i){if(e.bi_valid>a-i){e.bi_buf|=t<<e.bi_valid&65535;y(e,e.bi_buf);e.bi_buf=t>>a-e.bi_valid;e.bi_valid+=i-a}else{e.bi_buf|=t<<e.bi_valid&65535;e.bi_valid+=i}}function N(e,t,i){w(e,i[t*2],i[t*2+1])}function q(e,t){var i=0;do{i|=e&1;e>>>=1;i<<=1}while(--t>0);return i>>>1}function K(e){if(e.bi_valid===16){y(e,e.bi_buf);e.bi_buf=0;e.bi_valid=0}else if(e.bi_valid>=8){e.pending_buf[e.pending++]=e.bi_buf&255;e.bi_buf>>=8;e.bi_valid-=8}}function Q(e,t){var i=t.dyn_tree;var n=t.max_code;var r=t.stat_desc.static_tree;var a=t.stat_desc.has_stree;var s=t.stat_desc.extra_bits;var o=t.stat_desc.extra_base;var l=t.stat_desc.max_length;var u;var h,c;var f;var d;var g;var p=0;for(f=0;f<=_;f++){e.bl_count[f]=0}i[e.heap[e.heap_max]*2+1]=0;for(u=e.heap_max+1;u<m;u++){h=e.heap[u];f=i[i[h*2+1]*2+1]+1;if(f>l){f=l;p++}i[h*2+1]=f;if(h>n){continue}e.bl_count[f]++;d=0;if(h>=o){d=s[h-o]}g=i[h*2];e.opt_len+=g*(f+d);if(a){e.static_len+=g*(r[h*2+1]+d)}}if(p===0){return}do{f=l-1;while(e.bl_count[f]===0){f--}e.bl_count[f]--;e.bl_count[f+1]+=2;e.bl_count[l]--;p-=2}while(p>0);for(f=l;f!==0;f--){h=e.bl_count[f];while(h!==0){c=e.heap[--u];if(c>n){continue}if(i[c*2+1]!==f){e.opt_len+=(f-i[c*2+1])*i[c*2];i[c*2+1]=f}h--}}}function J(e,t,i){var n=new Array(_+1);var r=0;var a;var s;for(a=1;a<=_;a++){n[a]=r=r+i[a-1]<<1}for(s=0;s<=t;s++){var o=e[s*2+1];if(o===0){continue}e[s*2]=q(n[o]++,o)}}function $(){var e;var t;var i;var n;var r;var a=new Array(_+1);i=0;for(n=0;n<s-1;n++){T[n]=i;for(e=0;e<1<<b[n];e++){x[i++]=n}}x[i-1]=n;r=0;for(n=0;n<16;n++){B[n]=r;for(e=0;e<1<<v[n];e++){C[r++]=n}}r>>=7;for(;n<h;n++){B[n]=r<<7;for(e=0;e<1<<v[n]-7;e++){C[256+r++]=n}}for(t=0;t<=_;t++){a[t]=0}e=0;while(e<=143){F[e*2+1]=8;e++;a[8]++}while(e<=255){F[e*2+1]=9;e++;a[9]++}while(e<=279){F[e*2+1]=7;e++;a[7]++}while(e<=287){F[e*2+1]=8;e++;a[8]++}J(F,u+1,a);for(e=0;e<h;e++){A[e*2+1]=5;A[e*2]=q(e,5)}D=new I(F,b,l+1,u,_);S=new I(A,v,0,h,_);O=new I(new Array(0),Y,0,c,W)}function ee(e){var t;for(t=0;t<u;t++){e.dyn_ltree[t*2]=0}for(t=0;t<h;t++){e.dyn_dtree[t*2]=0}for(t=0;t<c;t++){e.bl_tree[t*2]=0}e.dyn_ltree[f*2]=1;e.opt_len=e.static_len=0;e.last_lit=e.matches=0}function te(e){if(e.bi_valid>8){y(e,e.bi_buf)}else if(e.bi_valid>0){e.pending_buf[e.pending++]=e.bi_buf}e.bi_buf=0;e.bi_valid=0}function ie(e,t,i,n){te(e);if(n){y(e,i);y(e,~i)}k.arraySet(e.pending_buf,e.window,t,i,e.pending);e.pending+=i}function ne(e,t,i,n){var r=t*2;var a=i*2;return e[r]<e[a]||e[r]===e[a]&&n[t]<=n[i]}function M(e,t,i){var n=e.heap[i];var r=i<<1;while(r<=e.heap_len){if(r<e.heap_len&&ne(t,e.heap[r+1],e.heap[r],e.depth)){r++}if(ne(t,n,e.heap[r],e.depth)){break}e.heap[i]=e.heap[r];i=r;r<<=1}e.heap[i]=n}function re(e,t,i){var n;var r;var a=0;var s;var o;if(e.last_lit!==0){do{n=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1];r=e.pending_buf[e.l_buf+a];a++;if(n===0){N(e,r,t)}else{s=x[r];N(e,s+l+1,t);o=b[s];if(o!==0){r-=T[s];w(e,r,o)}n--;s=Z(n);N(e,s,i);o=v[s];if(o!==0){n-=B[s];w(e,n,o)}}}while(a<e.last_lit)}N(e,f,t)}function L(e,t){var i=t.dyn_tree;var n=t.stat_desc.static_tree;var r=t.stat_desc.has_stree;var a=t.stat_desc.elems;var s,o;var l=-1;var u;e.heap_len=0;e.heap_max=m;for(s=0;s<a;s++){if(i[s*2]!==0){e.heap[++e.heap_len]=l=s;e.depth[s]=0}else{i[s*2+1]=0}}while(e.heap_len<2){u=e.heap[++e.heap_len]=l<2?++l:0;i[u*2]=1;e.depth[u]=0;e.opt_len--;if(r){e.static_len-=n[u*2+1]}}t.max_code=l;for(s=e.heap_len>>1;s>=1;s--){M(e,i,s)}u=a;do{s=e.heap[1];e.heap[1]=e.heap[e.heap_len--];M(e,i,1);o=e.heap[1];e.heap[--e.heap_max]=s;e.heap[--e.heap_max]=o;i[u*2]=i[s*2]+i[o*2];e.depth[u]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1;i[s*2+1]=i[o*2+1]=u;e.heap[1]=u++;M(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1];Q(e,t);J(i,l,e.bl_count)}function ae(e,t,i){var n;var r=-1;var a;var s=t[0*2+1];var o=0;var l=7;var u=4;if(s===0){l=138;u=3}t[(i+1)*2+1]=65535;for(n=0;n<=i;n++){a=s;s=t[(n+1)*2+1];if(++o<l&&a===s){continue}else if(o<u){e.bl_tree[a*2]+=o}else if(a!==0){if(a!==r){e.bl_tree[a*2]++}e.bl_tree[d*2]++}else if(o<=10){e.bl_tree[g*2]++}else{e.bl_tree[p*2]++}o=0;r=a;if(s===0){l=138;u=3}else if(a===s){l=6;u=3}else{l=7;u=4}}}function se(e,t,i){var n;var r=-1;var a;var s=t[0*2+1];var o=0;var l=7;var u=4;if(s===0){l=138;u=3}for(n=0;n<=i;n++){a=s;s=t[(n+1)*2+1];if(++o<l&&a===s){continue}else if(o<u){do{N(e,a,e.bl_tree)}while(--o!==0)}else if(a!==0){if(a!==r){N(e,a,e.bl_tree);o--}N(e,d,e.bl_tree);w(e,o-3,2)}else if(o<=10){N(e,g,e.bl_tree);w(e,o-3,3)}else{N(e,p,e.bl_tree);w(e,o-11,7)}o=0;r=a;if(s===0){l=138;u=3}else if(a===s){l=6;u=3}else{l=7;u=4}}}function oe(e){var t;ae(e,e.dyn_ltree,e.l_desc.max_code);ae(e,e.dyn_dtree,e.d_desc.max_code);L(e,e.bl_desc);for(t=c-1;t>=3;t--){if(e.bl_tree[E[t]*2+1]!==0){break}}e.opt_len+=3*(t+1)+5+5+4;return t}function le(e,t,i,n){var r;w(e,t-257,5);w(e,i-1,5);w(e,n-4,4);for(r=0;r<n;r++){w(e,e.bl_tree[E[r]*2+1],3)}se(e,e.dyn_ltree,t-1);se(e,e.dyn_dtree,i-1)}function ue(e){var t=4093624447;var i;for(i=0;i<=31;i++,t>>>=1){if(t&1&&e.dyn_ltree[i*2]!==0){return n}}if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0){return r}for(i=32;i<l;i++){if(e.dyn_ltree[i*2]!==0){return r}}return n}var he=false;function ce(e){if(!he){$();he=true}e.l_desc=new i(e.dyn_ltree,D);e.d_desc=new i(e.dyn_dtree,S);e.bl_desc=new i(e.bl_tree,O);e.bi_buf=0;e.bi_valid=0;ee(e)}function fe(e,t,i,n){w(e,(G<<1)+(n?1:0),3);ie(e,t,i,true)}function de(e){w(e,o<<1,3);N(e,f,F);K(e)}function ge(e,t,i,n){var r,a;var s=0;if(e.level>0){if(e.strm.data_type===V){e.strm.data_type=ue(e)}L(e,e.l_desc);L(e,e.d_desc);s=oe(e);r=e.opt_len+3+7>>>3;a=e.static_len+3+7>>>3;if(a<=r){r=a}}else{r=a=i+5}if(i+4<=r&&t!==-1){fe(e,t,i,n)}else if(e.strategy===U||a===r){w(e,(o<<1)+(n?1:0),3);re(e,F,A)}else{w(e,(j<<1)+(n?1:0),3);le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1);re(e,e.dyn_ltree,e.dyn_dtree)}ee(e);if(n){te(e)}}function pe(e,t,i){e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255;e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255;e.pending_buf[e.l_buf+e.last_lit]=i&255;e.last_lit++;if(t===0){e.dyn_ltree[i*2]++}else{e.matches++;t--;e.dyn_ltree[(x[i]+l+1)*2]++;e.dyn_dtree[Z(t)*2]++}return e.last_lit===e.lit_bufsize-1}e._tr_init=ce;e._tr_stored_block=fe;e._tr_flush_block=ge;e._tr_tally=pe;e._tr_align=de},{"../utils/common":41}],53:[function(e,t,i){"use strict";function n(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}t.exports=n},{}],54:[function(e,t,i){"use strict";t.exports=typeof setImmediate==="function"?setImmediate:function e(){var t=[].slice.apply(arguments);t.splice(1,0,0);setTimeout.apply(null,t)}},{}]},{},[10])(10)});(()=>{var Ns={};(()=>{Ns.d=(e,t)=>{for(var i in t){if(Ns.o(t,i)&&!Ns.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{Ns.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{Ns.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var Ms={};(()=>{"use strict";Ns.r(Ms);Ns.d(Ms,{CGL:()=>ws,Framebuffer2:()=>Es,Geometry:()=>c,Mesh:()=>m,Shader:()=>E,Texture:()=>F,Uniform:()=>p});var D={};Ns.r(D);Ns.d(D,{ARRAY_TYPE:()=>_,EPSILON:()=>M,RANDOM:()=>u,equals:()=>q,setMatrixArrayType:()=>Y,toRadian:()=>Z});var S={};Ns.r(S);Ns.d(S,{LDU:()=>de,add:()=>ge,adjoint:()=>re,clone:()=>Q,copy:()=>J,create:()=>K,determinant:()=>ae,equals:()=>_e,exactEquals:()=>me,frob:()=>fe,fromRotation:()=>ue,fromScaling:()=>he,fromValues:()=>ee,identity:()=>$,invert:()=>ne,mul:()=>Ee,multiply:()=>se,multiplyScalar:()=>be,multiplyScalarAndAdd:()=>ve,rotate:()=>oe,scale:()=>le,set:()=>te,str:()=>ce,sub:()=>Fe,subtract:()=>pe,transpose:()=>ie});var O={};Ns.r(O);Ns.d(O,{add:()=>Ue,clone:()=>Ce,copy:()=>xe,create:()=>Ae,determinant:()=>Se,equals:()=>He,exactEquals:()=>ze,frob:()=>ke,fromRotation:()=>Me,fromScaling:()=>Le,fromTranslation:()=>Re,fromValues:()=>Be,identity:()=>Te,invert:()=>De,mul:()=>We,multiply:()=>Oe,multiplyScalar:()=>Ge,multiplyScalarAndAdd:()=>je,rotate:()=>ye,scale:()=>we,set:()=>Ie,str:()=>Pe,sub:()=>Ye,subtract:()=>Ve,translate:()=>Ne});var y={};Ns.r(y);Ns.d(y,{add:()=>_t,adjoint:()=>it,clone:()=>qe,copy:()=>Ke,create:()=>Xe,determinant:()=>nt,equals:()=>At,exactEquals:()=>Ft,frob:()=>mt,fromMat2d:()=>ct,fromMat4:()=>Ze,fromQuat:()=>ft,fromRotation:()=>ut,fromScaling:()=>ht,fromTranslation:()=>lt,fromValues:()=>Qe,identity:()=>$e,invert:()=>tt,mul:()=>Ct,multiply:()=>rt,multiplyScalar:()=>vt,multiplyScalarAndAdd:()=>Et,normalFromMat4:()=>dt,projection:()=>gt,rotate:()=>st,scale:()=>ot,set:()=>Je,str:()=>pt,sub:()=>xt,subtract:()=>bt,translate:()=>at,transpose:()=>et});var w={};Ns.r(w);Ns.d(w,{add:()=>si,adjoint:()=>Ot,clone:()=>Tt,copy:()=>Bt,create:()=>n,determinant:()=>yt,equals:()=>ci,exactEquals:()=>hi,frob:()=>ai,fromQuat:()=>Qt,fromQuat2:()=>Wt,fromRotation:()=>Vt,fromRotationTranslation:()=>Ht,fromRotationTranslationScale:()=>qt,fromRotationTranslationScaleOrigin:()=>Kt,fromScaling:()=>Ut,fromTranslation:()=>kt,fromValues:()=>It,fromXRotation:()=>Gt,fromYRotation:()=>jt,fromZRotation:()=>zt,frustum:()=>Jt,getRotation:()=>Zt,getScaling:()=>Xt,getTranslation:()=>Yt,identity:()=>C,invert:()=>t,lookAt:()=>ii,mul:()=>fi,multiply:()=>wt,multiplyScalar:()=>li,multiplyScalarAndAdd:()=>ui,ortho:()=>ti,perspective:()=>$t,perspectiveFromFieldOfView:()=>ei,rotate:()=>Mt,rotateX:()=>Lt,rotateY:()=>Rt,rotateZ:()=>Pt,scale:()=>Nt,set:()=>Dt,str:()=>ri,sub:()=>di,subtract:()=>oi,targetTo:()=>ni,translate:()=>r,transpose:()=>St});var N={};Ns.r(N);Ns.d(N,{add:()=>_i,angle:()=>ji,bezier:()=>Mi,ceil:()=>Ei,clone:()=>gi,copy:()=>mi,create:()=>P,cross:()=>j,dist:()=>Ki,distance:()=>Ii,div:()=>qi,divide:()=>vi,dot:()=>G,equals:()=>Yi,exactEquals:()=>Wi,floor:()=>Fi,forEach:()=>en,fromValues:()=>o,hermite:()=>Ni,inverse:()=>yi,len:()=>Ji,length:()=>pi,lerp:()=>wi,max:()=>Ci,min:()=>Ai,mul:()=>Zi,multiply:()=>bi,negate:()=>Oi,normalize:()=>V,random:()=>Li,rotateX:()=>Ui,rotateY:()=>Vi,rotateZ:()=>Gi,round:()=>xi,scale:()=>Ti,scaleAndAdd:()=>Bi,set:()=>k,sqrDist:()=>Qi,sqrLen:()=>$i,squaredDistance:()=>Di,squaredLength:()=>Si,str:()=>Hi,sub:()=>Xi,subtract:()=>U,transformMat3:()=>Pi,transformMat4:()=>Ri,transformQuat:()=>ki,zero:()=>zi});var L={};Ns.r(L);Ns.d(L,{add:()=>on,ceil:()=>cn,clone:()=>nn,copy:()=>an,create:()=>tn,cross:()=>Bn,dist:()=>kn,distance:()=>bn,div:()=>Pn,divide:()=>hn,dot:()=>Tn,equals:()=>Mn,exactEquals:()=>Nn,floor:()=>fn,forEach:()=>jn,fromValues:()=>rn,inverse:()=>Cn,len:()=>Vn,length:()=>En,lerp:()=>In,max:()=>gn,min:()=>dn,mul:()=>Rn,multiply:()=>un,negate:()=>An,normalize:()=>xn,random:()=>Dn,round:()=>pn,scale:()=>mn,scaleAndAdd:()=>_n,set:()=>sn,sqrDist:()=>Un,sqrLen:()=>Gn,squaredDistance:()=>vn,squaredLength:()=>Fn,str:()=>wn,sub:()=>Ln,subtract:()=>ln,transformMat4:()=>Sn,transformQuat:()=>On,zero:()=>yn});var R={};Ns.r(R);Ns.d(R,{add:()=>cr,calculateW:()=>Qn,clone:()=>or,conjugate:()=>nr,copy:()=>ur,create:()=>a,dot:()=>gr,equals:()=>Ar,exactEquals:()=>Fr,exp:()=>Jn,fromEuler:()=>ar,fromMat3:()=>rr,fromValues:()=>lr,getAngle:()=>Yn,getAxisAngle:()=>Wn,identity:()=>zn,invert:()=>ir,len:()=>_r,length:()=>mr,lerp:()=>pr,ln:()=>$n,mul:()=>fr,multiply:()=>Xn,normalize:()=>Er,pow:()=>er,random:()=>tr,rotateX:()=>Zn,rotateY:()=>qn,rotateZ:()=>Kn,rotationTo:()=>Cr,scale:()=>dr,set:()=>hr,setAxes:()=>Tr,setAxisAngle:()=>Hn,slerp:()=>l,sqlerp:()=>xr,sqrLen:()=>vr,squaredLength:()=>br,str:()=>sr});var H={};Ns.r(H);Ns.d(H,{add:()=>qr,clone:()=>Ir,conjugate:()=>ia,copy:()=>Mr,create:()=>Br,dot:()=>$r,equals:()=>ua,exactEquals:()=>la,fromMat4:()=>Nr,fromRotation:()=>wr,fromRotationTranslation:()=>Or,fromRotationTranslationValues:()=>Sr,fromTranslation:()=>yr,fromValues:()=>Dr,getDual:()=>kr,getReal:()=>Pr,getTranslation:()=>Gr,identity:()=>Lr,invert:()=>ta,len:()=>ra,length:()=>na,lerp:()=>ea,mul:()=>Qr,multiply:()=>Kr,normalize:()=>sa,rotateAroundAxis:()=>Zr,rotateByQuatAppend:()=>Yr,rotateByQuatPrepend:()=>Xr,rotateX:()=>zr,rotateY:()=>Hr,rotateZ:()=>Wr,scale:()=>Jr,set:()=>Rr,setDual:()=>Vr,setReal:()=>Ur,sqrLen:()=>aa,squaredLength:()=>f,str:()=>oa,translate:()=>jr});var W={};Ns.r(W);Ns.d(W,{add:()=>da,angle:()=>Va,ceil:()=>_a,clone:()=>ha,copy:()=>fa,create:()=>e,cross:()=>wa,dist:()=>qa,distance:()=>xa,div:()=>Za,divide:()=>ma,dot:()=>ya,equals:()=>Ha,exactEquals:()=>za,floor:()=>ba,forEach:()=>Ja,fromValues:()=>ca,inverse:()=>Sa,len:()=>Wa,length:()=>Ba,lerp:()=>Na,max:()=>Ea,min:()=>va,mul:()=>Xa,multiply:()=>pa,negate:()=>Da,normalize:()=>Oa,random:()=>Ma,rotate:()=>Ua,round:()=>Fa,scale:()=>Aa,scaleAndAdd:()=>Ca,set:()=>z,sqrDist:()=>Ka,sqrLen:()=>Qa,squaredDistance:()=>Ta,squaredLength:()=>Ia,str:()=>ja,sub:()=>Ya,subtract:()=>ga,transformMat2:()=>La,transformMat2d:()=>Ra,transformMat3:()=>Pa,transformMat4:()=>ka,zero:()=>Ga});const A=CABLES;const h=CABLES.SHARED;var M=1e-6;var _=typeof Float32Array!=="undefined"?Float32Array:Array;var u=Math.random;function Y(e){_=e}var X=Math.PI/180;function Z(e){return e*X}function q(e,t){return Math.abs(e-t)<=M*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)};function K(){var e=new _(4);if(_!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function Q(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function J(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function $(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function ee(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function te(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function ie(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function ne(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=i*a-r*n;if(!s){return null}s=1/s;e[0]=a*s;e[1]=-n*s;e[2]=-r*s;e[3]=i*s;return e}function re(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function ae(e){return e[0]*e[3]-e[2]*e[1]}function se(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*o+a*l;e[1]=r*o+s*l;e[2]=n*u+a*h;e[3]=r*u+s*h;return e}function oe(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=n*l+a*o;e[1]=r*l+s*o;e[2]=n*-o+a*l;e[3]=r*-o+s*l;return e}function le(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=i[0],l=i[1];e[0]=n*o;e[1]=r*o;e[2]=a*l;e[3]=s*l;return e}function ue(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;return e}function he(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function ce(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fe(e){return Math.hypot(e[0],e[1],e[2],e[3])}function de(e,t,i,n){e[2]=n[2]/n[0];i[0]=n[0];i[1]=n[1];i[3]=n[3]-e[2]*i[1];return[e,t,i]}function ge(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function pe(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function me(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _e(e,t){var i=e[0],n=e[1],r=e[2],a=e[3];var s=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-s)<=M*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=M*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=M*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=M*Math.max(1,Math.abs(a),Math.abs(u))}function be(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function ve(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}var Ee=se;var Fe=pe;function Ae(){var e=new _(6);if(_!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function Ce(e){var t=new _(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function xe(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Te(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Be(e,t,i,n,r,a){var s=new _(6);s[0]=e;s[1]=t;s[2]=i;s[3]=n;s[4]=r;s[5]=a;return s}function Ie(e,t,i,n,r,a,s){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=a;e[5]=s;return e}function De(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=t[4],o=t[5];var l=i*a-n*r;if(!l){return null}l=1/l;e[0]=a*l;e[1]=-n*l;e[2]=-r*l;e[3]=i*l;e[4]=(r*o-a*s)*l;e[5]=(n*s-i*o)*l;return e}function Se(e){return e[0]*e[3]-e[1]*e[2]}function Oe(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5];var u=i[0],h=i[1],c=i[2],f=i[3],d=i[4],g=i[5];e[0]=n*u+a*h;e[1]=r*u+s*h;e[2]=n*c+a*f;e[3]=r*c+s*f;e[4]=n*d+a*g+o;e[5]=r*d+s*g+l;return e}function ye(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5];var u=Math.sin(i);var h=Math.cos(i);e[0]=n*h+a*u;e[1]=r*h+s*u;e[2]=n*-u+a*h;e[3]=r*-u+s*h;e[4]=o;e[5]=l;return e}function we(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=n*u;e[1]=r*u;e[2]=a*h;e[3]=s*h;e[4]=o;e[5]=l;return e}function Ne(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=n;e[1]=r;e[2]=a;e[3]=s;e[4]=n*u+a*h+o;e[5]=r*u+s*h+l;return e}function Me(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;e[4]=0;e[5]=0;return e}function Le(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function Re(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function Pe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ke(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Ue(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function Ve(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function Ge(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function je(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;return e}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function He(e,t){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5];var l=t[0],u=t[1],h=t[2],c=t[3],f=t[4],d=t[5];return Math.abs(i-l)<=M*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-u)<=M*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=M*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-c)<=M*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-f)<=M*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-d)<=M*Math.max(1,Math.abs(o),Math.abs(d))}var We=Oe;var Ye=Ve;function Xe(){var e=new _(9);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function Ze(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function qe(e){var t=new _(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Ke(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function Qe(e,t,i,n,r,a,s,o,l){var u=new _(9);u[0]=e;u[1]=t;u[2]=i;u[3]=n;u[4]=r;u[5]=a;u[6]=s;u[7]=o;u[8]=l;return u}function Je(e,t,i,n,r,a,s,o,l,u){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=a;e[5]=s;e[6]=o;e[7]=l;e[8]=u;return e}function $e(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function et(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=n;e[7]=r}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function tt(e,t){var i=t[0],n=t[1],r=t[2];var a=t[3],s=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];var c=h*s-o*u;var f=-h*a+o*l;var d=u*a-s*l;var g=i*c+n*f+r*d;if(!g){return null}g=1/g;e[0]=c*g;e[1]=(-h*n+r*u)*g;e[2]=(o*n-r*s)*g;e[3]=f*g;e[4]=(h*i-r*l)*g;e[5]=(-o*i+r*a)*g;e[6]=d*g;e[7]=(-u*i+n*l)*g;e[8]=(s*i-n*a)*g;return e}function it(e,t){var i=t[0],n=t[1],r=t[2];var a=t[3],s=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];e[0]=s*h-o*u;e[1]=r*u-n*h;e[2]=n*o-r*s;e[3]=o*l-a*h;e[4]=i*h-r*l;e[5]=r*a-i*o;e[6]=a*u-s*l;e[7]=n*l-i*u;e[8]=i*s-n*a;return e}function nt(e){var t=e[0],i=e[1],n=e[2];var r=e[3],a=e[4],s=e[5];var o=e[6],l=e[7],u=e[8];return t*(u*a-s*l)+i*(-u*r+s*o)+n*(l*r-a*o)}function rt(e,t,i){var n=t[0],r=t[1],a=t[2];var s=t[3],o=t[4],l=t[5];var u=t[6],h=t[7],c=t[8];var f=i[0],d=i[1],g=i[2];var p=i[3],m=i[4],_=i[5];var b=i[6],v=i[7],E=i[8];e[0]=f*n+d*s+g*u;e[1]=f*r+d*o+g*h;e[2]=f*a+d*l+g*c;e[3]=p*n+m*s+_*u;e[4]=p*r+m*o+_*h;e[5]=p*a+m*l+_*c;e[6]=b*n+v*s+E*u;e[7]=b*r+v*o+E*h;e[8]=b*a+v*l+E*c;return e}function at(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=i[0],d=i[1];e[0]=n;e[1]=r;e[2]=a;e[3]=s;e[4]=o;e[5]=l;e[6]=f*n+d*s+u;e[7]=f*r+d*o+h;e[8]=f*a+d*l+c;return e}function st(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=Math.sin(i),d=Math.cos(i);e[0]=d*n+f*s;e[1]=d*r+f*o;e[2]=d*a+f*l;e[3]=d*s-f*n;e[4]=d*o-f*r;e[5]=d*l-f*a;e[6]=u;e[7]=h;e[8]=c;return e}function ot(e,t,i){var n=i[0],r=i[1];e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=r*t[3];e[4]=r*t[4];e[5]=r*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function lt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function ut(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=-i;e[4]=n;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ht(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ct(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function ft(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=i+i;var o=n+n;var l=r+r;var u=i*s;var h=n*s;var c=n*o;var f=r*s;var d=r*o;var g=r*l;var p=a*s;var m=a*o;var _=a*l;e[0]=1-c-g;e[3]=h-_;e[6]=f+m;e[1]=h+_;e[4]=1-u-g;e[7]=d-p;e[2]=f-m;e[5]=d+p;e[8]=1-u-c;return e}function dt(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*s;var v=i*l-r*s;var E=i*u-a*s;var F=n*l-r*o;var A=n*u-a*o;var C=r*u-a*l;var x=h*p-c*g;var T=h*m-f*g;var B=h*_-d*g;var I=c*m-f*p;var D=c*_-d*p;var S=f*_-d*m;var O=b*S-v*D+E*I+F*B-A*T+C*x;if(!O){return null}O=1/O;e[0]=(o*S-l*D+u*I)*O;e[1]=(l*B-s*S-u*T)*O;e[2]=(s*D-o*B+u*x)*O;e[3]=(r*D-n*S-a*I)*O;e[4]=(i*S-r*B+a*T)*O;e[5]=(n*B-i*D-a*x)*O;e[6]=(p*C-m*A+_*F)*O;e[7]=(m*E-g*C-_*v)*O;e[8]=(g*A-p*E+_*b)*O;return e}function gt(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function pt(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function mt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function _t(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function bt(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function vt(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function Et(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;return e}function Ft(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function At(e,t){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],h=e[8];var c=t[0],f=t[1],d=t[2],g=t[3],p=t[4],m=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=M*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=M*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=M*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-g)<=M*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-p)<=M*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-m)<=M*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=M*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-b)<=M*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=M*Math.max(1,Math.abs(h),Math.abs(v))}var Ct=rt;var xt=bt;function n(){var e=new _(16);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function Tt(e){var t=new _(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function Bt(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function It(e,t,i,n,r,a,s,o,l,u,h,c,f,d,g,p){var m=new _(16);m[0]=e;m[1]=t;m[2]=i;m[3]=n;m[4]=r;m[5]=a;m[6]=s;m[7]=o;m[8]=l;m[9]=u;m[10]=h;m[11]=c;m[12]=f;m[13]=d;m[14]=g;m[15]=p;return m}function Dt(e,t,i,n,r,a,s,o,l,u,h,c,f,d,g,p,m){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=a;e[5]=s;e[6]=o;e[7]=l;e[8]=u;e[9]=h;e[10]=c;e[11]=f;e[12]=d;e[13]=g;e[14]=p;e[15]=m;return e}function C(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function St(e,t){if(e===t){var i=t[1],n=t[2],r=t[3];var a=t[6],s=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=n;e[9]=a;e[11]=t[14];e[12]=r;e[13]=s;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function t(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*s;var v=i*l-r*s;var E=i*u-a*s;var F=n*l-r*o;var A=n*u-a*o;var C=r*u-a*l;var x=h*p-c*g;var T=h*m-f*g;var B=h*_-d*g;var I=c*m-f*p;var D=c*_-d*p;var S=f*_-d*m;var O=b*S-v*D+E*I+F*B-A*T+C*x;if(!O){return null}O=1/O;e[0]=(o*S-l*D+u*I)*O;e[1]=(r*D-n*S-a*I)*O;e[2]=(p*C-m*A+_*F)*O;e[3]=(f*A-c*C-d*F)*O;e[4]=(l*B-s*S-u*T)*O;e[5]=(i*S-r*B+a*T)*O;e[6]=(m*E-g*C-_*v)*O;e[7]=(h*C-f*E+d*v)*O;e[8]=(s*D-o*B+u*x)*O;e[9]=(n*B-i*D-a*x)*O;e[10]=(g*A-p*E+_*b)*O;e[11]=(c*E-h*A-d*b)*O;e[12]=(o*T-s*I-l*x)*O;e[13]=(i*I-n*T+r*x)*O;e[14]=(p*v-g*F-m*b)*O;e[15]=(h*F-c*v+f*b)*O;return e}function Ot(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];e[0]=o*(f*_-d*m)-c*(l*_-u*m)+p*(l*d-u*f);e[1]=-(n*(f*_-d*m)-c*(r*_-a*m)+p*(r*d-a*f));e[2]=n*(l*_-u*m)-o*(r*_-a*m)+p*(r*u-a*l);e[3]=-(n*(l*d-u*f)-o*(r*d-a*f)+c*(r*u-a*l));e[4]=-(s*(f*_-d*m)-h*(l*_-u*m)+g*(l*d-u*f));e[5]=i*(f*_-d*m)-h*(r*_-a*m)+g*(r*d-a*f);e[6]=-(i*(l*_-u*m)-s*(r*_-a*m)+g*(r*u-a*l));e[7]=i*(l*d-u*f)-s*(r*d-a*f)+h*(r*u-a*l);e[8]=s*(c*_-d*p)-h*(o*_-u*p)+g*(o*d-u*c);e[9]=-(i*(c*_-d*p)-h*(n*_-a*p)+g*(n*d-a*c));e[10]=i*(o*_-u*p)-s*(n*_-a*p)+g*(n*u-a*o);e[11]=-(i*(o*d-u*c)-s*(n*d-a*c)+h*(n*u-a*o));e[12]=-(s*(c*m-f*p)-h*(o*m-l*p)+g*(o*f-l*c));e[13]=i*(c*m-f*p)-h*(n*m-r*p)+g*(n*f-r*c);e[14]=-(i*(o*m-l*p)-s*(n*m-r*p)+g*(n*l-r*o));e[15]=i*(o*f-l*c)-s*(n*f-r*c)+h*(n*l-r*o);return e}function yt(e){var t=e[0],i=e[1],n=e[2],r=e[3];var a=e[4],s=e[5],o=e[6],l=e[7];var u=e[8],h=e[9],c=e[10],f=e[11];var d=e[12],g=e[13],p=e[14],m=e[15];var _=t*s-i*a;var b=t*o-n*a;var v=t*l-r*a;var E=i*o-n*s;var F=i*l-r*s;var A=n*l-r*o;var C=u*g-h*d;var x=u*p-c*d;var T=u*m-f*d;var B=h*p-c*g;var I=h*m-f*g;var D=c*m-f*p;return _*D-b*I+v*B+E*T-F*x+A*C}function wt(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=t[4],l=t[5],u=t[6],h=t[7];var c=t[8],f=t[9],d=t[10],g=t[11];var p=t[12],m=t[13],_=t[14],b=t[15];var v=i[0],E=i[1],F=i[2],A=i[3];e[0]=v*n+E*o+F*c+A*p;e[1]=v*r+E*l+F*f+A*m;e[2]=v*a+E*u+F*d+A*_;e[3]=v*s+E*h+F*g+A*b;v=i[4];E=i[5];F=i[6];A=i[7];e[4]=v*n+E*o+F*c+A*p;e[5]=v*r+E*l+F*f+A*m;e[6]=v*a+E*u+F*d+A*_;e[7]=v*s+E*h+F*g+A*b;v=i[8];E=i[9];F=i[10];A=i[11];e[8]=v*n+E*o+F*c+A*p;e[9]=v*r+E*l+F*f+A*m;e[10]=v*a+E*u+F*d+A*_;e[11]=v*s+E*h+F*g+A*b;v=i[12];E=i[13];F=i[14];A=i[15];e[12]=v*n+E*o+F*c+A*p;e[13]=v*r+E*l+F*f+A*m;e[14]=v*a+E*u+F*d+A*_;e[15]=v*s+E*h+F*g+A*b;return e}function r(e,t,i){var n=i[0],r=i[1],a=i[2];var s,o,l,u;var h,c,f,d;var g,p,m,_;if(t===e){e[12]=t[0]*n+t[4]*r+t[8]*a+t[12];e[13]=t[1]*n+t[5]*r+t[9]*a+t[13];e[14]=t[2]*n+t[6]*r+t[10]*a+t[14];e[15]=t[3]*n+t[7]*r+t[11]*a+t[15]}else{s=t[0];o=t[1];l=t[2];u=t[3];h=t[4];c=t[5];f=t[6];d=t[7];g=t[8];p=t[9];m=t[10];_=t[11];e[0]=s;e[1]=o;e[2]=l;e[3]=u;e[4]=h;e[5]=c;e[6]=f;e[7]=d;e[8]=g;e[9]=p;e[10]=m;e[11]=_;e[12]=s*n+h*r+g*a+t[12];e[13]=o*n+c*r+p*a+t[13];e[14]=l*n+f*r+m*a+t[14];e[15]=u*n+d*r+_*a+t[15]}return e}function Nt(e,t,i){var n=i[0],r=i[1],a=i[2];e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;e[3]=t[3]*n;e[4]=t[4]*r;e[5]=t[5]*r;e[6]=t[6]*r;e[7]=t[7]*r;e[8]=t[8]*a;e[9]=t[9]*a;e[10]=t[10]*a;e[11]=t[11]*a;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Mt(e,t,i,n){var r=n[0],a=n[1],s=n[2];var o=Math.hypot(r,a,s);var l,u,h;var c,f,d,g;var p,m,_,b;var v,E,F,A;var C,x,T;var B,I,D;var S,O,y;if(o<M){return null}o=1/o;r*=o;a*=o;s*=o;l=Math.sin(i);u=Math.cos(i);h=1-u;c=t[0];f=t[1];d=t[2];g=t[3];p=t[4];m=t[5];_=t[6];b=t[7];v=t[8];E=t[9];F=t[10];A=t[11];C=r*r*h+u;x=a*r*h+s*l;T=s*r*h-a*l;B=r*a*h-s*l;I=a*a*h+u;D=s*a*h+r*l;S=r*s*h+a*l;O=a*s*h-r*l;y=s*s*h+u;e[0]=c*C+p*x+v*T;e[1]=f*C+m*x+E*T;e[2]=d*C+_*x+F*T;e[3]=g*C+b*x+A*T;e[4]=c*B+p*I+v*D;e[5]=f*B+m*I+E*D;e[6]=d*B+_*I+F*D;e[7]=g*B+b*I+A*D;e[8]=c*S+p*O+v*y;e[9]=f*S+m*O+E*y;e[10]=d*S+_*O+F*y;e[11]=g*S+b*O+A*y;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function Lt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var a=t[4];var s=t[5];var o=t[6];var l=t[7];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=a*r+u*n;e[5]=s*r+h*n;e[6]=o*r+c*n;e[7]=l*r+f*n;e[8]=u*r-a*n;e[9]=h*r-s*n;e[10]=c*r-o*n;e[11]=f*r-l*n;return e}function Rt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var a=t[0];var s=t[1];var o=t[2];var l=t[3];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=a*r-u*n;e[1]=s*r-h*n;e[2]=o*r-c*n;e[3]=l*r-f*n;e[8]=a*n+u*r;e[9]=s*n+h*r;e[10]=o*n+c*r;e[11]=l*n+f*r;return e}function Pt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var a=t[0];var s=t[1];var o=t[2];var l=t[3];var u=t[4];var h=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=a*r+u*n;e[1]=s*r+h*n;e[2]=o*r+c*n;e[3]=l*r+f*n;e[4]=u*r-a*n;e[5]=h*r-s*n;e[6]=c*r-o*n;e[7]=f*r-l*n;return e}function kt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function Ut(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Vt(e,t,i){var n=i[0],r=i[1],a=i[2];var s=Math.hypot(n,r,a);var o,l,u;if(s<M){return null}s=1/s;n*=s;r*=s;a*=s;o=Math.sin(t);l=Math.cos(t);u=1-l;e[0]=n*n*u+l;e[1]=r*n*u+a*o;e[2]=a*n*u-r*o;e[3]=0;e[4]=n*r*u-a*o;e[5]=r*r*u+l;e[6]=a*r*u+n*o;e[7]=0;e[8]=n*a*u+r*o;e[9]=r*a*u-n*o;e[10]=a*a*u+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Gt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function jt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function zt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ht(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=n+n;var l=r+r;var u=a+a;var h=n*o;var c=n*l;var f=n*u;var d=r*l;var g=r*u;var p=a*u;var m=s*o;var _=s*l;var b=s*u;e[0]=1-(d+p);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(h+p);e[6]=g+m;e[7]=0;e[8]=f+_;e[9]=g-m;e[10]=1-(h+d);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Wt(e,t){var i=new _(3);var n=-t[0],r=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7];var c=n*n+r*r+a*a+s*s;if(c>0){i[0]=(o*s+h*n+l*a-u*r)*2/c;i[1]=(l*s+h*r+u*n-o*a)*2/c;i[2]=(u*s+h*a+o*r-l*n)*2/c}else{i[0]=(o*s+h*n+l*a-u*r)*2;i[1]=(l*s+h*r+u*n-o*a)*2;i[2]=(u*s+h*a+o*r-l*n)*2}Ht(e,t,i);return e}function Yt(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function Xt(e,t){var i=t[0];var n=t[1];var r=t[2];var a=t[4];var s=t[5];var o=t[6];var l=t[8];var u=t[9];var h=t[10];e[0]=Math.hypot(i,n,r);e[1]=Math.hypot(a,s,o);e[2]=Math.hypot(l,u,h);return e}function Zt(e,t){var i=new _(3);Xt(i,t);var n=1/i[0];var r=1/i[1];var a=1/i[2];var s=t[0]*n;var o=t[1]*r;var l=t[2]*a;var u=t[4]*n;var h=t[5]*r;var c=t[6]*a;var f=t[8]*n;var d=t[9]*r;var g=t[10]*a;var p=s+h+g;var m=0;if(p>0){m=Math.sqrt(p+1)*2;e[3]=.25*m;e[0]=(c-d)/m;e[1]=(f-l)/m;e[2]=(o-u)/m}else if(s>h&&s>g){m=Math.sqrt(1+s-h-g)*2;e[3]=(c-d)/m;e[0]=.25*m;e[1]=(o+u)/m;e[2]=(f+l)/m}else if(h>g){m=Math.sqrt(1+h-s-g)*2;e[3]=(f-l)/m;e[0]=(o+u)/m;e[1]=.25*m;e[2]=(c+d)/m}else{m=Math.sqrt(1+g-s-h)*2;e[3]=(o-u)/m;e[0]=(f+l)/m;e[1]=(c+d)/m;e[2]=.25*m}return e}function qt(e,t,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];var l=r+r;var u=a+a;var h=s+s;var c=r*l;var f=r*u;var d=r*h;var g=a*u;var p=a*h;var m=s*h;var _=o*l;var b=o*u;var v=o*h;var E=n[0];var F=n[1];var A=n[2];e[0]=(1-(g+m))*E;e[1]=(f+v)*E;e[2]=(d-b)*E;e[3]=0;e[4]=(f-v)*F;e[5]=(1-(c+m))*F;e[6]=(p+_)*F;e[7]=0;e[8]=(d+b)*A;e[9]=(p-_)*A;e[10]=(1-(c+g))*A;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Kt(e,t,i,n,r){var a=t[0],s=t[1],o=t[2],l=t[3];var u=a+a;var h=s+s;var c=o+o;var f=a*u;var d=a*h;var g=a*c;var p=s*h;var m=s*c;var _=o*c;var b=l*u;var v=l*h;var E=l*c;var F=n[0];var A=n[1];var C=n[2];var x=r[0];var T=r[1];var B=r[2];var I=(1-(p+_))*F;var D=(d+E)*F;var S=(g-v)*F;var O=(d-E)*A;var y=(1-(f+_))*A;var w=(m+b)*A;var N=(g+v)*C;var M=(m-b)*C;var L=(1-(f+p))*C;e[0]=I;e[1]=D;e[2]=S;e[3]=0;e[4]=O;e[5]=y;e[6]=w;e[7]=0;e[8]=N;e[9]=M;e[10]=L;e[11]=0;e[12]=i[0]+x-(I*x+O*T+N*B);e[13]=i[1]+T-(D*x+y*T+M*B);e[14]=i[2]+B-(S*x+w*T+L*B);e[15]=1;return e}function Qt(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=i+i;var o=n+n;var l=r+r;var u=i*s;var h=n*s;var c=n*o;var f=r*s;var d=r*o;var g=r*l;var p=a*s;var m=a*o;var _=a*l;e[0]=1-c-g;e[1]=h+_;e[2]=f-m;e[3]=0;e[4]=h-_;e[5]=1-u-g;e[6]=d+p;e[7]=0;e[8]=f+m;e[9]=d-p;e[10]=1-u-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Jt(e,t,i,n,r,a,s){var o=1/(i-t);var l=1/(r-n);var u=1/(a-s);e[0]=a*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(r+n)*l;e[10]=(s+a)*u;e[11]=-1;e[12]=0;e[13]=0;e[14]=s*a*2*u;e[15]=0;return e}function $t(e,t,i,n,r){var a=1/Math.tan(t/2),s;e[0]=a/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(r!=null&&r!==Infinity){s=1/(n-r);e[10]=(r+n)*s;e[14]=2*r*n*s}else{e[10]=-1;e[14]=-2*n}return e}function ei(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180);var a=Math.tan(t.downDegrees*Math.PI/180);var s=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(s+o);var u=2/(r+a);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=u;e[6]=0;e[7]=0;e[8]=-((s-o)*l*.5);e[9]=(r-a)*u*.5;e[10]=n/(i-n);e[11]=-1;e[12]=0;e[13]=0;e[14]=n*i/(i-n);e[15]=0;return e}function ti(e,t,i,n,r,a,s){var o=1/(t-i);var l=1/(n-r);var u=1/(a-s);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*u;e[11]=0;e[12]=(t+i)*o;e[13]=(r+n)*l;e[14]=(s+a)*u;e[15]=1;return e}function ii(e,t,i,n){var r,a,s,o,l,u,h,c,f,d;var g=t[0];var p=t[1];var m=t[2];var _=n[0];var b=n[1];var v=n[2];var E=i[0];var F=i[1];var A=i[2];if(Math.abs(g-E)<M&&Math.abs(p-F)<M&&Math.abs(m-A)<M){return C(e)}h=g-E;c=p-F;f=m-A;d=1/Math.hypot(h,c,f);h*=d;c*=d;f*=d;r=b*f-v*c;a=v*h-_*f;s=_*c-b*h;d=Math.hypot(r,a,s);if(!d){r=0;a=0;s=0}else{d=1/d;r*=d;a*=d;s*=d}o=c*s-f*a;l=f*r-h*s;u=h*a-c*r;d=Math.hypot(o,l,u);if(!d){o=0;l=0;u=0}else{d=1/d;o*=d;l*=d;u*=d}e[0]=r;e[1]=o;e[2]=h;e[3]=0;e[4]=a;e[5]=l;e[6]=c;e[7]=0;e[8]=s;e[9]=u;e[10]=f;e[11]=0;e[12]=-(r*g+a*p+s*m);e[13]=-(o*g+l*p+u*m);e[14]=-(h*g+c*p+f*m);e[15]=1;return e}function ni(e,t,i,n){var r=t[0],a=t[1],s=t[2],o=n[0],l=n[1],u=n[2];var h=r-i[0],c=a-i[1],f=s-i[2];var d=h*h+c*c+f*f;if(d>0){d=1/Math.sqrt(d);h*=d;c*=d;f*=d}var g=l*f-u*c,p=u*h-o*f,m=o*c-l*h;d=g*g+p*p+m*m;if(d>0){d=1/Math.sqrt(d);g*=d;p*=d;m*=d}e[0]=g;e[1]=p;e[2]=m;e[3]=0;e[4]=c*m-f*p;e[5]=f*g-h*m;e[6]=h*p-c*g;e[7]=0;e[8]=h;e[9]=c;e[10]=f;e[11]=0;e[12]=r;e[13]=a;e[14]=s;e[15]=1;return e}function ri(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ai(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function si(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function oi(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function li(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function ui(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;e[9]=t[9]+i[9]*n;e[10]=t[10]+i[10]*n;e[11]=t[11]+i[11]*n;e[12]=t[12]+i[12]*n;e[13]=t[13]+i[13]*n;e[14]=t[14]+i[14]*n;e[15]=t[15]+i[15]*n;return e}function hi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var i=e[0],n=e[1],r=e[2],a=e[3];var s=e[4],o=e[5],l=e[6],u=e[7];var h=e[8],c=e[9],f=e[10],d=e[11];var g=e[12],p=e[13],m=e[14],_=e[15];var b=t[0],v=t[1],E=t[2],F=t[3];var A=t[4],C=t[5],x=t[6],T=t[7];var B=t[8],I=t[9],D=t[10],S=t[11];var O=t[12],y=t[13],w=t[14],N=t[15];return Math.abs(i-b)<=M*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-v)<=M*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-E)<=M*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(a-F)<=M*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(s-A)<=M*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-C)<=M*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(l-x)<=M*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-T)<=M*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-B)<=M*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(c-I)<=M*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(f-D)<=M*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(d-S)<=M*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(g-O)<=M*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(p-y)<=M*Math.max(1,Math.abs(p),Math.abs(y))&&Math.abs(m-w)<=M*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(_-N)<=M*Math.max(1,Math.abs(_),Math.abs(N))}var fi=wt;var di=oi;function P(){var e=new _(3);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function gi(e){var t=new _(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function pi(e){var t=e[0];var i=e[1];var n=e[2];return Math.hypot(t,i,n)}function o(e,t,i){var n=new _(3);n[0]=e;n[1]=t;n[2]=i;return n}function mi(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function k(e,t,i,n){e[0]=t;e[1]=i;e[2]=n;return e}function _i(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function U(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function bi(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function vi(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function Ei(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function Fi(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function Ai(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function Ci(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function xi(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function Ti(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function Bi(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;return e}function Ii(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return Math.hypot(i,n,r)}function Di(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return i*i+n*n+r*r}function Si(e){var t=e[0];var i=e[1];var n=e[2];return t*t+i*i+n*n}function Oi(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function yi(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function V(e,t){var i=t[0];var n=t[1];var r=t[2];var a=i*i+n*n+r*r;if(a>0){a=1/Math.sqrt(a)}e[0]=t[0]*a;e[1]=t[1]*a;e[2]=t[2]*a;return e}function G(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function j(e,t,i){var n=t[0],r=t[1],a=t[2];var s=i[0],o=i[1],l=i[2];e[0]=r*l-a*o;e[1]=a*s-n*l;e[2]=n*o-r*s;return e}function wi(e,t,i,n){var r=t[0];var a=t[1];var s=t[2];e[0]=r+n*(i[0]-r);e[1]=a+n*(i[1]-a);e[2]=s+n*(i[2]-s);return e}function Ni(e,t,i,n,r,a){var s=a*a;var o=s*(2*a-3)+1;var l=s*(a-2)+a;var u=s*(a-1);var h=s*(3-2*a);e[0]=t[0]*o+i[0]*l+n[0]*u+r[0]*h;e[1]=t[1]*o+i[1]*l+n[1]*u+r[1]*h;e[2]=t[2]*o+i[2]*l+n[2]*u+r[2]*h;return e}function Mi(e,t,i,n,r,a){var s=1-a;var o=s*s;var l=a*a;var u=o*s;var h=3*a*o;var c=3*l*s;var f=l*a;e[0]=t[0]*u+i[0]*h+n[0]*c+r[0]*f;e[1]=t[1]*u+i[1]*h+n[1]*c+r[1]*f;e[2]=t[2]*u+i[2]*h+n[2]*c+r[2]*f;return e}function Li(e,t){t=t||1;var i=u()*2*Math.PI;var n=u()*2-1;var r=Math.sqrt(1-n*n)*t;e[0]=Math.cos(i)*r;e[1]=Math.sin(i)*r;e[2]=n*t;return e}function Ri(e,t,i){var n=t[0],r=t[1],a=t[2];var s=i[3]*n+i[7]*r+i[11]*a+i[15];s=s||1;e[0]=(i[0]*n+i[4]*r+i[8]*a+i[12])/s;e[1]=(i[1]*n+i[5]*r+i[9]*a+i[13])/s;e[2]=(i[2]*n+i[6]*r+i[10]*a+i[14])/s;return e}function Pi(e,t,i){var n=t[0],r=t[1],a=t[2];e[0]=n*i[0]+r*i[3]+a*i[6];e[1]=n*i[1]+r*i[4]+a*i[7];e[2]=n*i[2]+r*i[5]+a*i[8];return e}function ki(e,t,i){var n=i[0],r=i[1],a=i[2],s=i[3];var o=t[0],l=t[1],u=t[2];var h=r*u-a*l,c=a*o-n*u,f=n*l-r*o;var d=r*f-a*c,g=a*h-n*f,p=n*c-r*h;var m=s*2;h*=m;c*=m;f*=m;d*=2;g*=2;p*=2;e[0]=o+h+d;e[1]=l+c+g;e[2]=u+f+p;return e}function Ui(e,t,i,n){var r=[],a=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];a[0]=r[0];a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n);a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n);e[0]=a[0]+i[0];e[1]=a[1]+i[1];e[2]=a[2]+i[2];return e}function Vi(e,t,i,n){var r=[],a=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n);a[1]=r[1];a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n);e[0]=a[0]+i[0];e[1]=a[1]+i[1];e[2]=a[2]+i[2];return e}function Gi(e,t,i,n){var r=[],a=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n);a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n);a[2]=r[2];e[0]=a[0]+i[0];e[1]=a[1]+i[1];e[2]=a[2]+i[2];return e}function ji(e,t){var i=o(e[0],e[1],e[2]);var n=o(t[0],t[1],t[2]);V(i,i);V(n,n);var r=G(i,n);if(r>1){return 0}else if(r<-1){return Math.PI}else{return Math.acos(r)}}function zi(e){e[0]=0;e[1]=0;e[2]=0;return e}function Hi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Wi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Yi(e,t){var i=e[0],n=e[1],r=e[2];var a=t[0],s=t[1],o=t[2];return Math.abs(i-a)<=M*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=M*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=M*Math.max(1,Math.abs(r),Math.abs(o))}var Xi=U;var Zi=bi;var qi=vi;var Ki=Ii;var Qi=Di;var Ji=pi;var $i=Si;var en=function(){var l=P();return function(e,t,i,n,r,a){var s,o;if(!t){t=3}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(s=i;s<o;s+=t){l[0]=e[s];l[1]=e[s+1];l[2]=e[s+2];r(l,l,a);e[s]=l[0];e[s+1]=l[1];e[s+2]=l[2]}return e}}();function tn(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function nn(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function rn(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function an(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function sn(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function on(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function ln(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function un(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function hn(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function cn(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function fn(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function dn(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function gn(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function pn(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function mn(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function _n(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}function bn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var a=t[3]-e[3];return Math.hypot(i,n,r,a)}function vn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var a=t[3]-e[3];return i*i+n*n+r*r+a*a}function En(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return Math.hypot(t,i,n,r)}function Fn(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return t*t+i*i+n*n+r*r}function An(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function Cn(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function xn(e,t){var i=t[0];var n=t[1];var r=t[2];var a=t[3];var s=i*i+n*n+r*r+a*a;if(s>0){s=1/Math.sqrt(s)}e[0]=i*s;e[1]=n*s;e[2]=r*s;e[3]=a*s;return e}function Tn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Bn(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],a=i[0]*n[2]-i[2]*n[0],s=i[0]*n[3]-i[3]*n[0],o=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],u=i[2]*n[3]-i[3]*n[2];var h=t[0];var c=t[1];var f=t[2];var d=t[3];e[0]=c*u-f*l+d*o;e[1]=-(h*u)+f*s-d*a;e[2]=h*l-c*s+d*r;e[3]=-(h*o)+c*a-f*r;return e}function In(e,t,i,n){var r=t[0];var a=t[1];var s=t[2];var o=t[3];e[0]=r+n*(i[0]-r);e[1]=a+n*(i[1]-a);e[2]=s+n*(i[2]-s);e[3]=o+n*(i[3]-o);return e}function Dn(e,t){t=t||1;var i,n,r,a;var s,o;do{i=u()*2-1;n=u()*2-1;s=i*i+n*n}while(s>=1);do{r=u()*2-1;a=u()*2-1;o=r*r+a*a}while(o>=1);var l=Math.sqrt((1-s)/o);e[0]=t*i;e[1]=t*n;e[2]=t*r*l;e[3]=t*a*l;return e}function Sn(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];e[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*s;e[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*s;e[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*s;e[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*s;return e}function On(e,t,i){var n=t[0],r=t[1],a=t[2];var s=i[0],o=i[1],l=i[2],u=i[3];var h=u*n+o*a-l*r;var c=u*r+l*n-s*a;var f=u*a+s*r-o*n;var d=-s*n-o*r-l*a;e[0]=h*u+d*-s+c*-l-f*-o;e[1]=c*u+d*-o+f*-s-h*-l;e[2]=f*u+d*-l+h*-o-c*-s;e[3]=t[3];return e}function yn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function wn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Nn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Mn(e,t){var i=e[0],n=e[1],r=e[2],a=e[3];var s=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-s)<=M*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=M*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=M*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=M*Math.max(1,Math.abs(a),Math.abs(u))}var Ln=ln;var Rn=un;var Pn=hn;var kn=bn;var Un=vn;var Vn=En;var Gn=Fn;var jn=function(){var l=tn();return function(e,t,i,n,r,a){var s,o;if(!t){t=4}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(s=i;s<o;s+=t){l[0]=e[s];l[1]=e[s+1];l[2]=e[s+2];l[3]=e[s+3];r(l,l,a);e[s]=l[0];e[s+1]=l[1];e[s+2]=l[2];e[s+3]=l[3]}return e}}();function a(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function zn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function Hn(e,t,i){i=i*.5;var n=Math.sin(i);e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=Math.cos(i);return e}function Wn(e,t){var i=Math.acos(t[3])*2;var n=Math.sin(i/2);if(n>M){e[0]=t[0]/n;e[1]=t[1]/n;e[2]=t[2]/n}else{e[0]=1;e[1]=0;e[2]=0}return i}function Yn(e,t){var i=gr(e,t);return Math.acos(2*i*i-1)}function Xn(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*h+s*o+r*u-a*l;e[1]=r*h+s*l+a*o-n*u;e[2]=a*h+s*u+n*l-r*o;e[3]=s*h-n*o-r*l-a*u;return e}function Zn(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],s=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+s*o;e[1]=r*l+a*o;e[2]=a*l-r*o;e[3]=s*l-n*o;return e}function qn(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],s=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l-a*o;e[1]=r*l+s*o;e[2]=a*l+n*o;e[3]=s*l-r*o;return e}function Kn(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],s=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*o;e[1]=r*l-n*o;e[2]=a*l+s*o;e[3]=s*l-a*o;return e}function Qn(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i;e[1]=n;e[2]=r;e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));return e}function Jn(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=Math.sqrt(i*i+n*n+r*r);var o=Math.exp(a);var l=s>0?o*Math.sin(s)/s:0;e[0]=i*l;e[1]=n*l;e[2]=r*l;e[3]=o*Math.cos(s);return e}function $n(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=Math.sqrt(i*i+n*n+r*r);var o=s>0?Math.atan2(s,a)/s:0;e[0]=i*o;e[1]=n*o;e[2]=r*o;e[3]=.5*Math.log(i*i+n*n+r*r+a*a);return e}function er(e,t,i){$n(e,t);dr(e,e,i);Jn(e,e);return e}function l(e,t,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];var l=i[0],u=i[1],h=i[2],c=i[3];var f,d,g,p,m;d=r*l+a*u+s*h+o*c;if(d<0){d=-d;l=-l;u=-u;h=-h;c=-c}if(1-d>M){f=Math.acos(d);g=Math.sin(f);p=Math.sin((1-n)*f)/g;m=Math.sin(n*f)/g}else{p=1-n;m=n}e[0]=p*r+m*l;e[1]=p*a+m*u;e[2]=p*s+m*h;e[3]=p*o+m*c;return e}function tr(e){var t=u();var i=u();var n=u();var r=Math.sqrt(1-t);var a=Math.sqrt(t);e[0]=r*Math.sin(2*Math.PI*i);e[1]=r*Math.cos(2*Math.PI*i);e[2]=a*Math.sin(2*Math.PI*n);e[3]=a*Math.cos(2*Math.PI*n);return e}function ir(e,t){var i=t[0],n=t[1],r=t[2],a=t[3];var s=i*i+n*n+r*r+a*a;var o=s?1/s:0;e[0]=-i*o;e[1]=-n*o;e[2]=-r*o;e[3]=a*o;return e}function nr(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function rr(e,t){var i=t[0]+t[4]+t[8];var n;if(i>0){n=Math.sqrt(i+1);e[3]=.5*n;n=.5/n;e[0]=(t[5]-t[7])*n;e[1]=(t[6]-t[2])*n;e[2]=(t[1]-t[3])*n}else{var r=0;if(t[4]>t[0])r=1;if(t[8]>t[r*3+r])r=2;var a=(r+1)%3;var s=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[a*3+a]-t[s*3+s]+1);e[r]=.5*n;n=.5/n;e[3]=(t[a*3+s]-t[s*3+a])*n;e[a]=(t[a*3+r]+t[r*3+a])*n;e[s]=(t[s*3+r]+t[r*3+s])*n}return e}function ar(e,t,i,n){var r=.5*Math.PI/180;t*=r;i*=r;n*=r;var a=Math.sin(t);var s=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var u=Math.sin(n);var h=Math.cos(n);e[0]=a*l*h-s*o*u;e[1]=s*o*h+a*l*u;e[2]=s*l*u-a*o*h;e[3]=s*l*h+a*o*u;return e}function sr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var or=nn;var lr=rn;var ur=an;var hr=sn;var cr=on;var fr=Xn;var dr=mn;var gr=Tn;var pr=In;var mr=En;var _r=mr;var br=Fn;var vr=br;var Er=xn;var Fr=Nn;var Ar=Mn;var Cr=function(){var r=P();var a=o(1,0,0);var s=o(0,1,0);return function(e,t,i){var n=G(t,i);if(n<-.999999){j(r,a,t);if(Ji(r)<1e-6)j(r,s,t);V(r,r);Hn(e,r,Math.PI);return e}else if(n>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{j(r,t,i);e[0]=r[0];e[1]=r[1];e[2]=r[2];e[3]=1+n;return Er(e,e)}}}();var xr=function(){var s=a();var o=a();return function(e,t,i,n,r,a){l(s,t,r,a);l(o,i,n,a);l(e,s,o,2*a*(1-a));return e}}();var Tr=function(){var r=Xe();return function(e,t,i,n){r[0]=i[0];r[3]=i[1];r[6]=i[2];r[1]=n[0];r[4]=n[1];r[7]=n[2];r[2]=-t[0];r[5]=-t[1];r[8]=-t[2];return Er(e,rr(e,r))}}();function Br(){var e=new _(8);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function Ir(e){var t=new _(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function Dr(e,t,i,n,r,a,s,o){var l=new _(8);l[0]=e;l[1]=t;l[2]=i;l[3]=n;l[4]=r;l[5]=a;l[6]=s;l[7]=o;return l}function Sr(e,t,i,n,r,a,s){var o=new _(8);o[0]=e;o[1]=t;o[2]=i;o[3]=n;var l=r*.5,u=a*.5,h=s*.5;o[4]=l*n+u*i-h*t;o[5]=u*n+h*e-l*i;o[6]=h*n+l*t-u*e;o[7]=-l*e-u*t-h*i;return o}function Or(e,t,i){var n=i[0]*.5,r=i[1]*.5,a=i[2]*.5,s=t[0],o=t[1],l=t[2],u=t[3];e[0]=s;e[1]=o;e[2]=l;e[3]=u;e[4]=n*u+r*l-a*o;e[5]=r*u+a*s-n*l;e[6]=a*u+n*o-r*s;e[7]=-n*s-r*o-a*l;return e}function yr(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function wr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Nr(e,t){var i=a();Zt(i,t);var n=new _(3);Yt(n,t);Or(e,i,n);return e}function Mr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function Lr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Rr(e,t,i,n,r,a,s,o,l){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=a;e[5]=s;e[6]=o;e[7]=l;return e}var Pr=ur;function kr(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var Ur=ur;function Vr(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function Gr(e,t){var i=t[4],n=t[5],r=t[6],a=t[7],s=-t[0],o=-t[1],l=-t[2],u=t[3];e[0]=(i*u+a*s+n*l-r*o)*2;e[1]=(n*u+a*o+r*s-i*l)*2;e[2]=(r*u+a*l+i*o-n*s)*2;return e}function jr(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=i[0]*.5,l=i[1]*.5,u=i[2]*.5,h=t[4],c=t[5],f=t[6],d=t[7];e[0]=n;e[1]=r;e[2]=a;e[3]=s;e[4]=s*o+r*u-a*l+h;e[5]=s*l+a*o-n*u+c;e[6]=s*u+n*l-r*o+f;e[7]=-n*o-r*l-a*u+d;return e}function zr(e,t,i){var n=-t[0],r=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*s+h*n+l*a-u*r,f=l*s+h*r+u*n-o*a,d=u*s+h*a+o*r-l*n,g=h*s-o*n-l*r-u*a;Zn(e,t,i);n=e[0];r=e[1];a=e[2];s=e[3];e[4]=c*s+g*n+f*a-d*r;e[5]=f*s+g*r+d*n-c*a;e[6]=d*s+g*a+c*r-f*n;e[7]=g*s-c*n-f*r-d*a;return e}function Hr(e,t,i){var n=-t[0],r=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*s+h*n+l*a-u*r,f=l*s+h*r+u*n-o*a,d=u*s+h*a+o*r-l*n,g=h*s-o*n-l*r-u*a;qn(e,t,i);n=e[0];r=e[1];a=e[2];s=e[3];e[4]=c*s+g*n+f*a-d*r;e[5]=f*s+g*r+d*n-c*a;e[6]=d*s+g*a+c*r-f*n;e[7]=g*s-c*n-f*r-d*a;return e}function Wr(e,t,i){var n=-t[0],r=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*s+h*n+l*a-u*r,f=l*s+h*r+u*n-o*a,d=u*s+h*a+o*r-l*n,g=h*s-o*n-l*r-u*a;Kn(e,t,i);n=e[0];r=e[1];a=e[2];s=e[3];e[4]=c*s+g*n+f*a-d*r;e[5]=f*s+g*r+d*n-c*a;e[6]=d*s+g*a+c*r-f*n;e[7]=g*s-c*n-f*r-d*a;return e}function Yr(e,t,i){var n=i[0],r=i[1],a=i[2],s=i[3],o=t[0],l=t[1],u=t[2],h=t[3];e[0]=o*s+h*n+l*a-u*r;e[1]=l*s+h*r+u*n-o*a;e[2]=u*s+h*a+o*r-l*n;e[3]=h*s-o*n-l*r-u*a;o=t[4];l=t[5];u=t[6];h=t[7];e[4]=o*s+h*n+l*a-u*r;e[5]=l*s+h*r+u*n-o*a;e[6]=u*s+h*a+o*r-l*n;e[7]=h*s-o*n-l*r-u*a;return e}function Xr(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*h+s*o+r*u-a*l;e[1]=r*h+s*l+a*o-n*u;e[2]=a*h+s*u+n*l-r*o;e[3]=s*h-n*o-r*l-a*u;o=i[4];l=i[5];u=i[6];h=i[7];e[4]=n*h+s*o+r*u-a*l;e[5]=r*h+s*l+a*o-n*u;e[6]=a*h+s*u+n*l-r*o;e[7]=s*h-n*o-r*l-a*u;return e}function Zr(e,t,i,n){if(Math.abs(n)<M){return Mr(e,t)}var r=Math.hypot(i[0],i[1],i[2]);n=n*.5;var a=Math.sin(n);var s=a*i[0]/r;var o=a*i[1]/r;var l=a*i[2]/r;var u=Math.cos(n);var h=t[0],c=t[1],f=t[2],d=t[3];e[0]=h*u+d*s+c*l-f*o;e[1]=c*u+d*o+f*s-h*l;e[2]=f*u+d*l+h*o-c*s;e[3]=d*u-h*s-c*o-f*l;var g=t[4],p=t[5],m=t[6],_=t[7];e[4]=g*u+_*s+p*l-m*o;e[5]=p*u+_*o+m*s-g*l;e[6]=m*u+_*l+g*o-p*s;e[7]=_*u-g*s-p*o-m*l;return e}function qr(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function Kr(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=i[4],l=i[5],u=i[6],h=i[7],c=t[4],f=t[5],d=t[6],g=t[7],p=i[0],m=i[1],_=i[2],b=i[3];e[0]=n*b+s*p+r*_-a*m;e[1]=r*b+s*m+a*p-n*_;e[2]=a*b+s*_+n*m-r*p;e[3]=s*b-n*p-r*m-a*_;e[4]=n*h+s*o+r*u-a*l+c*b+g*p+f*_-d*m;e[5]=r*h+s*l+a*o-n*u+f*b+g*m+d*p-c*_;e[6]=a*h+s*u+n*l-r*o+d*b+g*_+c*m-f*p;e[7]=s*h-n*o-r*l-a*u+g*b-c*p-f*m-d*_;return e}var Qr=Kr;function Jr(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var $r=gr;function ea(e,t,i,n){var r=1-n;if($r(t,i)<0)n=-n;e[0]=t[0]*r+i[0]*n;e[1]=t[1]*r+i[1]*n;e[2]=t[2]*r+i[2]*n;e[3]=t[3]*r+i[3]*n;e[4]=t[4]*r+i[4]*n;e[5]=t[5]*r+i[5]*n;e[6]=t[6]*r+i[6]*n;e[7]=t[7]*r+i[7]*n;return e}function ta(e,t){var i=f(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function ia(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var na=mr;var ra=na;var f=br;var aa=f;function sa(e,t){var i=f(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i;var r=t[1]/i;var a=t[2]/i;var s=t[3]/i;var o=t[4];var l=t[5];var u=t[6];var h=t[7];var c=n*o+r*l+a*u+s*h;e[0]=n;e[1]=r;e[2]=a;e[3]=s;e[4]=(o-n*c)/i;e[5]=(l-r*c)/i;e[6]=(u-a*c)/i;e[7]=(h-s*c)/i}return e}function oa(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function la(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function ua(e,t){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7];var h=t[0],c=t[1],f=t[2],d=t[3],g=t[4],p=t[5],m=t[6],_=t[7];return Math.abs(i-h)<=M*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=M*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=M*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-d)<=M*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-g)<=M*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-p)<=M*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=M*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(u-_)<=M*Math.max(1,Math.abs(u),Math.abs(_))}function e(){var e=new _(2);if(_!=Float32Array){e[0]=0;e[1]=0}return e}function ha(e){var t=new _(2);t[0]=e[0];t[1]=e[1];return t}function ca(e,t){var i=new _(2);i[0]=e;i[1]=t;return i}function fa(e,t){e[0]=t[0];e[1]=t[1];return e}function z(e,t,i){e[0]=t;e[1]=i;return e}function da(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function ga(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function pa(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function ma(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function _a(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function ba(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function va(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function Ea(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function Fa(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function Aa(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function Ca(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;return e}function xa(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.hypot(i,n)}function Ta(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Ba(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function Ia(e){var t=e[0],i=e[1];return t*t+i*i}function Da(e,t){e[0]=-t[0];e[1]=-t[1];return e}function Sa(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function Oa(e,t){var i=t[0],n=t[1];var r=i*i+n*n;if(r>0){r=1/Math.sqrt(r)}e[0]=t[0]*r;e[1]=t[1]*r;return e}function ya(e,t){return e[0]*t[0]+e[1]*t[1]}function wa(e,t,i){var n=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=n;return e}function Na(e,t,i,n){var r=t[0],a=t[1];e[0]=r+n*(i[0]-r);e[1]=a+n*(i[1]-a);return e}function Ma(e,t){t=t||1;var i=u()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function La(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r;e[1]=i[1]*n+i[3]*r;return e}function Ra(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r+i[4];e[1]=i[1]*n+i[3]*r+i[5];return e}function Pa(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[3]*r+i[6];e[1]=i[1]*n+i[4]*r+i[7];return e}function ka(e,t,i){var n=t[0];var r=t[1];e[0]=i[0]*n+i[4]*r+i[12];e[1]=i[1]*n+i[5]*r+i[13];return e}function Ua(e,t,i,n){var r=t[0]-i[0],a=t[1]-i[1],s=Math.sin(n),o=Math.cos(n);e[0]=r*o-a*s+i[0];e[1]=r*s+a*o+i[1];return e}function Va(e,t){var i=e[0],n=e[1],r=t[0],a=t[1];var s=i*i+n*n;if(s>0){s=1/Math.sqrt(s)}var o=r*r+a*a;if(o>0){o=1/Math.sqrt(o)}var l=(i*r+n*a)*s*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function Ga(e){e[0]=0;e[1]=0;return e}function ja(e){return"vec2("+e[0]+", "+e[1]+")"}function za(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ha(e,t){var i=e[0],n=e[1];var r=t[0],a=t[1];return Math.abs(i-r)<=M*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-a)<=M*Math.max(1,Math.abs(n),Math.abs(a))}var Wa=Ba;var Ya=ga;var Xa=pa;var Za=ma;var qa=xa;var Ka=Ta;var Qa=Ia;var Ja=function(){var l=e();return function(e,t,i,n,r,a){var s,o;if(!t){t=2}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(s=i;s<o;s+=t){l[0]=e[s];l[1]=e[s+1];r(l,l,a);e[s]=l[0];e[s+1]=l[1]}return e}}();class c{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new h.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let n="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)n="float";else if(i==2)n="vec2";else if(i==3)n="vec3";else if(i==4)n="vec4";const r={name:e,data:t,itemSize:i,type:n};this._attributes[e]=r}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,n){let r=P();if(t==undefined)t=1;if(i==undefined)i=1;if(n==undefined)n=1;for(let e=0;e<this.vertexNormals.length;e+=3){k(r,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);r[0]*=-t;r[1]*=-i;r[2]*=-n;V(r,r);this.vertexNormals[e+0]=r[0];this.vertexNormals[e+1]=r[1];this.vertexNormals[e+2]=r[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const n=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+n;this.vertices=A.utils.float32Concat(this._vertices,t.vertices);this.texCoords=A.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=A.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=A.utils.float32Concat(this.tangents,t.tangents);this.biTangents=A.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new c(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=P();const n=P();const r=P();function a(e){U(i,e[0],e[1]);U(n,e[0],e[2]);j(r,i,n);V(r,r);if(t&&t.forceZUp){if(r[2]<0){r[0]*=-1;r[1]*=-1;r[2]*=-1}}return r}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const s=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=a(o);s.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=s}else{const u=[];u.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];u[e/3]=a(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=u[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const h=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];V(h,h);this.vertexNormals[this.verticesIndices[t+e]*3+0]=h[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=h[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=h[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const E=this.vertices.length/3*2;this.texCoords=new Float32Array(E);for(let e=0;e<E;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const n=[];n.length=i*2;const r=P();const a=P();const s=P();const o=e();const l=e();const u=e();const h=P();const c=P();for(let e=0;e<t;e+=1){const F=this.verticesIndices[e*3];const A=this.verticesIndices[e*3+1];const C=this.verticesIndices[e*3+2];k(r,this.vertices[F*3],this.vertices[F*3+1],this.vertices[F*3+2]);k(a,this.vertices[A*3],this.vertices[A*3+1],this.vertices[A*3+2]);k(s,this.vertices[C*3],this.vertices[C*3+1],this.vertices[C*3+2]);z(o,this.texCoords[F*2],this.texCoords[F*2+1]);z(l,this.texCoords[A*2],this.texCoords[A*2+1]);z(u,this.texCoords[C*2],this.texCoords[C*2+1]);const x=a[0]-r[0];const T=s[0]-r[0];const B=a[1]-r[1];const I=s[1]-r[1];const D=a[2]-r[2];const S=s[2]-r[2];const O=l[0]-o[0];const y=u[0]-o[0];const w=l[1]-o[1];const N=u[1]-o[1];const M=1/(O*N-y*w);k(h,(N*x-w*T)*M,(N*B-w*I)*M,(N*D-w*S)*M);k(c,(O*T-y*x)*M,(O*I-y*B)*M,(O*S-y*D)*M);n[F]=h;n[A]=h;n[C]=h;n[F+i]=c;n[A+i]=c;n[C+i]=c}const f=P();const d=P();const g=P();const p=P();const m=P();const _=P();const b=P();const v=P();for(let e=0;e<i;e+=1){if(!n[e])continue;k(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);k(d,n[e][0],n[e][1],n[e][2]);const L=G(f,d);Ti(m,f,L);U(_,d,m);V(v,_);j(b,f,d);const R=1;Ti(g,v,1/R);j(p,f,g);this.tangents[e*3+0]=g[0];this.tangents[e*3+1]=g[1];this.tangents[e*3+2]=g[2];this.biTangents[e*3+0]=p[0];this.biTangents[e*3+1]=p[1];this.biTangents[e*3+2]=p[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const n=[];let r=0;for(let e in this._attributes){const a=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(a.itemSize==3)i.push(a.data[this.verticesIndices[t+e]*3+0],a.data[this.verticesIndices[t+e]*3+1],a.data[this.verticesIndices[t+e]*3+2]);else if(a.itemSize==4)i.push(a.data[this.verticesIndices[t+e]*4+0],a.data[this.verticesIndices[t+e]*4+1],a.data[this.verticesIndices[t+e]*4+2],a.data[this.verticesIndices[t+e]*4+3]);else if(a.itemSize==2)i.push(a.data[this.verticesIndices[t+e]*2+0],a.data[this.verticesIndices[t+e]*2+1]);else if(a.itemSize==1)i.push(a.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",a)}}this.setAttribute(a.name,i,a.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);n.push(r);r++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=n;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new i(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let n=0;const r=this.getBounds();const a=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(n=0;n<this.vertices.length;n+=3){if(this.vertices[n+0]==this.vertices[n+0]){if(e)this.vertices[n+0]-=a[0];if(t)this.vertices[n+1]-=a[1];if(i)this.vertices[n+2]-=a[2]}}return a}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const n=this.vertices[e*3+0];const r=this.vertices[e*3+1];this.texCoords[e*2+0]=n/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-r/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}c.buildFromFaces=function(t,e,i){const n=[];const r=[];for(let e=0;e<t.length;e+=3){const s=t[e+0];const o=t[e+1];const l=t[e+2];const u=[-1,-1,-1];if(i)for(let e=0;e<n.length;e+=3){if(n[e+0]==s[0]&&n[e+1]==s[1]&&n[e+2]==s[2])u[0]=e/3;if(n[e+0]==o[0]&&n[e+1]==o[1]&&n[e+2]==o[2])u[1]=e/3;if(n[e+0]==l[0]&&n[e+1]==l[1]&&n[e+2]==l[2])u[2]=e/3}if(u[0]==-1){n.push(s[0],s[1],s[2]);u[0]=(n.length-1)/3}if(u[1]==-1){n.push(o[0],o[1],o[2]);u[1]=(n.length-1)/3}if(u[2]==-1){n.push(l[0],l[1],l[2]);u[2]=(n.length-1)/3}r.push(u[0]);r.push(u[1]);r.push(u[2])}const a=new c(e);a.name=e;a.vertices=n;a.verticesIndices=r;return a};class i{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyBoundingBox(e){this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ);this.calcCenterSize()}applyGeom(t){if(!t)return;console.log("text",i.constructor,t);if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);else{console.error("not geom",typeof t,typeof CABLES.CG.BoundingBox,typeof i);this.applyBoundingBox(t)}this.calcCenterSize()}copy(){return new i(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!A.utils.isNumeric(e)||!A.utils.isNumeric(t)||!A.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}Ri(this._max,this._max,e);Ri(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();r(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class $a{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new h.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(e,t,i=false){if(this._oldWidthRp!=e*this.pixelDensity||this._oldHeightRp!=t*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=e*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=t*this.pixelDensity;if(!i){this.canvasEle.style.width=e+"px";this.canvasEle.style.height=t+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class es extends h.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,A.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,A.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,A.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,A.now)()}}class s{constructor(){this._arr=[n()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const e=n();this._arr.push(e)}Bt(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class ts{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute={};this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){for(const e in this.counts)this.counts[e]=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t=1){this.counts[e]=this.counts[e]||0;this.counts[e]+=t}getCount(e){return this.counts[e]}addHeavyEvent(e,t,i){const n={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(n);this._cgl.emitEvent("heavyEvent",n)}}class is extends h.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";#patch=null;gApi=0;_textureslots=[];_pMatrixStack=new s;_mMatrixStack=new s;_vMatrixStack=new s;canvasScale=1;constructor(e){super();this._log=new h.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new es;this._identView=P();this._ident=P();k(this._identView,0,0,-2);k(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new ts(this);this.pMatrix=n();this.mMatrix=n();this.vMatrix=n();C(this.mMatrix);C(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new $a({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;$t(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);C(this.mMatrix);C(this.vMatrix);r(this.mMatrix,this.mMatrix,e);r(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,n){console.log("no screenshot function implemented")}saveScreenshot(i,n,e,t,r){this.patch.renderOneFrame();let a=this.canvas.clientWidth*this.pixelDensity;let s=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;a=e}if(t){this.canvas.height=t;s=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const u="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+u+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=a;this.canvas.height=s;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(n)n(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}class ns extends h.Events{id=A.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=A.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=A.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=A.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}class rs{constructor(e,t,i,n,r,a,s,o,l,u){this._log=new h.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=u;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof n=="object"&&n instanceof A.Port){this._port=n;this._value=this._port.get();if(r&&a&&s){if(!(r instanceof A.Port)||!(a instanceof A.Port)||!(s instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=r;this._port3=a;this._port4=s;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(r&&a){if(!(r instanceof A.Port)||!(a instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=r;this._port3=a;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(r){if(!(r instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=r;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=n;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class as{_name="unknown";constructor(){}}const ss=8;class d{constructor(e={}){this.id=A.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||d.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=ss;if(!e.height)e.height=ss}}d.getDefaultTextureData=(e,a,s={})=>{if(e=="empty"){return new Uint8Array(a*a*4).fill(0)}else if(e=="color"){const r=new Uint8Array(a*a*4);let t=s.r||1;let i=s.g||1;let n=s.b||1;for(let e=0;e<a*a;e++){r[e*4+0]=t;r[e*4+1]=i;r[e*4+2]=n;r[e*4+3]=255}return r}else if(e=="randomUInt"){const r=new Uint8Array(a*a*4);for(let e=0;e<a*a;e++){r[e*4+0]=Math.random()*255;r[e*4+1]=Math.random()*255;r[e*4+2]=Math.random()*255;r[e*4+3]=255}return r}else if(e=="random"||e=="randomFloat"){const r=new Float32Array(a*a*4);for(let e=0;e<a*a;e++){r[e*4+0]=(Math.random()-.5)*2;r[e*4+1]=(Math.random()-.5)*2;r[e*4+2]=(Math.random()-.5)*2;r[e*4+3]=1}return r}else if(e=="stripes"){const o=[];let i=s.r;let n=s.g;let r=s.b;if(i===undefined)i=1;if(n===undefined)n=1;if(r===undefined)r=1;for(let t=0;t<a;t++){for(let e=0;e<a;e++){if((e+t)%64<32){o.push((200+t/a*25+e/a*25)*i);o.push((200+t/a*25+e/a*25)*n);o.push((200+t/a*25+e/a*25)*r)}else{o.push((40+t/a*25+e/a*25)*i);o.push((40+t/a*25+e/a*25)*n);o.push((40+t/a*25+e/a*25)*r)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return d.getDefaultTextureData("stripes",a,{r:1,g:0,b:0})}};d.FILTER_NEAREST=0;d.FILTER_LINEAR=1;d.FILTER_MIPMAP=2;d.WRAP_REPEAT=0;d.WRAP_MIRRORED_REPEAT=1;d.WRAP_CLAMP_TO_EDGE=2;d.TYPE_DEFAULT=0;d.TYPE_DEPTH=1;d.TYPE_FLOAT=2;d.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";d.PFORMATSTR_R8UB="R 8bit ubyte";d.PFORMATSTR_RG8UB="RG 8bit ubyte";d.PFORMATSTR_RGB8UB="RGB 8bit ubyte";d.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";d.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";d.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";d.PFORMATSTR_R16F="R 16bit float";d.PFORMATSTR_RG16F="RG 16bit float";d.PFORMATSTR_RGB16F="RGB 16bit float";d.PFORMATSTR_RGBA16F="RGBA 16bit float";d.PFORMATSTR_R32F="R 32bit float";d.PFORMATSTR_RG32F="RG 32bit float";d.PFORMATSTR_RGB32F="RGB 32bit float";d.PFORMATSTR_RGBA32F="RGBA 32bit float";d.PFORMATSTR_DEPTH="DEPTH";d.PIXELFORMATS=[d.PFORMATSTR_RGB565,d.PFORMATSTR_R8UB,d.PFORMATSTR_RG8UB,d.PFORMATSTR_RGB8UB,d.PFORMATSTR_RGBA8UB,d.PFORMATSTR_SRGBA8,d.PFORMATSTR_R11FG11FB10F,d.PFORMATSTR_R16F,d.PFORMATSTR_RG16F,d.PFORMATSTR_RGBA16F,d.PFORMATSTR_R32F,d.PFORMATSTR_RGBA32F];const os={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const ls={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const us=180/Math.PI;const hs=Math.PI/180;const g={MATH:{DEG2RAD:hs,RAD2DEG:us},SHADER:os,BLEND_MODES:ls};const x="\n";const cs={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:c,BoundingBox:i,FpsCounter:es,CgCanvas:$a};window.CABLES=window.CABLES||{};window.CABLES.CG={...cs,...window.CABLES.CG};window.CG={...cs,...window.CABLES.CG,...window.CG};window.glMatrix=D;window.mat2=S;window.mat2d=O;window.mat3=y;window.mat4=w;window.quat=R;window.quat2=H;window.vec2=W;window.vec3=N;window.vec4=L;class p extends rs{constructor(e,t,i,n,r,a,s,o,l,u){super(e,t,i,n,r,a,s,o,l,u);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new p(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return p.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.count("uniformUpdate")}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.count("uniformUpdate")}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.count("uniformUpdate")}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.count("uniformUpdate")}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.count("uniformUpdate")}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.count("uniformUpdate")}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.count("uniformUpdate")}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.count("uniformUpdate")}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.count("uniformUpdate")}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.count("uniformGet");this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.count("uniformUpdate");this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}p.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const T={};T.lastMesh=null;class m extends as{#log=new h.Logger("cgl_mesh");#cgl=null;#geom=null;#bufVerticesIndizes=null;#indexType;_attributes=[];_attribLocs={};_lastShader=null;_numInstances=0;_preWireframeGeom=null;addVertexNumbers=false;feedBackAttributes=[];_feedBacks=[];_feedBacksChanged=false;_transformFeedBackLoc=-1;_lastAttrUpdate=0;memFreed=false;_queryExt=null;constructor(e,t,i={}){super();this.#cgl=e;let n=i||{};if(A.utils.isNumeric(n))n={glPrimitive:i};this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this.#indexType=this.#cgl.gl.UNSIGNED_SHORT;this._glPrimitive=n.glPrimitive||null;this.opId=n.opId||"";this.setGeom(t);this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name)}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,n,r){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:n,offset:r,instanced:t==g.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,n){if(!e)return;if(!i&&!n)return;if(!e.name)this.#log.stack("no attrname?!");const r=this.#cgl.gl;r.bindBuffer(r.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=n-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=n-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(n>t.length&&!this.warned){this.warned=true;this.#log.warn(this.#cgl.canvas.id+"'"+e.name+"' buffersubdata out of bounds ?",t.length,n,i,e);return}r.bufferSubData(r.ARRAY_BUFFER,i*4,t,i,n-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame)console.log("_bufferArray",e.length,t.name);if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,n){this.setAttribute(e,t,i,n)}setAttribute(e,t,i,n={}){if(!t){this.#log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=null;let a=false;let s=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof n=="function"){r=n}if(typeof n=="object"){if(n.cb)r=n.cb;if(n.instanced)a=n.instanced}if(e==g.SHADER.SHADERVAR_INSTANCE_MMATRIX)a=true;for(s=0;s<this._attributes.length;s++){const h=this._attributes[s];if(h.name==e){if(h.numItems===o){}else{this._resizeAttr(t,h)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,h.buffer);this._bufferArray(t,h);return h}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let u=this.#cgl.gl.FLOAT;if(n&&n.type)u=n.type;const h={buffer:l,name:e,cb:r,itemSize:i,numItems:o,startItem:0,instanced:a,type:u};this._bufferArray(t,h);if(e==g.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=h;this._attributes.push(h);this._attribLocs={};return h}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new p(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this.#log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this.#log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this.#log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this.#indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this.#indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this.#indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;T.lastMesh=null;this.#cgl.profileData.count("meshSetGeom");this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const n={texCoords:g.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:g.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:g.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const r in i)if(i[r].data&&i[r].data.length)this.setAttribute(n[r]||r,i[r].data,i[r].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(i[e]==-1){if(n._attrLocationLastShaderTime!=t.lastCompile){n._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,n.buffer);if(n.instanced){if(n.itemSize<=4){if(!n.itemSize||n.itemSize==0)this.#log.warn("instanced attrib itemsize error",this.#geom.name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(n.itemSize==16){const r=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,n.type,false,r,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,n.type,false,r,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,n.type,false,r,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,n.type,false,r,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this.#log.warn("unknown instance attrib size",n.name)}}else{if(!n.itemSize||n.itemSize==0)this.#log.warn("attrib itemsize error",this._name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);if(n.pointer){for(let e=0;e<n.pointer.length;e++){const a=n.pointer[e];if(a.loc==-1){a.loc=this.#cgl.glGetAttribLocation(t.getProgram(),a.name)}if(a.loc>-1){this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(a.loc);this.#cgl.gl.vertexAttribPointer(a.loc,n.itemSize,n.type,false,a.stride,a.offset)}}}if(this.bindFeedback)this.bindFeedback(n)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;T.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(T.lastMesh!=this){if(T.lastMesh)T.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();T.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==null)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let n=1;let r=this.#cgl.profileData.doProfileGlQuery;let a=false;if(r){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const s=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(s){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);a=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this.#indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this.#indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame){if(this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this.#log.error("mesh draw gl error");this.#log.error("mesh",this);this.#log.error("shader",i);const u=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const h=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this.#log.error("attrib ",h)}}}this.#cgl.profileData.count("glprimitives",this._bufVertexAttrib.numItems/n*(this._numInstances||1));this.#cgl.profileData.count("meshDrawCalls");if(r&&a){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(g.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const b={};b.getSimpleRect=function(e,t,i=1){const n=new c(t);n.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];n.texCoords=[1,1,0,1,1,0,0,0];n.verticesIndices=[0,1,2,2,1,3];n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(n)};b.getSimpleCube=function(e,t){const i=new c(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new m(e,i)};class v{constructor(e,t){this._cgl=e;this._log=new h.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new F(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.count("textureEffect");if(this._textureTarget.filter==F.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=b.getSimpleRect(this._cgl,"texEffectRect")}}v.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};v.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};v.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};v.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};v.AddBlendSelect=function(e,t,i){const n=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return n};v.AddBlendAlphaMask=function(e,t,i){const n=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return n};v.setupBlending=function(i,n,r,e,a){const t=()=>{let e=false;if(a)e=a.get()=="On";v.onChangeBlendSelect(n,r.get(),e);let t=r.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[r,e,a]);let s=false;r.onChange=t;if(a){a.onChange=t;s=a.get()=="On"}v.onChangeBlendSelect(n,r.get(),s)};const fs={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=v.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=v.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new p(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){F.getRandomTexture(e);e.setTexture(7,F.getRandomTexture(e).tex)}}};const ds="{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n";let gs=0;function B(){return ds}function I(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+x+"IN vec2 texCoord;"+x+"{{MODULES_HEAD}}"+x+"void main()"+x+"{"+x+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+x+"    {{MODULE_COLOR}}"+x+"    outColor = col;"+x+"}"}class E extends ns{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new h.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++gs;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=B();this.srcFrag=I();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=n();this._tempCamPosMatrix=n();this._tempInverseViewMatrix=n();this._tempInverseProjMatrix=n();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new E(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in fs){if(e.includes(t)){const i=new fs[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let n="";let r="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const a="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const s="struct "+this._uniforms[i]._structName+" {"+x+a+"};"+x+x;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")n=n.concat(s);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")r=r.concat(s);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(a);const l=r.lastIndexOf(a);n=n.slice(0,o)+t+n.slice(o-1);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(a);n=n.slice(0,o)+t+n.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=r.lastIndexOf(a);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsFrag.includes(i)){const a="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(a,"");n+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsVert.includes(i)){const a="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(a,"");r+=i;this._uniDeclarationsVert.push(i)}}return[r,n]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+x;i.srcHeadVert+="#define ATTRIB_"+e.name+x;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+x;if(!t)i.srcHeadVert+="#endif"+x;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadVert+="#endif"+x;i.srcVert=""+x+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadFrag+="#endif"+x}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.count("shaderCompile");this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+x;let i="";if(this._defines.length)i="\n// cgl generated"+x;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+x;const n=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const m=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=m.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+x;let r="";let a="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=B();this.srcFrag=I()}r="#version 300 es"+x+"// "+x+"// vertex shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define UNI uniform"+x+"#define IN in"+x+"#define OUT out"+x;a="#version 300 es"+x+"// "+x+"// fragment shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define IN in"+x+"#define OUT out"+x+"#define UNI uniform"+x+"{{DRAWBUFFER}}"+x;let s="\n// cgl generated"+x;let o="\n// cgl generated"+x;a+="\n// active mods: --------------- ";r+="\n// active mods: --------------- ";let l=false;let u=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;a+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";u=true}}}}if(!u)a+="\n// no mods used...";if(!l)a+="\n// no mods used...";a+="\n";r+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))s+=e+";"+t+x;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+x}}let h=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")h++}}if(h>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+h+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!a.includes("precision"))a="precision "+this.precision+" float;"+x+a;if(!r.includes("precision"))r="precision "+this.precision+" float;"+x+r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){a+="#define MOBILE"+x;r+="#define MOBILE"+x}r=t+r+i+n[0]+s+"\n// -- \n"+this.srcVert;a=t+a+i+n[1]+o+"\n// -- \n"+this.srcFrag;let f="";let d="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let g=false;for(let n=0;n<this._moduleNames.length;n++){let t="";let i="";if(!g){g=true;for(let e=0;e<this._attributes.length;e++){const E=this._getAttrSrc(this._attributes[e],true);if(E.srcHeadVert)f+=E.srcHeadVert;if(E.srcVert)t+=E.srcVert;if(E.srcHeadFrag)d+=E.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const F=this._modules[e];if(F.name==this._moduleNames[n]){f+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";d+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";t+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";i+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";if(F.attributes)for(let e=0;e<F.attributes.length;e++){const E=this._getAttrSrc(F.attributes[e],false);if(E.srcHeadVert)f+=E.srcHeadVert;if(E.srcVert)t+=E.srcVert;if(E.srcHeadFrag)d+=E.srcHeadFrag}f+=F.srcHeadVert||"";d+=F.srcHeadFrag||"";t+=F.srcBodyVert||"";i+=F.srcBodyFrag||"";f+="\n//---- end mod ------\n";d+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,F.prefix);i=i.replace(/{{mod}}/g,F.prefix);f=f.replace(/{{mod}}/g,F.prefix);d=d.replace(/{{mod}}/g,F.prefix);t=t.replace(/MOD_/g,F.prefix);i=i.replace(/MOD_/g,F.prefix);f=f.replace(/MOD_/g,F.prefix);d=d.replace(/MOD_/g,F.prefix)}}r=r.replace("{{"+this._moduleNames[n]+"}}",t);a=a.replace("{{"+this._moduleNames[n]+"}}",i)}r=r.replace("{{MODULES_HEAD}}",f);a=a.replace("{{MODULES_HEAD}}",d);r=this._addLibs(r);a=this._addLibs(a);let p="";for(let e=0;e<16;e++)if(a.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){p="out vec4 outColor;"+x;p+="#define gl_FragColor outColor"+x}else{p+="#define MULTI_COLORTARGETS"+x;p+="vec4 outColor;"+x;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)p+="#define gl_FragColor outColor"+e+""+x;p+="layout(location = "+e+") out vec4 outColor"+e+";"+x;t++}}a=a.replace("{{DRAWBUFFER}}",p);if(!this._program){this._program=this._createProgram(r,a)}else{this._program=this._createProgram(r,a);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=a;this.finalShaderVert=r;T.lastMesh=null;T.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,A.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;T.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,g.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.count("shaderBinds");this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.count("mvpMatrixCount")}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.count("mvpMatrixCount");this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){t(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.count("mvpMatrixCount")}if(this._inverseProjMatrixUniform){t(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.count("mvpMatrixCount")}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.count("mvpMatrixCount");if(this._camPosUniform){t(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.count("mvpMatrixCount")}}else{const e=n();fi(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.count("mvpMatrixCount")}if(this._normalMatrixUniform){t(this._tempNormalMatrix,this._cgl.mMatrix);St(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.count("mvpMatrixCount")}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,n,r,a){const s=new p(this,e,t,i,n,r,a);s.shaderType="frag";return s}addUniformVert(e,t,i,n,r,a){const s=new p(this,e,t,i,n,r,a);s.shaderType="vert";return s}addUniformBoth(e,t,i,n,r,a){const s=new p(this,e,t,i,n,r,a);s.shaderType="both";return s}addUniformStructFrag(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const a=n[e];if(!this.hasUniform(i+"."+a.name)){const s=new p(this,a.type,i+"."+a.name,a.v1,a.v2,a.v3,a.v4,i,t,a.name);s.shaderType="frag";r[i+"."+a.name]=s}}return r}addUniformStructVert(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const a=n[e];if(!this.hasUniform(i+"."+a.name)){const s=new p(this,a.type,i+"."+a.name,a.v1,a.v2,a.v3,a.v4,i,t,a.name);s.shaderType="vert";r[i+"."+a.name]=s}}return r}addUniformStructBoth(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const a=n[e];if(a.type==="2i"||a.type==="i"||a.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",a.name," of type:",a.type,".");if(!this.hasUniform(i+"."+a.name)){const s=new p(this,a.type,i+"."+a.name,a.v1,a.v2,a.v3,a.v4,i,t,a.name);s.shaderType="both";r[i+"."+a.name]=s}}return r}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=E.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=E.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const n=this._cgl.gl.getShaderInfoLog(this.fshader);const r=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||F.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const n=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return n}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,n){return I(e,t,i,n)}getDefaultVertexShader(){return B()}}E.getDefaultVertexShader=B;E.getDefaultFragmentShader=I;E.getErrorFragmentShader=function(){return""+x+"void main()"+x+"{"+x+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+x+"   g= step(0.1,g);"+x+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+x+"}"};E.createShader=function(e,t,i,n){if(e.aborted)return;const r=e.gl.createShader(i);e.gl.shaderSource(r,t);e.gl.compileShader(r);if(!e.gl.getShaderParameter(r,e.gl.COMPILE_STATUS)){n.error={str:t,infoLog:e.gl.getShaderInfoLog(r)};if(CABLES.UI)gui.emitEvent("ShaderError",n);if(!n.error.infoLog){n._log.warn("empty shader info log",this._name);return}n.setSource(E.getDefaultVertexShader(),E.getErrorFragmentShader())}return r};class ps extends A.RenderLoop{#patch;#cgl;#renderOneFrame;#animReq;frameNum=0;onOneFrameRendered=null;_frameNext=0;_frameInterval=0;_lastFrameTime=0;reqAnimTimeStamp=0;_frameWasdelayed=true;aborted=false;constructor(e,t){super();this.#cgl=e;this.#patch=t;this.#patch.renderloop=this;this.exec(0)}exec(e){this.#patch.config.fpsLimit=this.#patch.config.fpsLimit||0;if(this.#patch.config.fpsLimit){this._frameInterval=1e3/this.#patch.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.#patch.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.#patch.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(A.Patch.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.#patch.config.doRequestAnimation){this.#animReq=this.#patch.getDocument().defaultView.requestAnimationFrame(this.exec.bind(this))}}renderFrame(e){const t=this.#patch.timer.getTime();const i=performance.now();this.#cgl.frameStartTime=this.#patch.timer.getTime();const n=e-this.reqAnimTimeStamp||e;this.#patch.updateAnims(null,n,e);this.#cgl.profileData.profileFrameDelta=n;this.reqAnimTimeStamp=e;this.#cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.#patch.emitEvent(A.Patch.EVENT_RENDER_FRAME,t);this.frameNum++;if(this.frameNum==1){if(this.#patch.config.onFirstFrameRendered)this.#patch.config.onFirstFrameRendered()}}pause(){cancelAnimationFrame(this.#animReq);this.#animReq=null;this.paused=true}resume(){cancelAnimationFrame(this.#animReq);this.paused=false;this.exec(0)}}const ms={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class _s extends is{#cursor="auto";frameStartTime=0;constructor(e){super(e);this.gApi=is.API_WEBGL;this.aborted=false;e.cgl=this;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new h.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new E(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(E.getDefaultVertexShader(),E.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null;this.setCanvas(e.config.glCanvasId||e.config.glCanvas||"glcanvas");if(e.config.glCanvasResizeToWindow===true)this.setAutoResize("window");if(e.config.glCanvasResizeToParent===true)this.setAutoResize("parent");if(this.aborted)e.aborted=true;e.on(A.Patch.EVENT_DISPOSE,()=>{this.dispose()});e.on("patchClearStart",()=>{this.TextureEffectMesh=null});this.renderLoop=new ps(this,e)}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.warn("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push(e,t,i,n);this.setViewPort(e,t,i,n)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,n){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(n);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,n){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(is.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(g.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e,t=true){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();if(t)e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(CABLES.UI&&CABLES.UI.showDevInfo&&!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;A.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=F.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let n=this.gl.getError();if(n!=this.gl.NO_ERROR){let e="";if(n==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(n==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(n==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(n==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(n==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(n==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(n==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,n,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}n=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==g.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);if(i==-1)this.profileData.count("invalidAttribLoc");return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==g.BLEND_MODES.BLEND_NONE){}else if(e==g.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==g.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(A.utils.isNumeric(t))t={glPrimitive:t};return new m(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new E(this,"errormaterial");this.errorShader.setSource(E.getDefaultVertexShader(),E.getErrorFragmentShader());return this.errorShader}}const bs=8;const vs=new h.Logger("cgl_texture");class F extends d{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new h.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=F.FILTER_NEAREST;this.wrap=F.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=F.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=F.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=F.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=F.PFORMATSTR_RGBA32F;if(this.textureType==F.TYPE_DEPTH)this.pixelFormat=F.PFORMATSTR_DEPTH;this._cgl.profileData.count("texturecreated");this.setFormat(F.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return F.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new F(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=bs;if(t!=t||t<=0||!t)t=bs;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(F.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.count("textureResize");const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,n,r){this.filter=n;this.wrap=r;if(n==undefined)this.filter=F.FILTER_LINEAR;if(r==undefined)this.wrap=F.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const a=CGL.Texture.getTempTexture(this._cgl);this.width=a.width;this.height=a.height;this.tex=a.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(F.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==F.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.count("textureGenMipMap")}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(F.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.count("textureDelete");this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return F.isPowerOfTwo(this.width)&&F.isPowerOfTwo(this.height)}printInfo(){vs.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===F.FILTER_NEAREST)e+=" nearest";if(this.filter===F.FILTER_LINEAR)e+=" linear";if(this.filter===F.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===F.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===F.WRAP_REPEAT)e+=" repeat";if(this.wrap===F.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return F.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==F.TYPE_FLOAT&&this.filter==F.FILTER_MIPMAP){this.filter=F.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=F.FILTER_NEAREST;this.wrap=F.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==F.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==F.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==F.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==F.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==F.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==F.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}F.load=function(i,n,r,e){if(!n)return r({error:true});let a=null;if(!i.patch.loading.existByName(n))a=i.patch.loading.start("cgl.texture",n);const s=new F(i);s.name=n;s.image=new Image;s.image.crossOrigin="anonymous";s.loading=true;if(e&&e.hasOwnProperty("filter"))s.filter=e.filter;if(e&&e.hasOwnProperty("flip"))s.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))s.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))s.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))s.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))s.pixelFormat=e.pixelFormat;s.image.onabort=s.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e);s.loading=false;if(a)i.patch.loading.finished(a);const t={error:true};if(r)r(t,s)};s.image.onload=function(e){i.addNextFrameOnceCallback(()=>{s.initTexture(s.image);if(a)i.patch.loading.finished(a);s.loading=false;if(r)r(null,s)})};s.image.src=n;return s};F.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=F.getTemporaryTexture(e,256,F.FILTER_LINEAR,F.REPEAT);return e.tempTexture};F.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=F.getTemporaryTexture(e,256,F.FILTER_LINEAR,F.REPEAT,1,.2,.2);return e.errorTexture};F.getEmptyTexture=function(e,t){if(t)return F.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new F(e,{name:"emptyTexture"});const n=F.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(n,i,i,F.FILTER_NEAREST,F.WRAP_REPEAT);return e.tempTextureEmpty};F.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new F(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,F.FILTER_NEAREST,F.WRAP_REPEAT);return e.tempTextureEmptyFloat};F.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=F.getDefaultTextureData("randomUInt",t);e.randomTexture=new F(e);e.randomTexture.initFromData(i,t,t,F.FILTER_NEAREST,F.WRAP_REPEAT);return e.randomTexture};F.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=F.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new F(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,F.FILTER_NEAREST,F.WRAP_REPEAT);return e.getRandomFloatTexture};F.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=F.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new F(e);e.blackTexture.initFromData(i,t,t,F.FILTER_NEAREST,F.WRAP_REPEAT);return e.blackTexture};F.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const n=t.gl.TEXTURE_CUBE_MAP;const r=F.FILTER_NEAREST;const a=F.WRAP_CLAMP_TO_EDGE;const s=8;const o=8;t.profileData.count("texturecreated");t.gl.bindTexture(n,e);t.profileData.count("textureResize");for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(n,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(n,null);return{id:A.utils.uuid(),tex:e,cubemap:e,width:s,height:o,filter:r,wrap:a,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};F.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return F.getTempTexture(e)};F.getTemporaryTexture=function(e,t,i,n,r,a,s){const o=F.getDefaultTextureData("stripes",256,{r:r,g:a,b:s});const l=new F(e);l.initFromData(o,t,t,i,n);return l};F.createFromImage=function(e,t,i){i=i||{};const n=new F(e,i);n.flip=false;n.image=t;n.width=t.videoWidth||t.width||8;n.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))n.wrap=i.wrap;n.initTexture(t,i.filter);return n};F.fromImage=function(e,t,i,n){console.error("deprecated texture from image...");const r=new F(e);r.flip=false;if(i)r.filter=i;if(n)r.wrap=n;r.image=t;r.initTexture(t);return r};F.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};F.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==F.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==F.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==F.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==F.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==F.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==F.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==F.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==F.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==F.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==F.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};F.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=F.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let n=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==F.PFORMATSTR_RGBA32F)t=F.PFORMATSTR_RGBA16F;if(t==F.PFORMATSTR_RG32F)t=F.PFORMATSTR_RG16F;if(t==F.PFORMATSTR_R32F)t=F.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const r=e.enableExtension("EXT_color_buffer_half_float");if(!r){console.warn("no 16bit extension, fallback to 32bit",t);if(t==F.PFORMATSTR_RGBA16F)t=F.PFORMATSTR_RGBA32F;if(t==F.PFORMATSTR_RGB16F)t=F.PFORMATSTR_RGB32F;if(t==F.PFORMATSTR_RG16F)t=F.PFORMATSTR_RG32F;if(t==F.PFORMATSTR_R16F)t=F.PFORMATSTR_R32F}else{n=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==F.PFORMATSTR_RGBA16F||t==F.PFORMATSTR_RG16F||t==F.PFORMATSTR_R16F){const a=e.enableExtension("OES_texture_half_float");if(!a)throw new Error("no half float texture extension");n=a.HALF_FLOAT_OES}}if(t==F.PFORMATSTR_RGBA8UB){}else if(t==F.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==F.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==F.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==F.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==F.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==F.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=n}else if(t==F.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=n;i.glDataFormat=e.gl.RED}else if(t==F.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=n;i.glDataFormat=e.gl.RG}else if(t==F.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=n}else if(t==F.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=n;i.glDataFormat=e.gl.RGB}else if(t==F.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=n}else if(t==F.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{vs.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==F.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=F.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)vs.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};F.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};F.isPixelFormatFloat=e=>{return(e||"").includes("float")};F.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};A.Op.prototype.outTexture=function(e,t){const i=this.addOutPort(this.newPort(this,e,A.Port.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||F.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i};class Es{constructor(t,e,i,n){this._log=new h.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=n||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=F.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=F.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!n.pixelFormat){if(n.isFloatingPointTexture)this._options.pixelFormat=F.PFORMATSTR_RGBA32F;else this._options.pixelFormat=F.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new F(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let r=F.FILTER_NEAREST;if(this._options.shadowMap)r=F.FILTER_LINEAR;const a=512;if(this._options.depth){this._textureDepth=new F(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:r,shadowMap:this._options.shadowMap||false,width:e||a,height:i||a})}if(t.aborted)return;this.setSize(e||a,i||a);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const n=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const s=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,s);const o=F.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=F.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=F.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,s);this._colorRenderbuffers[i]=s}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)r=this._cgl.gl.DEPTH_COMPONENT16;if(n){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const a=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(a!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(a){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",a,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+a)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.count("framebufferBlit");if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==F.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const Fs=function(e){this.draw=function(e,t,i){}};const As=function(e){this.render=function(e,t){}};const Cs=function(e){this.render=function(e,t,i,n){}};class xs{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,n){this.coloruni.set(e,t,i,n)}}const Ts=Math.PI/180;const Bs=180/Math.PI;const Is=null;const Ds=window.navigator.userAgent.includes("Windows");const Ss=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(Ds)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const n=e||t.detail;i=-(n%3?n*10:n/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const Os=Ss;const ys=Ss;const ws={Framebuffer2:Es,Geometry:c,BoundingBox:i,Marker:Fs,WirePoint:As,WireCube:Cs,MatrixStack:s,Mesh:m,MESH:T,ShaderLibMods:fs,Shader:E,Uniform:p,MESHES:b,getWheelSpeed:Os,getWheelDelta:ys,Context:_s,Texture:F,TextureEffect:v,onLoadingAssetsFinished:Is,ProfileData:ts,UniColorShader:xs,...g.BLEND_MODES,...g.SHADER,...g.MATH,...g.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL={...ws,...window.CABLES.CGL};window.CGL={...ws,...window.CABLES.CGL,...window.CGL};window.addEventListener(A.Patch.EVENT_INIT_CGL,e=>{const t=e?.detail;if(!t||t.tempData.cglInitialized&&!CABLES.UI)return;t.tempData.cglInitialized=true;const i=new _s(t)});A.Anim.slerpQuaternion=function(e,t,i,n,r,a){if(!A.Anim.slerpQuaternion.q1){A.Anim.slerpQuaternion.q1=quat.create();A.Anim.slerpQuaternion.q2=quat.create()}const s=i.getKeyIndex(e);let o=s+1;if(o>=i.keys.length)o=i.keys.length-1;if(s==o){quat.set(t,i.keys[s].value,n.keys[s].value,r.keys[s].value,a.keys[s].value)}else{const l=i.keys[s].time;const u=i.keys[o].time;const h=(e-l)/(u-l);quat.set(A.Anim.slerpQuaternion.q1,i.keys[s].value,n.keys[s].value,r.keys[s].value,a.keys[s].value);quat.set(A.Anim.slerpQuaternion.q2,i.keys[o].value,n.keys[o].value,r.keys[o].value,a.keys[o].value);quat.slerp(t,A.Anim.slerpQuaternion.q1,A.Anim.slerpQuaternion.q2,h)}return t}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in Ms)e[t]=Ms[t];if(Ms.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{VarGetOpWrapper:()=>t,VarSetOpWrapper:()=>e});const s=CABLES;class e{constructor(t,e,i,n,r,a){this._valuePort=i;this._varNamePort=n;this._op=t;this._type=e;this._typeId=-1;this._triggerPort=r;this._nextPort=a;this._var=null;this._btnCreate=t.inTriggerButton("Create new variable");this._btnCreate.setUiAttribs({hidePort:true});this._btnCreate.onTriggered=this._createVar.bind(this);this._helper=t.inUiTriggerButtons("",["Rename"]);this._helper.setUiAttribs({hidePort:true});this._helper.onTriggered=e=>{CABLES.CMD.PATCH.renameVariable(t.varName.get())};this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]);n.setUiAttribs({_variableSelect:true});this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this));this._op.patch.addEventListener("variableRename",this._renameVar.bind(this));this._varNamePort.onChange=this._updateName.bind(this);this._isTexture=this._valuePort.uiAttribs.objType==="texture";this._valuePort.changeAlways=true;if(this._triggerPort){this._triggerPort.onTriggered=()=>{this._setVarValue(true)}}else{this._valuePort.onChange=this._setVarValue.bind(this)}this._op.init=()=>{this._updateName();if(!this._triggerPort)this._setVarValue();this._updateErrorUi()};if(e=="array")this._typeId=s.Port.TYPE_ARRAY;else if(e=="object")this._typeId=s.Port.TYPE_OBJECT;else if(e=="string")this._typeId=s.Port.TYPE_STRING;else if(e=="texture")this._typeId=s.Port.TYPE_TEXTURE;else this._typeId=s.Port.TYPE_VALUE}_updateErrorUi(){if(CABLES.UI){if(!this._varNamePort.get())this._op.setUiError("novarname","no variable selected");else{if(this._op.hasUiErrors)this._op.setUiError("novarname",null)}}}_updateName(){this._var=null;const e=this._varNamePort.get();this._op.setTitle("var set");this._op.setUiAttrib({extendTitle:"#"+e});this._updateErrorUi();const t=this._op.patch.getVar(e);if(t&&!t.type)t.type=this._type;if(!this._op.patch.hasVar(e)&&e!=0&&!this._triggerPort){this._setVarValue()}if(!this._op.patch.hasVar(e)&&e!=0&&this._triggerPort){if(this._type=="string")this._op.patch.setVarValue(e,"");else if(this._type=="number")this._op.patch.setVarValue(e,"");else this._op.patch.setVarValue(e,null)}if(this._op.isCurrentUiOp()){this._updateVarNamesDropdown();this._op.refreshParams()}this._updateDisplay();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded&&CABLES.UI.loaded){const e=gui.uiProfiler.start("[vars] _updateVarNamesDropdown");const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._varNamePort.uiAttribs.values=t;e.finish()}}_renameVar(e,t){if(e!=this._varNamePort.get())return;this._varNamePort.set(t);this._updateName()}_setVarValue(e){let t=this._valuePort.get();if(!this._var){const i=this._varNamePort.get();if(!i)return;if(this._typeId==s.Port.TYPE_VALUE&&typeof t=="string")t=parseFloat(t);this._op.patch.setVarValue(i,t,this._type);this._var=this._op.patch.getVar(i)}if(this._typeId==s.Port.TYPE_VALUE||this._typeId==s.Port.TYPE_STRING){this._var.setValue(t)}else if(this._typeId==s.Port.TYPE_ARRAY){this._arr=[];s.utils.copyArray(t,this._arr);this._var.setValue(this._arr)}else{if(this._typeId==s.Port.TYPE_OBJECT){if(this._isTexture)this._var.setValue(CGL.Texture.getEmptyTexture(this._op.patch.cgl));else this._var.setValue(null);if(t&&t.tex&&t._cgl&&!this._isTexture)this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture");else this._op.setUiError("texobj",null)}this._var.setValue(t)}if(e&&this._nextPort)this._nextPort.trigger()}}class t{constructor(e,t,i,n){this._op=e;this._type=t;this._varnamePort=i;this._variable=null;this._valueOutPort=n;this._listenerId=null;this._typeId=0;if(t=="array")this._typeId=s.Port.TYPE_ARRAY;else if(t=="object")this._typeId=s.Port.TYPE_OBJECT;else if(t=="texture")this._typeId=s.Port.TYPE_TEXTURE;else if(t=="string")this._typeId=s.Port.TYPE_STRING;else this._typeId=s.Port.TYPE_VALUE;if(n)this._isTexture=n.uiAttribs.objType==="texture";this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.on("uiErrorChange",this._updateTitle.bind(this));this._op.patch.on("variableRename",this._renameVar.bind(this));this._op.patch.on("variableDeleted",e=>{if(this._op.isCurrentUiOp())this._op.refreshParams()});i.setUiAttribs({_variableSelect:true});i.setUiAttribs({_variableSelectGet:true});this._varnamePort.onChange=this._changeVar.bind(this);this._op.patch.addEventListener("variablesChanged",this._init.bind(this));this._op.onDelete=()=>{if(this._variable&&this._listenerId)this._variable.off(this._listenerId)};this._op.init=()=>{this._init()}}get variable(){return this._variable}_changeVar(){if(this._variable&&this._listenerId){this._variable.off(this._listenerId)}this._init()}_renameVar(e,t){if(e!=this._varnamePort.get())return;this._varnamePort.set(t);if(!this._variable){console.log("rename has no var",e,t);this._init();if(!this._variable)return console.error("variable rename not found",e,t,this)}this._updateVarNamesDropdown();this._updateTitle();this._listenerId=this._variable.on("change",this._setValueOut.bind(this))}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded){const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._op.varName.uiAttribs.values=t}}_setValueOut(e){if(this._valueOutPort)if(this._typeId==s.Port.TYPE_NUMBER||this._typeId==s.Port.TYPE_STRING)this._valueOutPort.set(e);else if(this._typeId==s.Port.TYPE_ARRAY||this._typeId==s.Port.TYPE_OBJECT||this._isTexture)this._valueOutPort.setRef(e);else console.log("unkown type?")}_updateTitle(){if(this._variable){this._op.setUiError("unknownvar",null);this._op.setTitle("var get");this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()});if(this._valueOutPort)this._setValueOut(this._variable.getValue())}else{this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")");this._op.setUiAttrib({extendTitle:"#invalid"});if(this._valueOutPort)this._setValueOut(0)}}_init(){this._updateVarNamesDropdown();if(this._variable&&this._listenerId)this._variable.off(this._listenerId);this._variable=this._op.patch.getVar(this._op.varName.get());if(this._variable)this._listenerId=this._variable.on("change",this._setValueOut.bind(this));this._updateTitle();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{PixelReader:()=>t});const e=CABLES.SHARED;class t{constructor(){this._log=new e.Logger("LoadingStatus");this.pixelData=null;this._finishedFence=true;this._size=0;this._pbo=null}_fence(a){const s=a.gl;this._finishedFence=false;return new Promise(function(t,i){if(a.aborted)return;let n=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);if(!n)return;s.flush();function r(){if(a.aborted)return;const e=s.clientWaitSync(n,0,0);if(e==s.WAIT_FAILED){console.error("fence wait failed");if(i)i()}else if(e==s.TIMEOUT_EXPIRED){return setTimeout(r,0)}else if(e==s.CONDITION_SATISFIED){t();s.deleteSync(n)}else if(e==s.ALREADY_SIGNALED){t();s.deleteSync(n)}else{this._log.log("unknown fence status",e)}}r()})}read(i,n,e,r,a,s,o,t){if(CABLES.UI)if(!CABLES.UI.loaded||performance.now()-CABLES.UI.loadedTime<1e3)return;if(!this._finishedFence)return;const l=i.gl;let u=1;if(i.aborted)return;if(!n)return;if(e===CGL.Texture.TYPE_FLOAT)e=CGL.Texture.PFORMATSTR_RGBA32F;let h=CGL.Texture.isPixelFormatFloat(e);if(h)u=4;if(CGL.Texture.isPixelFormatHalfFloat(e))u=2;const c=CGL.Texture.setUpGlPixelFormat(i,e);const f=c.numColorChannels*s*o;if(s==0||o==0||f==0)return;if(!this._pixelData||this._size!=f*u){if(u>1)this._pixelData=new Float32Array(f);else this._pixelData=new Uint8Array(f);this._size=f*u}let d=l.UNSIGNED_BYTE;if(u>1)d=l.FLOAT;if(this._size==0||!this._pixelData){this._log.error("readpixel size 0",this._size,s,o);return}if(this._finishedFence){this._pbo=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.bufferData(l.PIXEL_PACK_BUFFER,this._pixelData.byteLength,l.DYNAMIC_READ);l.bindFramebuffer(l.FRAMEBUFFER,n);l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);i.profileData.count("textureFencedPixelRead");if(this._size!=f*u)this._log.error("buffer size invalid",f,s,o,u);let e=c.glDataType;if(u>1)e=i.gl.FLOAT;let t=c.glDataFormat;l.readPixels(r,a,s,o,t,e,0);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null)}let g=this._pixelData.byteLength;if(this._finishedFence&&this._pbo)this._fence(i).then(e=>{this._wasTriggered=false;this._finishedFence=true;if(!e&&this._pixelData&&this._pixelData.byteLength==g){l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._pixelData);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);if(t)t(this._pixelData)}l.deleteBuffer(this._pbo);this._pbo=null});return true}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();